---
phase: 33-navigation-issues-fix
plan: 01
type: execute
---

<objective>
Fix comments sheet persistence during profile navigation (ISS-004) and add swipe-up gesture to open comments (ISS-005).

Purpose: Create seamless comment interaction that persists across navigation and provides intuitive gesture access.
Output: Comments sheet that survives profile navigation and responds to swipe-up gesture on photo.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/33-navigation-issues-fix/33-CONTEXT.md

**From Phase 15.3 (Modal Architecture):**

- PhotoDetailScreen uses transparentModal presentation (navigation-based, not Modal component)
- PhotoDetailContext stores showComments state to persist across navigation
- ISS-004 root cause: React Native Modal component inside transparentModal screen gets dismissed when another fullScreenModal (OtherUserProfile) is pushed

**Key files:**
@src/components/comments/CommentsBottomSheet.js
@src/context/PhotoDetailContext.js
@src/screens/PhotoDetailScreen.js
@src/hooks/usePhotoDetailModal.js
@src/styles/CommentsBottomSheet.styles.js

**Tech stack:** React Native, Animated, PanResponder, expo-haptics
**Patterns established:** Navigation over Modal for complex overlays, context state for cross-navigation persistence
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert CommentsBottomSheet from Modal to Animated.View</name>
  <files>src/components/comments/CommentsBottomSheet.js, src/styles/CommentsBottomSheet.styles.js</files>
  <action>
  Refactor CommentsBottomSheet to use Animated.View instead of Modal component:

1. Replace Modal wrapper with a full-screen absolutely positioned Animated.View
2. Control visibility via:
   - pointerEvents prop: 'auto' when visible, 'none' when hidden
   - Animated opacity: 1 when visible, 0 when hidden (with transition animation)
   - Existing translateY animation for slide-up effect
3. Keep ALL existing functionality intact:
   - Backdrop tap to close
   - Swipe-down to close via panResponder
   - Swipe-up to expand to fullscreen
   - Keyboard animation handling
   - Comments list with FlatList
   - Comment input at bottom
4. Update styles:
   - Overlay style: position absolute, full screen, zIndex high enough to appear above photo
   - Remove any Modal-specific styles

WHY: Modal component gets dismissed by React Native when another modal (OtherUserProfile) pushes on top. Animated.View stays in render tree and controlled by visibility props.

Keep the existing animation logic (translateY, sheetTranslateY, swipeY, sheetHeight) - just change the wrapper from Modal to Animated.View.
</action>
<verify>

1. Open a photo from feed
2. Tap comment icon to open comments
3. Tap a commenter's avatar to navigate to their profile
4. Press back to return to photo detail
5. Comments sheet should still be visible in same state
   </verify>
   <done>

- Comments sheet uses Animated.View instead of Modal
- Sheet persists when navigating to profile and back
- All existing features work: backdrop close, swipe gestures, keyboard handling, expand/collapse
  </done>
  </task>

<task type="auto">
  <name>Task 2: Add swipe-up gesture on photo to open comments</name>
  <files>src/hooks/usePhotoDetailModal.js, src/screens/PhotoDetailScreen.js</files>
  <action>
  Add upward swipe detection to open the comments sheet:

1. In usePhotoDetailModal.js, modify the panResponder to also detect upward swipes:
   - In onMoveShouldSetPanResponder: also respond to upward swipes (dy < -threshold)
   - Return a new callback `onSwipeUp` from the hook that parent can use
   - Keep downward swipe behavior unchanged (swipe-to-dismiss)

2. In PhotoDetailScreen.js:
   - Accept an onSwipeUp callback from usePhotoDetailModal
   - When upward swipe detected, call setShowComments(true)
   - Only trigger when comments are currently closed (prevent double-open)

Implementation details for panResponder modification:

- onMoveShouldSetPanResponder: Check for upward movement (gestureState.dy < -10)
- onPanResponderRelease: If dy < -50 (or velocity vy < -0.5), trigger onSwipeUp callback
- Don't apply any translateY animation for upward swipes (just detect and callback)

WHY: This is a power user gesture (optional alternative to tapping comment icon). Should feel subtle and complementary.
</action>
<verify>

1. Open a photo from feed
2. Comments should be closed initially
3. Swipe up on the photo area (not footer)
4. Comments sheet should open
5. Verify swipe down still closes photo detail
   </verify>
   <done>

- Swiping up on photo opens comments sheet
- Behaves identically to tapping comment icon
- Swipe-down-to-dismiss still works
- Gesture feels natural and non-intrusive
  </done>
  </task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] Comments sheet persists when navigating to profile from comment avatar
- [ ] Comments sheet restores to same state (scroll position, expanded state) on return
- [ ] Swipe-up on photo opens comments
- [ ] Swipe-down on photo dismisses photo detail
- [ ] All existing comment features work (add, reply, delete, like, @mentions)
- [ ] Keyboard handling still works correctly
- [ ] Expand/collapse sheet gestures still work
</verification>

<success_criteria>

- Both ISS-004 and ISS-005 resolved
- No regressions in comment functionality
- Gestures feel natural and responsive
- Navigation behavior matches user expectations (Instagram-like)
  </success_criteria>

<output>
After completion, create `.planning/phases/33-navigation-issues-fix/33-01-SUMMARY.md`:

# Phase 33 Plan 01: Navigation Issues Fix Summary

**[Substantive one-liner describing what shipped]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase complete, ready for next phase
</output>
