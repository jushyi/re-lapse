---
phase: 51-ios-release-preparation
plan: 10
type: execute
---

<objective>
Run the production EAS build, submit to App Store Connect, configure Cloud Functions secrets for production, and verify the complete submission pipeline.

Purpose: This is the final step — building the production binary, uploading to Apple, and verifying everything works end-to-end.
Output: Production build submitted to App Store Connect, ready for App Review.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/51-ios-release-preparation/51-CONTEXT.md
@.planning/phases/51-ios-release-preparation/51-RESEARCH.md

@eas.json
@app.json

**Prerequisites (from prior plans):**

- 51-01: Rebrand complete (Flick everywhere)
- 51-02: Production Firebase project set up, EAS profiles configured
- 51-03: app.json production config (privacy, APS, version 1.0.0)
- 51-04: Domain registered, support email active
- 51-05: Report email Cloud Function created
- 51-06: Giphy production key configured
- 51-07: IAP service + ContributionsScreen built
- 51-08: Name color display implemented
- 51-09: App Store Connect listing complete, ascAppId in eas.json

**From RESEARCH.md:**

- EAS managed credentials handle certificates/profiles automatically
- First `eas build` prompts for Apple Developer account login
- `eas submit` uploads build to App Store Connect
- Can combine: `eas build --platform ios --profile production --auto-submit`

**Cloud Functions config needed for production:**

- smtp.email: Gmail address for sending report emails
- smtp.password: Gmail App Password
- support.email: support@[domain] for receiving reports
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Configure Cloud Functions secrets and deploy to production</name>
  <files>functions/</files>
  <action>
Set up the Cloud Functions environment config for the production Firebase project and deploy:

1. Switch to production Firebase: `firebase use production`

2. Set Cloud Functions config values:

```bash
firebase functions:config:set smtp.email="USERS_GMAIL" smtp.password="USERS_APP_PASSWORD" support.email="support@DOMAIN"
```

(The user will need to provide their Gmail and App Password. If they haven't set up a Gmail App Password, they need to: Google Account → Security → 2-Step Verification → App Passwords → Create one for "Flick Server")

3. Deploy Cloud Functions to production:

```bash
cd functions && npm install && cd ..
firebase deploy --only functions
```

4. Verify deployment:

```bash
firebase functions:list
```

5. Switch back to dev: `firebase use default`

**Important:** Do NOT commit any credentials to git. The `functions:config:set` values are stored server-side in Firebase, not in source code.

If the user hasn't set up SMTP yet, create a checkpoint to gather credentials before deploying.
</action>
<verify>Run `firebase use production && firebase functions:config:get` shows smtp and support config set. Switch back with `firebase use default`.</verify>
<done>Cloud Functions deployed to production with SMTP and support email configuration.</done>
</task>

<task type="auto">
  <name>Task 2: Run production EAS build</name>
  <files>(no file changes — build command)</files>
  <action>
Run the production build:

```bash
eas build --platform ios --profile production
```

This will:

1. Prompt for Apple Developer account credentials (first time)
2. Generate/reuse managed credentials (distribution cert, provisioning profile, APNs key)
3. Upload source code to EAS servers
4. Build the production .ipa with production Firebase config
5. Return a build URL when complete

**Expected:** Build takes 10-30 minutes on EAS servers. Monitor progress at the URL provided.

**If authentication error:** This is an auth gate, not a failure. The user needs to run `eas credentials --platform ios` or authenticate through the interactive prompt.

**If build fails:**

- Check build logs at the URL provided
- Common issues: missing native modules, CocoaPods version conflicts, provisioning profile mismatches
- Fix and re-run

Wait for the build to complete successfully before proceeding.
</action>
<verify>Run `eas build:list --platform ios --limit 1` shows a completed production build with status "finished"</verify>
<done>Production iOS build completed successfully on EAS.</done>
</task>

<task type="auto">
  <name>Task 3: Submit build to App Store Connect</name>
  <files>(no file changes — submit command)</files>
  <action>
Submit the completed build to App Store Connect:

```bash
eas submit --platform ios
```

This will:

1. Select the most recent production build
2. Upload to App Store Connect using the ascAppId configured in eas.json
3. The build will appear in TestFlight for processing

**After submission:**

- Build processing takes 15-30 minutes in App Store Connect
- Once processed, it appears in TestFlight and can be selected for the App Store version
- Go to App Store Connect → Your App → iOS App → 1.0 → Build → Select the uploaded build
- Upload screenshots to the version (from assets/screenshots/)
- Review all metadata one final time
- Click "Submit for Review"

**If submit fails:**

- Check for missing ascAppId in eas.json
- Verify Apple Developer account has active membership
- Check that the build was signed with the correct distribution certificate
  </action>
  <verify>Run `eas submit:list --platform ios --limit 1` or check App Store Connect for the build under TestFlight</verify>
  <done>Build submitted to App Store Connect and visible in TestFlight.</done>
  </task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete production pipeline: Cloud Functions deployed to production, iOS build compiled and submitted to App Store Connect</what-built>
  <how-to-verify>
    1. Go to App Store Connect → Your App → TestFlight
    2. Verify the build appears and processing is complete (green checkmark)
    3. Install via TestFlight on a physical device
    4. Test core flow:
       a. Phone auth (should use production Firebase)
       b. Take a photo (camera capture)
       c. Check darkroom (photo should be developing)
       d. Check push notifications work (aps-environment is production)
       e. Open Contributions page, verify IAP products load with correct prices
       f. Check Settings → Help & Support → correct email opens
       g. Verify no "Rewind" text anywhere — all "Flick"
       h. Check the app icon on home screen
    5. If everything works: Go to App Store Connect → iOS App → 1.0
       a. Select the build
       b. Upload screenshots (device-framed, with captions)
       c. Review all metadata
       d. Click "Submit for Review"
    6. Confirm App Review submission status is "Waiting for Review"
  </how-to-verify>
  <resume-signal>Type "approved" when app is submitted for review, or describe any issues found during TestFlight testing</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Cloud Functions deployed to production Firebase with SMTP config
- [ ] Production EAS build completed successfully
- [ ] Build uploaded to App Store Connect
- [ ] TestFlight testing confirms core features work
- [ ] Push notifications work (production APS)
- [ ] Screenshots uploaded to App Store Connect
- [ ] App submitted for App Review
- [ ] Phase 51 complete
</verification>

<success_criteria>

- Production Cloud Functions running with report email routing
- Successful production build via EAS
- Build submitted and visible in TestFlight
- Core features verified on real device via TestFlight
- App submitted for App Review
- Phase 51 complete — app is in Apple's hands
  </success_criteria>

<output>
After completion, create `.planning/phases/51-ios-release-preparation/51-10-SUMMARY.md`

This is the final plan for Phase 51. The summary should include:

- Build ID and version
- TestFlight test results
- App Review submission date
- Any issues encountered during build/submit
- Decision: "Phase 51 complete, ready for Phase 52 (Systematic UAT)"
  </output>
