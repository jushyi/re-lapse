---
phase: 51-ios-release-preparation
plan: 02
type: execute
---

<objective>
Set up a completely separate production Firebase project isolated from dev, and configure EAS build profiles so dev builds connect to dev Firebase and production builds connect to prod Firebase.

Purpose: Production environment must be isolated — clean database, no dev data leaking into prod, no prod data accessible during development.
Output: Production Firebase project created, environment-based GoogleService-Info.plist switching via EAS build profiles.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/51-ios-release-preparation/51-CONTEXT.md
@.planning/phases/51-ios-release-preparation/51-RESEARCH.md

@app.json
@app.config.js
@eas.json
@.firebaserc
@firebase.json

**Current state:**

- Single Firebase project: `re-lapse-fa89b`
- `.firebaserc` points to `re-lapse-fa89b` as default
- `app.config.js` uses `GOOGLE_SERVICES_PLIST` env var (EAS) or falls back to local `./GoogleService-Info.plist`
- EAS profiles: development (devClient), preview (internal), production (autoIncrement)
- `.env` contains GIPHY_API_KEY (dev key)

**Vision:** Same codebase, different targets. EAS build profiles handle environment switching deterministically.
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <action>Create production Firebase project in Firebase Console</action>
  <instructions>
    Claude cannot create Firebase projects via CLI without an existing project context. You need to:

    1. Go to https://console.firebase.google.com/
    2. Click "Add project" → Name it something like "flick-production" or "flick-prod"
    3. Disable Google Analytics (not needed for this app)
    4. Once created, enable these services:
       - **Authentication** → Sign-in method → Phone → Enable
       - **Cloud Firestore** → Create database → Start in production mode
       - **Cloud Storage** → Get started → Start in production mode
    5. Add an **iOS app**:
       - Bundle ID: `com.spoodsjs.rewind` (must match existing bundle ID)
       - App nickname: "Flick (Production)"
       - Download the `GoogleService-Info.plist`
    6. Save the downloaded plist file as `GoogleService-Info-prod.plist` in the project root (next to the existing `GoogleService-Info.plist`)
    7. Note the new project ID (e.g., "flick-production-xxxxx") — you'll need it for the next step.

    After creating, provide:
    - The production Firebase project ID
    - Confirm `GoogleService-Info-prod.plist` is saved in the project root

  </instructions>
  <verification>File `GoogleService-Info-prod.plist` exists in project root</verification>
  <resume-signal>Type the production Firebase project ID and confirm the plist is saved, e.g.: "Project ID: flick-prod-abc123, plist saved"</resume-signal>
</task>

<task type="auto">
  <name>Task 2: Configure environment-based Firebase switching</name>
  <files>app.config.js, eas.json, .firebaserc</files>
  <action>
Update `app.config.js` to select the correct GoogleService-Info.plist based on build profile:

**app.config.js** — Already uses `GOOGLE_SERVICES_PLIST` env var. The switching happens via EAS build secrets. No code change needed here IF we use EAS file credentials. But for local clarity, add a comment documenting the pattern:

- Development builds → `GoogleService-Info.plist` (dev project)
- Production builds → `GoogleService-Info-prod.plist` (prod project)

**eas.json** — Add `env` to each build profile to set the `GOOGLE_SERVICES_PLIST` path:

```json
{
  "build": {
    "development": {
      "developmentClient": true,
      "distribution": "internal",
      "env": {
        "GOOGLE_SERVICES_PLIST": "./GoogleService-Info.plist"
      }
    },
    "preview": {
      "distribution": "internal",
      "ios": { "simulator": false },
      "env": {
        "GOOGLE_SERVICES_PLIST": "./GoogleService-Info.plist"
      }
    },
    "production": {
      "autoIncrement": true,
      "ios": { "image": "latest" },
      "env": {
        "GOOGLE_SERVICES_PLIST": "./GoogleService-Info-prod.plist"
      }
    }
  }
}
```

**`.firebaserc`** — Add production project alias:

```json
{
  "projects": {
    "default": "re-lapse-fa89b",
    "production": "{PRODUCTION_PROJECT_ID}"
  }
}
```

This allows `firebase use production` before deploying rules/functions to prod.
</action>
<verify>Run `cat eas.json` and verify each profile has correct GOOGLE_SERVICES_PLIST env. Run `cat .firebaserc` and verify production alias exists.</verify>
<done>EAS profiles configured: dev/preview → dev Firebase, production → prod Firebase. Firebase CLI has production alias.</done>
</task>

<task type="auto">
  <name>Task 3: Deploy Firestore rules, Storage rules, and Cloud Functions to production</name>
  <files>firebase.json, firestore.rules, storage.rules, functions/</files>
  <action>
Deploy the existing security rules and Cloud Functions to the production Firebase project:

1. Switch Firebase CLI to production: `firebase use production`
2. Deploy Firestore rules: `firebase deploy --only firestore:rules`
3. Deploy Firestore indexes: `firebase deploy --only firestore:indexes`
4. Deploy Storage rules: `firebase deploy --only storage`
5. Deploy Cloud Functions: `cd functions && npm install && cd .. && firebase deploy --only functions`
6. Switch back to dev: `firebase use default`

This ensures the production project has identical security rules and Cloud Functions as dev. The database will be empty (clean start for production) but the rules and functions will be in place.

Do NOT deploy any test data or seed data — production starts clean.
</action>
<verify>Run `firebase use production && firebase deploy --only firestore:rules --dry-run` succeeds. Switch back with `firebase use default`.</verify>
<done>Production Firebase project has: Firestore rules deployed, Storage rules deployed, Cloud Functions deployed, Firestore indexes created. Database is empty (clean production start).</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `GoogleService-Info-prod.plist` exists in project root
- [ ] `eas.json` has env-based plist switching for all 3 profiles
- [ ] `.firebaserc` has both default and production project aliases
- [ ] Production Firebase has Auth (Phone), Firestore, Storage enabled
- [ ] Firestore rules, Storage rules, and Cloud Functions deployed to production
</verification>

<success_criteria>

- Production Firebase project fully set up and isolated from dev
- EAS build profiles deterministically select correct Firebase project
- Security rules and Cloud Functions deployed to production
- Production database is clean (no dev data)
  </success_criteria>

<output>
After completion, create `.planning/phases/51-ios-release-preparation/51-02-SUMMARY.md`
</output>
