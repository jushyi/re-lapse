---
phase: 51-ios-release-preparation
plan: 03
type: execute
---

<objective>
Configure app.json and eas.json for production iOS release — privacy manifests, APS production entitlement, supportsTablet:false, and EAS submit profile.

Purpose: These configurations are required for App Store submission. Missing any one causes rejection.
Output: Production-ready app.json and eas.json with all Apple-required configurations.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/51-ios-release-preparation/51-RESEARCH.md

@app.json
@eas.json

**From RESEARCH.md:**

- Privacy manifests required: FileTimestamp (C617.1), SystemBootTime (35F9.1), DiskSpace (E174.1), UserDefaults (CA92.1)
- APS environment must be "production" for push notifications to work
- supportsTablet: false — phone-only, avoids iPad review risk
- ITSAppUsesNonExemptEncryption: false — already set
- Need to discover additional privacy manifest entries from Firebase packages

**Current app.json state:**

- `aps-environment: "development"` — MUST change to production
- `supportsTablet: true` — MUST change to false
- No privacyManifests configured
- version: "0.1.0" — should bump for release
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Scan dependencies for privacy manifest entries</name>
  <files>(read-only scan)</files>
  <action>
Run a scan of all node_modules for PrivacyInfo.xcprivacy files to discover what API usage reasons are required:

```bash
find node_modules -name "PrivacyInfo.xcprivacy" -not -path "*/Example/*" 2>/dev/null
```

For each found file, read its contents and extract the NSPrivacyAccessedAPITypes entries. Aggregate all unique entries. These MUST be included in app.json's privacyManifests to avoid Apple rejection (ITMS-91053).

The baseline from RESEARCH.md is:

- FileTimestamp: C617.1
- SystemBootTime: 35F9.1
- DiskSpace: E174.1
- UserDefaults: CA92.1

Add any additional entries discovered from Firebase packages or other dependencies.

Document all findings as a comment in the commit message for future reference.
</action>
<verify>All PrivacyInfo.xcprivacy files scanned and entries aggregated</verify>
<done>Complete list of required privacy manifest entries identified from all project dependencies.</done>
</task>

<task type="auto">
  <name>Task 2: Update app.json and eas.json for production</name>
  <files>app.json, eas.json</files>
  <action>
**app.json changes:**

1. **Version bump:** `"version": "0.1.0"` → `"version": "1.0.0"` (first public release)

2. **supportsTablet:** Add `"supportsTablet": false` under `expo.ios` (replacing `true`)

3. **APS environment:** Change `"aps-environment": "development"` → `"aps-environment": "production"` under `expo.ios.entitlements`

4. **Privacy manifests:** Add `privacyManifests` under `expo.ios` with ALL aggregated entries from Task 1. At minimum:

```json
"privacyManifests": {
  "NSPrivacyAccessedAPITypes": [
    {
      "NSPrivacyAccessedAPIType": "NSPrivacyAccessedAPICategoryFileTimestamp",
      "NSPrivacyAccessedAPITypeReasons": ["C617.1"]
    },
    {
      "NSPrivacyAccessedAPIType": "NSPrivacyAccessedAPICategorySystemBootTime",
      "NSPrivacyAccessedAPITypeReasons": ["35F9.1"]
    },
    {
      "NSPrivacyAccessedAPIType": "NSPrivacyAccessedAPICategoryDiskSpace",
      "NSPrivacyAccessedAPITypeReasons": ["E174.1"]
    },
    {
      "NSPrivacyAccessedAPIType": "NSPrivacyAccessedAPICategoryUserDefaults",
      "NSPrivacyAccessedAPITypeReasons": ["CA92.1"]
    }
  ]
}
```

Add any additional entries found in Task 1.

5. **Background modes:** Verify `UIBackgroundModes: ["remote-notification"]` is present (already set).

6. **Encryption:** Verify `ITSAppUsesNonExemptEncryption: false` is present (already set).

**eas.json changes:**

1. **Submit profile:** Add `ascAppId` placeholder under `submit.production.ios`:

```json
"submit": {
  "production": {
    "ios": {
      "ascAppId": "PLACEHOLDER_SET_AFTER_ASC_SETUP"
    }
  }
}
```

The actual ascAppId will be set in Plan 51-09 after App Store Connect app listing is created.

Do NOT change the bundleIdentifier — it must stay `com.spoodsjs.rewind` to match the Apple Developer portal registration and EAS project linkage.
</action>
<verify>Run `cat app.json | python -m json.tool` (or `node -e "console.log(JSON.stringify(require('./app.json'), null, 2))"`) to validate JSON. Verify: version is "1.0.0", supportsTablet is false, aps-environment is "production", privacyManifests has at least 4 entries.</verify>
<done>app.json has production configuration: version 1.0.0, supportsTablet false, APS production, privacy manifests. eas.json has submit profile placeholder.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `app.json` version is "1.0.0"
- [ ] `supportsTablet` is `false`
- [ ] `aps-environment` is `"production"`
- [ ] `privacyManifests` has all required API type entries
- [ ] `eas.json` has submit.production.ios section
- [ ] JSON is valid (no syntax errors)
- [ ] `npm run lint` passes
</verification>

<success_criteria>

- All Apple-required production configurations in place
- Privacy manifests cover all dependency API usage
- APS environment set to production for push notifications
- iPad support disabled to avoid review risk
- Version bumped to 1.0.0
  </success_criteria>

<output>
After completion, create `.planning/phases/51-ios-release-preparation/51-03-SUMMARY.md`
</output>
