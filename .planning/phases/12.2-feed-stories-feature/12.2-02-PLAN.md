---
phase: 12.2-feed-stories-feature
plan: 02
type: execute
domain: react-native
---

<objective>
Create the FriendStoryCard component and add horizontal stories row to FeedScreen.

Purpose: Build the Stories row UI that displays friend avatars/cards that users tap to view stories.
Output: Horizontal scrolling stories row at top of feed with tappable friend cards showing avatars and photo previews.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary-format.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/12.2-feed-stories-feature/12.2-01-SUMMARY.md

# Codebase context
@.planning/codebase/CONVENTIONS.md
@.planning/codebase/STRUCTURE.md

# Key source files
@src/screens/FeedScreen.js
@src/components/FeedPhotoCard.js
@src/components/index.js
@src/services/firebase/feedService.js

**Design patterns from existing components:**
- FeedPhotoCard: Circular profile photo (40x40), card styling
- PhotoDetailModal: 80x80 profile photo with border
- Dark theme: #000000 background, #FFFFFF text, #1A1A1A secondary bg

**Stories row design (Instagram-inspired):**
- Horizontal ScrollView at top of feed
- Each card: ~70-80px wide, circular avatar with gradient ring if has unviewed photos
- Display name below avatar (truncated if too long)
- Tap opens StoriesViewerModal (to be built in Plan 03)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FriendStoryCard component</name>
  <files>src/components/FriendStoryCard.js, src/components/index.js</files>
  <action>
Create `FriendStoryCard.js` component that displays a single friend's story card:

**Props:**
```javascript
{
  friend: {
    userId: string,
    displayName: string,
    profilePhotoURL: string,
    topPhotos: [...],
    hasPhotos: boolean
  },
  onPress: () => void,
  isFirst: boolean  // For left margin handling
}
```

**Layout:**
1. Container: ~75px width, paddingHorizontal: 4
2. Avatar container:
   - 60x60 circular Image with friend's profilePhotoURL
   - Fallback to gray circle with first letter of displayName if no photo
   - Gradient border ring (purple/pink Instagram-style) if hasPhotos
3. Display name below avatar:
   - 10-12px font, white text
   - numberOfLines={1}, ellipsizeMode='tail'
   - Max width matches avatar width
4. TouchableOpacity wrapper that calls onPress

**Styling:**
- Match app's dark theme (#000 background, white text)
- Avatar border: 2px gradient ring when has photos, gray ring when empty
- For gradient ring, use LinearGradient from expo-linear-gradient (already in project via expo) or solid colored border as fallback

Export from components/index.js barrel file.
  </action>
  <verify>
Component renders without errors. Import works from components/index.js.
Visual check: Avatar displays, name truncates properly, tap fires onPress.
  </verify>
  <done>
- FriendStoryCard component created with avatar, name, and tap handler
- Exported from components/index.js
- Matches app's dark theme styling
  </done>
</task>

<task type="auto">
  <name>Task 2: Add stories row to FeedScreen</name>
  <files>src/screens/FeedScreen.js</files>
  <action>
Modify FeedScreen to add a horizontal stories row at the top:

**State additions:**
```javascript
const [friendStories, setFriendStories] = useState([]);
const [storiesLoading, setStoriesLoading] = useState(true);
```

**Data fetching:**
1. Add useEffect to fetch friend stories data on mount:
   ```javascript
   useEffect(() => {
     const loadFriendStories = async () => {
       setStoriesLoading(true);
       const result = await getFriendStoriesData(user.uid);
       if (result.success) {
         setFriendStories(result.friendStories);
       }
       setStoriesLoading(false);
     };
     if (user?.uid) loadFriendStories();
   }, [user?.uid]);
   ```
2. Import `getFriendStoriesData` from feedService

**UI additions:**
1. Add StoriesRow component/section above FlatList:
   ```jsx
   <View style={styles.storiesContainer}>
     {storiesLoading ? (
       <StoriesLoadingSkeleton />  // Simple horizontal placeholder
     ) : friendStories.length > 0 ? (
       <ScrollView
         horizontal
         showsHorizontalScrollIndicator={false}
         contentContainerStyle={styles.storiesScrollContent}
       >
         {friendStories.map((friend, index) => (
           <FriendStoryCard
             key={friend.userId}
             friend={friend}
             onPress={() => handleOpenStories(friend)}
             isFirst={index === 0}
           />
         ))}
       </ScrollView>
     ) : null}
   </View>
   ```

2. Add `handleOpenStories` function (placeholder for now):
   ```javascript
   const handleOpenStories = (friend) => {
     // TODO: Open StoriesViewerModal in Plan 03
     logger.info('FeedScreen: User tapped friend story', { friendId: friend.userId });
   };
   ```

3. Add styles:
   ```javascript
   storiesContainer: {
     paddingVertical: 12,
     borderBottomWidth: 1,
     borderBottomColor: '#1A1A1A',
   },
   storiesScrollContent: {
     paddingHorizontal: 12,
   },
   ```

4. Simple loading skeleton - just show 4-5 gray circles with shimmer effect or static placeholder

Keep existing FlatList for photo feed below stories row.
  </action>
  <verify>
App builds and runs. FeedScreen shows horizontal stories row above feed.
Stories row displays friend avatars when data loads.
Tapping a friend card logs the info message.
  </verify>
  <done>
- Stories row added to top of FeedScreen
- Friend stories data fetched on mount
- FriendStoryCard components render in horizontal ScrollView
- Tap handler ready for StoriesViewerModal integration
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Stories row UI at top of feed with friend avatar cards</what-built>
  <how-to-verify>
    1. Run: `npx expo start` and open on device/simulator
    2. Navigate to Feed tab
    3. Verify: Stories row appears at top with friend avatars
    4. Verify: Friend names appear below avatars (truncated if long)
    5. Verify: Horizontal scrolling works if many friends
    6. Verify: Tapping a friend card logs message (check console)
    7. Verify: Empty state (no stories row) if no friends have photos
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] FriendStoryCard component created and exported
- [ ] Stories row added to FeedScreen above feed
- [ ] Friend stories data fetched on mount
- [ ] Horizontal scrolling works
- [ ] Tap handler wired up (placeholder for now)
- [ ] App builds without errors
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Human verification approved
- Stories row UI matches Instagram-style design
- Ready for StoriesViewerModal integration in Plan 03
</success_criteria>

<output>
After completion, create `.planning/phases/12.2-feed-stories-feature/12.2-02-SUMMARY.md`
</output>
