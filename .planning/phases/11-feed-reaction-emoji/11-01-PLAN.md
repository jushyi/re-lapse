---
phase: 11-feed-reaction-emoji
plan: 01
type: execute
---

<objective>
Implement curated emoji reactions with custom emoji picker for feed photos.

Purpose: Replace static 8-emoji reaction bar with rotating curated emojis (5 per photo) plus "Add your own" custom emoji picker using rn-emoji-keyboard.

Output: Each photo shows different curated emojis based on photo ID, with ability to add any custom emoji via picker. Custom selection shows preview before committing reaction.
</objective>

<execution_context>
@~/.claude/get-shit-done/references/plan-format.md
</execution_context>

<context>
**Project context:**
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/11-feed-reaction-emoji/11-CONTEXT.md
@.planning/phases/11-feed-reaction-emoji/11-RESEARCH.md
@.planning/codebase/CONVENTIONS.md

**Source files to modify:**
@src/hooks/usePhotoDetailModal.js
@src/components/PhotoDetailModal.js
@src/styles/PhotoDetailModal.styles.js
</context>

<tasks>
<task type="auto">
  <name>Task 1: Install library and create emoji infrastructure</name>
  <files>
    - package.json (install rn-emoji-keyboard)
    - src/constants/emojiPools.js (NEW)
    - src/utils/emojiRotation.js (NEW)
  </files>
  <action>
    1. Install rn-emoji-keyboard: `npm install rn-emoji-keyboard`

    2. Create `src/constants/emojiPools.js`:
       - Export EMOJI_POOLS object with 8 categories (faces, love, fire, animals, food, gestures, nature, expressions)
       - Each category has 10 emojis (stick to Unicode v13 or earlier for compatibility)
       - Export POOL_KEYS array of category names
       - Include commonly-used reaction-appropriate emojis per category

    3. Create `src/utils/emojiRotation.js`:
       - Export `getCuratedEmojis(photoId, count = 5)` function
       - Use hashCode of photoId to seed deterministic selection
       - Pick from DIFFERENT categories for variety (not all from same pool)
       - Return array of 5 emojis that will be consistent for same photoId
       - Use prime multiplier for spread across pools

    IMPORTANT: Selection must be deterministic (same photoId = same emojis every time) to prevent flickering on re-renders.

  </action>
  <verify>
    - `npm ls rn-emoji-keyboard` shows package installed
    - Files exist: `src/constants/emojiPools.js`, `src/utils/emojiRotation.js`
    - Import test: Can import getCuratedEmojis and call it without errors
  </verify>
  <done>
    - rn-emoji-keyboard installed
    - emojiPools.js exports EMOJI_POOLS with 8 categories of 10 emojis each
    - emojiRotation.js exports getCuratedEmojis that returns deterministic 5-emoji array based on photoId
  </done>
</task>

<task type="auto">
  <name>Task 2: Update usePhotoDetailModal hook for curated emojis</name>
  <files>
    - src/hooks/usePhotoDetailModal.js
  </files>
  <action>
    1. Remove the hardcoded REACTION_EMOJIS constant (line ~22)

    2. Import getCuratedEmojis from utils/emojiRotation

    3. Add new state for custom emoji picker:
       - `customEmoji` - the emoji user selected from picker (null when not set)
       - `showEmojiPicker` - boolean to control picker visibility

    4. Add new memoized value `curatedEmojis`:
       - Call getCuratedEmojis with currentPhoto?.id
       - Returns 5 emojis based on photo ID
       - Memoize on [currentPhoto?.id]

    5. Update `orderedEmojis` logic:
       - Use curatedEmojis instead of REACTION_EMOJIS
       - Keep frozenOrder logic for reaction animation stability
       - If customEmoji is set, append it to the end (6th position)

    6. Add handler functions:
       - `handleOpenEmojiPicker()` - sets showEmojiPicker to true
       - `handleEmojiPickerSelect(emojiObject)` - sets customEmoji to emojiObject.emoji, closes picker
       - `handleCustomEmojiConfirm()` - calls onReactionToggle with customEmoji, then clears customEmoji

    7. Export new values from hook:
       - curatedEmojis
       - customEmoji, setCustomEmoji (for clearing preview)
       - showEmojiPicker, setShowEmojiPicker
       - handleOpenEmojiPicker, handleEmojiPickerSelect, handleCustomEmojiConfirm

    IMPORTANT: Do NOT remove existing reaction logic (handleEmojiPress, getUserReactionCount, etc.) - those still work for the curated emojis.

  </action>
  <verify>
    - No lint errors in usePhotoDetailModal.js
    - Hook exports all new values
    - curatedEmojis returns 5 emojis that differ based on photo ID
  </verify>
  <done>
    - Hook uses getCuratedEmojis instead of hardcoded REACTION_EMOJIS
    - Custom emoji state (customEmoji, showEmojiPicker) added
    - Handler functions for picker flow added
    - All new values exported from hook
  </done>
</task>

<task type="auto">
  <name>Task 3: Update PhotoDetailModal UI with picker integration</name>
  <files>
    - src/components/PhotoDetailModal.js
    - src/styles/PhotoDetailModal.styles.js
  </files>
  <action>
    1. Import EmojiPicker from 'rn-emoji-keyboard' in PhotoDetailModal.js

    2. Destructure new values from usePhotoDetailModal:
       - curatedEmojis, customEmoji, showEmojiPicker
       - handleOpenEmojiPicker, handleEmojiPickerSelect, handleCustomEmojiConfirm

    3. Update the emoji picker row in footer (around line 371-411):
       - Display 5 curated emojis (from curatedEmojis array)
       - After the 5 emojis, add "Add" button:
         - If customEmoji is null: Show "+" icon/button, onPress calls handleOpenEmojiPicker
         - If customEmoji is set: Show the customEmoji, onPress calls handleCustomEmojiConfirm (commits the reaction)
       - Add button should have EQUAL visual presence to emoji pills (same size, same styling)

    4. Add EmojiPicker component at bottom of modal (before closing tags):
       ```jsx
       <EmojiPicker
         onEmojiSelected={handleEmojiPickerSelect}
         open={showEmojiPicker}
         onClose={() => setShowEmojiPicker(false)}
         enableRecentlyUsed={false}
         enableSearchBar={true}
       />
       ```

    5. Update PhotoDetailModal.styles.js:
       - Add `addEmojiButton` style matching `emojiPill` dimensions
       - Add `addEmojiText` style for the "+" character (same size as emoji)
       - Add `customEmojiPreview` style for preview state (optional: subtle highlight to show it's tappable)

    STYLING NOTES:
    - Add button must be same size as emoji pills (equal visual presence per context)
    - Keep existing emojiPill styling for consistency
    - "+" should be clear and recognizable (use same font size as emojis)

  </action>
  <verify>
    - No lint errors in PhotoDetailModal.js or PhotoDetailModal.styles.js
    - EmojiPicker import present
    - Add button renders in emoji row
  </verify>
  <done>
    - Footer shows 5 curated emojis + add button
    - Add button opens rn-emoji-keyboard picker
    - Selecting emoji from picker shows preview in add button position
    - Tapping preview commits the reaction
    - All styling consistent with existing emoji pills
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Curated emoji reactions with custom emoji picker</what-built>
  <how-to-verify>
    1. Run: `npm start` and open app on device/simulator
    2. Navigate to Feed and tap a photo to open PhotoDetailModal
    3. Verify emoji row shows 5 emojis (not 8) plus an "+" add button at the end
    4. Tap any curated emoji - verify it triggers reaction (haptic + count updates)
    5. Swipe to a different photo - verify different emojis appear (curated variety)
    6. Tap the "+" add button - verify emoji picker opens
    7. Select any emoji from picker - verify:
       - Picker closes
       - Selected emoji appears in the add button position (preview)
    8. Tap the preview emoji - verify:
       - Reaction is committed (count updates)
       - Preview clears back to "+" button
    9. Check that existing reactions still work (tap same emoji multiple times)
    10. Verify no visual glitches or layout issues
  </how-to-verify>
  <resume-signal>Type "approved" if working correctly, or describe any issues found</resume-signal>
</task>
</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run lint` passes without errors
- [ ] App starts without crashes
- [ ] PhotoDetailModal renders curated emojis correctly
- [ ] Custom emoji picker opens and selection works
- [ ] Preview â†’ confirm flow works for custom emojis
- [ ] Different photos show different curated emojis
- [ ] Existing reaction functionality (tap to react, counts, haptic) preserved
</verification>

<success_criteria>

- Each photo shows 5 curated emojis rotated by category based on photo ID
- Add button has equal visual presence to emoji options
- rn-emoji-keyboard opens when add button tapped
- Custom emoji selection shows preview before committing
- Tapping preview commits reaction and clears preview
- No flickering or layout instability during use
  </success_criteria>

<output>
After completion, create `.planning/phases/11-feed-reaction-emoji/11-01-SUMMARY.md`:

# Phase 11-01: Feed Reaction Emoji Enhancements Summary

**[Substantive one-liner about what was accomplished]**

## Accomplishments

- [Key accomplishment 1]
- [Key accomplishment 2]
- [Key accomplishment 3]

## Files Created

- src/constants/emojiPools.js
- src/utils/emojiRotation.js

## Files Modified

- src/hooks/usePhotoDetailModal.js
- src/components/PhotoDetailModal.js
- src/styles/PhotoDetailModal.styles.js
- package.json

## Decisions Made

- [Any implementation decisions]

## Issues Encountered

- [Any issues and how resolved]

## Next Phase Readiness

- [Ready for Phase 12 or any blockers]
  </output>
