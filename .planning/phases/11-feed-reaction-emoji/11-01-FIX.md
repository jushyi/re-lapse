---
phase: 11-feed-reaction-emoji
plan: 01-FIX
type: fix
---

<objective>
Fix 2 UAT issues from plan 11-01.

Source: 11-01-ISSUES.md
Priority: 0 critical, 1 major, 1 cosmetic
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md

**Issues being fixed:**
@.planning/phases/11-feed-reaction-emoji/11-01-ISSUES.md

**Original plan for reference:**
@.planning/phases/11-feed-reaction-emoji/11-01-PLAN.md

**Key files:**
@src/components/PhotoDetailModal.js
@src/hooks/usePhotoDetailModal.js
@src/styles/PhotoDetailModal.styles.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix UAT-001 - Apply dark theme to emoji picker</name>
  <files>src/components/PhotoDetailModal.js</files>
  <action>
Configure rn-emoji-keyboard with dark theme styling.

The EmojiPicker component from rn-emoji-keyboard supports a `theme` prop. Update the EmojiPicker component to use dark theme colors:

```jsx
<EmojiPicker
  onEmojiSelected={handleEmojiPickerSelect}
  open={showEmojiPicker}
  onClose={() => setShowEmojiPicker(false)}
  enableRecentlyUsed={false}
  enableSearchBar={true}
  theme={{
    backdrop: '#00000080',
    knob: colors.text.secondary,
    container: '#1a1a1a',
    header: colors.text.primary,
    skinTonesContainer: '#1a1a1a',
    category: {
      icon: colors.text.secondary,
      iconActive: colors.text.primary,
      container: '#1a1a1a',
      containerActive: colors.brand.purple,
    },
    search: {
      text: colors.text.primary,
      placeholder: colors.text.secondary,
      icon: colors.text.secondary,
      background: '#2a2a2a',
    },
    emoji: {
      selected: colors.brand.purple,
    },
  }}
/>
```

This matches the app's dark aesthetic with:

- Dark container background (#1a1a1a)
- White/gray text using existing color constants
- Purple accent for selected states (brand purple)
  </action>
  <verify>Open photo detail, tap "+", verify emoji picker has dark background instead of white</verify>
  <done>Emoji picker displays with dark theme matching app aesthetic</done>
  </task>

<task type="auto">
  <name>Task 2: Fix UAT-002 - Persist custom emoji in reaction row after reacting</name>
  <files>src/hooks/usePhotoDetailModal.js, src/components/PhotoDetailModal.js</files>
  <action>
Change the custom emoji flow so that:
1. After confirming a custom emoji reaction, the emoji persists in the reaction row
2. User can tap the persisted emoji again to add more reactions
3. The "+" button remains available for selecting additional custom emojis

**Implementation approach:**

In usePhotoDetailModal.js:

1. Add new state `activeCustomEmojis` to track custom emojis that have been confirmed (Set or array)
2. Modify `handleCustomEmojiConfirm`:
   - Add the emoji to `activeCustomEmojis` set
   - React with the emoji
   - Clear `customEmoji` preview state (so "+" button shows "+" again)
3. Update `orderedEmojis` to include `activeCustomEmojis` at the end of curated emojis
4. Reset `activeCustomEmojis` when photo changes (since each photo has different reactions)

In PhotoDetailModal.js:

1. The emoji row already iterates over `orderedEmojis` - no changes needed there
2. The "+" button logic stays the same (customEmoji preview then confirm)

**Key behavior:**

- Curated emojis (5) + active custom emojis appear in the row
- Each can be tapped multiple times to add more reactions
- "+" button always available at the end for adding new custom emojis
- Custom emojis that already exist in the photo's reactions should be included in activeCustomEmojis
  </action>
  <verify>

1. Open photo, tap "+", select custom emoji, tap to confirm
2. Verify emoji appears in the reaction row (not just the "+" button)
3. Tap the persisted emoji again - reaction count should increment
4. Verify "+" button is still available for more custom emojis
   </verify>
   <done>

- Custom emojis persist in reaction row after first reaction
- Can tap persisted emoji to add more reactions
- "+" button remains available for new custom emojis
  </done>
  </task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Dark theme emoji picker + persisted custom emoji reactions</what-built>
  <how-to-verify>
1. Run the app: `npx expo start`
2. Navigate to feed with photos
3. Tap a photo to open PhotoDetailModal

**Test UAT-001 (Dark theme):** 4. Tap the "+" button at end of emoji row 5. Verify emoji picker has dark background (not white) 6. Verify text is readable (white/gray on dark)

**Test UAT-002 (Persist custom emoji):** 7. Select any emoji from the picker 8. Tap the preview emoji to confirm reaction 9. Verify the emoji now appears in the reaction row (alongside curated emojis) 10. Tap the same emoji again - verify count increases 11. Tap "+" to add another custom emoji - verify it also persists
</how-to-verify>
<resume-signal>Type "approved" or describe any remaining issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Emoji picker displays with dark theme
- [ ] Custom emojis persist in reaction row after confirming
- [ ] Can tap persisted custom emoji to add more reactions
- [ ] "+" button remains functional for adding more custom emojis
- [ ] Existing curated emoji functionality unchanged
</verification>

<success_criteria>

- UAT-001 resolved: Emoji picker matches app's dark aesthetic
- UAT-002 resolved: Custom emojis persist and can be re-used
- No regressions in existing emoji reaction functionality
  </success_criteria>

<output>
After completion, create `.planning/phases/11-feed-reaction-emoji/11-01-FIX-SUMMARY.md`
</output>
