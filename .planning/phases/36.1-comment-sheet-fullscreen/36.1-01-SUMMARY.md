---
phase: 36.1-comment-sheet-fullscreen
plan: 01
subsystem: ui
tags: [comments, gestures, animation, bottom-sheet]

# Dependency graph
requires:
  - phase: 36
    provides: CommentsBottomSheet component with swipe-to-close
provides:
  - Bidirectional expand/collapse gesture on comment sheet
  - Velocity-based snapping for fast swipes
affects: [comments, photo-detail-modal]

# Tech tracking
tech-stack:
  added: []
  patterns: [nested-animated-views, js-native-driver-separation]

key-files:
  created: []
  modified:
    - src/components/comments/CommentsBottomSheet.js
    - src/styles/CommentsBottomSheet.styles.js

key-decisions:
  - 'Reduced EXPANDED_HEIGHT from 95% to 85% to avoid notch overlap'
  - 'Increased handle bar padding for easier grabbing (16px vs 12px)'
  - 'Removed mini photo thumbnail per user feedback'
  - 'Nested Animated.Views to separate JS (height) and native (transform) drivers'

patterns-established:
  - 'Ref-based state for PanResponder closure access (isExpandedRef)'
  - 'Nested Animated.Views for mixed driver animations'

issues-created: []

# Metrics
duration: 18min
completed: 2026-01-27
---

# Phase 36.1 Plan 01: Comment Sheet Fullscreen Expand Summary

**Bidirectional swipe gesture to expand comment sheet to ~85% height with velocity-based snapping**

## Performance

- **Duration:** 18 min
- **Started:** 2026-01-27T10:00:00Z
- **Completed:** 2026-01-27T10:18:00Z
- **Tasks:** 3 (2 auto + 1 verify checkpoint)
- **Files modified:** 3

## Accomplishments

- Bidirectional expand/collapse gesture on handle bar
- Swipe UP when collapsed expands to 85% screen height
- Swipe DOWN when expanded collapses back to 60%
- Swipe DOWN when collapsed closes sheet (existing behavior preserved)
- Velocity-based snapping: fast swipes (vy > 0.5) snap immediately
- Slow drags spring back to current state
- Enlarged handle bar touch target for easier grabbing

## Task Commits

Each task was committed atomically:

1. **Task 1: Add bidirectional expand/collapse gesture** - `5aca46f` (feat)
2. **Task 2: Add mini photo header when expanded** - `0f79433` (feat)
3. **Fix: Separate native and JS animated drivers** - `0fbf30a` (fix)
4. **Fix: Adjust expanded height and remove photo thumbnail** - `50610b1` (fix)

## Files Created/Modified

- `src/components/comments/CommentsBottomSheet.js` - Added sheetHeight animated value, bidirectional PanResponder, nested Animated.Views for driver separation
- `src/styles/CommentsBottomSheet.styles.js` - Added EXPANDED_HEIGHT (85%), increased handleBarContainer padding
- `src/components/PhotoDetailModal.js` - Removed photoUrl prop (no longer needed)

## Decisions Made

| Decision                       | Rationale                                                               |
| ------------------------------ | ----------------------------------------------------------------------- |
| 85% expanded height (not 95%)  | User feedback: 95% went into notch area, hard to grab handle            |
| Remove mini photo thumbnail    | User feedback: unnecessary, cluttered the expanded view                 |
| Nested Animated.Views          | Required to separate JS driver (height) from native driver (transforms) |
| isExpandedRef for PanResponder | Ref provides synchronous access inside PanResponder closure             |
| Handle bar padding 16px        | Larger touch target for easier gesture initiation                       |

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 3 - Blocking] Animated driver conflict**

- **Found during:** Task 1 verification
- **Issue:** Mixing JS driver (height) and native driver (transforms) on same Animated.View caused runtime error
- **Fix:** Nested Animated.Views - outer for height, inner for transforms
- **Files modified:** src/components/comments/CommentsBottomSheet.js
- **Verification:** No more "Style property 'height' is not supported by native animated module" error
- **Commit:** 0fbf30a

### User-Requested Changes

**2. Expanded height and photo thumbnail removal**

- **Found during:** Checkpoint verification
- **Issue:** Sheet expanded too high (into notch), handle hard to grab, photo thumbnail unnecessary
- **Fix:** Reduced EXPANDED_HEIGHT from 95% to 85%, increased handle padding, removed photo thumbnail
- **Files modified:** All 3 files
- **Commit:** 50610b1

---

**Total deviations:** 1 auto-fixed (driver conflict), 1 user-requested adjustment
**Impact on plan:** Minor scope reduction (photo thumbnail removed), improved UX (better height, easier handle)

## Issues Encountered

None beyond the deviations documented above.

## Next Phase Readiness

- Comment sheet expand/collapse complete and polished
- Ready for Phase 37.2: Stories Thumbnail Flash Fix & Feed Skeleton Update

---

_Phase: 36.1-comment-sheet-fullscreen_
_Completed: 2026-01-27_
