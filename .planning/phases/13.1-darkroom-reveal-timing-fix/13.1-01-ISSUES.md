# UAT Issues: Phase 13.1 Plan 01

**Tested:** 2026-01-20
**Source:** .planning/phases/13.1-darkroom-reveal-timing-fix/13.1-01-SUMMARY.md
**Tester:** User via /gsd:verify-work

## Open Issues

### UAT-001: Darkroom timing not refreshed on photo capture

**Discovered:** 2026-01-20
**Phase/Plan:** 13.1-01
**Severity:** Major
**Feature:** Darkroom timing auto-initialization on photo capture
**Description:** When capturing a new photo, the darkroom's nextRevealAt timestamp is not being updated despite having stale data (Jan 19, 2026 9:03 PM - over 24 hours old).
**Expected:** After capturing a photo, ensureDarkroomInitialized() should detect the stale nextRevealAt and refresh it to 0-15 minutes from now.
**Actual:** The darkroom document retains the old nextRevealAt timestamp after photo capture. Database shows:
- createdAt: January 19, 2026 at 8:26:51 PM UTC-5
- lastRevealedAt: null
- nextRevealAt: January 19, 2026 at 9:03:35 PM UTC-5 (STALE - not updated)
- userId: "D6BWI7FcWDflfznnETbPQooVupn2"

**Repro:**
1. Have a darkroom with stale nextRevealAt (in the past)
2. Open Camera and capture a new photo
3. Check darkroom document in Firestore
4. nextRevealAt should be updated but remains unchanged

**Investigation Notes:**
- Code at photoService.js:77 calls `await ensureDarkroomInitialized(userId)` after photo creation
- Code at darkroomService.js:106-144 should detect stale timing and refresh it
- Possible causes:
  - Promise not properly awaited
  - Function failing silently (error caught but not visible)
  - Timestamp comparison issue
  - Metro bundler not serving latest code (restart Metro?)

### UAT-002: Darkroom not created even after photo capture

**Discovered:** 2026-01-20
**Phase/Plan:** 13.1-01
**Severity:** Major
**Feature:** Darkroom initialization on photo capture
**Description:** After taking a photo, the darkroom document is NOT created in Firestore. The ensureDarkroomInitialized() function appears to not be running or is failing silently.
**Expected:** After capturing a photo, ensureDarkroomInitialized() should create a darkroom document with nextRevealAt set to 0-15 minutes from now.
**Actual:** No darkroom document is created in Firebase after photo capture.

**Repro:**
1. Use a new user account (or user with no darkroom document)
2. Capture a photo
3. Check Firestore darkrooms collection
4. No document exists for this user

**Investigation Notes:**
- This confirms ensureDarkroomInitialized() at photoService.js:77 is not executing successfully
- Combined with UAT-001 (existing darkroom not updated), this indicates the function is likely:
  - Not being called at all (code not deployed/bundled)
  - Failing before any Firestore write
  - Or the entire createPhoto flow is using old cached code
- **Strong indicator:** Restart Metro bundler and clear cache (`npx expo start -c`)

## Resolved Issues

[None yet]

---

*Phase: 13.1-darkroom-reveal-timing-fix*
*Plan: 01*
*Tested: 2026-01-20*
