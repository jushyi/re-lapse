---
phase: 13.1-darkroom-reveal-timing-fix
plan: 01
subsystem: darkroom
tags: [firebase, firestore, timing, reveal, photo-capture]

# Dependency graph
requires:
  - phase: 13
    provides: Production build setup
provides:
  - Accurate darkroom reveal timing
  - 0-15 minute reveal intervals
  - Auto-initialization on photo capture
affects: [14-remote-notifications]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Ensure service state on action (ensureDarkroomInitialized on photo capture)"

key-files:
  created: []
  modified:
    - src/services/firebase/darkroomService.js
    - src/services/firebase/photoService.js
    - src/screens/DarkroomScreen.js

key-decisions:
  - "Changed reveal interval from 0-2 hours to 0-15 minutes for faster photo reveals"
  - "Added ensureDarkroomInitialized() call after photo capture to guarantee accurate timing"

patterns-established:
  - "Service state initialization: ensure related state exists/valid before returning success"

issues-created: []

# Metrics
duration: 8min
completed: 2026-01-20
---

# Phase 13.1 Plan 01: Darkroom Reveal Timing Fix Summary

**Reduced reveal interval to 0-15 minutes and added darkroom auto-initialization on photo capture for accurate nextRevealAt timing**

## Performance

- **Duration:** 8 min
- **Started:** 2026-01-20T12:00:00Z
- **Completed:** 2026-01-20T12:08:00Z
- **Tasks:** 2
- **Files modified:** 3

## Accomplishments

- Changed reveal interval from 0-2 hours to 0-15 minutes for faster photo reveals
- Added `ensureDarkroomInitialized()` function that creates/refreshes darkroom timing
- Integrated darkroom initialization into photo capture flow for always-accurate nextRevealAt
- Fixed root cause of stale timing: darkroom state now refreshed on every photo capture

## Task Commits

Each task was committed atomically:

1. **Task 1: Update reveal interval to 0-15 minutes** - `249e3ea` (feat)
2. **Task 2: Ensure darkroom timing is set on photo capture** - `af506ac` (feat)

**Plan metadata:** (this commit) (docs: complete plan)

## Files Created/Modified

- `src/services/firebase/darkroomService.js` - Updated interval to 0-15 min, added ensureDarkroomInitialized()
- `src/services/firebase/photoService.js` - Calls ensureDarkroomInitialized() after photo creation
- `src/screens/DarkroomScreen.js` - Updated comment from "0-2 hours" to "0-15 minutes"

## Decisions Made

- **0-15 minute interval:** User requested faster reveals, 15 min max feels responsive while still creating anticipation
- **Initialize on photo capture:** Ensures timing is always accurate regardless of when user last opened darkroom

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None.

## Next Step

Phase 13.1 complete, ready for Phase 14: Remote Notification Testing & Polish.

---
*Phase: 13.1-darkroom-reveal-timing-fix*
*Completed: 2026-01-20*
