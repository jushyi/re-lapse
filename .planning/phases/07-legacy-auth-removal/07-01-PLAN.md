---
phase: 07-legacy-auth-removal
plan: 01
type: execute
---

<objective>
Remove legacy email/password and Apple Sign-In authentication, migrate AuthContext to phone-only auth, and clean up unused auth screens and services.

Purpose: Simplify the authentication flow to phone-only, reducing code complexity and maintenance burden. After Phase 6 integration (06-03), this phase removes all email/Apple auth remnants.
Output: Phone-only authentication system with cleaned-up codebase, no legacy auth code, updated security rules if needed.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-phone-auth-implementation/06-02-SUMMARY.md

# Current Auth State (as of Phase 6):
- React Native Firebase (@react-native-firebase/auth) integrated in Phase 6-01
- Phone auth service (phoneAuthService.js) created in Phase 6-02
- PhoneInputScreen and VerificationScreen created in Phase 6-02
- AuthContext has dual auth support: email/Apple (legacy) + phone (new) in Phase 6-03
- AppNavigator shows LoginScreen/SignUpScreen (legacy) + PhoneInputScreen/VerificationScreen (new)

# Key Files to Modify:
@src/context/AuthContext.js - Remove email/Apple auth functions (signUp, signIn, signInWithApple)
@src/services/firebase/authService.js - Remove entire file OR keep only signOutUser/getCurrentUser if reusable
@src/navigation/AppNavigator.js - Remove LoginScreen, SignUpScreen, ForgotPasswordScreen from auth stack

# Files to Delete:
- src/screens/LoginScreen.js
- src/screens/SignUpScreen.js
- src/screens/ForgotPasswordScreen.js (if exists)

# Patterns Established in Phase 6:
- React Native Firebase auth().onAuthStateChanged() listener (works for both email and phone)
- Phone auth flow: PhoneInputScreen -> VerificationScreen -> ProfileSetup (if new user)
- Auth state management: user (Firebase Auth), userProfile (Firestore), confirmationResult (phone verification)

**Tech stack available:** React Native Firebase (@react-native-firebase/auth), libphonenumber-js
**Established patterns:** Phone-only auth flow, E.164 phone format validation
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove legacy auth functions from AuthContext</name>
  <files>src/context/AuthContext.js</files>
  <action>
Remove the following legacy auth functions from AuthContext.js:
- signUp (email/password) - lines 75-111
- signIn (email/password) - lines 113-128
- signInWithApple - lines 130-165

Remove these imports at top of file:
- signUpWithEmail, signInWithEmail from '../services/firebase/authService'
- signInWithApple as firebaseSignInWithApple from '../services/firebase/authService'

Keep these functions:
- signOut (uses React Native Firebase auth().signOut()) - lines 167-184
- sendPhoneVerification - lines 193-210
- verifyPhoneCode - lines 212-245

Update AuthContext value object at bottom to only export:
{ user, userProfile, loading, initializing, confirmationResult, sendPhoneVerification, verifyPhoneCode, signOut }

Verify auth().onAuthStateChanged() listener remains unchanged (lines 38-73) - it handles both email and phone auth state.
  </action>
  <verify>git diff src/context/AuthContext.js shows signUp, signIn, signInWithApple removed, phone auth functions remain</verify>
  <done>AuthContext only exposes phone auth and signOut functions, legacy email/Apple imports and functions deleted</done>
</task>

<task type="auto">
  <name>Task 2: Delete legacy authentication screens</name>
  <files>src/screens/LoginScreen.js, src/screens/SignUpScreen.js, src/screens/index.js</files>
  <action>
Delete legacy authentication screens:
1. Delete src/screens/LoginScreen.js entirely
2. Delete src/screens/SignUpScreen.js entirely
3. Check if ForgotPasswordScreen.js exists: `ls src/screens/ForgotPasswordScreen.js`. If exists, delete it too.
4. Update src/screens/index.js: Remove exports for LoginScreen, SignUpScreen, ForgotPasswordScreen (if present)

Do NOT delete:
- PhoneInputScreen.js (new auth screen)
- VerificationScreen.js (new auth screen)
- ProfileSetupScreen.js (still needed for new users)
  </action>
  <verify>ls src/screens/Login*.js returns "not found", ls src/screens/SignUp*.js returns "not found", git status shows deleted files</verify>
  <done>Legacy auth screens deleted, src/screens/index.js updated to remove exports, no build errors</done>
</task>

<task type="auto">
  <name>Task 3: Update AppNavigator to remove legacy auth screens</name>
  <files>src/navigation/AppNavigator.js</files>
  <action>
Update AppNavigator.js auth stack (lines 314-334):

Current auth stack has:
- LoginScreen (line 317)
- SignUpScreen (lines 318-321)
- ForgotPasswordScreen (lines 322-325)
- PhoneInputScreen (lines 326-329)
- VerificationScreen (lines 330-333)

Replace with phone-only auth stack:
```jsx
{!isAuthenticated ? (
  // Auth Stack - Phone-only authentication
  <>
    <Stack.Screen name="PhoneInput" component={PhoneInputScreen} />
    <Stack.Screen name="Verification" component={VerificationScreen} />
  </>
) : needsProfileSetup ? (
  // ... rest unchanged
```

Remove imports at top (lines 13-16):
- LoginScreen
- SignUpScreen
- ForgotPasswordScreen

Keep these imports:
- PhoneInputScreen (line 19)
- VerificationScreen (line 20)

Update deep linking config (lines 259-285) to remove:
- Login: 'login' (line 278)
- SignUp: 'signup' (line 279)

Keep:
- PhoneInput: 'phone-input' (line 281)
- Verification: 'verification' (line 282)
  </action>
  <verify>npm run build succeeds with no import errors, git diff shows LoginScreen/SignUpScreen/ForgotPasswordScreen removed from AppNavigator</verify>
  <done>AppNavigator only shows PhoneInput screen for unauthenticated users, legacy screen imports and routes removed, deep linking cleaned up</done>
</task>

<task type="auto">
  <name>Task 4: Remove or simplify legacy authService.js</name>
  <files>src/services/firebase/authService.js, src/services/firebase/index.js</files>
  <action>
Evaluate authService.js (121 lines total):

Functions in authService.js:
- signUpWithEmail (lines 46-53) - REMOVE (no longer used)
- signInWithEmail (lines 61-68) - REMOVE (no longer used)
- signOutUser (lines 74-81) - KEEP? (currently not used, AuthContext calls auth().signOut() directly)
- resetPassword (lines 88-95) - REMOVE (no password reset in phone auth)
- updateUserProfile (lines 102-113) - KEEP? (may be used elsewhere)
- getCurrentUser (lines 119-121) - KEEP? (may be used elsewhere)
- getFirebaseErrorMessage (lines 15-38) - REMOVE (email/password error codes only)

Decision:
- If signOutUser, updateUserProfile, getCurrentUser are not imported anywhere else, DELETE entire authService.js file
- Search codebase: `grep -r "from.*authService" src/ --exclude-dir=node_modules` to verify no other imports
- If no other imports found, DELETE src/services/firebase/authService.js
- Update src/services/firebase/index.js to remove authService exports

If other imports found, keep those specific functions and remove email auth functions only.
  </action>
  <verify>
grep -r "authService" src/ --exclude="authService.js" returns no results (confirms no usage) OR only shows expected removals.
If deleted: ls src/services/firebase/authService.js returns "not found"
  </verify>
  <done>
If fully deleted: authService.js removed, no imports reference it, build succeeds.
If partially kept: Only reusable utility functions remain, email/Apple auth functions removed.
  </done>
</task>

<task type="auto">
  <name>Task 5: Verify Firebase imports and remove unused Firebase JS SDK functions</name>
  <files>src/services/firebase/firebaseConfig.js (if exists)</files>
  <action>
Check Firebase initialization in firebaseConfig.js or similar:

Search for Firebase JS SDK imports:
```bash
grep -r "firebase/auth" src/services/firebase/ --exclude-dir=node_modules
```

Expected findings:
- AuthContext.js should NOT import firebase/auth (removed in Task 1)
- authService.js should NOT exist (removed in Task 4) OR not import email auth functions
- phoneAuthService.js should NOT import firebase/auth (uses @react-native-firebase/auth)

If firebaseConfig.js exists and initializes Firebase JS SDK auth:
- Check if 'auth' export from firebaseConfig is still used anywhere
- If not used: Remove auth export, keep only firestore, storage exports
- Firebase JS SDK can coexist with React Native Firebase (different packages)

Do NOT remove:
- Firebase JS SDK for Firestore (still needed for database operations)
- Firebase JS SDK for Storage (still needed for photo uploads)
- React Native Firebase auth (needed for phone auth)
  </action>
  <verify>
grep -r "firebase/auth" src/ returns no results OR only in firebaseConfig.js (if kept for historical reasons).
npm run build succeeds with no import errors.
  </verify>
  <done>Firebase JS SDK auth imports removed or verified as unused, React Native Firebase auth is primary auth method, no import conflicts</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] npm run build succeeds without errors
- [ ] grep -r "signUpWithEmail\|signInWithEmail\|signInWithApple\|LoginScreen\|SignUpScreen" src/ returns no results (confirms removal)
- [ ] grep -r "PhoneInputScreen\|VerificationScreen\|sendPhoneVerification\|verifyPhoneCode" src/ returns expected results in AuthContext, AppNavigator, phone auth screens
- [ ] AuthContext.js exposes: user, userProfile, loading, initializing, confirmationResult, sendPhoneVerification, verifyPhoneCode, signOut
- [ ] AppNavigator.js auth stack only shows PhoneInputScreen for unauthenticated users
- [ ] No TypeScript/ESLint errors in modified files
</verification>

<success_criteria>

- All legacy auth functions removed from AuthContext (signUp, signIn, signInWithApple)
- LoginScreen.js and SignUpScreen.js deleted from codebase
- ForgotPasswordScreen.js deleted if it exists
- AppNavigator only shows PhoneInput in auth stack
- authService.js either fully deleted or reduced to only reusable utility functions
- Firebase JS SDK auth imports removed from codebase
- npm run build succeeds with no errors
- Phone auth flow remains functional (verified by code inspection, not manual test)
  </success_criteria>

<output>
After completion, create `.planning/phases/07-legacy-auth-removal/07-01-SUMMARY.md`:

---
phase: 07-legacy-auth-removal
plan: 01
subsystem: auth
tags: [phone-auth, legacy-removal, code-cleanup, refactoring]

# Dependency graph
requires:
  - phase: 06-03
    provides: AuthContext integrated with phone auth screens
provides:
  - Phone-only authentication system
  - Cleaned codebase with no email/Apple auth code
affects: [08-polish-testing]

# Tech tracking
tech-stack:
  removed: [Firebase JS SDK auth functions, email/password auth, Apple Sign-In]
  patterns: [phone-only-auth, simplified-auth-flow]

key-files:
  deleted: [src/screens/LoginScreen.js, src/screens/SignUpScreen.js, src/screens/ForgotPasswordScreen.js (if existed), src/services/firebase/authService.js (if fully removed)]
  modified: [src/context/AuthContext.js, src/navigation/AppNavigator.js, src/screens/index.js, src/services/firebase/index.js]

key-decisions:
  - "Removed all email/password and Apple Sign-In code after phone auth migration"
  - "Kept React Native Firebase auth as sole authentication method"
  - "Simplified AppNavigator auth stack to PhoneInput only"

patterns-established:
  - "Phone-only authentication (no email/password fallback)"
  - "Single auth entry point (PhoneInputScreen)"

issues-created: []

# Metrics
duration: [TBD]
completed: [TBD]
---

# Phase 7 Plan 01: Legacy Auth Removal Summary

**[One-line summary of what shipped]**

## Accomplishments

- Removed legacy email/password authentication functions from AuthContext
- Deleted LoginScreen, SignUpScreen, ForgotPasswordScreen from codebase
- Updated AppNavigator to phone-only auth flow
- Cleaned up unused Firebase JS SDK auth imports
- Simplified authentication codebase (removed ~[X] lines of legacy code)

## Files Created/Modified

- `src/context/AuthContext.js` - Removed signUp, signIn, signInWithApple functions
- `src/navigation/AppNavigator.js` - Removed legacy auth screens from stack
- `src/screens/index.js` - Removed legacy screen exports
- `src/services/firebase/index.js` - Removed authService exports (if deleted)

## Files Deleted

- `src/screens/LoginScreen.js` - Legacy email login screen
- `src/screens/SignUpScreen.js` - Legacy email signup screen
- `src/screens/ForgotPasswordScreen.js` - Password reset screen (if existed)
- `src/services/firebase/authService.js` - Legacy auth service (if fully removed)

## Decisions Made

[Document any decisions made during execution]

## Issues Encountered

[Document any issues and resolutions, or "None"]

## Next Phase Readiness

- Phone-only authentication system complete
- Codebase simplified and ready for Phase 8: Polish & Testing
- All legacy auth code removed, no backwards compatibility concerns

---
*Phase: 07-legacy-auth-removal*
*Completed: [TBD]*
</output>
