---
phase: 09-monthly-albums
plan: 02
type: execute
---

<objective>
Create collapsible year sections and monthly albums wrapper component with smooth expand/collapse animations.

Purpose: Organize monthly album cards by year with expandable headers, enabling users to browse their photo history efficiently.
Output: YearSection component with animation and MonthlyAlbumsSection wrapper ready for ProfileScreen integration.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-monthly-albums/09-CONTEXT.md
@.planning/phases/09-monthly-albums/09-01-SUMMARY.md (will exist after Plan 01)

**Relevant source files:**
@src/components/MonthlyAlbumCard.js (created in 09-01)
@src/services/firebase/monthlyAlbumService.js (created in 09-01)
@src/constants/colors.js - Color constants

**Animation reference:**
@src/screens/SelectsScreen.js - Uses LayoutAnimation for smooth transitions
@src/components/AlbumBar.js - Animation patterns

**Key constraints from CONTEXT.md:**

- Year headers: bold text + rotating chevron for expand/collapse
- Current year expanded by default, older years collapsed
- Within each year, months display newest-first (December at top, January at bottom)
- Smooth expand/collapse animations for year sections
- Empty months already filtered out by service (only months with photos returned)
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Create YearSection component with expand/collapse animation</name>
  <files>src/components/YearSection.js</files>
  <action>
Create YearSection component that displays a year header with collapsible month cards.

Props:

- `year` - Year string (e.g., "2026")
- `months` - Array of month data: `[{ month: "2026-01", coverPhotoUrl: string, photoCount: number }, ...]`
- `initiallyExpanded` - Boolean, true for current year
- `onMonthPress` - Callback `(month) => void` when a month card is tapped

Structure:

```
[Year Header with chevron]
  [MonthlyAlbumCard - December]
  [MonthlyAlbumCard - November]
  ...
```

Year Header styling:

- Full width, paddingVertical: 12, paddingHorizontal: 16
- Year text: fontSize 22, fontWeight 'bold', color: colors.text.primary
- Chevron icon: Ionicons 'chevron-down' (rotates to 'chevron-up' when expanded, or use rotation transform)
- Header row: flexDirection 'row', justifyContent 'space-between', alignItems 'center'
- TouchableOpacity for tap to toggle

Animation approach using Animated API:

1. Use `Animated.Value` for chevron rotation (0 = collapsed pointing right, 1 = expanded pointing down)
2. Use `LayoutAnimation.configureNext(LayoutAnimation.Presets.easeInEaseOut)` before state change for smooth height transition
3. Interpolate rotation: `rotation.interpolate({ inputRange: [0, 1], outputRange: ['0deg', '180deg'] })`

State:

- `expanded` - Boolean tracking current state, initialized from `initiallyExpanded`

When collapsed, hide month cards entirely (don't render them, not just opacity 0).

Month cards rendered with 12px gap between them (marginTop: 12 on each card except first).
</action>
<verify>Component renders with header visible, tapping toggles month visibility with smooth animation</verify>
<done>YearSection shows year header with rotating chevron, smoothly expands/collapses to show/hide month cards</done>
</task>

<task type="auto">
  <name>Task 2: Create MonthlyAlbumsSection wrapper component</name>
  <files>src/components/MonthlyAlbumsSection.js, src/components/index.js</files>
  <action>
Create MonthlyAlbumsSection component that fetches and displays all monthly albums organized by year.

Props:

- `userId` - User ID to fetch photos for
- `onMonthPress` - Callback `(month) => void` passed through to YearSection

Component responsibilities:

1. On mount, call `getUserPhotosByMonth(userId)` from monthlyAlbumService
2. Handle loading state (show spinner or loading text)
3. Handle empty state (no photos yet - show nothing or subtle message)
4. Render YearSection for each year in the data

Data transformation:

- Service returns: `{ "2026": [...months], "2025": [...months] }`
- Convert to array sorted by year descending: `[{ year: "2026", months: [...] }, { year: "2025", months: [...] }]`
- Current year = new Date().getFullYear().toString()
- Pass `initiallyExpanded={year === currentYear}` to each YearSection

Layout:

- marginTop: 24 to separate from AlbumBar above
- Each YearSection with marginBottom: 16 for spacing between years

Empty state: If no monthly data (user has no triaged photos), render nothing (transparent) - the section simply doesn't appear. Per CONTEXT.md "Empty months are hidden entirely" - extend to entire section if empty.

Loading state: Small ActivityIndicator centered, or just render nothing while loading (brief flash acceptable).

Export MonthlyAlbumsSection and YearSection from components/index.js barrel.
</action>
<verify>Component fetches data on mount and renders year sections with correct expand states</verify>
<done>MonthlyAlbumsSection fetches photo data, renders YearSection per year with current year expanded, handles loading/empty gracefully</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] YearSection component with expand/collapse animation working
- [ ] Chevron rotates smoothly on toggle
- [ ] MonthlyAlbumsSection fetches and organizes data by year
- [ ] Current year expanded by default, older years collapsed
- [ ] Both components exported from src/components/index.js
- [ ] No TypeScript/lint errors
</verification>

<success_criteria>

- YearSection shows collapsible year headers with smooth animation
- MonthlyAlbumsSection organizes data and manages expand states correctly
- Components follow existing codebase patterns
- Ready for Plan 09-03 (grid view and ProfileScreen integration)
  </success_criteria>

<output>
After completion, create `.planning/phases/09-monthly-albums/09-02-SUMMARY.md` with frontmatter:

```yaml
---
phase: 09-monthly-albums
plan: 02
subsystem: ui
tags: [react-native, animation, collapsible, monthly-albums]

requires:
  - phase: 09-01
    provides: monthlyAlbumService and MonthlyAlbumCard

provides:
  - YearSection collapsible component
  - MonthlyAlbumsSection data-fetching wrapper

affects: [09-03, profile-screen]

tech-stack:
  added: []
  patterns: [collapsible-section, layout-animation]

key-files:
  created:
    - src/components/YearSection.js
    - src/components/MonthlyAlbumsSection.js
  modified:
    - src/components/index.js

key-decisions: []
patterns-established: []
issues-created: []

duration: TBD
completed: TBD
---
```

</output>
