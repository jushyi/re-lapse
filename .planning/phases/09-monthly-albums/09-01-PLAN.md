---
phase: 09-monthly-albums
plan: 01
type: execute
---

<objective>
Create monthly albums data layer and card component for displaying photos grouped by month.

Purpose: Enable querying user photos organized by month/year and provide visual representation as full-width cards with month name overlay.
Output: monthlyAlbumService.js with query functions and MonthlyAlbumCard component ready for integration.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-monthly-albums/09-CONTEXT.md

**From Phase 8:**
@.planning/phases/08-user-albums/08-01-SUMMARY.md - albumService patterns
@.planning/phases/08-user-albums/08-02-SUMMARY.md - AlbumCard component patterns

**Relevant source files:**
@src/services/firebase/photoService.js - Photos have `month` field (YYYY-MM format), `photoState` for journal/archive
@src/services/firebase/index.js - Service barrel export pattern
@src/components/AlbumCard.js - Card component patterns to adapt

**Key constraints from CONTEXT.md:**

- Monthly albums are read-only, auto-generated
- Include both journaled AND archived photos (photoState: 'journal' OR 'archive')
- Empty months should be hidden (only return months with photos)
- Last photo of month (most recent by capturedAt) becomes cover
- Cards are full-width (larger than user album 150x150 cards)
- Month name overlay: bottom-left, white text, subtle shadow
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Create monthlyAlbumService.js with query functions</name>
  <files>src/services/firebase/monthlyAlbumService.js, src/services/firebase/index.js</files>
  <action>
Create monthlyAlbumService.js following existing service patterns (photoService, albumService).

Functions to implement:

1. `getUserPhotosByMonth(userId)` - Main query function:
   - Query photos where userId matches AND status='triaged' AND photoState IN ['journal', 'archive']
   - Group results by `month` field (YYYY-MM format)
   - For each month, sort photos by capturedAt descending and take the last one as cover
   - Return structure: `{ success: true, monthlyData: { "2026": [{ month: "2026-01", coverPhoto: {...}, photoCount: N, photos: [...] }, ...], "2025": [...] } }`
   - Years sorted descending (newest first), months within year sorted descending (December first)
   - Return empty object for years with no photos

2. `getMonthPhotos(userId, month)` - Get all photos for a specific month:
   - Query photos where userId, month matches, status='triaged', photoState IN ['journal', 'archive']
   - Sort by capturedAt descending
   - Return `{ success: true, photos: [...] }`

Use existing Firebase imports pattern. No composite index needed - filter on userId+month in separate queries then filter photoState client-side if needed. Add barrel export to index.js.
</action>
<verify>Import functions in a test file or check syntax with `npx tsc --noEmit` if TypeScript, otherwise manual review that service follows patterns</verify>
<done>monthlyAlbumService.js exports getUserPhotosByMonth and getMonthPhotos, both handle empty results gracefully</done>
</task>

<task type="auto">
  <name>Task 2: Create MonthlyAlbumCard component</name>
  <files>src/components/MonthlyAlbumCard.js, src/components/index.js</files>
  <action>
Create MonthlyAlbumCard component for full-width monthly album display.

Props:

- `month` - Month string in YYYY-MM format
- `coverPhotoUrl` - URL for cover image
- `onPress` - Callback when card is tapped

Visual specs from CONTEXT.md:

- Full-width card (SCREEN_WIDTH - 32px for 16px margins on each side)
- Height: ~180px (visually distinct from 150x150 user album cards)
- Cover photo fills card with resizeMode 'cover'
- Month name overlay at bottom-left corner:
  - Format: Full month name only ("January", "February") - NOT year, just month
  - White text (#FFFFFF), fontSize 20, fontWeight 'bold'
  - Text shadow for readability on photos: `textShadowColor: 'rgba(0,0,0,0.7)', textShadowOffset: { width: 1, height: 1 }, textShadowRadius: 3`
  - Position: absolute, bottom: 12, left: 12
- Rounded corners: borderRadius 12
- No photo count displayed (per CONTEXT.md: "Cards are clean - no photo count")

Helper function to convert YYYY-MM to display name:

```javascript
const getMonthDisplayName = monthStr => {
  const [year, month] = monthStr.split('-');
  const date = new Date(parseInt(year), parseInt(month) - 1, 1);
  return date.toLocaleString('default', { month: 'long' });
};
```

If no coverPhotoUrl, show dark placeholder with month name only (colors.background.tertiary).

Export from components/index.js barrel.
</action>
<verify>Component renders without errors: check import in ProfileScreen temporarily or use React Native debugger</verify>
<done>MonthlyAlbumCard displays full-width card with cover photo and month name overlay, handles missing photo gracefully</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] monthlyAlbumService.js created with getUserPhotosByMonth and getMonthPhotos
- [ ] Service exported from src/services/firebase/index.js
- [ ] MonthlyAlbumCard component created with full-width layout and month overlay
- [ ] Component exported from src/components/index.js
- [ ] No TypeScript/lint errors
</verification>

<success_criteria>

- monthlyAlbumService can query and group photos by month/year
- MonthlyAlbumCard renders full-width card with proper styling
- Both follow existing codebase patterns
- Ready for Plan 09-02 (YearSection integration)
  </success_criteria>

<output>
After completion, create `.planning/phases/09-monthly-albums/09-01-SUMMARY.md` with frontmatter:

```yaml
---
phase: 09-monthly-albums
plan: 01
subsystem: database, ui
tags: [firestore, monthly-albums, service, component]

requires:
  - phase: 08-user-albums
    provides: Album patterns and card component structure

provides:
  - monthlyAlbumService for querying photos by month
  - MonthlyAlbumCard component for display

affects: [09-02, 09-03, profile-monthly-albums]

tech-stack:
  added: []
  patterns: [month-grouping-query, full-width-card]

key-files:
  created:
    - src/services/firebase/monthlyAlbumService.js
    - src/components/MonthlyAlbumCard.js
  modified:
    - src/services/firebase/index.js
    - src/components/index.js

key-decisions: []
patterns-established: []
issues-created: []

duration: TBD
completed: TBD
---
```

</output>
