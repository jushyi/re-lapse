---
phase: 52-systematic-uat
plan: 02
type: execute
---

<objective>
Test multi-device features â€” friend requests, push notifications, real-time feed updates, photo tagging, @mentions â€” features requiring two phones.

Purpose: Verify real-time synchronization and notification delivery work correctly across devices.
Output: All multi-device interactions tested, notifications verified, real-time updates confirmed.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/52-systematic-uat/52-CONTEXT.md

@src/services/firebase/friendshipService.js
@src/services/firebase/notificationService.js
@src/services/firebase/feedService.js
@src/services/firebase/photoService.js
@src/services/firebase/commentService.js

**Testing device:** Two physical iPhones (Device A and Device B)
**Firebase environment:** Dev environment
**Starting state:** Both phones logged in with different accounts

**Features to test:**

- Friend requests (send, receive, accept, reject)
- Push notifications (all types: friend request, comment, tag, mention, darkroom ready, reactions)
- Real-time feed updates (new photo appears immediately)
- Photo tagging (tag another user in photo)
- Comment @mentions (mention another user, notification sent)
- Mutual friends suggestions
- Story viewed state synchronization
- Edge cases: offline/reconnect, rapid actions, notification permission denied
  </context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <action>Set up two iPhones for multi-device testing</action>
  <instructions>
    **Device A:** Your primary testing phone (used in all previous plans)
    **Device B:** A second iPhone (can be another personal device, borrowed device, or simulator if absolutely necessary, but physical device preferred)

    1. Install Flick on Device B (same build as Device A)
    2. Create a new account on Device B (or sign in with existing test account)
    3. Complete onboarding on Device B
    4. Verify both devices are on same dev Firebase environment
    5. Verify both devices have push notification permission enabled (grant when prompted)
    6. Write down the usernames for both accounts:
       - Device A username: ___________
       - Device B username: ___________

  </instructions>
  <verification>Both devices logged in, notifications enabled, usernames noted</verification>
  <resume-signal>Type "ready" with both usernames when both devices are set up</resume-signal>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Friend request flow (send, receive, accept, reject)</what-built>
  <how-to-verify>
    **Step 1: Send Friend Request (Device A â†’ Device B)**
    1. On Device A, go to search or friends screen
    2. Search for Device B's username
    3. Tap their profile
    4. Tap "Add Friend" or send friend request button
    5. Verify button changes to "Pending" or similar
    6. On Device B, verify push notification received: "[Device A username] sent you a friend request"
    7. On Device B, go to Notifications or Friend Requests
    8. Verify friend request appears in list

    **Expected:**
    - Friend request sends successfully
    - Device A shows pending state
    - Device B receives push notification within 5 seconds
    - Request appears in Device B's notifications

    **Step 2: Accept Friend Request (Device B)**
    1. On Device B, tap the friend request notification (or open from notifications screen)
    2. Verify shows Device A's profile with "Accept" and "Reject" buttons
    3. Tap "Accept"
    4. Verify success message appears
    5. On Device A, verify push notification received: "[Device B username] accepted your friend request"
    6. On both devices, go to Friends screen
    7. Verify each user now appears in the other's friends list

    **Expected:**
    - Accept updates both devices immediately
    - Push notification sent to Device A
    - Both friends lists updated

    **Step 3: Send and Reject Friend Request (Device B â†’ New User)**
    1. Create a third test account (Device C, or use existing test account)
    2. On Device B, send friend request to Device C
    3. On Device C, receive request
    4. On Device C, tap "Reject"
    5. On Device B, verify no notification (reject is silent)
    6. On Device B, go to Device C's profile
    7. Verify "Add Friend" button reappears (can re-send request)

    **Expected:**
    - Reject removes request
    - No notification sent to sender
    - Sender can re-send request

    **If creating Device C is too complex:** Skip this step, reject testing can be manual later.

  </how-to-verify>
  <resume-signal>Type "approved" if friend request tests pass, or describe issues</resume-signal>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Real-time feed updates and notifications</what-built>
  <how-to-verify>
    **Prerequisites:** Device A and Device B are now friends (from previous checkpoint)

    **Step 1: New Photo in Feed**
    1. On Device B, go to Camera tab
    2. Capture a new photo
    3. Wait for upload to complete
    4. Wait for photo to reveal (if reveal time imminent) OR manually trigger reveal if dev environment allows
    5. On Device A, go to Feed tab
    6. Pull to refresh OR wait a few seconds
    7. Verify Device B's new photo appears in feed

    **Expected:**
    - Photo appears in Device A's feed within 10 seconds
    - Real-time subscription or pull-to-refresh works

    **Step 2: Comment Notification**
    1. On Device A, tap Device B's photo from feed
    2. Add a comment: "Test comment from Device A"
    3. Post comment
    4. On Device B, verify push notification received: "[Device A username] commented on your photo"
    5. On Device B, tap notification
    6. Verify navigates to photo detail with comments visible

    **Expected:**
    - Comment notification arrives within 5 seconds
    - Notification tap navigates correctly
    - Comment visible on Device B

    **Step 3: @Mention Notification**
    1. On Device A, add another comment mentioning Device B: "Hey @[DeviceB_username], test mention"
    2. Post comment
    3. On Device B, verify push notification: "[Device A username] mentioned you in a comment"
    4. On Device B, tap notification
    5. Verify navigates to photo with mention highlighted

    **Expected:**
    - Mention notification sent
    - Navigation works
    - Mention is clickable

    **Step 4: Reaction Notification**
    1. On Device A, add a reaction (emoji) to Device B's photo
    2. On Device B, verify push notification: "[Device A username] reacted ðŸ˜‚ to your photo"
    3. Tap notification
    4. Verify navigates to photo detail

    **Expected:**
    - Reaction notification sent
    - Emoji shows in notification
    - Navigation works

    **Step 5: Darkroom Ready Notification (if testable)**
    1. On Device A, capture a new photo
    2. Wait for next darkroom reveal time (or trigger manually if dev allows)
    3. Verify Device A receives push notification: "Your photos are ready to reveal!"
    4. Tap notification
    5. Verify navigates to darkroom screen

    **Expected:**
    - Darkroom ready notification sent at reveal time
    - Navigation to darkroom works

    **If reveal time too far:** Skip this, we've tested darkroom logic in Plan 52-04.

  </how-to-verify>
  <resume-signal>Type "approved" if feed updates and notifications tests pass, or describe issues</resume-signal>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Photo tagging and mutual friends</what-built>
  <how-to-verify>
    **Step 1: Tag User in Photo**
    1. On Device A, go to one of your photos (Profile â†’ Photos â†’ tap photo)
    2. Tap menu (three dots) â†’ "Tag People"
    3. Search for Device B's username
    4. Select Device B
    5. Verify tag added to photo
    6. On Device B, verify push notification: "[Device A username] tagged you in a photo"
    7. On Device B, tap notification
    8. Verify navigates to photo detail
    9. On Device B, go to Profile â†’ Photos Tagged (or similar)
    10. Verify tagged photo appears in tagged section

    **Expected:**
    - Tagging flow works
    - Tag notification sent
    - Tagged photo appears in tagged section

    **Step 2: Remove Tag**
    1. On Device A (or Device B), open the tagged photo
    2. Tap menu â†’ "Remove Tag"
    3. Select Device B's tag
    4. Confirm removal
    5. On Device B, verify tagged photo removed from tagged section

    **Expected:**
    - Tag removal works
    - Photo removed from tagged section

    **Step 3: Mutual Friends Suggestions**
    1. On Device A, add another friend (Device C from earlier, or create new test account)
    2. On Device B, add the same friend (Device C)
    3. On Device A, go to Friends screen â†’ Suggestions
    4. Verify Device C does NOT appear (already friends)
    5. On Device B, go to Friends screen â†’ Suggestions
    6. Verify Device C does NOT appear (already friends)
    7. If Device C is NOT friends with Device A yet, verify Device C appears in Device A's suggestions as "mutual friend of Device B"

    **Expected:**
    - Mutual friends suggestions appear
    - Already-friends users don't appear in suggestions

    **If setting up Device C is too complex:** Skip mutual friends test, note that feature exists from Phase 42.

  </how-to-verify>
  <resume-signal>Type "approved" if tagging and mutual friends tests pass, or describe issues (or "skip-mutual-friends" if Device C setup too complex)</resume-signal>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Edge cases and notification settings</what-built>
  <how-to-verify>
    **Step 1: Notification Permission Denied**
    1. On Device B, go to iPhone Settings â†’ Flick â†’ Notifications
    2. Toggle notifications OFF
    3. On Device A, send Device B a comment
    4. On Device B, verify NO push notification received (expected)
    5. On Device B, open app â†’ go to Notifications screen
    6. Verify comment notification appears in in-app list (push disabled, but in-app should work)
    7. Re-enable push notifications in iPhone Settings

    **Expected:**
    - No push notification when permission denied
    - In-app notifications still work
    - Re-enabling restores push

    **Step 2: Notification Settings in App**
    1. On Device A, go to Settings â†’ Notifications
    2. Toggle "Comment notifications" OFF
    3. On Device B, comment on Device A's photo
    4. On Device A, verify NO push notification (disabled in settings)
    5. On Device A, go to in-app Notifications screen
    6. Verify comment still appears in-app (only push disabled)
    7. Re-enable "Comment notifications"

    **Expected:**
    - In-app notification toggles work
    - Disabling stops push but not in-app
    - Re-enabling restores push

    **Step 3: Offline/Reconnect**
    1. On Device B, enable Airplane Mode
    2. On Device A, send Device B a comment
    3. Verify Device B receives no notification (offline)
    4. On Device B, disable Airplane Mode (reconnect)
    5. Wait 5-10 seconds
    6. Verify Device B receives push notification for missed comment

    **Expected:**
    - Offline state prevents notification
    - Reconnect triggers missed notifications
    - No duplicate notifications

    **Step 4: Rapid Actions (Stress Test)**
    1. On Device A, rapidly add 10 reactions to Device B's photos (tap 10 photos quickly)
    2. On Device B, verify notifications arrive (may batch or arrive individually)
    3. Verify app doesn't crash from notification flood
    4. Verify all 10 reactions visible on Device B

    **Expected:**
    - Multiple rapid notifications handled gracefully
    - No crashes or lost notifications
    - All actions recorded

  </how-to-verify>
  <resume-signal>Type "approved" if edge case tests pass, or describe issues</resume-signal>
</task>

<task type="auto">
  <name>Fix any issues found during multi-device testing</name>
  <files>Determined by issues found</files>
  <action>If issues found (e.g., notifications not sending, friend request fails, real-time updates don't appear, tagging broken), investigate and fix inline. Read notification/friendship/feed services, diagnose, fix, have user re-test. Multi-device bugs can be trickyâ€”if issue is complex (Firebase rules, FCM token issues), escalate to GitHub.</action>
  <verify>User confirms issue is resolved</verify>
  <done>All reported issues fixed or escalated</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Two devices set up and logged in
- [ ] Friend requests send, receive, accept, reject correctly
- [ ] Push notifications deliver for all event types
- [ ] Real-time feed updates appear
- [ ] Comment, mention, reaction notifications work
- [ ] Photo tagging sends notifications and appears in tagged section
- [ ] Mutual friends suggestions appear (if tested)
- [ ] Notification permission denial handled
- [ ] In-app notification settings work
- [ ] Offline/reconnect delivers missed notifications
- [ ] Rapid actions don't crash app
- [ ] No critical bugs left unresolved
</verification>

<success_criteria>

- Friend requests work bidirectionally with notifications
- All notification types deliver within 5 seconds
- Real-time feed updates appear across devices
- Tagging and mentions trigger notifications correctly
- Notification settings (in-app and iOS) respected
- Edge cases handled (offline, permission denied, rapid actions)
- Multi-device synchronization reliable
  </success_criteria>

<output>
After completion, create `.planning/phases/52-systematic-uat/52-02-SUMMARY.md`:

# Plan 52-02 Summary: Multi-Device Tests

**[One-line summary of test results]**

## Test Results

**Friend Requests:**

- Send request: [PASS/FAIL + notes]
- Receive notification: [PASS/FAIL + notes]
- Accept flow: [PASS/FAIL + notes]
- Reject flow: [PASS/FAIL/SKIPPED + notes]

**Notifications:**

- Comment: [PASS/FAIL + notes]
- @Mention: [PASS/FAIL + notes]
- Reaction: [PASS/FAIL + notes]
- Tag: [PASS/FAIL + notes]
- Darkroom ready: [PASS/FAIL/SKIPPED + notes]

**Real-Time Updates:**

- Feed updates: [PASS/FAIL + notes]
- Comment appears: [PASS/FAIL + notes]

**Tagging:**

- Add tag: [PASS/FAIL + notes]
- Tag notification: [PASS/FAIL + notes]
- Tagged section: [PASS/FAIL + notes]
- Remove tag: [PASS/FAIL + notes]

**Mutual Friends:**

- Suggestions: [PASS/FAIL/SKIPPED + notes]

**Edge Cases:**

- Permission denied: [PASS/FAIL + notes]
- In-app settings: [PASS/FAIL + notes]
- Offline/reconnect: [PASS/FAIL + notes]
- Rapid actions: [PASS/FAIL + notes]

## Issues Found

[List any bugs or issues]

## Inline Fixes Applied

[List fixes or "None"]

## Next Step

Ready for 52-03-PLAN.md (Auth & Account Management)

**Note:** Device B can now be put away. Remaining tests are single-device only.
</output>
