---
phase: 52-systematic-uat
plan: 09
type: execute
---

<objective>
Test contributions page, in-app purchase flow, and name color perk — the monetization feature from Phase 51.

Purpose: Verify IAP integration works correctly, purchase flow is smooth, and name color perk applies app-wide after purchase.
Output: Contributions page tested, purchase flow verified (or mocked in dev), name color perk confirmed functional.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/52-systematic-uat/52-CONTEXT.md

@src/screens/ContributionsScreen.js
@src/screens/EditProfileScreen.js
@src/services/iapService.js
@src/context/AuthContext.js

**Testing device:** Physical iPhone
**Firebase environment:** Dev environment
**Starting state:** Logged in

**Features to test:**

- Contributions screen (pitch, tier buttons, Giphy attribution)
- IAP purchase flow (sandbox or production depending on build)
- Purchase success handling
- Name color picker after purchase
- Name color display app-wide (feed, comments, profiles, etc.)
- Color editing from Edit Profile
- Edge cases: purchase failure, restore purchases

**IAP Testing Note:**
IAP requires App Store Connect sandbox account or production. If sandbox is configured, purchases will work. If not, we'll verify UI and defer actual purchase testing to production smoke test.
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Contributions screen and pitch</what-built>
  <how-to-verify>
    **Step 1: Navigate to Contributions**
    1. Go to Profile → Settings → Support → Contribute (or wherever contributions is)
    2. Verify ContributionsScreen appears

    **Expected:**
    - Screen accessible from settings

    **Step 2: Review Pitch and Tiers**
    1. Read the personal pitch at top of screen
    2. Verify tone is heartfelt, not corporate (from Phase 51 context)
    3. Verify 4 tier buttons appear: $0.99, $2.99, $4.99, $9.99
    4. Verify each button shows price clearly
    5. Verify all tiers unlock the same perk (name color)
    6. Verify perk description is clear ("Choose a custom name color")

    **Expected:**
    - Pitch is personal and genuine
    - 4 tier options visible
    - Prices displayed correctly
    - Perk benefit clear

    **Step 3: Giphy Attribution (if GIFs used)**
    1. Scroll to bottom of contributions screen
    2. Verify Giphy attribution appears ("Powered by GIPHY" or similar)
    3. Verify attribution is visible and meets Giphy requirements

    **Expected:**
    - Attribution present and visible
    - Meets Giphy's branding guidelines

    **If no GIFs on this screen:** Attribution may be on other screens (feed, comments). Note it and move on.

  </how-to-verify>
  <resume-signal>Type "approved" if contributions screen tests pass, or describe issues</resume-signal>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>In-app purchase flow</what-built>
  <how-to-verify>
    **NOTE:** IAP testing depends on App Store Connect sandbox configuration. If sandbox account not set up, purchases will fail. We'll verify UI flow and defer actual purchase to production.

    **Step 1: Initiate Purchase**
    1. On ContributionsScreen, tap the $0.99 tier button
    2. Verify iOS purchase sheet appears (native App Store UI)
    3. Verify product title and price shown correctly
    4. If sandbox account configured: Tap "Buy"
    5. If NOT configured: Tap "Cancel" (we'll test UI only)

    **Expected (if sandbox works):**
    - Purchase sheet appears
    - Price and product name correct
    - Sandbox account login may prompt

    **Expected (if sandbox not configured):**
    - Purchase sheet appears but fails with "Cannot connect to iTunes Store" or similar
    - App handles failure gracefully with error message

    **Step 2: Handle Purchase Success (if sandbox works)**
    1. After purchase completes, verify ContributionsScreen updates
    2. Verify tier buttons now show "Purchased" or similar state
    3. Verify color picker appears on screen (below tiers or as modal)
    4. Verify color picker shows color wheel or palette
    5. Select a color (e.g., electric cyan)
    6. Tap "Save" or confirm selection
    7. Verify success message appears

    **Expected:**
    - Purchase success detected
    - UI updates to show purchased state
    - Color picker appears immediately
    - Color selection works

    **If purchase fails (sandbox not configured):**
    - Verify error message is clear
    - Note that actual IAP will be tested in production smoke test (Plan 52-10)
    - Skip to Step 4 (manual name color setting for UI testing)

    **Step 3: Restore Purchases (if IAP works)**
    1. Look for "Restore Purchases" button on ContributionsScreen
    2. Tap "Restore Purchases"
    3. Verify attempts to restore
    4. If already purchased, verify shows "Already purchased" or similar
    5. If not purchased, verify shows "No purchases to restore"

    **Expected:**
    - Restore button exists and works
    - Provides feedback on result

    **Step 4: Manual Name Color for Testing (if IAP failed)**
    If IAP purchases don't work in dev, we can manually set name color via Firebase console to test the perk display:

    1. Note: I (Claude) can update Firestore directly to set `nameColor` field
    2. This allows us to test the perk display without actual purchase
    3. We'll do actual purchase testing in Plan 52-10 (production smoke test)

    Type "iap-works" if purchase succeeded, or "iap-failed" if purchase failed (I'll set nameColor manually for UI testing)

  </how-to-verify>
  <resume-signal>Type "iap-works" if purchases work, "iap-failed" if they don't, or describe other issues</resume-signal>
</task>

<task type="auto">
  <name>Set name color manually if IAP unavailable</name>
  <files>None (Firestore update)</files>
  <action>If user types "iap-failed", use Firebase Admin SDK (or Firestore REST API) to set `nameColor` field on user document to a test color (e.g., "#00D4FF"). This allows testing name color display without working IAP. If "iap-works", skip this task.</action>
  <verify>User document updated with nameColor field</verify>
  <done>nameColor set, ready for display testing</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Name color perk display app-wide</what-built>
  <how-to-verify>
    **Prerequisites:** Name color set (either via purchase or manual Firestore update)

    **Step 1: Verify Color in Own Profile**
    1. Go to Profile tab
    2. Verify your username displays in the custom color (not default white)
    3. Verify color matches the one you selected

    **Expected:**
    - Username color changed from white to custom color
    - Color accurate

    **Step 2: Verify Color in Feed**
    1. Go to Feed tab
    2. If you have photos in feed (or post one), verify your username shows in custom color
    3. Verify other users' names still white (unless they also purchased)

    **Expected:**
    - Custom color applied to your name in feed
    - Other users unaffected

    **Step 3: Verify Color in Comments**
    1. Go to a photo with comments (or add a comment)
    2. Verify your username in comment shows custom color
    3. Verify reply mentions (@username) also show custom color

    **Expected:**
    - Comment username colored
    - Mentions colored

    **Step 4: Verify Color on Other Screens**
    1. Go to Notifications → verify your name in notifications colored
    2. Go to Friends screen → verify your name colored (if shown)
    3. View your profile from another user's perspective (if possible) → verify colored

    **Expected:**
    - Name color applied consistently app-wide
    - No screens show default white after purchase

    **Step 5: Edit Color from Edit Profile**
    1. Go to Profile → Edit Profile
    2. Look for "Name Color" field or button
    3. Tap to open color picker
    4. Select a different color
    5. Save
    6. Verify color updates across app immediately

    **Expected:**
    - Color editable from Edit Profile
    - Picker shows current color selected
    - Changes apply immediately app-wide

  </how-to-verify>
  <resume-signal>Type "approved" if name color perk tests pass, or describe issues</resume-signal>
</task>

<task type="auto">
  <name>Fix any issues found during contributions/IAP testing</name>
  <files>Determined by issues found</files>
  <action>If issues found (e.g., tier buttons don't trigger purchase, color picker doesn't appear, name color doesn't apply, Edit Profile color picker broken), investigate and fix inline. Read IAP service and ContributionsScreen, diagnose, fix, have user re-test. Note: IAP connection issues are expected in dev if sandbox not configured—defer to production test. Escalate complex issues to GitHub.</action>
  <verify>User confirms issue is resolved</verify>
  <done>All reported issues fixed or escalated</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Contributions screen loads and displays pitch/tiers
- [ ] Giphy attribution present (if applicable)
- [ ] IAP purchase flow initiates (success or expected failure noted)
- [ ] Name color picker appears after purchase (or manual set)
- [ ] Name color displays app-wide (profile, feed, comments, notifications)
- [ ] Name color editable from Edit Profile
- [ ] Restore purchases works (if IAP functional)
- [ ] No crashes or broken UI
</verification>

<success_criteria>

- Contributions screen accessible and displays correctly
- IAP purchase flow initiates (actual purchase may fail in dev—that's OK)
- Name color perk applies app-wide after purchase (or manual set)
- Color picker works in contributions and Edit Profile
- Color changes reflect immediately across all screens
- Edge cases noted (IAP sandbox issues deferred to production)
  </success_criteria>

<output>
After completion, create `.planning/phases/52-systematic-uat/52-09-SUMMARY.md`:

# Plan 52-09 Summary: Contributions & IAP

**[One-line summary of test results]**

## Test Results

**Contributions Screen:**

- Navigation: [PASS/FAIL + notes]
- Pitch & tiers: [PASS/FAIL + notes]
- Giphy attribution: [PASS/FAIL/N/A + notes]

**IAP Flow:**

- Purchase initiation: [PASS/FAIL + notes]
- Purchase completion: [PASS/FAIL/DEFERRED + notes]
- Restore purchases: [PASS/FAIL/DEFERRED + notes]

**Name Color Perk:**

- Color picker: [PASS/FAIL + notes]
- Display in profile: [PASS/FAIL + notes]
- Display in feed: [PASS/FAIL + notes]
- Display in comments: [PASS/FAIL + notes]
- Display in notifications: [PASS/FAIL + notes]
- Edit from profile: [PASS/FAIL + notes]

## IAP Testing Note

[If IAP failed in dev: "IAP purchases failed due to sandbox configuration. Actual purchase flow will be tested in Plan 52-10 (production smoke test). Name color display tested via manual Firestore update."]

## Issues Found

[List any bugs or issues]

## Inline Fixes Applied

[List fixes or "None"]

## Next Step

Ready for 52-10-PLAN.md (Production Smoke Test)
</output>
