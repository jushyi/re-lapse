---
phase: 39-darkroom-tagging
plan: 01-FIX
type: fix
---

<objective>
Fix 1 UAT issue from plan 39-01: relocate tag button from triage bar to bottom-right of each photo card.

Source: 39-01-ISSUES.md
Priority: 0 critical, 0 major, 1 minor
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md

**Issues being fixed:**
@.planning/phases/39-darkroom-tagging/39-01-ISSUES.md

**Original plan for reference:**
@.planning/phases/39-darkroom-tagging/39-01-PLAN.md

# Key source files:

@src/screens/DarkroomScreen.js
@src/styles/DarkroomScreen.styles.js
@src/components/SwipeablePhotoCard.js
@src/styles/SwipeablePhotoCard.styles.js
@src/hooks/useDarkroom.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Move tag button from triage bar to photo card overlay</name>
  <files>src/screens/DarkroomScreen.js, src/styles/DarkroomScreen.styles.js, src/components/SwipeablePhotoCard.js, src/styles/SwipeablePhotoCard.styles.js</files>
  <action>
Move the tag button from the bottom triage bar to a small overlay icon on the bottom-right of each active photo card.

**1. DarkroomScreen.js changes:**

- REMOVE the tag button TouchableOpacity and its badge from the triageButtonBar (lines 281-284)
- REMOVE `currentPhotoTags` and `currentPhotoHasTags` computed values (lines 61-62) â€” these will be computed inside the card rendering
- Pass new props to SwipeablePhotoCard (only the active card, stackIndex===0):
  - `onTagPress={handleOpenTagModal}`
  - `hasTagged={getTagsForPhoto(photo.id).length > 0}`
- Keep TagFriendsModal rendering at the bottom of the component exactly as-is

**2. SwipeablePhotoCard.js changes:**

- Accept two new optional props: `onTagPress` and `hasTagged`
- Inside the cardContent Animated.View, after the Image component and BEFORE the overlay views, add a tag button overlay (only when `onTagPress` is provided):
  ```jsx
  {
    onTagPress && (
      <TouchableOpacity style={styles.tagOverlayButton} onPress={onTagPress} activeOpacity={0.7}>
        <Ionicons name="person-add-outline" size={20} color={colors.icon.primary} />
        {hasTagged && <View style={styles.tagOverlayBadge} />}
      </TouchableOpacity>
    );
  }
  ```
- Add imports for TouchableOpacity from react-native, Ionicons from @expo/vector-icons, and colors from constants

**3. SwipeablePhotoCard.styles.js changes:**

- Add `tagOverlayButton` style:
  - position: 'absolute'
  - bottom: 12
  - right: 12
  - width: 40
  - height: 40
  - borderRadius: 20
  - backgroundColor: colors.overlay.medium (semi-transparent dark background for visibility over photo)
  - justifyContent: 'center'
  - alignItems: 'center'
  - zIndex: 5 (above image, below swipe overlays)

- Add `tagOverlayBadge` style:
  - position: 'absolute'
  - top: 4
  - right: 4
  - width: 8
  - height: 8
  - borderRadius: 4
  - backgroundColor: colors.interactive.primary (purple dot)

**4. DarkroomScreen.styles.js changes:**

- REMOVE `tagButton` and `tagBadge` style definitions (no longer needed since they moved to SwipeablePhotoCard.styles.js)

Note: The tag button should ONLY appear on the active (front) card since `onTagPress` is only passed when `isActive` is true. Stack cards behind won't have the button.
</action>
<verify>Tag button appears as small overlay on bottom-right of active photo card, not in triage bar. Badge dot shows when photo has tags. Tapping opens TagFriendsModal.</verify>
<done>Tag button relocated from triage bar to bottom-right of photo card. Triage bar has 3 buttons (Archive, Delete, Journal). Tag button only shows on active card with purple badge when tagged.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Tag button removed from triage bar
- [ ] Tag button appears as overlay on bottom-right of active photo card
- [ ] Tag button does NOT appear on stacked (behind) cards
- [ ] Tapping tag button opens TagFriendsModal
- [ ] Purple badge dot shows when current photo has tags
- [ ] Triage bar has 3 buttons: Archive, Delete, Journal (no tag button)
- [ ] All existing triage functionality still works (swipe, buttons, undo)
</verification>

<success_criteria>

- UAT-001 from 39-01-ISSUES.md resolved
- Tag button on photo card bottom-right
- No regressions in triage flow
- Ready for re-verification
  </success_criteria>

<output>
After completion, create `.planning/phases/39-darkroom-tagging/39-01-FIX-SUMMARY.md`
</output>
