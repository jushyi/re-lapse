---
phase: 12-own-snaps-stories-bar
plan: 01
type: execute
---

<objective>
Display user's own journaled snaps in the stories bar with disabled self-reactions.

Purpose: Let users view their own snaps alongside friends' stories, see friend activity (reactions/comments), and add their own comments - while preventing nonsensical self-reactions.
Output: MeStoryCard component, getUserStoriesData service function, FeedScreen integration with reaction-disabled viewer.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-own-snaps-stories-bar/12-CONTEXT.md

# Prior phase context:

@.planning/phases/11-feed-reaction-emoji/11-01-SUMMARY.md

# Key files to reference:

@src/components/FriendStoryCard.js
@src/screens/FeedScreen.js
@src/services/firebase/feedService.js
@src/components/PhotoDetailModal.js
@src/hooks/useViewedStories.js

**Phase 12 Vision (from CONTEXT.md):**

- Own snaps appear in stories bar, always positioned leftmost with "Me" label
- Same visual style as FriendStoryCard, same viewer experience as friends' stories
- Reactions visible but non-interactive (grayed out) on own photos
- Comments work for both personal notes and replies to friends
- Empty card appears when no snaps (not hidden)

**Key patterns from codebase:**

- FriendStoryCard: 88x130 card with gradient/gray border, 32px profile photo
- feedService.getFriendStoriesData: Returns { userId, displayName, profilePhotoURL, topPhotos, thumbnailURL, hasPhotos }
- PhotoDetailModal mode="stories": Progress bar, emoji reactions, swipe navigation
- Story data structure: topPhotos[] with reactions object
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Create getUserStoriesData function and MeStoryCard component</name>
  <files>src/services/firebase/feedService.js, src/components/MeStoryCard.js</files>
  <action>
    1. In feedService.js, add getUserStoriesData(userId) function:
       - Query photos collection where userId matches and photoState='journal'
       - Order by capturedAt ascending (oldest first, matching friend stories)
       - Return same structure as friend stories: { userId, displayName: 'Me', profilePhotoURL, topPhotos, thumbnailURL (most recent), totalPhotoCount, hasPhotos }
       - Get profilePhotoURL from users collection

    2. Create MeStoryCard.js component:
       - Copy FriendStoryCard pattern exactly (88x130, gradient/gray border, blurred thumbnail)
       - Key differences:
         - Always show "Me" as label (not displayName)
         - Empty state: Show card with "M" initial placeholder when no snaps (not hidden)
         - Use user's profile photo from friend.profilePhotoURL
       - Accept same props: friend (user's story data), onPress, isFirst, isViewed
       - Export as named export for consistency

    Avoid: Don't create special styling that differs from FriendStoryCard - the card should look identical except for the "Me" label.

  </action>
  <verify>
    grep -r "getUserStoriesData" src/services/firebase/feedService.js confirms function exists
    cat src/components/MeStoryCard.js | head -50 shows component with "Me" label
  </verify>
  <done>
    - getUserStoriesData returns user's journaled photos in friend-compatible format
    - MeStoryCard renders identically to FriendStoryCard with "Me" label
    - Empty state shows card with "M" placeholder
  </done>
</task>

<task type="auto">
  <name>Task 2: Update FeedScreen to display own snaps first in stories bar</name>
  <files>src/screens/FeedScreen.js</files>
  <action>
    1. Import MeStoryCard and getUserStoriesData

    2. Add state and effect to fetch user's own stories:
       - Add myStories state (same structure as friend data)
       - Fetch in useEffect when user is available
       - Handle loading/error states gracefully

    3. Update stories bar rendering:
       - Render MeStoryCard FIRST (before sorted friends), always leftmost
       - Pass isFirst={true} to MeStoryCard
       - Pass isViewed based on whether user has viewed all their own photos (use hasViewedAllPhotos)
       - Adjust FriendStoryCard isFirst={false} for all friends (MeStoryCard takes first position)

    4. Handle tap on MeStoryCard:
       - Create handleOpenMyStories function
       - Open PhotoDetailModal with mode="stories" and isOwnStory={true} flag
       - Pass myStories.topPhotos as photos array
       - Calculate starting index with getFirstUnviewedIndex

    Avoid: Don't change the sort order of friends - just prepend user's card. Don't hide card when empty.

  </action>
  <verify>
    Run app, check stories bar shows "Me" card on the left before any friend cards
    Tap "Me" card opens PhotoDetailModal with user's own photos
  </verify>
  <done>
    - MeStoryCard appears leftmost in stories bar
    - Empty state shows card when user has no journaled snaps
    - Tapping opens PhotoDetailModal with user's photos
  </done>
</task>

<task type="auto">
  <name>Task 3: Disable reactions in viewer for own photos</name>
  <files>src/components/PhotoDetailModal.js, src/styles/PhotoDetailModal.styles.js</files>
  <action>
    1. Add isOwnStory prop to PhotoDetailModal:
       - Default to false for backward compatibility
       - Pass from FeedScreen when opening own stories

    2. Modify emoji reaction rendering when isOwnStory={true}:
       - Show emoji row but apply disabled/grayed out styling
       - Use opacity: 0.4 and remove TouchableOpacity (or disable onPress)
       - Show existing reaction counts (from friends) but prevent taps
       - Hide the "+" add emoji button for own photos

    3. Keep comments functional:
       - Comment input, send button, and comment list work normally
       - User can add comments to their own photos (for notes/captions)

    4. Add disabledEmojiRow style to PhotoDetailModal.styles.js:
       - opacity: 0.4 for grayed out appearance

    Avoid: Don't hide the reactions entirely - user should see what emojis friends have reacted with, just can't tap to react themselves.

  </action>
  <verify>
    When viewing own stories, emoji row is visible but grayed out and non-interactive
    Comment input still works - can type and send comments
  </verify>
  <done>
    - Emoji reactions visible but disabled (opacity 0.4, no tap response) on own photos
    - "+" add emoji button hidden on own photos
    - Comments work normally on own photos
    - Friend reaction counts visible as read-only
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>User's own snaps in stories bar with disabled self-reactions</what-built>
  <how-to-verify>
    1. Run: npx expo start
    2. Open app on device/simulator with a user that has journaled photos

    Stories bar checks:
    3. Verify "Me" card appears leftmost in stories bar
    4. Verify "Me" card shows blurred thumbnail of most recent journaled photo
    5. Verify "Me" card shows user's profile photo at bottom
    6. Verify "Me" label appears below card (not username)

    Viewer checks:
    7. Tap "Me" card to open story viewer
    8. Verify progress bar shows at top (same as friends)
    9. Verify emoji reaction row is visible but grayed out (opacity ~0.4)
    10. Tap any emoji - should NOT register a reaction
    11. Verify "+" add emoji button is NOT visible
    12. Verify any existing friend reactions are displayed (counts visible)

    Comment checks:
    13. Tap comment area to open keyboard
    14. Type a comment and send - should work normally
    15. Verify comment appears in comment list

    Empty state check:
    16. If possible, test with user who has no journaled photos
    17. Verify "Me" card still appears with "M" initial placeholder

  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npx expo start` runs without errors
- [ ] MeStoryCard appears leftmost in stories bar
- [ ] Tap opens PhotoDetailModal with user's photos
- [ ] Emoji reactions are visible but disabled (grayed out) on own photos
- [ ] Comments work normally on own photos
- [ ] Empty state shows card with placeholder (not hidden)
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript/ESLint errors introduced
- Own snaps integrated seamlessly with existing stories bar
- Reactions disabled but visible, comments functional
  </success_criteria>

<output>
After completion, create `.planning/phases/12-own-snaps-stories-bar/12-01-SUMMARY.md`:

# Phase 12 Plan 01: Own Snaps in Stories Bar Summary

**[Substantive one-liner - what shipped]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase complete, ready for Phase 13 (Split Activity into Notifications & Friends)
</output>
