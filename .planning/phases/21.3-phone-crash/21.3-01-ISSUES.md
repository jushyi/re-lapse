# UAT Issues: Phase 21.3 Plan 01

**Tested:** 2026-01-24
**Source:** .planning/phases/21.3-phone-crash/21.3-01-SUMMARY.md
**Tester:** User via /gsd:verify-work

## Open Issues

[None - all issues resolved]

### ~~UAT-001: App still crashes when tapping Send Code button~~ - MOVED TO RESOLVED

**Discovered:** 2026-01-24
**Phase/Plan:** 21.3-01
**Severity:** Blocker
**Feature:** Phone number input and send code
**Description:** App crashes with no error message when user taps the Send Code button after entering a phone number. The crash is sudden with no error displayed.
**Expected:** App should send verification code and navigate to verification screen without crashing
**Actual:** App closes immediately with no error message when Send button is tapped
**Repro:**

1. Start phone authentication flow
2. Enter a phone number
3. Tap "Send Code" button
4. App crashes/closes immediately

**Notes:** This is the same crash the fix was intended to address. The PhoneAuthContext useRef approach may not be resolving the underlying serialization issue, or there may be another cause.

**User observation:** Could be related to reCAPTCHA verification. Firebase Phone Auth requires reCAPTCHA verification which may be crashing when attempting to open/verify. This would occur at the point of calling `signInWithPhoneNumber()` which triggers reCAPTCHA before sending SMS.

**Additional detail:** No reCAPTCHA popup/webview appears - crash happens before reCAPTCHA would show. This suggests the crash occurs during the setup/initialization of the reCAPTCHA flow, not during user interaction with it.

**Build context:** EAS development build created after Phase 21.1/21.2 (API key remediation and secure file setup).

### Investigation Analysis (2026-01-24)

**Phase 21.3 fix status:** The PhoneAuthContext/useRef fix is correct but addresses a DIFFERENT crash (navigation param serialization). That crash would occur when navigating from PhoneInput to Verification screen.

**Current crash is different:** The crash occurs at `signInWithPhoneNumber()` call BEFORE any ConfirmationResult exists.

**Probable root causes (in order of likelihood):**

1. **Missing reCAPTCHA URL Scheme** - Firebase Phone Auth on iOS falls back to reCAPTCHA when APNs isn't available. The app's `CFBundleURLSchemes` contains a Google OAuth scheme but may be missing the Firebase Auth reCAPTCHA callback scheme (typically `REVERSED_CLIENT_ID` from GoogleService-Info.plist).

2. **APNs Not Configured for Dev Build** - Development builds may not have valid APNs push notification credentials, forcing reCAPTCHA fallback which then crashes.

3. **Firebase Phone Auth Enable Status** - Verify Phone authentication is enabled in Firebase Console.

**Key file:** `GoogleService-Info.plist` contains `REVERSED_CLIENT_ID` that must be added to URL schemes in app.json.

### ROOT CAUSE CONFIRMED (2026-01-24)

**The `GoogleService-Info.plist` is incomplete!**

Current plist is MISSING critical OAuth keys required for Firebase Phone Auth:

- ❌ `CLIENT_ID` - Not present
- ❌ `REVERSED_CLIENT_ID` - Not present

These keys are required for Firebase Phone Auth to set up the reCAPTCHA verification flow. Without them, `signInWithPhoneNumber()` crashes immediately.

**Fix required:**

1. Download fresh GoogleService-Info.plist from Firebase Console (Project Settings → Your Apps → iOS)
2. Replace local file
3. Re-upload to EAS file environment variable
4. Add REVERSED_CLIENT_ID to CFBundleURLSchemes in app.json
5. Rebuild dev client

## Resolved Issues

### UAT-001: App still crashes when tapping Send Code button - **RESOLVED**

**Resolved:** 2026-01-24
**Fix:** 21.3-01-FIX.md

**Root Cause:** GoogleService-Info.plist was missing CLIENT_ID and REVERSED_CLIENT_ID keys because the existing iOS OAuth 2.0 client in Google Cloud Console was created for bundle ID `com.lapseclone.app` instead of the app's actual bundle ID `com.spoodsjs.oly`.

**Solution:**

1. Created new iOS OAuth 2.0 Client in Google Cloud Console for `com.spoodsjs.oly`
2. Downloaded fresh GoogleService-Info.plist from Firebase Console
3. Updated app.json CFBundleURLSchemes with correct REVERSED_CLIENT_ID
4. Uploaded new plist to EAS environment variable
5. Rebuilt development client

**Verification:** Phone authentication now works - reCAPTCHA appears and SMS codes are sent without crash.

---

_Phase: 21.3-phone-crash_
_Plan: 01_
_Tested: 2026-01-24_
