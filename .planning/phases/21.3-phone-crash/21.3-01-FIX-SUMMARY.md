---
phase: 21.3-phone-crash
plan: 01-FIX
subsystem: auth
tags: [firebase, phone-auth, oauth, recaptcha, ios]

requires:
  - phase: 21.3-01
    provides: PhoneAuthContext and useRef fix (addressed different crash)
provides:
  - Firebase Phone Auth reCAPTCHA working on iOS
  - Correct OAuth client for com.spoodsjs.oly bundle ID
affects: [phone-auth, builds]

tech-stack:
  added: []
  patterns:
    - iOS OAuth client must match bundle ID exactly

key-files:
  created: []
  modified:
    - app.json

key-decisions:
  - 'Created new iOS OAuth client for com.spoodsjs.oly (old one was for com.lapseclone.app)'
  - 'Updated REVERSED_CLIENT_ID in app.json URL schemes'

patterns-established:
  - 'OAuth client bundle ID must match app bundle ID for Firebase Phone Auth'

issues-created: []

duration: ~15min
completed: 2026-01-24
---

# Phase 21.3-01 FIX: Firebase Phone Auth Configuration Summary

**Fixed UAT-001: App crashes when tapping Send Code - root cause was OAuth client bundle ID mismatch**

## Performance

- **Duration:** ~15 min
- **Completed:** 2026-01-24
- **Tasks:** 8 (7 manual, 1 code)
- **Files modified:** 1 (app.json)

## Root Cause Analysis

The original 21.3-01 fix addressed a **navigation param serialization crash** (ConfirmationResult not serializable). That fix was correct but addressed a different crash.

The **actual crash** (UAT-001) occurred at `signInWithPhoneNumber()` BEFORE any navigation, caused by:

- GoogleService-Info.plist missing `CLIENT_ID` and `REVERSED_CLIENT_ID` keys
- Existing iOS OAuth client was created for bundle ID `com.lapseclone.app`
- App's actual bundle ID is `com.spoodsjs.oly`
- Firebase Phone Auth reCAPTCHA flow crashed during initialization due to this mismatch

## Accomplishments

- Created new iOS OAuth 2.0 Client in Google Cloud Console for correct bundle ID (`com.spoodsjs.oly`)
- Downloaded fresh GoogleService-Info.plist with proper CLIENT_ID and REVERSED_CLIENT_ID
- Updated app.json URL schemes with correct REVERSED_CLIENT_ID
- Uploaded new plist to EAS environment variable
- Rebuilt development client
- Verified phone auth works without crashing

## Task Commits

1. **Task 5: Update app.json URL Schemes** - `aa576db` (fix)

Tasks 1-4, 6-8 were manual configuration steps (no commits).

## Files Created/Modified

- `app.json` - Updated CFBundleURLSchemes with correct REVERSED_CLIENT_ID:
  - Old: `com.googleusercontent.apps.958995611148-k8nl243l2h21n9sh0ugss4ad6qbldk7a`
  - New: `com.googleusercontent.apps.958995611148-52u8fcfk424tf5pg4saqrf5iju9a9dvj`

## Configuration Changes (Manual)

- **Google Cloud Console:** Created iOS OAuth 2.0 Client for `com.spoodsjs.oly`
- **Firebase Console:** Verified Phone Auth enabled
- **Local:** Replaced GoogleService-Info.plist with fresh download
- **EAS:** Updated GOOGLE_SERVICES_PLIST environment variable
- **Build:** Created new development client with correct configuration

## Decisions Made

| Decision                                   | Rationale                                                                                                    |
| ------------------------------------------ | ------------------------------------------------------------------------------------------------------------ |
| Create new OAuth client vs update existing | Existing client had wrong bundle ID (com.lapseclone.app) - cannot change bundle ID on existing OAuth clients |
| Replace REVERSED_CLIENT_ID vs add both     | New client replaces old one for phone auth - old one was never correct for this bundle ID                    |

## Deviations from Plan

None - plan executed exactly as written.

## Issues Resolved

- **UAT-001:** App crashes when tapping Send Code button - **RESOLVED**

## Next Phase Readiness

- Phone authentication fully functional
- Ready to continue with Phase 22 (Environment and Configuration)

---

_Phase: 21.3-phone-crash_
_Plan: 01-FIX_
_Completed: 2026-01-24_
