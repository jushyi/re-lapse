---
phase: 18.6-triage-animation-timing
plan: 01
subsystem: ui
tags: [reanimated, animation, triage, darkroom, cascade]

# Dependency graph
requires:
  - phase: 18.5-camera-default-launch-screen
    provides: Camera as default launch screen
  - phase: 18.1-batched-darkroom-triage-with-undo
    provides: Cascade animation infrastructure, hiddenPhotoIds state
provides:
  - Early cascade trigger via onExitClearance callback
  - 100ms clearance delay for fluid triage feel
  - No perceptible gap between card exit and cascade
affects: []

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "onExitClearance callback pattern for early animation trigger"
    - "runOnJS bridge for worklet-to-JS setTimeout calls"

key-files:
  created: []
  modified:
    - src/components/SwipeablePhotoCard.js
    - src/screens/DarkroomScreen.js

key-decisions:
  - "100ms clearance delay for instant cascade feel"
  - "CASCADE_DELAY_MS reduced to 0ms since clearance handles timing"

patterns-established:
  - "Early trigger callback pattern: fire callback during animation, not after completion"

issues-created: []

# Metrics
duration: 11min
completed: 2026-01-23
---

# Phase 18.6 Plan 01: Triage Animation Timing Optimization Summary

**Early cascade trigger at 100ms eliminates delay between card exit and next card animation for fluid triage flow**

## Performance

- **Duration:** 11 min
- **Started:** 2026-01-23T14:20:22Z
- **Completed:** 2026-01-23T14:31:02Z
- **Tasks:** 2 auto + 1 checkpoint
- **Files modified:** 2

## Accomplishments

- Added onExitClearance callback prop to SwipeablePhotoCard
- Connected early cascade trigger in DarkroomScreen
- Tuned clearance delay to 100ms for instant, fluid feel
- Cascade animation now starts while exiting card is still visible

## Task Commits

1. **Task 1: Add early cascade trigger callback** - `c229847` (feat)
2. **Task 2: Connect early trigger to cascade** - included in `c229847` (feat)

**Plan metadata:** TBD (docs: complete plan)

## Files Created/Modified

- `src/components/SwipeablePhotoCard.js` - Added onExitClearance prop, scheduleClearanceCallback helper, 100ms clearance delays
- `src/screens/DarkroomScreen.js` - Added handleExitClearance callback, wired to SwipeablePhotoCard, updated handleTriage to avoid double-hide

## Decisions Made

- **100ms clearance delay:** Tested 60%, 40%, 20% of exit duration - settled on fixed 100ms for instant feel
- **CASCADE_DELAY_MS = 0:** No additional delay needed since clearance callback handles timing
- **runOnJS bridge:** Required for setTimeout calls from worklet context in gesture handlers

## Deviations from Plan

None - plan executed as written with timing adjustments during UAT.

## Issues Encountered

- **Crash on swipe:** Initial implementation called setTimeout directly in worklet context. Fixed by using runOnJS to bridge to JS thread.
- **Timing tuning:** 60% and 40% delays still felt sluggish. Reduced to 100ms fixed delay for fluid feel.

## Next Phase Readiness

- Phase 18.6 complete
- v1.5 milestone complete (Phase 18.6 is the final phase)

---
*Phase: 18.6-triage-animation-timing*
*Completed: 2026-01-23*
