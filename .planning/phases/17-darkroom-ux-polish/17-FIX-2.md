---
phase: 17-darkroom-ux-polish
plan: 17-FIX-2
type: fix
---

<objective>
Fix 4 UAT issues from Phase 17 Darkroom UX Polish (second UAT round).

Source: 17-ISSUES.md
Priority: 1 major, 3 minor
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md

**Issues being fixed:**
@.planning/phases/17-darkroom-ux-polish/17-ISSUES.md

**Previous fix plan for reference:**
@.planning/phases/17-darkroom-ux-polish/17-FIX.md

**Key files:**
@src/components/SwipeablePhotoCard.js
@src/screens/DarkroomScreen.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix UAT-006 (MAJOR) - Stacked cards should peek from top at rest</name>
  <files>src/components/SwipeablePhotoCard.js</files>
  <action>
**Issue:** Stack cards are only visible during swipe animation. User wants cards to peek from the TOP at all times, creating a visible stack effect at rest.

**Current behavior:**
- stackOffset is negative (e.g., -10, -20) which positions cards ABOVE the front card
- But they have lower opacity and are hidden behind the front card at rest
- They only become visible during animation

**Fix approach:**
1. Change stack positioning to peek from TOP of front card:
   - Stack cards should be visually offset UPWARD (negative Y from front card's position)
   - Currently using stackOffset -10, -20 but this isn't visually noticeable
   - Increase the offset values for more visible peek: stackIndex 1 → -20, stackIndex 2 → -40

2. Ensure stack cards are always rendered (not conditionally hidden):
   - Stack cards should always be visible at rest with their offset/scale/opacity
   - The cascade animation on triage remains unchanged

3. Adjust scale for better visual depth:
   - stackIndex 0: scale 1.0 (front card, full size)
   - stackIndex 1: scale 0.96, offset -20, opacity 0.85 (more visible)
   - stackIndex 2: scale 0.92, offset -40, opacity 0.7 (more visible)

4. Ensure proper layering with zIndex so front card is on top.

**Result:** 2-3 cards visible at rest, peeking from above the front card, creating a deck effect.
  </action>
  <verify>
1. Open darkroom with 3+ photos
2. See stack of cards at rest (NOT only during swipe)
3. Behind cards peek from TOP of front card
4. Swipe still works normally
  </verify>
  <done>Stacked cards are visually visible at rest, peeking from top</done>
</task>

<task type="auto">
  <name>Task 2: Fix UAT-007 (MINOR) - Remove black border on photo cards</name>
  <files>src/components/SwipeablePhotoCard.js</files>
  <action>
**Issue:** Photo cards have a black border that user doesn't want.

**Current code in styles.cardContainer:**
```javascript
borderWidth: 2,
borderColor: '#000000',
```

**Fix:**
1. Remove the borderWidth and borderColor properties from cardContainer style
2. Keep the borderRadius (24) and shadow for depth
3. Optionally keep a subtle border if needed for visual definition, but make it very subtle (e.g., 1px dark gray) - or remove entirely per user preference

**Removing entirely since user said they don't want the border:**
```javascript
// REMOVE these lines:
borderWidth: 2,
borderColor: '#000000',
```
  </action>
  <verify>
1. Open darkroom with a photo
2. Photo card has no visible black border
3. Card still has rounded corners and shadow for depth
  </verify>
  <done>Black border removed from photo cards</done>
</task>

<task type="auto">
  <name>Task 3: Fix UAT-008 (MINOR) - Button-triggered animation too fast</name>
  <files>src/components/SwipeablePhotoCard.js</files>
  <action>
**Issue:** Button-triggered animations complete too quickly (250ms currently). User can barely see the arc motion.

**Current EXIT_DURATION:** 250ms

**Fix approach:**
1. Increase EXIT_DURATION from 250ms to 400-450ms for more visible animation
2. This affects both swipe release and button-triggered animations since they share EXIT_DURATION
3. Consider using different durations if swipe needs to stay faster - but for consistency, increase both

**Recommended change:**
```javascript
const EXIT_DURATION = 400; // Was 250, now slower for more visible animation
```

4. The easing (Easing.out(Easing.cubic)) is good - gives natural deceleration
5. Animation distance is already good (1.5x screen width, 0.5x screen height for arc)

**Result:** Animation is visible and satisfying, showing the arc motion clearly.
  </action>
  <verify>
1. Tap Archive button - animation takes ~400ms, arc motion clearly visible
2. Tap Journal button - animation takes ~400ms, arc motion clearly visible
3. Tap Delete button - animation takes ~400ms, drop motion visible
4. Swipe gestures also feel smooth (same timing)
  </verify>
  <done>Animation duration increased for more visible arc motion</done>
</task>

<task type="auto">
  <name>Task 4: Fix UAT-009 (MINOR) - Next card appears with jump/flicker</name>
  <files>src/screens/DarkroomScreen.js, src/components/SwipeablePhotoCard.js</files>
  <action>
**Issue:** After triaging a photo, the next card appears with a visible jump or flicker rather than a smooth transition.

**Desired animation:** Stack moves DOWN and FORWARD when front card is removed:
- Cards peek from TOP at rest (negative Y offset - above front card)
- When front card exits, entire stack slides DOWN toward viewer
- Creates feeling of cards descending from the stack to become the new front

**Visual model:**
```
At rest (cards peek from TOP):
  [Card 3] ← furthest back, highest up, smallest
  [Card 2] ← behind, peeking above
  [Card 1] ← FRONT (full size, lowest position)

After triage (stack slides DOWN):
  [Card 3] → slides down to Card 2 position
  [Card 2] → slides down to FRONT position (scales up, moves down)
```

**Fix approach:**

1. Stack positioning at rest (from Task 1):
   - Front card (index 0): translateY = 0, scale = 1.0, opacity = 1.0
   - Behind card (index 1): translateY = -20 (ABOVE), scale = 0.96, opacity = 0.85
   - Furthest card (index 2): translateY = -40 (HIGHEST), scale = 0.92, opacity = 0.70

2. Use shared values with useEffect to animate on stackIndex change:
   ```javascript
   // Shared values for smooth cascade animation
   const stackScaleAnim = useSharedValue(getStackScale(stackIndex));
   const stackOffsetAnim = useSharedValue(getStackOffset(stackIndex));
   const stackOpacityAnim = useSharedValue(getStackOpacity(stackIndex));

   // Helper functions
   const getStackScale = (idx) => idx === 0 ? 1 : idx === 1 ? 0.96 : 0.92;
   const getStackOffset = (idx) => idx === 0 ? 0 : idx === 1 ? -20 : -40;  // Negative = above
   const getStackOpacity = (idx) => idx === 0 ? 1 : idx === 1 ? 0.85 : 0.7;

   // Animate when stackIndex changes (card moves forward in stack)
   useEffect(() => {
     stackScaleAnim.value = withSpring(getStackScale(stackIndex), { damping: 15, stiffness: 150 });
     stackOffsetAnim.value = withSpring(getStackOffset(stackIndex), { damping: 15, stiffness: 150 });
     stackOpacityAnim.value = withSpring(getStackOpacity(stackIndex), { damping: 15, stiffness: 150 });
   }, [stackIndex]);
   ```

3. In cardStyle for non-active cards, use the animated shared values:
   ```javascript
   return {
     transform: [
       { translateX: 0 },
       { translateY: stackOffsetAnim.value },  // Animates from -40 → -20 → 0 (slides DOWN)
       { rotate: '0deg' },
       { scale: stackScaleAnim.value },        // Animates from 0.92 → 0.96 → 1.0 (grows)
     ],
     opacity: stackOpacityAnim.value,          // Animates from 0.7 → 0.85 → 1.0 (brightens)
   };
   ```

4. The key insight: negative offset at rest means cards are ABOVE. When stackIndex decreases (card moves forward), offset animates toward 0 (card slides DOWN to front position).

**Result:** When front card exits, the stack visibly slides down and forward - cards descend from above to take the front position.
  </action>
  <verify>
1. Open darkroom with 3+ photos
2. Observe stack at rest - cards peek from TOP (above front card)
3. Triage front card
4. Watch stack slide DOWN - next card descends to front position
5. Animation feels like cards are coming down from the stack
6. No jump or flicker - smooth spring animation
7. Repeat for all cards - consistent cascade effect
  </verify>
  <done>Stack slides down and forward when front card is removed</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Fixed all 4 UAT issues: visible stack at rest, removed black border, slower animations, smooth card transitions</what-built>
  <how-to-verify>
    1. Run: npx expo start
    2. Navigate to Darkroom with 3+ photos

    **Test UAT-006 (Stack visible at rest):**
    3. Observe cards at rest (NOT swiping)
    4. Should see 2-3 cards stacked, with behind cards peeking from TOP

    **Test UAT-007 (No black border):**
    5. Look at photo card edges - no visible black border
    6. Card still has rounded corners and depth shadow

    **Test UAT-008 (Animation speed):**
    7. Tap Archive button - animation should take ~400ms, clearly visible arc
    8. Tap Journal button - same ~400ms visible animation
    9. Tap Delete button - same ~400ms visible drop

    **Test UAT-009 (Smooth transition):**
    10. Triage front card
    11. Watch next card - should smoothly animate forward (no jump/flicker)
    12. Repeat for multiple cards - all transitions smooth
  </how-to-verify>
  <resume-signal>Type "approved" or describe any remaining issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] UAT-006: Stacked cards peek from top at rest (not just during swipe)
- [ ] UAT-007: Black border removed from photo cards
- [ ] UAT-008: Animation duration increased for visible arc motion
- [ ] UAT-009: Next card transitions smoothly without jump/flicker
- [ ] All swipe/button functionality still works correctly
- [ ] App builds without errors
</verification>

<success_criteria>
- All 4 UAT issues from 17-ISSUES.md (second round) addressed
- Tests pass
- Ready for re-verification
</success_criteria>

<output>
After completion, create `.planning/phases/17-darkroom-ux-polish/17-FIX-2-SUMMARY.md`

Update 17-ISSUES.md to move fixed issues to "Resolved Issues" section.
</output>
