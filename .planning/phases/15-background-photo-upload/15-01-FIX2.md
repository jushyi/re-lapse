---
phase: 15-background-photo-upload
plan: 15-01-FIX2
type: fix
---

<objective>
Fix 1 additional UAT issue from plan 15-01 (discovered after initial fix).

Source: 15-01-ISSUES.md (UAT-003)
Priority: 0 critical, 1 major, 0 minor
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md

**Issues being fixed:**
@.planning/phases/15-background-photo-upload/15-01-ISSUES.md

**Original plan for reference:**
@.planning/phases/15-background-photo-upload/15-01-PLAN.md

**Previous fix for context:**
@.planning/phases/15-background-photo-upload/15-01-FIX-SUMMARY.md

**Key file:**
@src/screens/CameraScreen.js
</context>

<tasks>

<task type="auto">
  <name>Fix UAT-003: Eliminate perceptible delay between button press and capture feedback</name>
  <files>src/screens/CameraScreen.js</files>
  <action>
**Issue:** There's a slight but noticeable delay between pressing the capture button and when visual feedback (flash/animation) appears. This makes the experience feel clunky rather than instant.

**Root cause analysis:**

Looking at the current takePicture() flow:
```javascript
const takePicture = async () => {
  if (!cameraRef.current || isCapturing || !user) return;

  try {
    setIsCapturing(true);

    // PROBLEM: Awaiting camera before any visual feedback!
    const photo = await cameraRef.current.takePictureAsync({...});

    // Feedback only happens AFTER capture completes (~100-200ms delay)
    addToQueue(user.uid, photo.uri);
    playPhotoAnimation(photo.uri);  // Flash is called inside here
    // ...
  }
};
```

The flash effect is triggered inside `playPhotoAnimation()`, which is called AFTER `takePictureAsync()` completes. This creates 100-200ms of visual silence after the button press.

**Fix:** Trigger flash effect IMMEDIATELY on button press, before awaiting the camera.

**Implementation:**

1. Move `playFlashEffect()` call to the start of `takePicture()`, before the await:

```javascript
const takePicture = async () => {
  if (!cameraRef.current || isCapturing || !user) return;

  try {
    setIsCapturing(true);

    // INSTANT FEEDBACK: Flash fires immediately on tap!
    playFlashEffect();

    // Camera capture runs in parallel with flash animation
    const photo = await cameraRef.current.takePictureAsync({
      quality: 0.8,
      skipProcessing: true,
    });

    logger.debug('CameraScreen: Photo captured', { uri: photo.uri });

    // Queue for background upload (non-blocking)
    addToQueue(user.uid, photo.uri);

    // Play arc animation (flash already started above)
    playPhotoAnimation(photo.uri);

    // Optimistically update badge count
    setDarkroomCounts(prev => ({
      ...prev,
      developingCount: prev.developingCount + 1,
      totalCount: prev.totalCount + 1,
    }));

    logger.info('CameraScreen: Photo queued for background upload');
  } catch (error) {
    logger.error('CameraScreen: Error capturing photo', error);
  } finally {
    setIsCapturing(false);
  }
};
```

2. Remove `playFlashEffect()` call from `playPhotoAnimation()` to avoid duplicate flash:

```javascript
const playPhotoAnimation = (photoUri) => {
  // Flash already started in takePicture() - don't duplicate

  setCapturedPhoto(photoUri);
  animatedValue.setValue(0);

  Animated.sequence([
    Animated.timing(animatedValue, {
      toValue: 1,
      duration: 600,
      useNativeDriver: true,
    }),
    Animated.timing(animatedValue, {
      toValue: 2,
      duration: 200,
      useNativeDriver: true,
    }),
  ]).start(() => {
    setCapturedPhoto(null);
    animatedValue.setValue(0);
  });

  setTimeout(playBadgeBounce, 600);
};
```

**Why this works:**
- Flash animation (150ms total) runs in PARALLEL with camera capture (~100-200ms)
- User sees immediate visual feedback on tap
- By the time capture completes, flash is finishing - seamless transition to arc animation
- The overall timing feels tighter and more responsive

**Avoid:**
- Don't call playFlashEffect() twice (remove from playPhotoAnimation)
- Don't add additional delays between flash and arc animation
  </action>
  <verify>
- Tap capture button - flash should fire INSTANTLY (no perceptible delay)
- Arc animation follows smoothly after capture completes
- No duplicate flash effects
- Photo still captures correctly and uploads to Firestore
- Badge count updates optimistically
- Rapid captures work without glitches
  </verify>
  <done>
- Flash effect triggers immediately on button press
- No perceptible delay between tap and visual feedback
- Arc animation still plays correctly after capture
- Capture feels instant and responsive like a real camera
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Flash fires immediately on button tap (instant feedback)
- [ ] No perceptible delay between tap and response
- [ ] Arc animation plays correctly after capture
- [ ] Badge bounce still triggers at animation end
- [ ] Photo uploads successfully in background
- [ ] No duplicate flash effects
- [ ] Rapid captures work correctly
</verification>

<success_criteria>
- UAT-003 resolved: Capture feels instant with no perceptible lag
- Flash provides immediate visual acknowledgment of button press
- Overall capture flow remains smooth and functional
</success_criteria>

<output>
After completion, create `.planning/phases/15-background-photo-upload/15-01-FIX2-SUMMARY.md`
</output>
