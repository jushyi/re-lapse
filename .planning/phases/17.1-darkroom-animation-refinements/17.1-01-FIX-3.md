---
phase: 17.1-darkroom-animation-refinements
plan: 01-FIX-3
type: fix
---

<objective>
Fix 2 UAT issues from plan 17.1-01.

Source: 17.1-01-ISSUES.md
Priority: 0 critical, 0 major, 2 minor
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md

**Issues being fixed:**
@.planning/phases/17.1-darkroom-animation-refinements/17.1-01-ISSUES.md

**Original plan for reference:**
@.planning/phases/17.1-darkroom-animation-refinements/17.1-01-PLAN.md

**Key files:**
@src/screens/DarkroomScreen.js
@src/navigation/AppNavigator.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix UAT-005 - Black background visible during header swipe</name>
  <files>src/screens/DarkroomScreen.js</files>
  <action>
The issue is that during header swipe-down gesture, there's a black background visible behind the darkroom content, making it look like two screens swiping down.

**Root cause:** The GestureHandlerRootView has `styles.container` (black background), and the ReAnimated.View with `screenAnimatedStyle` is inside it. When the animated view moves down, the GestureHandlerRootView's black background shows through.

**Fix:** Make the background transparent during the gesture by:
1. Change the GestureHandlerRootView background to transparent
2. Move the black background to the inner animated view only

In all three render paths (loading, success/empty, and photos states):
- Change `<GestureHandlerRootView style={styles.container}>` to use a transparent background style
- The inner `<ReAnimated.View style={[styles.container, screenAnimatedStyle]}>` already has the black background, so it will move with the animation

Create a new style:
```javascript
gestureRootView: {
  flex: 1,
  backgroundColor: 'transparent',
}
```

Update all GestureHandlerRootView usages to use this style instead of `styles.container`.

This way, when the screen animates down, there's no visible background behind it - just whatever was underneath (the camera screen).
  </action>
  <verify>Run app, swipe down on header, no black background visible during swipe - screen moves as single cohesive unit</verify>
  <done>Header swipe shows single cohesive screen movement, no second background visible</done>
</task>

<task type="auto">
  <name>Task 2: Fix UAT-006 - Done button closes darkroom in wrong direction</name>
  <files>src/screens/DarkroomScreen.js</files>
  <action>
The Done button in success state uses `navigation.navigate('MainTabs', { screen: 'Camera' })` which creates a new navigation action that slides the screen in the default direction (right).

**Fix:** Change the Done button to use `navigation.goBack()` instead of `navigate()`.

The reason `goBack()` works correctly is that React Navigation remembers the animation used to open the screen (slide_from_bottom) and reverses it when going back (slide_to_bottom).

Update `handleDonePress` function:
```javascript
const handleDonePress = () => {
  logger.info('DarkroomScreen: User tapped Done button');
  Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);
  navigation.goBack();
};
```

This matches the behavior of the chevron back button and header swipe gestures.
  </action>
  <verify>Complete triage, tap Done button, darkroom slides DOWN to close (not right)</verify>
  <done>Done button closes darkroom with slide-down animation matching chevron button behavior</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] UAT-005: Header swipe shows single screen movement, no black background
- [ ] UAT-006: Done button slides darkroom down (not right)
- [ ] All existing functionality still works (chevron button, gestures, triage)
- [ ] No console errors or warnings
</verification>

<success_criteria>
- All UAT issues from 17.1-01-ISSUES.md addressed
- Darkroom close animations are consistent across all methods (chevron, header swipe, Done button)
- Ready for re-verification
</success_criteria>

<output>
After completion, create `.planning/phases/17.1-darkroom-animation-refinements/17.1-01-FIX-3-SUMMARY.md`
</output>
