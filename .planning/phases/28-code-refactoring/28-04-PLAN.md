---
phase: 28-code-refactoring
plan: 04
type: execute
---

<objective>
Refactor FeedPhotoCard and PhotoDetailModal into three-way separation.

Purpose: Complete Phase 28 by applying the extraction pattern to the remaining scoped components.
Output: FeedPhotoCard.styles.js, usePhotoDetailModal hook, PhotoDetailModal.styles.js, thin components.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/28-code-refactoring/28-CONTEXT.md
@.planning/phases/28-code-refactoring/28-01-SUMMARY.md
@.planning/phases/28-code-refactoring/28-02-SUMMARY.md
@.planning/phases/28-code-refactoring/28-03-SUMMARY.md

**Target files:**
@src/components/FeedPhotoCard.js
@src/components/PhotoDetailModal.js

**Pattern references (from previous plans):**
@src/hooks/useSwipeableCard.js
@src/hooks/useCamera.js
@src/hooks/useDarkroom.js
@src/styles/

**Key constraints from 28-CONTEXT.md:**

- Consistent treatment for all scoped components
- Style naming: ComponentName.styles.js in src/styles/
- No behavior changes - pure refactor
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Refactor FeedPhotoCard styles</name>
  <files>src/styles/FeedPhotoCard.styles.js, src/components/FeedPhotoCard.js, src/styles/index.js</files>
  <action>
FeedPhotoCard.js is 203 lines - simpler than other targets.

**1. Assess hook need:**
Review FeedPhotoCard.js to determine if a hook is warranted:

- If component is mostly presentation with minimal state/logic → styles extraction only
- If component has significant state/callbacks → create useFeedPhotoCard hook

Likely outcome: FeedPhotoCard is a presentational component that receives data via props. In this case, extract styles only.

**2. Create src/styles/FeedPhotoCard.styles.js:**
Extract the StyleSheet.create() block.

- Export as `styles`
- Add to src/styles/index.js barrel export

**3. Update src/components/FeedPhotoCard.js:**

- Import styles from src/styles/FeedPhotoCard.styles
- Remove StyleSheet.create block
- If a hook was created, integrate it

The component should remain simple and presentational.
</action>
<verify>
npm test -- --testPathPattern=FeedPhotoCard --passWithNoTests && ls src/styles/FeedPhotoCard.styles.js
</verify>
<done>
FeedPhotoCard styles extracted.
Component updated to import external styles.
</done>
</task>

<task type="auto">
  <name>Task 2: Refactor PhotoDetailModal hook and styles</name>
  <files>src/hooks/usePhotoDetailModal.js, src/styles/PhotoDetailModal.styles.js, src/components/PhotoDetailModal.js, src/styles/index.js</files>
  <action>
PhotoDetailModal.js is 432 lines - has gesture handling and animation logic.

**1. Create src/hooks/usePhotoDetailModal.js:**
Extract modal logic:

- State: selected emoji, reaction counts, frozen order state
- Animation values: translateY, opacity (for swipe-to-dismiss)
- PanResponder logic (gesture handling)
- Callbacks: handleReaction, handleClose, gesture handlers
- useEffect for reaction sorting/freezing

The hook should:

- Accept props (photo, visible, onClose, onReaction, currentUserId)
- Return state, animated styles, gesture handlers

**2. Create src/styles/PhotoDetailModal.styles.js:**
Extract the StyleSheet.create() block.

- Export as `styles`
- Add to src/styles/index.js barrel export

**3. Finalize src/components/PhotoDetailModal.js as thin component:**
After extraction:

- Import usePhotoDetailModal hook
- Import styles
- Keep JSX render logic

Target: ~80-120 lines, mostly JSX.

**Component structure:**

```javascript
import { usePhotoDetailModal } from '../hooks/usePhotoDetailModal';
import { styles } from '../styles/PhotoDetailModal.styles';

const PhotoDetailModal = ({ photo, visible, onClose, onReaction, currentUserId }) => {
  const {
    // destructure all from hook
  } = usePhotoDetailModal({ photo, visible, onClose, onReaction, currentUserId });

  return (
    <Modal visible={visible} ...>
      {/* JSX */}
    </Modal>
  );
};
```

  </action>
  <verify>
npm test -- --testPathPattern=PhotoDetailModal --passWithNoTests && ls src/hooks/usePhotoDetailModal.js && ls src/styles/PhotoDetailModal.styles.js && wc -l src/components/PhotoDetailModal.js
  </verify>
  <done>
PhotoDetailModal fully refactored:
- usePhotoDetailModal hook contains gesture and reaction logic
- PhotoDetailModal.styles.js contains all styles
- PhotoDetailModal.js is thin component (~80-120 lines)
Phase 28 complete.
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] src/styles/FeedPhotoCard.styles.js exists
- [ ] src/hooks/usePhotoDetailModal.js exists (if hook was created)
- [ ] src/styles/PhotoDetailModal.styles.js exists
- [ ] Both components use external styles
- [ ] npm test passes
- [ ] Feed photo cards render correctly
- [ ] Photo detail modal opens, allows reactions, swipe-to-dismiss works
</verification>

<success_criteria>

- FeedPhotoCard and PhotoDetailModal refactored following three-way separation
- All scoped components now follow consistent pattern
- Component behavior unchanged (pure refactor)
- Tests pass
- Phase 28 complete
  </success_criteria>

<output>
After completion, create `.planning/phases/28-code-refactoring/28-04-SUMMARY.md`:

# Phase 28 Plan 04: FeedPhotoCard + PhotoDetailModal Summary

**[One-liner describing what shipped]**

## Accomplishments

- Extracted FeedPhotoCard.styles.js (X lines)
- Extracted usePhotoDetailModal hook (X lines)
- Extracted PhotoDetailModal.styles.js (X lines)
- Reduced PhotoDetailModal.js from 432 to ~Y lines

## Files Created/Modified

- `src/styles/FeedPhotoCard.styles.js` - Feed card styles (created)
- `src/hooks/usePhotoDetailModal.js` - Modal logic hook (created)
- `src/styles/PhotoDetailModal.styles.js` - Modal styles (created)
- `src/components/FeedPhotoCard.js` - Updated imports (modified)
- `src/components/PhotoDetailModal.js` - Thin component (modified)
- `src/styles/index.js` - Added exports (modified)

## Decisions Made

[Any decisions and rationale]

## Issues Encountered

[Problems and resolutions, or "None"]

## Phase 28 Complete

All scoped components refactored:

- SwipeablePhotoCard (829 → X lines)
- CameraScreen (906 → X lines)
- DarkroomScreen (902 → X lines)
- FeedPhotoCard (styles extracted)
- PhotoDetailModal (432 → X lines)

Total lines reduced from ~3,272 to ~X through three-way separation.

Ready for Phase 29: Documentation
</output>
