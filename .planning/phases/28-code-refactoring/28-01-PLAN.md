---
phase: 28-code-refactoring
plan: 01
type: execute
---

<objective>
Set up refactoring infrastructure and refactor SwipeablePhotoCard.

Purpose: Establish the src/styles/ directory structure and extraction pattern, then apply it to the most complex component (SwipeablePhotoCard - 829 lines) as the reference implementation.
Output: src/styles/ directory, useSwipeableCard hook, SwipeablePhotoCard.styles.js, thin SwipeablePhotoCard component.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/28-code-refactoring/28-CONTEXT.md
@.planning/codebase/CONVENTIONS.md
@.planning/codebase/ARCHITECTURE.md

**Target file:**
@src/components/SwipeablePhotoCard.js

**Existing hooks pattern:**
@src/hooks/useFeedPhotos.js

**Design system constants:**
@src/constants/

**Key constraints from 28-CONTEXT.md:**

- Three-way separation: Logic in hooks, styles in src/styles/, components as thin render layers
- Hook naming: Feature-based (useSwipeableCard)
- Hook granularity: Multiple focused hooks per feature if needed
- Style naming: SwipeablePhotoCard.styles.js in src/styles/
- No behavior changes - pure refactor
- No new dependencies
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Create src/styles/ directory and extraction pattern</name>
  <files>src/styles/index.js</files>
  <action>
Create the src/styles/ directory structure:

1. Create src/styles/ directory
2. Create src/styles/index.js as barrel export file (empty initially, will be populated as style files are added)
3. Document the style file pattern in a brief comment at top of index.js:
   - Style files named: ComponentName.styles.js
   - Each exports `styles` object from StyleSheet.create()
   - Imports design tokens from src/constants/ (colors, spacing, typography)

This establishes the convention that all subsequent refactoring will follow.
</action>
<verify>ls src/styles/ shows index.js exists</verify>
<done>src/styles/ directory created with index.js barrel file</done>
</task>

<task type="auto">
  <name>Task 2: Extract useSwipeableCard hook and styles from SwipeablePhotoCard</name>
  <files>src/hooks/useSwipeableCard.js, src/styles/SwipeablePhotoCard.styles.js, src/components/SwipeablePhotoCard.js</files>
  <action>
Refactor SwipeablePhotoCard.js (829 lines) into three-way separation:

**1. Create src/hooks/useSwipeableCard.js:**
Extract all stateful logic:

- All useState hooks (thresholdTriggered, etc.)
- All useSharedValue hooks (translateX, translateY, cardOpacity, cardScale, stackScaleAnim, stackOffsetAnim, stackOpacityAnim, prevStackIndex, hasAnimatedEntry, isTransitioningToFront)
- All useCallback functions (handleGestureEnd, resetCard, triggerHapticFeedback, etc.)
- All useEffect hooks
- Helper functions (getStackScale, getStackOffset, getStackOpacity)
- Constants (HORIZONTAL_THRESHOLD, EXIT_DURATION, etc.) - keep at top of hook file
- useImperativeHandle logic for ref forwarding

The hook should accept props (photo, onSwipeLeft, onSwipeRight, onSwipeDown, onDeleteComplete, onExitClearance, stackIndex, isActive, enterFrom, isNewlyVisible) and return:

- All animated values needed by the component
- All animated styles (cardStyle, overlayStyle, etc.)
- Any imperative methods needed

Use forwardRef pattern - the hook should handle useImperativeHandle internally.

**2. Create src/styles/SwipeablePhotoCard.styles.js:**
Extract the StyleSheet.create() block from the component.

- Export as `styles`
- Import any design tokens from src/constants/ if applicable
- Add to src/styles/index.js barrel export

**3. Refactor src/components/SwipeablePhotoCard.js to thin component:**

- Import useSwipeableCard hook from src/hooks/
- Import styles from src/styles/SwipeablePhotoCard.styles
- Component body should be mostly JSX with hook calls at top
- Keep forwardRef wrapper
- Remove all extracted logic, keeping only:
  - Hook call(s)
  - Style import
  - JSX render

**Important:**

- Preserve exact behavior - this is a pure refactor
- Run tests after extraction: npm test -- --testPathPattern=SwipeablePhotoCard
- Keep the component's public API (props, ref methods) identical
  </action>
  <verify>
  npm test -- --testPathPattern=SwipeablePhotoCard --passWithNoTests && ls src/hooks/useSwipeableCard.js && ls src/styles/SwipeablePhotoCard.styles.js
  </verify>
  <done>
  SwipeablePhotoCard refactored into three files:
- src/hooks/useSwipeableCard.js contains all logic
- src/styles/SwipeablePhotoCard.styles.js contains all styles
- src/components/SwipeablePhotoCard.js is thin render layer (~50-100 lines)
  All existing functionality preserved.
  </done>
  </task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] src/styles/ directory exists with index.js
- [ ] src/hooks/useSwipeableCard.js exists and contains extracted logic
- [ ] src/styles/SwipeablePhotoCard.styles.js exists and contains extracted styles
- [ ] src/components/SwipeablePhotoCard.js is thin (~50-100 lines, mostly JSX)
- [ ] npm test passes (existing tests still work)
- [ ] App builds without errors: npx expo start (verify no runtime errors)
</verification>

<success_criteria>

- Infrastructure (src/styles/) established
- SwipeablePhotoCard fully refactored following three-way separation
- Component behavior unchanged (pure refactor)
- Tests pass
- Pattern established for remaining refactoring
  </success_criteria>

<output>
After completion, create `.planning/phases/28-code-refactoring/28-01-SUMMARY.md`:

# Phase 28 Plan 01: Infrastructure + SwipeablePhotoCard Summary

**[One-liner describing what shipped]**

## Accomplishments

- Created src/styles/ directory infrastructure
- Extracted useSwipeableCard hook (X lines)
- Extracted SwipeablePhotoCard.styles.js (X lines)
- Reduced SwipeablePhotoCard.js from 829 to ~Y lines

## Files Created/Modified

- `src/styles/index.js` - Barrel export for style files (created)
- `src/hooks/useSwipeableCard.js` - Swipeable card logic hook (created)
- `src/styles/SwipeablePhotoCard.styles.js` - Card styles (created)
- `src/components/SwipeablePhotoCard.js` - Thin component (modified)

## Decisions Made

[Any decisions and rationale]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 28-02-PLAN.md (CameraScreen refactoring)
</output>
