---
phase: 28-code-refactoring
plan: 03
type: execute
---

<objective>
Refactor DarkroomScreen into three-way separation.

Purpose: Apply the established extraction pattern to DarkroomScreen (902 lines) - the photo reveal and triage interface.
Output: useDarkroom hook(s), DarkroomScreen.styles.js, thin DarkroomScreen component.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/28-code-refactoring/28-CONTEXT.md
@.planning/phases/28-code-refactoring/28-01-SUMMARY.md
@.planning/phases/28-code-refactoring/28-02-SUMMARY.md

**Target file:**
@src/screens/DarkroomScreen.js

**Pattern references (from 28-01, 28-02):**
@src/hooks/useSwipeableCard.js
@src/hooks/useCamera.js
@src/styles/SwipeablePhotoCard.styles.js
@src/styles/CameraScreen.styles.js

**Key constraints from 28-CONTEXT.md:**

- Hook naming: useDarkroom
- Hook granularity: Multiple focused hooks if complexity warrants
- Style naming: DarkroomScreen.styles.js in src/styles/
- No behavior changes - pure refactor
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Extract useDarkroom hook from DarkroomScreen</name>
  <files>src/hooks/useDarkroom.js, src/screens/DarkroomScreen.js</files>
  <action>
Create src/hooks/useDarkroom.js encapsulating all DarkroomScreen logic:

**State to extract:**

- photos, loading, triageComplete, pendingSuccess
- undoStack, undoingPhoto, saving
- hiddenPhotoIds (Set)
- cardRef
- successFadeAnim, deleteButtonScale (Animated values)
- prevVisiblePhotoIdsRef

**Computed values:**

- visiblePhotos (filtered by hiddenPhotoIds)
- currentVisibleIds, newlyVisibleIds (for fade-in detection)

**Effects to extract:**

- useFocusEffect for loadDevelopingPhotos
- Any other useEffect hooks

**Callbacks to extract:**

- loadDevelopingPhotos
- handleSwipe (left/right/down)
- handleUndo
- handleDone (batch save)
- handleExitClearance
- handleDeleteComplete
- triggerDeleteButtonPulse
- Success animation handling

**The hook should:**

- Accept userId from useAuth (or accept user as prop)
- Return all state, computed values, refs, and handlers
- Handle all the complex triage logic (undo stack, batch save, hidden photos)
- Handle success state transitions

**Hook structure options:**

- Single useDarkroom hook (recommended - keeps all triage logic together)
- Or split: useDarkroomPhotos (loading), useDarkroomTriage (swipe/undo/save)

Use judgment based on clarity. The goal is "obvious at a glance."
</action>
<verify>
npm test -- --testPathPattern=Darkroom --passWithNoTests && ls src/hooks/useDarkroom.js
</verify>
<done>
useDarkroom hook created containing all DarkroomScreen logic.
DarkroomScreen.js updated to use hook.
</done>
</task>

<task type="auto">
  <name>Task 2: Extract DarkroomScreen styles and finalize thin component</name>
  <files>src/styles/DarkroomScreen.styles.js, src/screens/DarkroomScreen.js, src/styles/index.js</files>
  <action>
**1. Create src/styles/DarkroomScreen.styles.js:**
Extract the StyleSheet.create() block from DarkroomScreen.
- Export as `styles`
- Add to src/styles/index.js barrel export

**2. Finalize src/screens/DarkroomScreen.js as thin component:**
After hook and style extraction, the component should be:

- Import block
- Hook call (destructure all needed values)
- JSX return

Target: ~100-150 lines, mostly JSX.

**Component structure:**

```javascript
import { useDarkroom } from '../hooks/useDarkroom';
import { styles } from '../styles/DarkroomScreen.styles';
// ... other imports

const DarkroomScreen = () => {
  const {
    photos,
    visiblePhotos,
    loading,
    triageComplete,
    // ... all other destructured values
    handleSwipe,
    handleUndo,
    handleDone,
    // ... all other handlers
  } = useDarkroom();

  return (
    // JSX using destructured values and styles
  );
};

export default DarkroomScreen;
```

**Important:**

- The SwipeablePhotoCard rendering logic stays in JSX (it's view concern)
- Success state conditional rendering stays in JSX
- Run tests after extraction to verify no regressions
  </action>
  <verify>
  npm test -- --passWithNoTests && ls src/styles/DarkroomScreen.styles.js && wc -l src/screens/DarkroomScreen.js
  </verify>
  <done>
  DarkroomScreen.js refactored to thin component (~100-150 lines).
  All styles extracted to DarkroomScreen.styles.js.
  All logic in useDarkroom hook.
  Tests pass, app functions correctly.
  </done>
  </task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] src/hooks/useDarkroom.js exists and contains extracted logic
- [ ] src/styles/DarkroomScreen.styles.js exists and contains extracted styles
- [ ] src/screens/DarkroomScreen.js is thin (~100-150 lines)
- [ ] npm test passes
- [ ] Darkroom triage flow works correctly (swipe, undo, done)
</verification>

<success_criteria>

- DarkroomScreen fully refactored following three-way separation
- Component behavior unchanged (pure refactor)
- Tests pass
- Triage, undo, batch save all work correctly
  </success_criteria>

<output>
After completion, create `.planning/phases/28-code-refactoring/28-03-SUMMARY.md`:

# Phase 28 Plan 03: DarkroomScreen Refactoring Summary

**[One-liner describing what shipped]**

## Accomplishments

- Extracted useDarkroom hook (X lines)
- Extracted DarkroomScreen.styles.js (X lines)
- Reduced DarkroomScreen.js from 902 to ~Y lines

## Files Created/Modified

- `src/hooks/useDarkroom.js` - Darkroom logic hook (created)
- `src/styles/DarkroomScreen.styles.js` - Darkroom styles (created)
- `src/screens/DarkroomScreen.js` - Thin component (modified)
- `src/styles/index.js` - Added DarkroomScreen export (modified)

## Decisions Made

[Hook structure decision and rationale]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 28-04-PLAN.md (FeedPhotoCard + PhotoDetailModal refactoring)
</output>
