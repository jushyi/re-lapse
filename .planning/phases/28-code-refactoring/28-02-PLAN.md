---
phase: 28-code-refactoring
plan: 02
type: execute
---

<objective>
Refactor CameraScreen into three-way separation.

Purpose: Apply the established extraction pattern to CameraScreen (906 lines) - the primary capture interface.
Output: useCamera hook(s), CameraScreen.styles.js, thin CameraScreen component.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/28-code-refactoring/28-CONTEXT.md
@.planning/phases/28-code-refactoring/28-01-SUMMARY.md

**Target file:**
@src/screens/CameraScreen.js

**Pattern references (from 28-01):**
@src/hooks/useSwipeableCard.js
@src/styles/SwipeablePhotoCard.styles.js

**Key constraints from 28-CONTEXT.md:**

- Hook granularity: Multiple focused hooks per feature (e.g., useCameraState, useCameraCapture, useCameraPermissions)
- Style naming: CameraScreen.styles.js in src/styles/
- No behavior changes - pure refactor
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Extract useCamera hooks from CameraScreen</name>
  <files>src/hooks/useCamera.js, src/screens/CameraScreen.js</files>
  <action>
Create src/hooks/useCamera.js with focused sub-hooks or a single hook (use judgment based on complexity):

**Option A - Single hook (simpler):**
Create useCamera hook that encapsulates:

- Camera permission state (from useCameraPermissions)
- Camera state (facing, flash, zoom, isCapturing, zoomLevels, etc.)
- Camera refs (cameraRef)
- Darkroom counts state
- Capture logic (handleCapture callback)
- Flash toggle logic
- Camera flip logic
- Zoom control logic
- Focus effect for darkroom counts refresh

**Option B - Multiple focused hooks (if complexity warrants):**

- useCameraPermissions - Permission request and status
- useCameraState - facing, flash, zoom, isCapturing
- useCameraCapture - Capture logic, queue integration
- useCameraDarkroom - Darkroom counts, bottom sheet state

Use judgment based on the actual code structure. The goal is "obvious at a glance" - if a single hook is clear, use it. If separation improves clarity, use multiple.

The hook(s) should:

- Accept minimal props (userId from useAuth)
- Return all state and handlers needed by the component
- Handle all useEffect and useFocusEffect logic
- Keep constants (ZOOM_LEVELS_BASE, layout constants) in the hook file

**Important:**

- Keep SVG icon components (FlashIcon, FlipCameraIcon) in the component file - they're render concerns
- Preserve exact behavior - this is a pure refactor
  </action>
  <verify>
  npm test -- --testPathPattern=Camera --passWithNoTests && ls src/hooks/useCamera.js
  </verify>
  <done>
  useCamera hook(s) created containing all CameraScreen logic.
  CameraScreen.js updated to use hook(s).
  </done>
  </task>

<task type="auto">
  <name>Task 2: Extract CameraScreen styles and finalize thin component</name>
  <files>src/styles/CameraScreen.styles.js, src/screens/CameraScreen.js, src/styles/index.js</files>
  <action>
**1. Create src/styles/CameraScreen.styles.js:**
Extract the StyleSheet.create() block from CameraScreen.
- Export as `styles`
- Keep layout constants (TAB_BAR_HEIGHT, FOOTER_HEIGHT, etc.) in the styles file or import from constants
- Add to src/styles/index.js barrel export

**2. Finalize src/screens/CameraScreen.js as thin component:**
After hook and style extraction, the component should be:

- Import block at top
- Hook call(s)
- Helper render functions if needed (for complex JSX sections)
- Main return with JSX

Target: ~100-150 lines, mostly JSX.

**Component structure should be:**

```javascript
import { useCamera } from '../hooks/useCamera';
import { styles } from '../styles/CameraScreen.styles';
// ... other imports

const CameraScreen = () => {
  const {
    // destructure all state and handlers from hook
  } = useCamera();

  return (
    // JSX using destructured values and styles
  );
};

export default CameraScreen;
```

**Important:**

- SVG icon components can stay in the component file (they're view concerns)
- Or extract to src/components/icons/ if they're reused elsewhere
- Run tests after extraction to verify no regressions
  </action>
  <verify>
  npm test -- --passWithNoTests && ls src/styles/CameraScreen.styles.js && wc -l src/screens/CameraScreen.js
  </verify>
  <done>
  CameraScreen.js refactored to thin component (~100-150 lines).
  All styles extracted to CameraScreen.styles.js.
  All logic in useCamera hook(s).
  Tests pass, app functions correctly.
  </done>
  </task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] src/hooks/useCamera.js exists and contains extracted logic
- [ ] src/styles/CameraScreen.styles.js exists and contains extracted styles
- [ ] src/screens/CameraScreen.js is thin (~100-150 lines)
- [ ] npm test passes
- [ ] App builds and camera functions correctly (manual verification)
</verification>

<success_criteria>

- CameraScreen fully refactored following three-way separation
- Component behavior unchanged (pure refactor)
- Tests pass
- Camera capture, flash, flip, zoom all work correctly
  </success_criteria>

<output>
After completion, create `.planning/phases/28-code-refactoring/28-02-SUMMARY.md`:

# Phase 28 Plan 02: CameraScreen Refactoring Summary

**[One-liner describing what shipped]**

## Accomplishments

- Extracted useCamera hook(s) (X lines)
- Extracted CameraScreen.styles.js (X lines)
- Reduced CameraScreen.js from 906 to ~Y lines

## Files Created/Modified

- `src/hooks/useCamera.js` - Camera logic hook (created)
- `src/styles/CameraScreen.styles.js` - Camera styles (created)
- `src/screens/CameraScreen.js` - Thin component (modified)
- `src/styles/index.js` - Added CameraScreen export (modified)

## Decisions Made

[Hook structure decision - single vs multiple hooks, and rationale]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 28-03-PLAN.md (DarkroomScreen refactoring)
</output>
