---
phase: 49-automated-test-suite
plan: 08
type: execute
---

<objective>
Write Maestro E2E flows for feed and social critical user journeys, and perform final verification of the complete test suite.

Purpose: Complete E2E coverage for the three critical flow areas (auth done in 49-07, feed and social here). Run final verification across all test types to confirm the full suite is CI-ready for Phase 50.
Output: Feed and social E2E flows, full test suite verification, phase complete.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/49-automated-test-suite/49-RESEARCH.md
@.planning/phases/49-automated-test-suite/49-CONTEXT.md

@src/screens/FeedScreen.js
@src/screens/FriendsScreen.js
@src/components/comments/CommentsBottomSheet.js

**Constraining decisions:**

- Camera and real push notifications can't be tested on iOS simulator (RESEARCH.md Pitfall 6) — test the response to photos/notifications, not capture/delivery
- Feed E2E assumes the test user has friends with photos — may need test data seeding or a login flow that creates test state
- Social E2E (friend request) needs a second test user — use Firebase test phone numbers for both accounts
- Maestro has limited JavaScript support — use runScript sparingly, prefer YAML commands
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Write feed and camera E2E flows</name>
  <files>.maestro/feed/view-feed.yaml, .maestro/feed/react-to-photo.yaml, src/screens/FeedScreen.js</files>
  <action>
1. **Add testIDs to FeedScreen.js** (minimal additions):
   - Feed list: `testID="feed-list"`
   - Photo card: `testID="feed-photo-card"` (on the repeating card component)
   - Reaction button area: `testID="feed-reaction-button"`
   - Comments button: `testID="feed-comments-button"`

2. **Write .maestro/feed/view-feed.yaml:**

   ```yaml
   # Feed Browsing E2E Flow
   # Prerequisites: Logged-in user with friends who have photos
   appId: com.spoodsjs.rewind
   ---
   - launchApp
   - assertVisible:
       id: 'feed-list'
       timeout: 10000
   - scroll:
       direction: DOWN
       duration: 500
   - assertVisible:
       id: 'feed-photo-card'
   ```

3. **Write .maestro/feed/react-to-photo.yaml:**

   ```yaml
   # Photo Reaction E2E Flow
   appId: com.spoodsjs.rewind
   ---
   - launchApp
   - assertVisible:
       id: 'feed-list'
       timeout: 10000
   - tapOn:
       id: 'feed-photo-card'
   - assertVisible:
       id: 'feed-reaction-button'
   - tapOn:
       id: 'feed-reaction-button'
   # Assert reaction animation or count change
   ```

   **Note on camera testing:** Camera capture can't be reliably tested on simulator (no hardware camera). The camera flow (capture → darkroom → reveal → feed) is covered by the integration tests in **tests**/integration/photoLifecycle.test.js. E2E tests focus on feed viewing and interaction, which is the user-facing part.

   Adjust YAML based on actual FeedScreen structure — the above is a template. If FeedScreen uses a different component hierarchy, update selectors accordingly.
   </action>
   <verify>.maestro/feed/\*.yaml files exist with correct Maestro YAML syntax</verify>
   <done>Feed E2E flows written with testIDs added to FeedScreen; react-to-photo flow covers tap and reaction</done>
   </task>

<task type="auto">
  <name>Task 2: Write social E2E flows</name>
  <files>.maestro/social/friend-request.yaml, .maestro/social/comments.yaml, src/screens/FriendsScreen.js, src/components/comments/CommentsBottomSheet.js</files>
  <action>
1. **Add testIDs to social screens** (minimal additions):

**FriendsScreen.js:**

- Friends list: `testID="friends-list"`
- Add friend button/search: `testID="friends-add-button"`
- Friend request accept button: `testID="friend-accept-button"`

**CommentsBottomSheet.js:**

- Comment input: `testID="comment-input"`
- Comment send button: `testID="comment-send-button"`
- Comments list: `testID="comments-list"`

2. **Write .maestro/social/friend-request.yaml:**

   ```yaml
   # Friend Request E2E Flow
   # Prerequisites: Two test accounts, not yet friends
   appId: com.spoodsjs.rewind
   ---
   - launchApp
   # Navigate to friends tab/screen
   - tapOn:
       text: '.*[Ff]riends.*'
   - assertVisible:
       id: 'friends-list'
       timeout: 5000
   # Verify friends screen loads
   - assertVisible:
       text: '.*[Ss]uggestion.*|.*[Aa]dd.*'
   ```

3. **Write .maestro/social/comments.yaml:**

   ```yaml
   # Comments E2E Flow
   # Prerequisites: Logged-in user, feed has photos
   appId: com.spoodsjs.rewind
   ---
   - launchApp
   - assertVisible:
       id: 'feed-list'
       timeout: 10000
   - tapOn:
       id: 'feed-comments-button'
   - assertVisible:
       id: 'comment-input'
       timeout: 3000
   - tapOn:
       id: 'comment-input'
   - inputText: 'Great photo!'
   - tapOn:
       id: 'comment-send-button'
   # Assert comment appears in list
   - assertVisible:
       text: 'Great photo!'
       timeout: 5000
   ```

   **Note on @mention testing:** The @mention autocomplete overlay depends on having mutual friends. For a basic E2E test, testing comment submission is sufficient. @mention can be verified if test data supports it, but isn't required for the initial E2E suite.

   Adjust all YAML based on actual screen structure. These flows verify the critical path — user can view friends, post comments, and interact socially.
   </action>
   <verify>.maestro/social/\*.yaml files exist with correct Maestro YAML syntax</verify>
   <done>Social E2E flows written with testIDs added to FriendsScreen and CommentsBottomSheet; comment flow covers input and submission</done>
   </task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete test suite for Phase 49:
- Client-side: utility tests, service tests (social + content + account layers), hook tests
- Cloud Functions: infrastructure + notification + trigger + callable + scheduled tests
- E2E: Maestro flows for auth, feed, and social journeys

Total test files: ~20+ new test files across 3 testing domains.
</what-built>
<how-to-verify> 1. Run client-side tests: `npm test` — verify all pass 2. Run Cloud Functions tests: `cd functions && npm test` — verify all pass 3. Review .maestro/ directory — verify YAML files exist for all critical flows: - .maestro/auth/phone-login.yaml - .maestro/auth/onboarding.yaml - .maestro/feed/view-feed.yaml - .maestro/feed/react-to-photo.yaml - .maestro/social/friend-request.yaml - .maestro/social/comments.yaml 4. If on macOS with simulator: Run `maestro test .maestro/` to execute all E2E flows 5. Run coverage: `npm run test:coverage` — review coverage report 6. Verify no lint issues: `npm run lint` 7. Confirm test execution speed: unit tests should complete in <30 seconds total
</how-to-verify>
<resume-signal>Type "approved" to confirm Phase 49 complete, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm test` passes all client-side tests
- [ ] `cd functions && npm test` passes all Cloud Functions tests
- [ ] .maestro/ directory has complete E2E flow coverage
- [ ] testIDs added to auth, feed, and social screens
- [ ] No existing functionality broken
- [ ] No lint errors introduced
- [ ] Test suite is fast (unit tests <30s)
- [ ] All test infrastructure is CI-ready for Phase 50
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- Three testing layers established: unit (Jest), Cloud Functions (Jest + firebase-functions-test), E2E (Maestro)
- Phase 49 complete — test suite ready for CI/CD integration in Phase 50
  </success_criteria>

<output>
After completion, create `.planning/phases/49-automated-test-suite/49-08-SUMMARY.md`:

# Phase 49 Plan 08: Maestro E2E Critical Flows & Final Verification Summary

**[Substantive one-liner]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `.maestro/feed/view-feed.yaml` - Feed browsing E2E
- `.maestro/feed/react-to-photo.yaml` - Photo reaction E2E
- `.maestro/social/friend-request.yaml` - Friend request E2E
- `.maestro/social/comments.yaml` - Comment posting E2E
- `src/screens/FeedScreen.js` - Added testIDs
- `src/screens/FriendsScreen.js` - Added testIDs
- `src/components/comments/CommentsBottomSheet.js` - Added testIDs

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase 49 complete. Ready for Phase 50: CI/CD Pipeline.
</output>
