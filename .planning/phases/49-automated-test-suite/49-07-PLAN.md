---
phase: 49-automated-test-suite
plan: 07
type: execute
---

<objective>
Install Maestro CLI, set up E2E test directory structure, add testIDs to auth screens, and write the auth/onboarding E2E flow.

Purpose: Establish the E2E testing foundation with Maestro and cover the most critical user journey — authentication. If users can't log in, nothing else matters.
Output: Maestro CLI installed, .maestro/ directory with auth E2E flow, testIDs in auth screens.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/49-automated-test-suite/49-RESEARCH.md
@.planning/phases/49-automated-test-suite/49-CONTEXT.md

@src/screens/LoginScreen.js
@src/screens/SignupScreen.js
@src/screens/VerificationCodeScreen.js

**Tech stack available:** Maestro CLI, Firebase test phone numbers
**Constraining decisions:**

- Maestro primarily works on macOS/Linux — on Windows, install via WSL2 or use .maestro/ YAML files for CI execution on macOS runners
- Firebase test phone numbers must be configured in Firebase Console (Authentication → Phone → Test phone numbers) — this is a prerequisite
- Use testID props on React Native components for reliable element targeting (not text matching which breaks on copy changes)
- App bundle ID: com.spoodsjs.rewind (from app.config.js)
- Maestro uses YAML — not JavaScript test files
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Install Maestro and create E2E directory structure</name>
  <files>.maestro/config.yaml, .maestro/auth/phone-login.yaml, .maestro/auth/onboarding.yaml, .maestro/feed/view-feed.yaml, .maestro/social/friend-request.yaml</files>
  <action>
1. **Install Maestro CLI** (platform-aware):
   - macOS/Linux: `curl -Ls "https://get.maestro.mobile.dev" | bash`
   - Windows: Maestro requires WSL2. Check if WSL is available: `wsl --version`. If available, install via WSL. If not, create the .maestro/ YAML files for CI execution on macOS runners (Phase 50 CI/CD will handle the runner).
   - If Maestro CLI can't be installed on this machine, skip CLI installation and focus on writing the YAML files — they'll be executed in CI.

2. **Create .maestro/ directory structure:**

   ```
   .maestro/
   ├── config.yaml          # Global Maestro config
   ├── auth/
   │   ├── phone-login.yaml    # Phone auth flow
   │   └── onboarding.yaml     # Profile setup flow
   ├── feed/
   │   └── view-feed.yaml      # Feed browsing (placeholder)
   └── social/
       └── friend-request.yaml # Friend request (placeholder)
   ```

3. **Create .maestro/config.yaml:**

   ```yaml
   appId: com.spoodsjs.rewind
   ```

4. **Create placeholder YAML files** for feed/ and social/ directories (just the appId header and a comment — actual flows in 49-08).

5. **Add .maestro/ to .gitignore exception** if .gitignore currently ignores it, or verify it will be tracked by git.
   </action>
   <verify>ls .maestro/ shows directory structure; .maestro/config.yaml exists with correct appId</verify>
   <done>Maestro directory structure created, config.yaml has correct appId, placeholder files for all flow categories</done>
   </task>

<task type="auto">
  <name>Task 2: Add testIDs to auth screens and write auth E2E flows</name>
  <files>src/screens/LoginScreen.js, src/screens/SignupScreen.js, src/screens/VerificationCodeScreen.js, .maestro/auth/phone-login.yaml, .maestro/auth/onboarding.yaml</files>
  <action>
1. **Add testID props to auth screen elements** (minimal, targeted additions):

**LoginScreen.js:**

- Phone input: `testID="login-phone-input"`
- Continue/Submit button: `testID="login-continue-button"`
- Signup link: `testID="login-signup-link"`

**SignupScreen.js:**

- Phone input: `testID="signup-phone-input"`
- Continue/Submit button: `testID="signup-continue-button"`

**VerificationCodeScreen.js:**

- Code input: `testID="verification-code-input"`
- Verify button: `testID="verification-submit-button"`

Add testID as a prop on the component. For TextInput: `testID="login-phone-input"`. For TouchableOpacity/Pressable: `testID="login-continue-button"`. Do NOT restructure components — just add the testID prop.

2. **Write .maestro/auth/phone-login.yaml:**

   ```yaml
   # Phone Login E2E Flow
   # Prerequisites: Firebase test phone number +16505553434 with code 123456
   appId: com.spoodsjs.rewind
   ---
   - launchApp:
       clearState: true
   - tapOn:
       id: 'login-phone-input'
   - inputText: '6505553434'
   - tapOn:
       id: 'login-continue-button'
   - assertVisible:
       id: 'verification-code-input'
       timeout: 5000
   - tapOn:
       id: 'verification-code-input'
   - inputText: '123456'
   - tapOn:
       id: 'verification-submit-button'
   - assertVisible:
       text: '.*[Ff]eed.*|.*[Hh]ome.*'
       timeout: 10000
   ```

3. **Write .maestro/auth/onboarding.yaml:**
   This flow tests the profile setup for NEW users. Read the onboarding screens (ProfileSetupScreen.js or similar) to determine:
   - What screens exist in the onboarding flow (username, display name, photo, bio, selects, song)
   - Add testIDs to key elements in those screens
   - Write YAML that navigates through the entire onboarding flow

   If the onboarding flow is complex (many screens), focus on the critical path: username entry → display name → skip optional screens → complete setup. Use `tapOn` with text matching for skip buttons if testIDs aren't needed for optional screens.

**Important:** These YAML files may need adjustment when actually run on a simulator. The testIDs and element targeting are based on reading the source — actual behavior may differ slightly. This is expected and will be verified in the checkpoint.
</action>
<verify>grep -r "testID" src/screens/LoginScreen.js src/screens/SignupScreen.js src/screens/VerificationCodeScreen.js shows testIDs added; .maestro/auth/\*.yaml files exist with correct structure</verify>
<done>testIDs added to auth screens, phone-login.yaml and onboarding.yaml written with correct Maestro syntax</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Maestro E2E test infrastructure with auth flow tests. Added testIDs to auth screens. Created .maestro/ directory with phone-login.yaml and onboarding.yaml.</what-built>
  <how-to-verify>
    1. Prerequisite: Configure Firebase test phone number in Firebase Console → Authentication → Phone → Test phone numbers → Add +16505553434 with code 123456
    2. If on macOS: Run `maestro test .maestro/auth/phone-login.yaml` with iOS simulator running your app
    3. If on Windows: Verify .maestro/auth/*.yaml files look correct syntactically — actual execution will happen in CI (Phase 50)
    4. Verify testIDs are present in auth screens: check LoginScreen, SignupScreen, VerificationCodeScreen
    5. Confirm the YAML flows match the actual auth screen flow (button labels, input fields, screen transitions)
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] .maestro/ directory structure exists
- [ ] .maestro/config.yaml has correct appId
- [ ] .maestro/auth/phone-login.yaml covers phone auth flow
- [ ] .maestro/auth/onboarding.yaml covers profile setup flow
- [ ] testIDs added to LoginScreen, SignupScreen, VerificationCodeScreen
- [ ] No existing functionality broken by testID additions
- [ ] `npm test` still passes (testIDs don't affect unit tests)
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- Auth E2E flow is ready for execution (locally or in CI)
- testIDs follow consistent naming convention (screen-element pattern)
  </success_criteria>

<output>
After completion, create `.planning/phases/49-automated-test-suite/49-07-SUMMARY.md`
</output>
