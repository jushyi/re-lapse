---
phase: 15.1-profile-setup-cancel-flow
plan: 01
type: execute
---

<objective>
Allow users to cancel profile setup and return to phone number input screen.

Purpose: Users who start profile setup but change their mind need an escape hatch. Currently they're forced to complete the flow with no way out.
Output: Back button on ProfileSetupScreen that shows confirmation, deletes partial profile data, and returns to phone input.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/15.1-profile-setup-cancel-flow/15.1-CONTEXT.md
@src/screens/ProfileSetupScreen.js
@src/context/AuthContext.js
@src/services/firebase/userService.js
@src/navigation/AppNavigator.js

**Tech stack available:**

- Firebase Firestore deleteDoc pattern (used in albumService, photoService)
- Alert.alert for confirmation dialogs (used throughout)
- useAuth hook with signOut function
- Ionicons for back chevron icon

**Established patterns:**

- Services return { success: boolean, error?: string }
- Alert.alert for confirmation before destructive actions
- signOut clears all user data and navigates via auth state change

**Constraining decisions:**

- Cancel only available from first profile setup screen (not from Selects)
- Always show confirmation dialog, even with empty fields
- Standard iOS Alert.alert, not custom styled modal
- After cancel: delete user doc + sign out → automatic navigation to PhoneInput via auth state listener
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Add cancelProfileSetup service function</name>
  <files>src/services/firebase/userService.js, src/services/firebase/index.js</files>
  <action>
Add cancelProfileSetup function to userService.js that:
1. Takes userId as parameter
2. Deletes the user document from Firestore using deleteDoc
3. Returns { success: true } on success, { success: false, error } on failure
4. Logs start, success, and error via logger

Import deleteDoc from @react-native-firebase/firestore (already used in other services).
Follow existing service pattern - see checkUsernameAvailability for reference.

Export from index.js alongside other userService exports.

Do NOT handle auth signout in this function - that's handled by the caller (keeps concerns separated).
</action>
<verify>
Check file compiles: `npx expo export --platform ios 2>&1 | head -30` (no red errors)
Verify function exported: `grep "cancelProfileSetup" src/services/firebase/index.js`
</verify>
<done>cancelProfileSetup function exists in userService.js and is exported from index.js</done>
</task>

<task type="auto">
  <name>Task 2: Add back button and cancel flow to ProfileSetupScreen</name>
  <files>src/screens/ProfileSetupScreen.js</files>
  <action>
Update ProfileSetupScreen to add cancel functionality:

1. Import cancelProfileSetup from services/firebase
2. Import signOut from useAuth hook (already using useAuth)

3. Add header with back button at top of screen content (inside ScrollView, before StepIndicator):

```jsx
<View style={styles.header}>
  <TouchableOpacity onPress={handleCancel} style={styles.backButton}>
    <Ionicons name="chevron-back" size={28} color={colors.text.primary} />
  </TouchableOpacity>
</View>
```

4. Add handleCancel function that:
   - Shows Alert.alert with title "Cancel Setup?"
   - Message: "Your profile won't be saved. You'll need to verify your phone number again to sign up."
   - Buttons: "Keep Setting Up" (cancel style) and "Exit" (destructive style)
   - On "Exit":
     a. Call cancelProfileSetup(user.uid)
     b. On success, call signOut() (this triggers auth state change → navigates to PhoneInput)
     c. On failure, show Alert.alert with error message

5. Add styles:
   - header: flexDirection row, paddingVertical 8, marginBottom 8
   - backButton: padding 4 for hit target
     </action>
     <verify>
6. Run app in simulator
7. Go through phone verification to reach ProfileSetupScreen
8. Verify back chevron appears in top-left
9. Tap back button → confirm dialog appears
10. Tap "Keep Setting Up" → stays on ProfileSetupScreen
11. Tap "Exit" → returns to PhoneInputScreen
12. Verify user document is deleted from Firestore (check Firebase Console or logs)
    </verify>
    <done>Back button visible on ProfileSetupScreen, confirmation dialog works, cancel deletes user doc and returns to phone input</done>
    </task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] cancelProfileSetup function exists and is exported
- [ ] Back button appears on ProfileSetupScreen
- [ ] Confirmation dialog shows on back button tap
- [ ] "Keep Setting Up" dismisses dialog, stays on screen
- [ ] "Exit" deletes user document from Firestore
- [ ] After exit, user lands on PhoneInputScreen
- [ ] No TypeScript/ESLint errors in modified files
</verification>

<success_criteria>

- Both tasks completed
- All verification checks pass
- User can cancel profile setup and return to phone input
- Partial profile data is cleaned up from database
- No regressions in normal profile setup flow
  </success_criteria>

<output>
After completion, create `.planning/phases/15.1-profile-setup-cancel-flow/15.1-01-SUMMARY.md`
</output>
