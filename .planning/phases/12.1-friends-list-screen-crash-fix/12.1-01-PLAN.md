---
phase: 12.1-friends-list-screen-crash-fix
plan: 01
type: execute
---

<objective>
Fix FriendsListScreen crash caused by incorrect Filter.or usage pattern in friendshipService.js.

Purpose: The FriendsListScreen crashes on load because friendshipService.js uses `Filter.or()` from a named import, but the `or` method is undefined when imported this way. React Native Firebase requires accessing Filter through the default firestore import.
Output: Working FriendsListScreen with corrected Filter usage pattern in friendshipService.js.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-friendship-service-fix/12-01-SUMMARY.md

**Root Cause Analysis:**
The friendshipService.js imports Filter as a named export:
```javascript
import { ..., Filter } from '@react-native-firebase/firestore';
```

Then uses it in three places:
- Line 229: `where(Filter.or(...))`
- Line 278: `where(Filter.or(...))`
- Line 417: `where(Filter.or(...))`

Per GitHub issue #7346, importing Filter this way doesn't expose `.or()` and `.and()` methods. The solution is to access Filter through the default firestore import.

**Reference:** https://github.com/invertase/react-native-firebase/issues/7346

**Key files:**
@src/services/firebase/friendshipService.js

**Tech stack available:**
- @react-native-firebase/firestore (modular API)
- Filter.or via `firestore.Filter.or()` pattern

**Constraining decisions:**
- Phase 11: Uses modular API (getFirestore, query, where, etc.)
- Phase 12: Fixed exists() method calls - codebase uses modular API consistently
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix Filter.or usage in friendshipService.js</name>
  <files>src/services/firebase/friendshipService.js</files>
  <action>
1. Add default import of firestore alongside existing named imports:
   ```javascript
   import firestore, { getFirestore, collection, ... } from '@react-native-firebase/firestore';
   ```

2. Remove `Filter` from the named imports (it's already there, remove it)

3. Replace all three occurrences of `Filter.or()` and `Filter.where()` with `firestore.Filter.or()` and `firestore.Filter.where()`:

   - Line 229-232: getFriendships query
   - Line 278-281: getPendingRequests query
   - Line 417-420: subscribeFriendships query

4. Do NOT change the where() wrapper - the pattern `where(firestore.Filter.or(...))` is correct for the modular API.

**What to avoid and WHY:**
- Do NOT import Filter directly (named import doesn't expose .or method)
- Do NOT remove the where() wrapper around Filter.or() - it's needed for the modular API
- Do NOT change any other code patterns - only the Filter access pattern
  </action>
  <verify>
1. Run `npx expo start` and navigate to Friends tab
2. FriendsListScreen should load without crashing
3. Real-time friendship updates should work (subscribeFriendships)
4. Friend list should display correctly
  </verify>
  <done>
- friendshipService.js uses `firestore.Filter.or()` instead of `Filter.or()`
- FriendsListScreen loads without ErrorBoundary catching crash
- All three Filter.or usages (getFriendships, getPendingRequests, subscribeFriendships) work correctly
  </done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] friendshipService.js imports firestore default export
- [ ] Filter removed from named imports
- [ ] All 3 occurrences of Filter.or → firestore.Filter.or
- [ ] All Filter.where → firestore.Filter.where
- [ ] App starts without errors
- [ ] FriendsListScreen loads successfully
- [ ] Friends list displays (if user has friends)
- [ ] Empty state displays (if user has no friends)
</verification>

<success_criteria>
- Filter.or accessed via firestore.Filter.or pattern
- FriendsListScreen no longer crashes on load
- Friendship queries work correctly (OR logic functions)
- No TypeScript/JavaScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/12.1-friends-list-screen-crash-fix/12.1-01-SUMMARY.md`:

# Phase 12.1 Plan 01: Fix Filter.or Usage Summary

**[One-liner describing what was fixed]**

## Accomplishments

- [Key changes made]

## Files Modified

- `src/services/firebase/friendshipService.js` - Description

## Decisions Made

[Any decisions, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase 12.1 complete, ready for Phase 13 (Production Build & Branding).
</output>
