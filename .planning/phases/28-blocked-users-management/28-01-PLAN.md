---
phase: 28-blocked-users-management
plan: 01
type: execute
---

<objective>
Add blocked users management UI - a Settings screen to view and unblock blocked users.

Purpose: Provide users visibility into who they've blocked and enable easy unblocking via familiar card UI.
Output: BlockedUsersScreen accessible from Settings, displaying blocked users with unblock functionality.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/28-blocked-users-management/28-CONTEXT.md

# Key files from Phase 21 (block implementation):

@src/services/firebase/blockService.js
@src/services/firebase/userService.js

# UI patterns to follow:

@src/components/FriendCard.js
@src/styles/FriendCard.styles.js
@src/screens/SettingsScreen.js
@src/screens/FriendsScreen.js

# Navigation registration:

@src/navigation/AppNavigator.js
@src/screens/index.js

**Tech stack available:** React Native, Firebase Firestore, existing blockService with getBlockedUserIds/unblockUser
**Established patterns:** FriendCard component, SettingsScreen menu items, DropdownMenu for actions
**Constraining decisions:**

- Phase 21: blockService functions exist (blockUser, unblockUser, getBlockedUserIds, isBlocked)
- Phase 16: All colors must use colors.js constants
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Add getBlockedUsersWithProfiles to blockService</name>
  <files>src/services/firebase/blockService.js, src/services/firebase/index.js</files>
  <action>
Add a new function `getBlockedUsersWithProfiles(userId)` to blockService.js that:
1. Calls existing `getBlockedUserIds(userId)` to get array of blocked user IDs
2. For each blocked user ID, calls `getUserProfile(blockedUserId)` from userService
3. Returns `{ success: true, blockedUsers: [...] }` with array of user profile objects
4. Each profile includes: userId, displayName, username, profilePhotoURL (the fields FriendCard needs)
5. Handle case where blocked user no longer exists (skip them, don't fail)
6. Import getUserProfile from userService at top of file

Export pattern (add to existing exports):

```javascript
export const getBlockedUsersWithProfiles = async (userId) => { ... }
```

Also update src/services/firebase/index.js to export the new function.
</action>
<verify>Function exists and exports correctly - check file for getBlockedUsersWithProfiles export</verify>
<done>getBlockedUsersWithProfiles function added and exported, follows existing service patterns</done>
</task>

<task type="auto">
  <name>Task 2: Create BlockedUsersScreen with Settings integration</name>
  <files>src/screens/BlockedUsersScreen.js, src/styles/BlockedUsersScreen.styles.js, src/screens/SettingsScreen.js, src/navigation/AppNavigator.js, src/screens/index.js</files>
  <action>
**Create BlockedUsersScreen.js:**
- SafeAreaView container with colors.background.primary
- Header: back chevron (left), "Blocked Users" title (center), spacer (right) - matching SettingsScreen pattern
- FlatList rendering FriendCard components for each blocked user
- Empty state: centered text "No blocked users" when list empty
- Loading state: centered ActivityIndicator while fetching
- On mount, call getBlockedUsersWithProfiles(user.uid)
- FriendCard props:
  - user: blocked user profile data
  - relationshipStatus: 'none' (no Add button, just show user info)
  - onPress: navigate to OtherUserProfile to view their profile
  - onUnblock: callback to handle unblock (refresh list after)
  - isBlocked: true (triggers Unblock option in menu)
- Handle unblock: call unblockUser(user.uid, blockedUserId), show success, remove from list with optimistic update

**Create BlockedUsersScreen.styles.js:**

- Follow pattern from FriendsScreen.styles.js
- container: flex 1, colors.background.primary
- header: same as SettingsScreen (row, space-between, border-bottom)
- emptyContainer: flex 1, center, justify center
- emptyText: colors.text.secondary, fontSize 16
- listContainer: flex 1

**Update SettingsScreen.js:**

- Add menu item after 'recentlyDeleted' and before 'signout':

```javascript
{
  id: 'blockedUsers',
  label: 'Blocked Users',
  icon: 'ban-outline',
  onPress: () => handleNavigate('BlockedUsers'),
},
```

**Update AppNavigator.js:**

- Import BlockedUsersScreen from screens
- Add to stack: `<Stack.Screen name="BlockedUsers" component={BlockedUsersScreen} options={{ headerShown: false }} />`
- Place near SettingsScreen in the stack

**Update src/screens/index.js:**

- Add export for BlockedUsersScreen
  </action>
  <verify>

1. Navigate to Settings, see "Blocked Users" menu item with ban-outline icon
2. Tap "Blocked Users", see BlockedUsersScreen with header and either empty state or blocked users list
3. If blocked users exist, cards display correctly with three-dot menu showing "Unblock User" option
4. Tapping card navigates to profile, tapping unblock shows confirmation then removes user from list
   </verify>
   <done>

- BlockedUsersScreen accessible from Settings
- Displays blocked users using FriendCard pattern
- Unblock functionality works with confirmation dialog
- Empty state shows when no blocked users
- Navigation and exports registered
  </done>
  </task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run lint` passes without new errors
- [ ] Settings > Blocked Users navigation works
- [ ] BlockedUsersScreen displays correctly (empty state or with blocked users)
- [ ] Unblock flow works: menu > Unblock User > confirmation > user removed from list
- [ ] Profile navigation from blocked user card works
- [ ] All colors use colors.js constants (no hardcoded hex values)
</verification>

<success_criteria>

- getBlockedUsersWithProfiles function added to blockService
- BlockedUsersScreen created with proper styling
- Settings menu item added with navigation
- FriendCard reused for consistent UI
- Unblock functionality works with optimistic updates
- All verification checks pass
  </success_criteria>

<output>
After completion, create `.planning/phases/28-blocked-users-management/28-01-SUMMARY.md`
</output>
