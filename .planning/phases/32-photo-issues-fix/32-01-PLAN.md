---
phase: 32-photo-issues-fix
plan: 01
type: execute
---

<objective>
Fix photo capture aspect ratio so photos fill the full screen when viewed.

Purpose: Photos taken in-app should match the screen's aspect ratio, eliminating black bars or unexpected cropping when viewed in full-screen modes (stories, albums, AlbumPhotoViewer).
Output: Camera captures photos that fill the screen when viewed, with viewfinder showing exactly what will be captured.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/32-photo-issues-fix/32-CONTEXT.md
@.planning/ISSUES.md

**Issue being addressed:** ISS-001 (Optimize photo capture for full-screen display)

**Key files:**
@src/hooks/useCamera.js
@src/screens/CameraScreen.js
@src/styles/CameraScreen.styles.js

**Tech available:**

- expo-camera (CameraView component)
- expo-image-manipulator (for cropping)
- Dimensions API for screen measurements

**Current state:**

- Camera viewfinder height: `SCREEN_HEIGHT - FOOTER_HEIGHT - TAB_BAR_HEIGHT`
- Photos captured at camera's native aspect ratio (typically 4:3)
- When viewed full-screen, photos may not fill the screen

**Target state:**

- Viewfinder displays exactly what will be captured (WYSIWYG)
- Photos cropped to screen aspect ratio after capture
- Photos fill full-screen viewers without black bars
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Configure viewfinder to display target aspect ratio</name>
  <files>src/screens/CameraScreen.js, src/styles/CameraScreen.styles.js</files>
  <action>
    1. Calculate target aspect ratio from screen dimensions (Dimensions.get('window'))
    2. Adjust cameraContainer styling so the camera preview displays at the target aspect ratio
    3. The camera preview should use resizeMode="cover" so it naturally fills the container
    4. What the user sees in the viewfinder = what will be in the final photo
    5. Keep the footer and controls layout working correctly with the adjusted camera area

    The goal is that the viewfinder fills its space while showing only the portion of the camera feed that will be in the final cropped photo.

  </action>
  <verify>
    - Camera preview fills viewfinder area without letterboxing
    - Footer and controls still positioned correctly
    - App builds without errors: `npx expo start`
  </verify>
  <done>Viewfinder displays at screen aspect ratio, filling its container area</done>
</task>

<task type="auto">
  <name>Task 2: Crop captured photos to match viewfinder</name>
  <files>src/hooks/useCamera.js</files>
  <action>
    1. In takePicture function, after takePictureAsync completes:
    2. Use expo-image-manipulator to crop the photo to match the screen's aspect ratio
    3. Calculate center crop region:
       - Get photo dimensions from the captured result
       - Calculate target dimensions based on screen aspect ratio
       - Center the crop region to maximize the captured content
    4. Use ImageManipulator.manipulateAsync with crop action
    5. Pass the cropped photo URI to addToQueue instead of the original

    Import: `import * as ImageManipulator from 'expo-image-manipulator';`

    The crop should match exactly what the viewfinder showed (same aspect ratio, center-aligned).

  </action>
  <verify>
    - Take a photo and check the saved file dimensions match screen aspect ratio
    - Log the crop dimensions for debugging: `logger.debug('Photo cropped', { original, cropped })`
  </verify>
  <done>Captured photos are cropped to screen aspect ratio before upload</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Photo capture now crops to screen aspect ratio with matching viewfinder</what-built>
  <how-to-verify>
    1. Run the app: `npx expo start`
    2. Open the Camera tab
    3. Note what you see in the viewfinder
    4. Take a photo
    5. Go to Darkroom, reveal the photo, add to an album
    6. View the photo in AlbumPhotoViewer (full-screen)
    7. Confirm:
       - Photo fills the entire screen (no black bars)
       - Photo matches what you saw in the viewfinder
       - No unexpected cropping of subjects
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Camera viewfinder displays at screen aspect ratio
- [ ] takePicture crops photos using expo-image-manipulator
- [ ] Photos fill full-screen viewers without black bars
- [ ] What you see in viewfinder = what you get in photo
- [ ] No TypeScript/ESLint errors
- [ ] App builds and runs without crashes
</verification>

<success_criteria>

- ISS-001 resolved
- Viewfinder shows exactly what will be captured
- Photos fill the screen when viewed in full-screen modes
- No post-viewing cropping or black bars
  </success_criteria>

<output>
After completion, create `.planning/phases/32-photo-issues-fix/32-01-SUMMARY.md`
</output>
