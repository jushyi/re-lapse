---
phase: 43-comment-cleanup-audit
plan: 01
type: execute
---

<objective>
Audit and clean up comments in all service files and Cloud Functions.

Purpose: Services and Cloud Functions contain the core business logic where comments are most likely to have drifted from what the code actually does. This plan fixes all known stale TODO/phase-reference comments and audits every comment in services/ and functions/ for accuracy, staleness, and noise.
Output: All comments in services/ and functions/ are accurate, stale TODOs removed, noise eliminated.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/43-comment-cleanup-audit/43-CONTEXT.md
@.planning/codebase/CONVENTIONS.md
@.planning/codebase/CONCERNS.md

# Key source files (all files to audit):

@src/services/firebase/feedService.js
@src/services/firebase/photoService.js
@src/services/firebase/darkroomService.js
@src/services/firebase/commentService.js
@src/services/firebase/friendshipService.js
@src/services/firebase/notificationService.js
@src/services/firebase/albumService.js
@src/services/firebase/accountService.js
@src/services/firebase/blockService.js
@src/services/firebase/contactSyncService.js
@src/services/firebase/monthlyAlbumService.js
@src/services/firebase/phoneAuthService.js
@src/services/firebase/reportService.js
@src/services/firebase/signedUrlService.js
@src/services/firebase/storageService.js
@src/services/firebase/userService.js
@src/services/firebase/viewedStoriesService.js
@src/services/firebase/index.js
@functions/index.js
@functions/logger.js

# Known stale comments to fix:

**From CONCERNS.md:** feedService.js line ~436 says "Using simple query to avoid composite index requirement" but code now uses composite indexes.

**From discovery:**

- src/utils/logger.js lines 218 and 242: "TODO: In Phase 10, send to Sentry" — Phase 10 complete, Sentry never integrated
- src/components/ErrorBoundary.js line 65: "TODO: In Phase 10, send to Sentry" — same
- src/hooks/useFeedPhotos.js line 97: Phase 35 reference in JSDoc — Phase 35 complete
- functions/index.js line 1242: "Tagging UI will be added in Phase 39/40" — Phases 39-40 complete

**Constraining rules:**

- NO code behavior changes — only touch comments, never change logic
- NO adding new documentation — don't add JSDoc or comments where none existed
- NO refactoring — if code is messy but works, leave it; only fix what comments say about it
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Fix known stale comments and audit core services</name>
  <files>src/services/firebase/feedService.js, src/services/firebase/photoService.js, src/services/firebase/darkroomService.js, src/services/firebase/commentService.js, src/services/firebase/friendshipService.js, src/services/firebase/notificationService.js, src/services/firebase/albumService.js, src/services/firebase/accountService.js, src/utils/logger.js, src/components/ErrorBoundary.js, src/hooks/useFeedPhotos.js</files>
  <action>
**Part A: Fix all known stale comments first.**

1. **feedService.js (~line 436):** The comment says "Using simple query to avoid composite index requirement" but the code now uses server-side Firestore filtering with composite indexes. Fix the comment to accurately describe the current query approach.

2. **logger.js (lines ~218 and ~242):** Two identical "TODO: In Phase 10, send to Sentry" comments with blocks of commented-out Sentry code below them. Phase 10 is complete and Sentry was never integrated. Remove the TODO comments AND the commented-out Sentry code blocks below each. Do NOT remove the actual working console.warn/console.error lines — only remove the TODO + commented-out code.

3. **ErrorBoundary.js (line ~65):** Same stale "TODO: In Phase 10, send to Sentry" with commented-out Sentry.captureException. Remove the TODO comment and the commented-out code line.

4. **useFeedPhotos.js (line ~97):** JSDoc has "Phase 35: Hot highlights filter for engagement-based curation". Phase 35 is complete. Remove the phase number reference — change to just describe the feature without referencing the phase (e.g., "Hot highlights filter for engagement-based curation"). Also check for other "Week N:" references in the same JSDoc block and update those similarly — they should describe what the code does, not when it was added.

5. **functions/index.js (line ~1242):** Comment says "Tagging UI will be added in Phase 39 (Darkroom) and Phase 40 (Feed)." Both phases are complete. Update to reflect that tagging is fully implemented. Also remove the "This function is ready to fire when photos have taggedUserIds field" line since it's now actively in use.

**Part B: Audit all comments in core services.**

Read each of the following files and audit every comment for:

- **Accuracy:** Does the comment truthfully describe what the code does right now? If not, fix it.
- **Staleness:** Is it a TODO/FIXME/HACK that's been addressed or is no longer relevant? If so, remove it.
- **Noise:** Does the comment just restate what the code obviously does (e.g., `// Set loading to true` above `setLoading(true)`)? If so, remove it.
- **Phase references:** Does the comment reference a specific phase number? If the phase is complete, remove the phase reference and keep only the functional description.

Files to audit (read each one fully):

- feedService.js (after fixing known issue)
- photoService.js
- darkroomService.js
- commentService.js
- friendshipService.js
- notificationService.js
- albumService.js
- accountService.js

Leave comments that explain "why" something works a certain way, document business rules, or describe complex workarounds.
</action>
<verify>

1. `npm run lint` passes
2. All 5 known stale comments fixed or removed
3. No TODO/FIXME comments remaining in audited files unless genuinely needed
4. No phase-number references remaining in audited files
5. No noise comments remaining (comments that just restate code)
6. All remaining comments accurately describe what the code does
7. No code behavior was changed — only comment text was modified
   </verify>
   <done>Known stale comments fixed. Core services (feedService, photoService, darkroomService, commentService, friendshipService, notificationService, albumService, accountService) plus logger.js, ErrorBoundary.js, and useFeedPhotos.js audited and cleaned.</done>
   </task>

<task type="auto">
  <name>Task 2: Audit remaining services and Cloud Functions</name>
  <files>src/services/firebase/blockService.js, src/services/firebase/contactSyncService.js, src/services/firebase/monthlyAlbumService.js, src/services/firebase/phoneAuthService.js, src/services/firebase/reportService.js, src/services/firebase/signedUrlService.js, src/services/firebase/storageService.js, src/services/firebase/userService.js, src/services/firebase/viewedStoriesService.js, src/services/firebase/index.js, functions/index.js, functions/logger.js</files>
  <action>
Read each file and audit every comment for accuracy, staleness, and noise.

**For each file:**

1. Read the entire file
2. Identify every comment (single-line `//` and multi-line `/* */` including JSDoc `/** */`)
3. For each comment, assess:
   - **Accurate?** Does it truthfully describe what the code does right now? → Fix if not
   - **Stale?** Is it a TODO/FIXME/HACK that's been done or abandoned? → Remove
   - **Noise?** Does it just restate what the code obviously does? → Remove
   - **Phase reference?** Does it reference a specific phase number for completed work? → Remove phase number, keep functional description
4. Leave comments that explain "why", document business rules, or describe workarounds

**Files to audit:**

- blockService.js
- contactSyncService.js
- monthlyAlbumService.js
- phoneAuthService.js
- reportService.js
- signedUrlService.js
- storageService.js
- userService.js
- viewedStoriesService.js
- services/firebase/index.js
- functions/index.js (focus on the known Phase 39/40 comment already fixed in Task 1, but audit ALL other comments in this large file)
- functions/logger.js

**Rules:**

- NO code behavior changes — only modify comment text
- NO adding new comments or documentation
- NO refactoring code
  </action>
  <verify>

1. `npm run lint` passes
2. No stale TODO/FIXME comments remaining in audited files
3. No phase-number references for completed phases
4. No noise comments remaining
5. All remaining comments accurately describe current code behavior
6. No code behavior changed
   </verify>
   <done>Remaining services (blockService, contactSyncService, monthlyAlbumService, phoneAuthService, reportService, signedUrlService, storageService, userService, viewedStoriesService, index) and Cloud Functions (functions/index.js, functions/logger.js) audited and cleaned.</done>
   </task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run lint` passes
- [ ] All 5 known stale comments from discovery are fixed
- [ ] feedService.js outdated "composite index" comment is fixed
- [ ] No stale TODOs/FIXMEs remain in services/ or functions/
- [ ] No misleading phase references in services/ or functions/
- [ ] No noise comments in services/ or functions/
- [ ] All remaining comments accurately describe code behavior
- [ ] Zero code behavior changes — only comment text modified
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No lint errors introduced
- Every comment in services/ and functions/ is accurate
- All stale TODO/FIXME comments removed
- All completed-phase references cleaned up
- No noise comments remain
- Zero code logic changes
  </success_criteria>

<output>
After completion, create `.planning/phases/43-comment-cleanup-audit/43-01-SUMMARY.md`
</output>
