---
phase: 08-user-albums
plan: FIX5
type: fix
---

<objective>
Menu system overhaul - replace Alert.alert with custom dropdown menus.

Issues: UAT-007, UAT-009
Scope: 2 minor fixes (significant refactor)
</objective>

<context>
@.planning/phases/08-user-albums/08-ISSUES.md
@src/components/AlbumPhotoViewer.js
@src/screens/AlbumGridScreen.js
@src/screens/ProfileScreen.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create reusable DropdownMenu component</name>
  <files>src/components/DropdownMenu.js, src/components/index.js</files>
  <action>
Create a reusable dropdown menu component:

Props:

- visible: boolean
- onClose: () => void
- options: Array<{ label: string, icon?: string, onPress: () => void, destructive?: boolean }>
- anchorPosition?: { x: number, y: number } (optional, for positioning near tap)

Structure:

```jsx
<Modal visible={visible} transparent animationType="fade">
  <TouchableOpacity style={styles.backdrop} onPress={onClose}>
    <View style={styles.menu}>
      {options.map(option => (
        <TouchableOpacity
          key={option.label}
          style={styles.menuItem}
          onPress={() => { option.onPress(); onClose(); }}
        >
          {option.icon && <Ionicons name={option.icon} ... />}
          <Text style={[
            styles.menuText,
            option.destructive && styles.destructiveText
          ]}>
            {option.label}
          </Text>
        </TouchableOpacity>
      ))}
    </View>
  </TouchableOpacity>
</Modal>
```

Styles:

- Backdrop: rgba(0,0,0,0.5)
- Menu: dark background (#1a1a1a), rounded corners (12px), padding
- Menu items: padding 16px, border-bottom subtle
- Text: white, destructive = red (#ff4444)
- Position: centered or near anchor if provided

Export from components/index.js
</action>
<verify>Component renders modal with options, closes on backdrop tap</verify>
<done>DropdownMenu component created and exported</done>
</task>

<task type="auto">
  <name>Task 2: Create RenameAlbumModal component</name>
  <files>src/components/RenameAlbumModal.js, src/components/index.js</files>
  <action>
Create half-screen modal for album renaming (replaces Alert.prompt):

Props:

- visible: boolean
- currentName: string
- onClose: () => void
- onSave: (newName: string) => void

Structure:

```jsx
<Modal visible={visible} transparent animationType="slide">
  <View style={styles.backdrop}>
    <View style={styles.modalContent}>
      <Text style={styles.title}>Rename Album</Text>
      <TextInput
        style={styles.input}
        value={name}
        onChangeText={setName}
        placeholder="Album name"
        placeholderTextColor="#666"
        autoFocus
        maxLength={24}
      />
      <Text style={styles.charCount}>{name.length}/24</Text>
      <View style={styles.buttons}>
        <TouchableOpacity onPress={onClose}>
          <Text style={styles.cancelText}>Cancel</Text>
        </TouchableOpacity>
        <TouchableOpacity onPress={() => onSave(name)}>
          <Text style={styles.saveText}>Save</Text>
        </TouchableOpacity>
      </View>
    </View>
  </View>
</Modal>
```

Styles:

- Modal slides up from bottom, covers ~40% of screen
- Dark background (#1a1a1a), rounded top corners
- Input: dark background (#333), white text, rounded
- Buttons: Cancel (gray), Save (brand color)
  </action>
  <verify>Modal opens with current name, allows editing, Save/Cancel work</verify>
  <done>RenameAlbumModal component created</done>
  </task>

<task type="auto">
  <name>Task 3: Replace AlbumPhotoViewer menu with DropdownMenu</name>
  <files>src/components/AlbumPhotoViewer.js</files>
  <action>
Replace Alert.alert in 3-dot menu with DropdownMenu:

Before:

```javascript
Alert.alert('Options', '', [
  { text: 'Set as Album Cover', onPress: handleSetCover },
  { text: 'Remove from Album', onPress: handleRemove },
  { text: 'Cancel', style: 'cancel' },
]);
```

After:

```jsx
const [menuVisible, setMenuVisible] = useState(false);

// In render:
<TouchableOpacity onPress={() => setMenuVisible(true)}>
  <Ionicons name="ellipsis-horizontal" ... />
</TouchableOpacity>

<DropdownMenu
  visible={menuVisible}
  onClose={() => setMenuVisible(false)}
  options={[
    { label: 'Set as Album Cover', icon: 'image-outline', onPress: handleSetCover },
    { label: 'Remove from Album', icon: 'trash-outline', onPress: handleRemove, destructive: true }
  ]}
/>
```

  </action>
  <verify>3-dot menu opens dropdown, not Alert.alert</verify>
  <done>Photo viewer uses DropdownMenu</done>
</task>

<task type="auto">
  <name>Task 4: Replace AlbumGridScreen menus with DropdownMenu</name>
  <files>src/screens/AlbumGridScreen.js</files>
  <action>
Replace both menus in AlbumGridScreen:

1. Header 3-dot menu:

```jsx
<DropdownMenu
  visible={headerMenuVisible}
  onClose={() => setHeaderMenuVisible(false)}
  options={[
    { label: 'Rename Album', icon: 'pencil-outline', onPress: () => setRenameModalVisible(true) },
    { label: 'Change Cover', icon: 'image-outline', onPress: handleChangeCover },
    { label: 'Delete Album', icon: 'trash-outline', onPress: handleDeleteAlbum, destructive: true },
  ]}
/>
```

2. Long-press photo menu:

```jsx
<DropdownMenu
  visible={photoMenuVisible}
  onClose={() => setPhotoMenuVisible(false)}
  options={[
    { label: 'Set as Cover', icon: 'image-outline', onPress: () => handleSetCover(selectedPhoto) },
    {
      label: 'Remove from Album',
      icon: 'close-circle-outline',
      onPress: () => handleRemove(selectedPhoto),
      destructive: true,
    },
  ]}
/>
```

3. Replace Alert.prompt rename with RenameAlbumModal:

```jsx
<RenameAlbumModal
  visible={renameModalVisible}
  currentName={album.name}
  onClose={() => setRenameModalVisible(false)}
  onSave={handleRename}
/>
```

  </action>
  <verify>All menus use dropdown, rename uses half-screen modal</verify>
  <done>AlbumGridScreen uses DropdownMenu and RenameAlbumModal</done>
</task>

<task type="auto">
  <name>Task 5: Replace ProfileScreen album menu with DropdownMenu</name>
  <files>src/screens/ProfileScreen.js</files>
  <action>
Replace long-press album menu in ProfileScreen:

Find the album long-press handler and replace Alert.alert with DropdownMenu:

```jsx
const [albumMenuVisible, setAlbumMenuVisible] = useState(false);
const [selectedAlbum, setSelectedAlbum] = useState(null);

const handleAlbumLongPress = (album) => {
  setSelectedAlbum(album);
  setAlbumMenuVisible(true);
};

// In render:
<DropdownMenu
  visible={albumMenuVisible}
  onClose={() => setAlbumMenuVisible(false)}
  options={[
    { label: 'Rename', icon: 'pencil-outline', onPress: () => { setAlbumMenuVisible(false); setRenameModalVisible(true); }},
    { label: 'Delete Album', icon: 'trash-outline', onPress: handleDeleteAlbum, destructive: true }
  ]}
/>

<RenameAlbumModal
  visible={renameModalVisible}
  currentName={selectedAlbum?.name || ''}
  onClose={() => setRenameModalVisible(false)}
  onSave={(newName) => handleRenameAlbum(selectedAlbum.id, newName)}
/>
```

  </action>
  <verify>Album long-press shows dropdown menu, rename shows modal</verify>
  <done>ProfileScreen uses DropdownMenu</done>
</task>

</tasks>

<verification>
- [ ] DropdownMenu component works correctly
- [ ] RenameAlbumModal component works correctly
- [ ] AlbumPhotoViewer 3-dot uses dropdown
- [ ] AlbumGridScreen header menu uses dropdown
- [ ] AlbumGridScreen photo long-press uses dropdown
- [ ] AlbumGridScreen rename uses modal
- [ ] ProfileScreen album long-press uses dropdown
- [ ] No Alert.alert menus remain in album features
- [ ] App builds without errors
</verification>

<success_criteria>

- UAT-007, UAT-009 resolved
- Consistent dropdown menu UX across all album features
  </success_criteria>

<output>
Create `.planning/phases/08-user-albums/08-FIX5-SUMMARY.md`
</output>
