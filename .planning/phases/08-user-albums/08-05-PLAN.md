---
phase: 08-user-albums
plan: 05
type: execute
---

<objective>
Create full-screen photo viewer for browsing album photos.

Purpose: Allow users to view individual photos with swipe navigation.
Output: AlbumPhotoViewer with swipe/tap navigation and photo actions.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./08-05-SUMMARY.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-user-albums/08-CONTEXT.md
@.planning/phases/08-user-albums/08-04-SUMMARY.md

@src/screens/AlbumGridScreen.js
@src/services/firebase/albumService.js
@src/components/FullscreenSelectsViewer.js
@src/constants/colors.js

**From context - Full-screen photo view specs:**

- Swipe or tap to navigate between photos
- Header: album name + position (3 of 12)
- 3-dot menu: Remove from album, Set as cover
- Remove always shows confirmation
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Create AlbumPhotoViewer component</name>
  <files>src/components/AlbumPhotoViewer.js</files>
  <action>
Create AlbumPhotoViewer for full-screen photo browsing.

Reference FullscreenSelectsViewer for patterns but adapt for albums.

Props:

- `visible` - Boolean to show/hide
- `photos` - Array of photo objects with { id, imageURL }
- `initialIndex` - Starting photo index
- `albumName` - Album name for header
- `isOwnProfile` - Show edit options only for own albums
- `onClose` - Callback to close viewer
- `onRemovePhoto` - Callback(photoId) when photo removed
- `onSetCover` - Callback(photoId) when set as cover

Layout:

- Modal with full-screen dark background
- Header (safe area aware):
  - Left: Close button (X icon)
  - Center: Album name + position ("Vacation • 3 of 12")
  - Right: 3-dot menu (only if isOwnProfile)
- Photo display:
  - FlatList horizontal with pagingEnabled
  - Each photo fills screen width, centered vertically
  - resizeMode="contain"
- Navigation:
  - Swipe left/right between photos
  - Tap left edge: previous photo
  - Tap right edge: next photo
  - Tap center: toggle header visibility (optional, can skip)

3-dot menu options (Alert.alert):

- "Set as Album Cover" - calls onSetCover(currentPhotoId)
- "Remove from Album" - shows confirmation, then calls onRemovePhoto(currentPhotoId)
- "Cancel"

Remove confirmation:

- Alert: "Remove Photo?" / "This photo will be removed from the album but will still be in your library."
- Buttons: "Cancel", "Remove" (destructive)
  </action>
  <verify>Component renders full-screen photo with swipe navigation</verify>
  <done>AlbumPhotoViewer shows photos with swipe, position indicator, and action menu</done>
  </task>

<task type="auto">
  <name>Task 2: Integrate viewer into AlbumGridScreen with photo actions</name>
  <files>src/screens/AlbumGridScreen.js, src/components/index.js</files>
  <action>
Wire up AlbumPhotoViewer in AlbumGridScreen.

1. Export AlbumPhotoViewer from components/index.js

2. In AlbumGridScreen, add state:

```javascript
const [viewerVisible, setViewerVisible] = useState(false);
const [viewerInitialIndex, setViewerInitialIndex] = useState(0);
```

3. Handle photo tap in grid:

```javascript
const handlePhotoPress = index => {
  setViewerInitialIndex(index);
  setViewerVisible(true);
};
```

4. Handle remove photo:

```javascript
const handleRemovePhoto = async photoId => {
  const result = await removePhotoFromAlbum(album.id, photoId);
  if (result.success) {
    // Refresh album data
    fetchAlbum();
    // If removed last photo, show warning or navigate back
    if (result.warning === 'last_photo') {
      Alert.alert('Album Deleted', 'The album was deleted because it had no more photos.');
      navigation.goBack();
    }
  } else {
    Alert.alert('Error', 'Could not remove photo');
  }
};
```

5. Handle set cover:

```javascript
const handleSetCover = async photoId => {
  const result = await setCoverPhoto(album.id, photoId);
  if (result.success) {
    fetchAlbum(); // Refresh to update cover
  } else {
    Alert.alert('Error', 'Could not set cover photo');
  }
};
```

6. Render AlbumPhotoViewer:

```jsx
<AlbumPhotoViewer
  visible={viewerVisible}
  photos={photos}
  initialIndex={viewerInitialIndex}
  albumName={album?.name}
  isOwnProfile={isOwnProfile}
  onClose={() => setViewerVisible(false)}
  onRemovePhoto={handleRemovePhoto}
  onSetCover={handleSetCover}
/>
```

  </action>
  <verify>Tapping photo in grid opens viewer, can swipe and use menu actions</verify>
  <done>Photo viewer integrated with remove and set cover functionality</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Full-screen album photo viewer with navigation and actions</what-built>
  <how-to-verify>
    1. Run: npx expo start
    2. Open an album with multiple photos
    3. Tap a photo in the grid
    4. Verify: Full-screen viewer opens at that photo
    5. Verify: Header shows album name and position (e.g., "Vacation • 2 of 5")
    6. Swipe left/right to navigate between photos
    7. Verify: Position indicator updates
    8. Tap 3-dot menu
    9. Select "Set as Album Cover" - verify it works (cover updates in album bar)
    10. Select "Remove from Album" - verify confirmation appears
    11. Confirm removal - verify photo is removed from album
    12. Close viewer and verify grid updated
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] AlbumPhotoViewer component created
- [ ] Swipe and tap navigation works
- [ ] Position indicator shows correctly
- [ ] Set as cover updates album
- [ ] Remove photo with confirmation works
- [ ] Grid refreshes after actions
- [ ] No lint errors: `npm run lint`
</verification>

<success_criteria>

- Can browse all album photos full-screen
- Navigation is smooth and intuitive
- Photo actions work correctly
- Removing last photo handles gracefully
  </success_criteria>

<output>
After completion, create `.planning/phases/08-user-albums/08-05-SUMMARY.md`
</output>
