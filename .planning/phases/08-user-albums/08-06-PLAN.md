---
phase: 08-user-albums
plan: 06
type: execute
---

<objective>
Implement album management features and additional entry points.

Purpose: Complete album editing capabilities and make albums discoverable from photos.
Output: Full album management (rename, delete) and "Add to album" from photo menus.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./08-06-SUMMARY.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-user-albums/08-CONTEXT.md
@.planning/phases/08-user-albums/08-05-SUMMARY.md

@src/screens/AlbumGridScreen.js
@src/screens/ProfileScreen.js
@src/services/firebase/albumService.js
@src/constants/colors.js

**From context - Album management specs:**

- Long-press album card: Edit cover, Rename, Delete
- Grid 3-dot menu: Rename (inline edit), Change cover, Delete album
- Delete album: simple confirm, photos stay in app
- "Add to album" from photo 3-dot menus opens album list + create new option
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Implement album edit options in AlbumGridScreen</name>
  <files>src/screens/AlbumGridScreen.js</files>
  <action>
Implement the 3-dot menu actions in AlbumGridScreen header.

Menu already shows options from 08-04, now make them functional:

1. Rename Album:
   - Show Alert.prompt (iOS) or custom modal with TextInput
   - Pre-fill current name
   - Max 24 characters
   - On confirm: call updateAlbum(albumId, { name: newName })
   - Refresh album data

2. Change Cover:
   - Navigate to a cover selection mode:
     - Could reuse AlbumPhotoViewer with mode="selectCover"
     - Or show grid with "tap to select cover" instruction
   - Simpler approach: Alert.alert listing photo positions ("Photo 1", "Photo 2"...)
   - On select: call setCoverPhoto(albumId, photoId)
   - Alternative: Add "Set as cover" action to each grid cell long-press

3. Delete Album:
   - Confirmation Alert: "Delete Album?" / "Photos will remain in your library."
   - Buttons: "Cancel", "Delete" (destructive)
   - On confirm: call deleteAlbum(albumId)
   - Navigate back to Profile

Implement simpler inline approach for Change Cover:

- Add long-press on grid photos (not in viewer, on grid itself)
- Long-press shows: "Set as Album Cover" option
- This is more intuitive than the menu approach

Update grid FlatList renderItem to include onLongPress.
</action>
<verify>Rename, change cover, and delete all work from grid screen</verify>
<done>All album edit actions functional from grid header menu and long-press</done>
</task>

<task type="auto">
  <name>Task 2: Add album long-press menu on ProfileScreen</name>
  <files>src/screens/ProfileScreen.js</files>
  <action>
Implement long-press on album cards in profile album bar.

Update handleAlbumLongPress:

```javascript
const handleAlbumLongPress = album => {
  logger.info('ProfileScreen: Album long press', { albumId: album.id });

  Alert.alert(album.name, '', [
    {
      text: 'Edit Album',
      onPress: () =>
        navigation.navigate('AlbumGrid', {
          albumId: album.id,
          isOwnProfile: true,
          editMode: true, // Optional: could auto-open menu
        }),
    },
    {
      text: 'Delete Album',
      style: 'destructive',
      onPress: () => confirmDeleteAlbum(album),
    },
    {
      text: 'Cancel',
      style: 'cancel',
    },
  ]);
};

const confirmDeleteAlbum = album => {
  Alert.alert('Delete Album?', 'Photos will remain in your library.', [
    { text: 'Cancel', style: 'cancel' },
    {
      text: 'Delete',
      style: 'destructive',
      onPress: async () => {
        const result = await deleteAlbum(album.id);
        if (result.success) {
          // Refresh albums list
          fetchAlbums();
        } else {
          Alert.alert('Error', 'Could not delete album');
        }
      },
    },
  ]);
};
```

Ensure AlbumCard passes onLongPress to TouchableOpacity/Pressable.
</action>
<verify>Long-press on album card shows edit/delete menu</verify>
<done>Album long-press menu works on profile with delete functionality</done>
</task>

<task type="auto">
  <name>Task 3: Create AddToAlbumSheet for adding photos from other screens</name>
  <files>src/components/AddToAlbumSheet.js, src/components/index.js</files>
  <action>
Create AddToAlbumSheet component for the "Add to album" entry point from photo menus.

This will be used when viewing a photo and selecting "Add to album" from its 3-dot menu.

Props:

- `visible` - Boolean to show/hide
- `photoId` - Photo ID to add
- `onClose` - Close callback
- `onAlbumCreated` - Optional callback when new album created

Layout (bottom sheet style or modal):

- Header: "Add to Album" title, close X button
- "Create New Album" row at top with plus icon
  - On tap: navigate to CreateAlbum, pass photoId to pre-select
- List of existing albums:
  - Album cover thumbnail (small, 50x50)
  - Album name
  - Photo count
  - If photo already in album: checkmark, disabled (grayed out)
  - On tap: call addPhotosToAlbum(albumId, [photoId]), show success, close

Data:

- Fetch user's albums with getUserAlbums
- Check each album's photoIds to see if photoId already included

Success feedback:

- Brief "Added to [Album Name]" toast or the row updates with checkmark
- Auto-close after short delay or stay open for multiple additions

Export from components/index.js.

Note: Integration into photo detail views (FeedPhotoCard, PhotoDetailModal) is out of scope for this phase - just create the component. Can be wired up when those screens get the "Add to album" menu option.
</action>
<verify>AddToAlbumSheet renders with album list and create option</verify>
<done>AddToAlbumSheet component ready for integration into photo menus</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete album management with edit, delete, and add-to-album component</what-built>
  <how-to-verify>
    1. Run: npx expo start
    2. Create an album if needed
    3. On Profile, long-press an album card
    4. Verify: Menu shows "Edit Album" and "Delete Album" options
    5. Tap "Edit Album" - verify navigates to grid
    6. In grid, tap 3-dot menu
    7. Test "Rename Album" - verify name updates
    8. Long-press a photo in grid - verify "Set as Album Cover" option
    9. Set a new cover - verify album card updates
    10. Test "Delete Album" - verify confirmation and deletion works
    11. Verify: AddToAlbumSheet component exists and renders (manual import test)
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Rename album works (inline or prompt)
- [ ] Change cover works (long-press photo in grid)
- [ ] Delete album works with confirmation
- [ ] Album card long-press menu works on profile
- [ ] AddToAlbumSheet component created
- [ ] No lint errors: `npm run lint`
</verification>

<success_criteria>

- All album management features complete
- Multiple entry points for editing
- Delete is safe (confirmation, photos preserved)
- Phase 8 complete with full album functionality
  </success_criteria>

<output>
After completion, create `.planning/phases/08-user-albums/08-06-SUMMARY.md`:

Include:

- Phase 8 complete summary
- All features implemented
- Note: AddToAlbumSheet ready for integration in future phases
  </output>
