---
phase: 25-color-palette
plan: 05
type: execute
domain: react-native
teaching: true
---

<objective>
Add theme selection as an optional step during new user onboarding.

Purpose: Allow new users to personalize their app experience during profile setup.
Output: ThemePickerStep component integrated into ProfileSetupScreen flow.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/25-color-palette/25-CONTEXT.md
@src/screens/ProfileSetupScreen.js
@src/context/ThemeContext.js
@src/components/ThemeCard.js
@.planning/phases/25-color-palette/25-04-SUMMARY.md (if exists)

**Current Onboarding Flow:**

1. Profile info (name, username, bio)
2. Selects/highlights (photo selection)
3. Profile song (optional)

**This Plan Adds:**

- Theme picker as optional step between profile info and selects
- Step indicator updates (Step X of Y)
- Skip functionality (keeps default dark theme)
  </context>

<learning_objectives>
By the end of this plan, you will:

1. Understand multi-step form patterns
2. Learn to integrate new steps into existing flows
3. Handle optional steps (skip vs select)
4. Complete a full feature from concept to integration
   </learning_objectives>

<tasks>

<task type="auto">
  <name>Task 1: Create ThemePickerStep component</name>
  <files>src/components/ThemePickerStep.js</files>
  <action>
**Create a reusable theme picker component for onboarding.**

This component is similar to AppearanceSettingsScreen but:

- Designed for onboarding flow (inline, not modal)
- Has Skip option (optional step)
- Simpler layout (no preview/apply, direct selection)

**Component requirements:**

```javascript
// Props:
// onComplete: (themeId: string | null) => void
//   - Called with selected themeId when user picks, or null when skipped
// initialThemeId: string (optional) - pre-selected theme

// Layout:
// - Title: "Choose your style" or similar
// - Subtitle: "You can change this anytime in Settings"
// - Theme grid (2 columns)
// - Skip button at bottom
```

**Implementation:**

```javascript
import React, { useState } from 'react';
import { View, Text, FlatList, TouchableOpacity, StyleSheet } from 'react-native';
import { useTheme } from '../context/ThemeContext';
import ThemeCard from './ThemeCard';
import { colors } from '../constants/colors';

const ThemePickerStep = ({ onComplete, initialThemeId = 'dark' }) => {
  const { themes, setTheme } = useTheme();
  const [selectedThemeId, setSelectedThemeId] = useState(initialThemeId);

  const handleThemeSelect = themeId => {
    setSelectedThemeId(themeId);
    setTheme(themeId); // Apply immediately for preview during onboarding
  };

  const handleContinue = () => {
    onComplete(selectedThemeId);
  };

  const handleSkip = () => {
    // Reset to default if they previewed other themes
    setTheme('dark');
    onComplete(null); // Signal skip
  };

  // Filter out 'custom' from onboarding - too complex for new users
  const availableThemes = themes.filter(t => !t.isCustom);

  return (
    <View style={styles.container}>
      <View style={styles.header}>
        <Text style={styles.title}>Choose your style</Text>
        <Text style={styles.subtitle}>You can always change this later in Settings</Text>
      </View>

      <FlatList
        data={availableThemes}
        numColumns={2}
        keyExtractor={item => item.id}
        renderItem={({ item }) => (
          <ThemeCard
            theme={item}
            isSelected={item.id === selectedThemeId}
            onPress={() => handleThemeSelect(item.id)}
          />
        )}
        contentContainerStyle={styles.grid}
        columnWrapperStyle={styles.row}
      />

      <View style={styles.buttons}>
        <TouchableOpacity style={styles.continueButton} onPress={handleContinue}>
          <Text style={styles.continueText}>Continue</Text>
        </TouchableOpacity>

        <TouchableOpacity style={styles.skipButton} onPress={handleSkip}>
          <Text style={styles.skipText}>Skip for now</Text>
        </TouchableOpacity>
      </View>
    </View>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: colors.background.primary,
    padding: 16,
  },
  header: {
    marginBottom: 24,
  },
  title: {
    color: colors.text.primary,
    fontSize: 28,
    fontWeight: 'bold',
    marginBottom: 8,
  },
  subtitle: {
    color: colors.text.secondary,
    fontSize: 16,
  },
  grid: {
    paddingBottom: 16,
  },
  row: {
    justifyContent: 'space-between',
  },
  buttons: {
    marginTop: 'auto',
    paddingBottom: 20,
  },
  continueButton: {
    backgroundColor: colors.interactive.primary,
    padding: 16,
    borderRadius: 12,
    alignItems: 'center',
    marginBottom: 12,
  },
  continueText: {
    color: colors.text.primary,
    fontSize: 16,
    fontWeight: '600',
  },
  skipButton: {
    padding: 14,
    alignItems: 'center',
  },
  skipText: {
    color: colors.text.secondary,
    fontSize: 14,
  },
});

export default ThemePickerStep;
```

**Learning point - Preview during onboarding:**
We call `setTheme(themeId)` immediately when user taps a theme card. This gives instant visual feedback - they can see how the app looks with each theme before deciding. If they skip, we reset to default.
</action>
<verify>

1. Component renders without errors
2. Shows grid of themes (excluding custom)
3. Theme selection updates immediately (visual feedback)
4. Continue and Skip buttons work
   </verify>
   <done>ThemePickerStep component created for onboarding flow</done>
   </task>

<task type="auto">
  <name>Task 2: Integrate into ProfileSetupScreen</name>
  <files>src/screens/ProfileSetupScreen.js</files>
  <action>
**Add theme picker as a new step in profile setup.**

**Current flow understanding:**
First, examine ProfileSetupScreen.js to understand:

- How steps are managed (useState? step counter?)
- How navigation between steps works
- Where the step indicator is rendered

**Integration approach:**

**If using step counter pattern:**

```javascript
// Current steps might be:
// 1 = Profile Info
// 2 = Selects
// 3 = Profile Song

// New steps:
// 1 = Profile Info
// 2 = Theme Picker (NEW)
// 3 = Selects
// 4 = Profile Song

const TOTAL_STEPS = 4; // Was 3
```

**If using page/screen array pattern:**

```javascript
const steps = [
  { id: 'profile-info', component: ProfileInfoStep },
  { id: 'theme', component: ThemePickerStep }, // NEW
  { id: 'selects', component: SelectsStep },
  { id: 'song', component: ProfileSongStep },
];
```

**Step content rendering:**

```javascript
import ThemePickerStep from '../components/ThemePickerStep';

// In render switch/conditional:
{
  step === 2 && (
    <ThemePickerStep
      onComplete={themeId => {
        // Log selection for analytics if needed
        if (themeId) {
          logger.info('ProfileSetup: Theme selected', { themeId });
        } else {
          logger.info('ProfileSetup: Theme selection skipped');
        }
        setStep(3); // Move to selects
      }}
    />
  );
}
```

**Update step indicator:**
If there's a StepIndicator component, update total steps:

```javascript
<StepIndicator currentStep={step} totalSteps={4} />
```

**Learning hint - Understanding existing code:**
Before adding code, trace through the existing flow:

1. What happens when user completes profile info?
2. How does the step number increment?
3. Where is the step displayed to the user?

Match the existing pattern rather than introducing new patterns.
</action>
<verify>

1. Profile setup now has 4 steps total (or however many with theme added)
2. After profile info, theme picker appears
3. Selecting theme and Continue moves to selects
4. Skip moves to selects with default theme
5. Step indicator shows correct step count
   </verify>
   <done>ThemePickerStep integrated into ProfileSetupScreen flow</done>
   </task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Theme selection integrated into new user onboarding flow</what-built>
  <how-to-verify>
**Full onboarding test (requires fresh account or logout):**

1. Log out of the app (Settings → Sign Out) or use a new phone number
2. Go through phone verification
3. Start profile setup:
   - Step 1: Enter name, username, bio
   - Tap "Next"
4. **Step 2 should now be Theme Picker:**
   - "Choose your style" title visible
   - Grid of themes (Dark, Light, Ocean, Forest, Sunset)
   - Continue and Skip buttons
5. Tap "Light" theme
   - Selection moves to Light
   - App background changes immediately (preview)
6. Tap "Continue"
   - Moves to Selects step (photo selection)
7. Complete onboarding normally
8. Verify Light theme is still active
9. Go to Settings → Appearance
   - Light should be selected

**Test skip functionality:**

1. Log out and restart onboarding
2. At theme step, tap "Skip for now"
3. Should move to next step with Dark theme active
4. Complete onboarding - Dark theme should be applied

**Test step indicator:**

- Verify step dots/numbers show correct position
- "Step 2 of 4" (or appropriate count) displayed
  </how-to-verify>
  <resume-signal>Type "onboarding approved" if working correctly, or describe issues</resume-signal>
  </task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] ThemePickerStep component created
- [ ] Integrated into ProfileSetupScreen
- [ ] Appears after profile info, before selects
- [ ] Theme preview works during selection
- [ ] Continue saves selection and proceeds
- [ ] Skip uses default theme and proceeds
- [ ] Step indicator accurate
</verification>

<success_criteria>

- New users see theme picker during onboarding
- Theme selection is optional (Skip available)
- Selected theme persists after completing onboarding
- Step indicator reflects new step count
- Full onboarding flow works end-to-end
  </success_criteria>

<output>
After completion, create `.planning/phases/25-color-palette/25-05-SUMMARY.md`:

# Phase 25 Plan 05: Onboarding Integration Summary

**[One-liner describing what was accomplished]**

## Files Created/Modified

- `src/components/ThemePickerStep.js` - Onboarding theme picker (NEW)
- `src/screens/ProfileSetupScreen.js` - Integrated theme step

## Key Patterns Learned

- Multi-step form integration
- Optional step handling (skip vs complete)
- Preview during selection (immediate feedback)

## Phase 25 Complete!

### Full Feature Summary

This phase added user-customizable color themes to the Rewind app:

1. **Plan 01:** Environment setup and ThemeCard component
2. **Plan 02:** Theme system core with 5 presets
3. **Plan 03:** Appearance settings UI with preview/apply
4. **Plan 04:** Custom palette editor with color pickers
5. **Plan 05:** Onboarding integration

### Features Delivered

- 5 preset themes (Dark, Light, Ocean, Forest, Sunset)
- Custom theme editor with 5 customizable colors
- Theme persistence across app restarts
- Settings → Appearance for theme selection
- New user onboarding includes theme picker
- Preview → Apply flow prevents accidental changes

### Files Created

- `src/constants/themes.js` - Theme definitions
- `src/components/ThemeCard.js` - Theme preview card
- `src/components/ColorPickerRow.js` - Color picker with modal
- `src/components/ThemePickerStep.js` - Onboarding theme picker
- `src/screens/AppearanceSettingsScreen.js` - Settings UI
- `src/screens/CustomThemeEditorScreen.js` - Custom editor

### Files Modified

- `src/context/ThemeContext.js` - Full theme support
- `src/screens/SettingsScreen.js` - Appearance navigation
- `src/screens/ProfileSetupScreen.js` - Theme onboarding step
- `src/navigation/AppNavigator.js` - New screen registration

### Learning Outcomes for Junior Developer

- React Native development environment
- Component architecture patterns
- Context API for global state
- AsyncStorage for persistence
- Third-party library integration
- Multi-step form patterns
- Preview/apply UX patterns

---

Ready for next phase in roadmap!
</output>
