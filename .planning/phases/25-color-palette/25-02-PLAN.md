---
phase: 25-color-palette
plan: 02
type: execute
domain: react-native
teaching: true
---

<objective>
Expand ThemeContext to support full theming with 5 customizable colors and add preset theme definitions.

Purpose: Build the core theme system that all UI will consume.
Output: Enhanced ThemeContext with full theme support, preset definitions for Dark, Light, and 3 custom palettes.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/25-color-palette/25-CONTEXT.md
@src/context/ThemeContext.js
@src/constants/colors.js
@.planning/phases/25-color-palette/25-01-SUMMARY.md (if exists)

**Current ThemeContext State:**

- Has 4 accent-only palettes (purple, blue, green, orange)
- Only changes accent and accentSecondary colors
- Background/text colors are static from colors.js

**This Plan Adds:**

- Full theme support (5 colors: background, card, text, accent, accentSecondary)
- Dark theme (current app appearance)
- Light theme (new)
- 3 additional presets (placeholder colors until user provides reference images)
- Theme preview data structure for ThemeCard consumption
  </context>

<learning_objectives>
By the end of this plan, you will:

1. Understand React Context pattern for global state
2. Know how to structure theme data for UI consumption
3. Learn AsyncStorage patterns for persistence
4. Practice updating existing code while maintaining backwards compatibility
   </learning_objectives>

<tasks>

<task type="auto">
  <name>Task 1: Define theme data structure and presets</name>
  <files>src/constants/themes.js</files>
  <action>
**Create a new file for theme definitions.**

This separates theme data from the context logic, making it easier to add new themes later.

**File structure:**

```javascript
/**
 * Theme Definitions
 * =================
 * Each theme defines 5 key colors that can be customized:
 * - background: Main screen background
 * - card: Cards, modals, elevated surfaces
 * - text: Primary text color
 * - accent: Primary interactive color (buttons, toggles, selected states)
 * - accentSecondary: Secondary accent (gradients, highlights)
 */

export const THEMES = {
  dark: {
    id: 'dark',
    name: 'Dark',
    description: 'Default dark theme',
    isDefault: true,
    colors: {
      background: '#000000',
      card: '#111111',
      text: '#FFFFFF',
      accent: '#8B5CF6', // Purple
      accentSecondary: '#EC4899', // Pink
    },
  },
  light: {
    id: 'light',
    name: 'Light',
    description: 'Clean light theme',
    colors: {
      background: '#FFFFFF',
      card: '#F5F5F5',
      text: '#000000',
      accent: '#8B5CF6',
      accentSecondary: '#EC4899',
    },
  },
  // TODO: Replace these with colors from user's reference images
  ocean: {
    id: 'ocean',
    name: 'Ocean',
    description: 'Deep blue tones',
    colors: {
      background: '#0A1628',
      card: '#1A2940',
      text: '#E0F2FE',
      accent: '#38BDF8', // Sky blue
      accentSecondary: '#22D3EE', // Cyan
    },
  },
  forest: {
    id: 'forest',
    name: 'Forest',
    description: 'Natural green palette',
    colors: {
      background: '#0A1F0A',
      card: '#1A3A1A',
      text: '#E8F5E9',
      accent: '#4ADE80', // Green
      accentSecondary: '#A3E635', // Lime
    },
  },
  sunset: {
    id: 'sunset',
    name: 'Sunset',
    description: 'Warm orange tones',
    colors: {
      background: '#1A0A0A',
      card: '#2D1515',
      text: '#FFF5F5',
      accent: '#F97316', // Orange
      accentSecondary: '#FBBF24', // Amber
    },
  },
};

// Default theme ID
export const DEFAULT_THEME_ID = 'dark';

// Get array of theme objects for UI rendering
export const getThemeList = () => Object.values(THEMES);

// Get theme by ID with fallback to default
export const getTheme = themeId => THEMES[themeId] || THEMES[DEFAULT_THEME_ID];
```

**Learning point - Why a separate file?**
Separating data (themes.js) from logic (ThemeContext.js) follows the "separation of concerns" principle. It makes it easy to:

- Add new themes without touching context code
- Test theme data independently
- Import themes in components that just need the data
  </action>
  <verify>

1. File exists at src/constants/themes.js
2. exports THEMES object with 5 themes
3. exports getThemeList() function
4. exports getTheme() function
5. No syntax errors (app still runs)
   </verify>
   <done>themes.js created with 5 preset themes and helper functions</done>
   </task>

<task type="auto">
  <name>Task 2: Update ThemeContext for full theme support</name>
  <files>src/context/ThemeContext.js</files>
  <action>
**Refactor ThemeContext to use the new theme structure.**

The current implementation only swaps accent colors. We need to:

1. Import themes from the new file
2. Store full theme ID (not just palette name)
3. Provide complete theme colors to consumers
4. Maintain backwards compatibility where possible

**Key changes needed:**

1. **Import themes:**

```javascript
import { THEMES, DEFAULT_THEME_ID, getTheme } from '../constants/themes';
```

2. **Update state:**

```javascript
const [currentThemeId, setCurrentThemeId] = useState(DEFAULT_THEME_ID);
```

3. **Update persistence key:**

```javascript
const THEME_STORAGE_KEY = '@rewind_theme_id';
```

4. **Update setTheme function:**

```javascript
const setTheme = async themeId => {
  if (!THEMES[themeId]) {
    logger.warn('ThemeContext: Invalid theme ID', { themeId });
    return;
  }
  setCurrentThemeId(themeId);
  try {
    await AsyncStorage.setItem(THEME_STORAGE_KEY, themeId);
  } catch (error) {
    logger.warn('ThemeContext: Failed to persist theme', { error: error.message });
  }
};
```

5. **Build theme object for consumers:**

```javascript
const currentTheme = getTheme(currentThemeId);
const theme = {
  // Theme metadata
  id: currentTheme.id,
  name: currentTheme.name,

  // The 5 customizable colors
  colors: currentTheme.colors,

  // Backwards compatibility - spread full color system
  ...colors,

  // Override specific color categories with theme values
  background: {
    ...colors.background,
    primary: currentTheme.colors.background,
    secondary: currentTheme.colors.card,
    card: currentTheme.colors.card,
  },
  text: {
    ...colors.text,
    primary: currentTheme.colors.text,
  },
  brand: {
    ...colors.brand,
    purple: currentTheme.colors.accent,
    pink: currentTheme.colors.accentSecondary,
  },
  interactive: {
    ...colors.interactive,
    primary: currentTheme.colors.accent,
  },
};
```

6. **Update context value:**

```javascript
const value = {
  theme,
  currentThemeId,
  setTheme,
  themes: getThemeList(), // For UI to render theme options
  initializing,
};
```

**Learning hint - Backwards compatibility:**
Notice how we spread `colors` and then override specific values. This means:

- Components using `theme.background.primary` get the themed background
- Components using `theme.status.danger` still work (unchanged)
- We don't break existing code while adding new features

**Also update the exports:**

- Keep `useTheme` hook as-is
- Remove old `PALETTES` export (deprecated)
- Add: `export { THEMES } from '../constants/themes';`
  </action>
  <verify>

1. App still runs without errors
2. useTheme() returns theme object with colors property
3. theme.colors has: background, card, text, accent, accentSecondary
4. theme.background.primary equals theme.colors.background
5. Existing components still work (test by navigating through app)
   </verify>
   <done>ThemeContext updated with full theme support, backwards compatible</done>
   </task>

<task type="auto">
  <name>Task 3: Update ThemeCard to use real theme data</name>
  <files>src/components/ThemeCard.js</files>
  <action>
**Update ThemeCard to work with the actual theme data structure.**

Now that we have a proper theme structure, update ThemeCard to:

1. Accept a theme object from THEMES
2. Display the 5 colors from theme.colors
3. Show proper selection state

**Updated props:**

```javascript
// Before: theme was a custom object
// After: theme comes from THEMES constant

const ThemeCard = ({ theme, isSelected, onPress }) => {
  // theme.id - unique identifier
  // theme.name - display name
  // theme.colors - { background, card, text, accent, accentSecondary }
```

**Color preview layout suggestion:**

```
┌─────────────────────┐
│ ┌───┐ ┌───┐ ┌───┐ │  <- accent, accentSecondary, text
│ └───┘ └───┘ └───┘ │
│ ┌───────────────┐ │  <- card color
│ └───────────────┘ │
│     background     │  <- background color
│                     │
│      "Dark"         │  <- theme.name
└─────────────────────┘
```

**Remove test code from ProfileScreen:**
After updating ThemeCard, remove the temporary test code we added in Plan 01.
</action>
<verify>

1. ThemeCard accepts theme object matching THEMES structure
2. All 5 colors displayed in preview
3. Test import removed from ProfileScreen
4. No console errors
   </verify>
   <done>ThemeCard updated to use real theme data structure</done>
   </task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Enhanced theme system with 5 presets and full color support</what-built>
  <how-to-verify>
1. Run the app: `npx expo start`
2. Open React Native Debugger or add console.log in a component:
   ```javascript
   import { useTheme } from '../context/ThemeContext';
   const { theme, themes } = useTheme();
   console.log('Current theme:', theme.id, theme.name);
   console.log('Theme colors:', theme.colors);
   console.log('Available themes:', themes.map(t => t.name));
   ```
3. Verify console shows:
   - Current theme: "dark" "Dark"
   - Theme colors with all 5 properties
   - Available themes: ["Dark", "Light", "Ocean", "Forest", "Sunset"]
4. Navigate through the app - everything should still work
5. Check no visual changes (we're still on dark theme)

**Code review:**

- Does themes.js export THEMES correctly?
- Does ThemeContext provide backwards-compatible theme object?
- Is ThemeCard ready to display any theme from the list?
  </how-to-verify>
  <resume-signal>Type "theme system approved" if working correctly, or describe issues</resume-signal>
  </task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] themes.js created with 5 preset themes
- [ ] ThemeContext updated for full theme support
- [ ] Backwards compatibility maintained (app works normally)
- [ ] ThemeCard updated for real theme data
- [ ] Test code removed from ProfileScreen
</verification>

<success_criteria>

- 5 preset themes defined (Dark, Light, Ocean, Forest, Sunset)
- ThemeContext provides full theme colors
- Existing app functionality unchanged
- ThemeCard component ready for theme selection UI
  </success_criteria>

<output>
After completion, create `.planning/phases/25-color-palette/25-02-SUMMARY.md`:

# Phase 25 Plan 02: Theme System Core Summary

**[One-liner describing what was accomplished]**

## Files Created/Modified

- `src/constants/themes.js` - Theme definitions (NEW)
- `src/context/ThemeContext.js` - Updated for full theming
- `src/components/ThemeCard.js` - Updated for real theme data

## Key Patterns Learned

- Separation of data (themes.js) from logic (ThemeContext.js)
- Backwards compatibility when refactoring
- Context state structure for complex data

## Next Step

Ready for 25-03-PLAN.md (Settings UI)
</output>
