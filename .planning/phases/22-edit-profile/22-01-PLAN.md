---
phase: 22-edit-profile
plan: 01
type: execute
---

<objective>
Create data layer for profile updates with username change tracking and add Edit Profile entry point in Settings.

Purpose: Establish the foundation for profile editing with 14-day username restriction enforcement.
Output: Updated userService.js with profile update function, Edit Profile menu item in Settings, EditProfileScreen registered in navigation.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/22-edit-profile/22-CONTEXT.md

@src/services/firebase/userService.js
@src/screens/SettingsScreen.js
@src/screens/ProfileSetupScreen.js
@src/navigation/ProfileStack.js

**Established patterns:**

- Service functions return { success, data/error } objects
- SettingsScreen uses menuItems array with icon, label, onPress
- ProfileStack handles profile-related screens

**Key requirements from CONTEXT.md:**

- 14-day username change restriction
- Access from Settings â†’ Edit Profile
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Add profile update service function with username tracking</name>
  <files>src/services/firebase/userService.js</files>
  <action>
Add a new function `updateUserProfile` to userService.js:

```javascript
/**
 * Update user profile with optional username change tracking
 * If username is changed, updates lastUsernameChange timestamp
 *
 * @param {string} userId - User ID
 * @param {object} updates - Profile fields to update
 * @param {string} currentUsername - Current username for comparison
 * @returns {Promise<{success: boolean, error?: string}>}
 */
export const updateUserProfile = async (userId, updates, currentUsername) => {
  // Check if username changed, if so add lastUsernameChange timestamp
  // Validate username availability if changed
  // Use Timestamp.now() for lastUsernameChange
  // Update user document
};
```

Also add helper function:

```javascript
/**
 * Check if user can change username (14-day restriction)
 * @param {Date|Timestamp} lastUsernameChange - Last change timestamp
 * @returns {{canChange: boolean, daysRemaining: number}}
 */
export const canChangeUsername = lastUsernameChange => {
  // Returns { canChange: true } if no lastUsernameChange or 14+ days ago
  // Returns { canChange: false, daysRemaining: X } otherwise
};
```

Update `getUserProfile` to include `lastUsernameChange` in the returned profile object.

Use Firestore Timestamp for date comparisons. Import `Timestamp` from '@react-native-firebase/firestore'.
</action>
<verify>Read userService.js and confirm updateUserProfile and canChangeUsername functions exist with correct signatures</verify>
<done>userService.js has updateUserProfile (handles username change tracking) and canChangeUsername (14-day check) functions</done>
</task>

<task type="auto">
  <name>Task 2: Add Edit Profile menu item and register screen</name>
  <files>src/screens/SettingsScreen.js, src/navigation/ProfileStack.js</files>
  <action>
1. In SettingsScreen.js, add Edit Profile as the FIRST menu item (before Privacy Policy):
```javascript
{
  id: 'editProfile',
  label: 'Edit Profile',
  icon: 'person-outline',
  onPress: () => handleNavigate('EditProfile'),
},
```

2. In ProfileStack.js, add the EditProfileScreen to the stack navigator:

```javascript
import EditProfileScreen from '../screens/EditProfileScreen';
// In Stack.Navigator:
<Stack.Screen name="EditProfile" component={EditProfileScreen} options={{ headerShown: false }} />;
```

Create a placeholder EditProfileScreen.js in src/screens/ with minimal structure so navigation doesn't crash:

```javascript
import { View, Text, StyleSheet } from 'react-native';
import { SafeAreaView } from 'react-native-safe-area-context';
import { colors } from '../constants/colors';

const EditProfileScreen = () => {
  return (
    <SafeAreaView style={styles.container}>
      <Text style={styles.text}>Edit Profile - Coming in Plan 02</Text>
    </SafeAreaView>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: colors.background.primary,
    justifyContent: 'center',
    alignItems: 'center',
  },
  text: {
    color: colors.text.primary,
    fontSize: 16,
  },
});

export default EditProfileScreen;
```

  </action>
  <verify>Run the app, navigate to Settings, and verify "Edit Profile" appears at the top. Tap it and confirm navigation works (shows placeholder).</verify>
  <done>Settings shows Edit Profile as first menu item, tapping it navigates to EditProfileScreen placeholder</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] userService.js has updateUserProfile function with username change tracking
- [ ] userService.js has canChangeUsername helper function (14-day check)
- [ ] getUserProfile includes lastUsernameChange in returned profile
- [ ] SettingsScreen has Edit Profile as first menu item
- [ ] ProfileStack includes EditProfileScreen
- [ ] Navigating to Edit Profile works (shows placeholder)
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No errors in Metro bundler
- Edit Profile accessible from Settings
  </success_criteria>

<output>
After completion, create `.planning/phases/22-edit-profile/22-01-SUMMARY.md`
</output>
