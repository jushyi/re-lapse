---
phase: 3.1-auth-input-fixes
plan: 01
type: execute
---

<objective>
Fix two auth-related input field bugs that impact user experience during signup.

Purpose: Remove friction from the signup flow by fixing the phone backspace issue and cleaning up profile input initialization.
Output: PhoneInputScreen with smooth backspace behavior, ProfileSetupScreen with clean empty inputs for new users.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/3.1-auth-input-fixes/3.1-CONTEXT.md

# Relevant source files:

@src/screens/PhoneInputScreen.js
@src/screens/ProfileSetupScreen.js
@src/utils/phoneUtils.js
@src/context/AuthContext.js

**Prior decisions:**

- Phase 1: Use colors.js constants throughout components
- Phase 3: Conditional nav rendering over manual replace

**Bug analysis:**

1. Phone backspace: `formatAsUserTypes` returns "(555) " for 3 digits. When user backspaces, `handlePhoneChange` strips non-digits and re-formats → parenthesis reappears. User gets stuck.
2. Profile inputs: AuthContext line 148-149 sets `username: user_${Date.now()}` and `displayName: 'New User'` for new users. ProfileSetupScreen initializes from these, showing default values instead of empty fields with placeholders.
   </context>

<tasks>

<task type="auto">
  <name>Task 1: Fix phone number backspace behavior</name>
  <files>src/screens/PhoneInputScreen.js</files>
  <action>
Fix `handlePhoneChange` to detect deletion and handle it properly:

1. Track the previous digit count using a ref (`prevDigitCount`)
2. In `handlePhoneChange`:
   - Extract digits from the new text
   - Compare new digit count to previous digit count
   - If new count < previous (user is deleting), use the raw digits directly
   - If new count >= previous (user is typing), use formatted output
   - Always update `prevDigitCount` ref

The key insight: when deleting, we want to track the RAW digit count, not fight the formatter. Let the formatter do its job on the way "in" (typing), but on the way "out" (deleting), just remove digits.

Implementation approach:

```javascript
const prevDigitCountRef = useRef(0);

const handlePhoneChange = text => {
  const digits = text.replace(/[^0-9]/g, '');
  const newDigitCount = digits.length;
  const isDeleting = newDigitCount < prevDigitCountRef.current;

  setPhoneNumber(digits);

  // When deleting, don't re-format (avoids parenthesis trap)
  // When typing, format normally
  const formatted = formatAsUserTypes(digits, selectedCountry.country);
  setFormattedPhone(isDeleting && digits.length <= 3 ? digits : formatted);

  prevDigitCountRef.current = newDigitCount;
  if (error) setError('');
};
```

Also update the Input value prop to ensure consistent display:

- Change `value={formattedPhone || phoneNumber}` to just use the properly managed `formattedPhone` state
  </action>
  <verify>
  Manual test in simulator:

1. Enter phone: 555-123-4567
2. Press backspace multiple times
3. Should smoothly delete digits without getting stuck on parenthesis
4. Should be able to delete all the way back to empty
   </verify>
   <done>Phone number backspace works smoothly - no getting stuck on formatting characters when deleting</done>
   </task>

<task type="auto">
  <name>Task 2: Fix profile input initialization for new users</name>
  <files>src/screens/ProfileSetupScreen.js</files>
  <action>
Fix the useState initialization to detect and ignore default placeholder values:

1. For `displayName`: Check if value is 'New User' or empty → use ''
2. For `username`: Check if value matches `user_\d+` pattern → use ''
3. For `bio`: Already correct (uses '' default)

Update the useState initializations:

```javascript
// Detect default placeholder values and use empty string instead
const isDefaultDisplayName = !userProfile?.displayName || userProfile.displayName === 'New User';
const isDefaultUsername = !userProfile?.username || /^user_\d+$/.test(userProfile.username);

const [displayName, setDisplayName] = useState(isDefaultDisplayName ? '' : userProfile.displayName);
const [username, setUsername] = useState(isDefaultUsername ? '' : userProfile.username);
const [bio, setBio] = useState(userProfile?.bio || '');
```

This keeps the initialization logic contained to ProfileSetupScreen without modifying AuthContext's user creation defaults (which may serve purposes elsewhere like ensuring unique usernames in the database).
</action>
<verify>
Check that new users see empty inputs with placeholders:

- "How should friends see you?" in display name field
- "Choose a unique username" in username field
- "Tell us about yourself..." in bio field
  </verify>
  <done>Profile setup inputs start empty with placeholder hints visible for new users</done>
  </task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Fixed phone backspace behavior and profile input initialization</what-built>
  <how-to-verify>
    1. Run: `npx expo start` and open on device/simulator
    2. Test phone input:
       - Navigate to phone entry screen
       - Enter a phone number (e.g., 555-123-4567)
       - Press backspace repeatedly
       - Verify: Can delete smoothly without getting stuck on parenthesis
       - Verify: Can delete all the way back to empty
    3. Test profile setup (need a fresh user or clear auth state):
       - Reach the profile setup screen
       - Verify: Display name field shows placeholder "How should friends see you?" (not "New User")
       - Verify: Username field shows placeholder "Choose a unique username" (not "user_123...")
       - Verify: Bio field shows placeholder "Tell us about yourself..."
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] Phone number backspace works smoothly from any digit count
- [ ] Profile setup inputs show placeholders, not default values
- [ ] No TypeScript/ESLint errors introduced
- [ ] Existing functionality (phone validation, profile submission) still works
</verification>

<success_criteria>

- Both input field bugs fixed
- User can smoothly correct phone number mistakes
- New users see clean profile setup form with only placeholders
- No regressions in auth flow
  </success_criteria>

<output>
After completion, create `.planning/phases/3.1-auth-input-fixes/03.1-01-SUMMARY.md`:

# Phase 3.1 Plan 1: Auth Input Fixes Summary

**[Substantive one-liner about what shipped]**

## Performance

- Duration: X min
- Tasks: 2 (+ 1 checkpoint)

## Accomplishments

- Fixed phone number backspace getting stuck on parenthesis
- Fixed profile inputs showing default values instead of placeholders

## Files Modified

- `src/screens/PhoneInputScreen.js` - Backspace deletion handling
- `src/screens/ProfileSetupScreen.js` - Input initialization logic

## Decisions Made

[Any decisions during implementation]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

Phase 3.1 complete. Ready for Phase 4 (Profile Creation Onboarding).
</output>
