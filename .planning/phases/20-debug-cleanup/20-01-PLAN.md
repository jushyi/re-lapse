---
phase: 20-debug-cleanup
plan: 01
type: execute
---

<objective>
Replace all console.* statements in Cloud Functions with structured logger utility.

Purpose: Production-silent logging - zero console noise in production, structured logs in development/emulator.
Output: Clean Cloud Functions with environment-aware logging, consistent with React Native app patterns.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/20-debug-cleanup/20-CONTEXT.md

# Prior phase summary (establishes logging patterns)

@.planning/phases/19-linting-prettier/19-02-SUMMARY.md

# Existing React Native logger (reference for patterns)

@src/utils/logger.js

# Target file for cleanup

@functions/index.js

**From 20-CONTEXT.md:**

- Zero console noise in production
- Simple API: logger.log(), logger.warn(), logger.error()
- Prefix logs with function name context
- Use environment detection for log filtering

**Current State:**

- React Native app (src/) is already clean - no console.\* statements
- Cloud Functions (functions/index.js) has 37 console statements
- Build scripts (scripts/) have 12 statements - acceptable for build-time tooling

**Scope:**

- Only functions/index.js needs cleanup
- Build scripts are out of scope (development tooling is fine to log)
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Create Cloud Functions logger utility</name>
  <files>functions/logger.js</files>
  <action>
Create a simple logger utility for Cloud Functions that:
1. Detects environment via `process.env.FUNCTIONS_EMULATOR` (true when running locally)
2. In emulator/local: logs everything with [DEBUG], [INFO], [WARN], [ERROR] prefixes
3. In production: only logs WARN and ERROR (skip DEBUG and INFO)
4. API: logger.debug(msg), logger.info(msg), logger.warn(msg), logger.error(msg)
5. Include function context in log prefix: `[FunctionName] message`

Keep it simple - no sanitization needed (Cloud Functions logs are internal).
Pattern should mirror the React Native logger but without React Native dependencies.

Use Firebase's recommended logging approach: functions.logger from firebase-functions for structured logging, with fallback to console for compatibility.
</action>
<verify>File exists at functions/logger.js with debug, info, warn, error exports</verify>
<done>Logger module created with environment-aware log filtering</done>
</task>

<task type="auto">
  <name>Task 2: Replace console statements in Cloud Functions</name>
  <files>functions/index.js</files>
  <action>
Replace all 37 console.log/console.error statements with logger calls:

1. Import logger: `const logger = require('./logger');`
2. Replace statements by severity:
   - console.log for info/progress: logger.info()
   - console.log for debug/verbose: logger.debug()
   - console.error: logger.error()
3. Keep the existing message content and context
4. Add function name prefix to messages where not already present

Mapping:

- "revealUserPhotos:" messages → logger.info() (user-visible progress)
- "processDarkroomReveals:" messages → logger.info() (scheduled job progress)
- "sendPhotoRevealNotification:" messages → logger.debug() (internal flow)
- "sendFriendRequestNotification:" messages → logger.debug() (internal flow)
- "sendReactionNotification:" messages → logger.debug() (internal flow)
- All console.error → logger.error() (keep as errors)

DO NOT change the message content or logic - only the logging function.
</action>
<verify>grep -c "console\." functions/index.js returns 0</verify>
<done>All console statements replaced with logger calls, no raw console.\* remaining</done>
</task>

<task type="auto">
  <name>Task 3: Verify Cloud Functions build</name>
  <files>functions/</files>
  <action>
Verify the Cloud Functions still build and lint correctly:
1. cd functions && npm run lint (if lint script exists)
2. cd functions && npm run build (if build script exists, for TypeScript projects)
3. If no lint/build scripts, verify syntax by running: node -c functions/index.js

This ensures the logger integration doesn't break the Cloud Functions deployment.
</action>
<verify>No syntax errors, lint passes (if configured), functions can be parsed by Node</verify>
<done>Cloud Functions build successfully with new logger integration</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `grep -c "console\." functions/index.js` returns 0 (no console statements)
- [ ] `grep -c "logger\." functions/index.js` shows logger usage (37+ occurrences)
- [ ] functions/logger.js exists with debug, info, warn, error exports
- [ ] No syntax errors in functions code
- [ ] ESLint passes on functions/ (if configured)
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No console.\* statements in functions/index.js
- Logger utility provides environment-aware filtering
- Cloud Functions can be deployed without errors
  </success_criteria>

<output>
After completion, create `.planning/phases/20-debug-cleanup/20-01-SUMMARY.md`:

# Phase 20-01: Debug Cleanup Summary

**[One-liner summary of what was accomplished]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `functions/logger.js` - Description
- `functions/index.js` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

Phase 20 complete, ready for Phase 21 (Global Constants and Design System)
</output>
