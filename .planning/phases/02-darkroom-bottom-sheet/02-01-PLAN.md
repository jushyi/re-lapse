---
phase: 02-darkroom-bottom-sheet
plan: 01
type: execute
---

<objective>
Create bottom sheet modal component with animated progress bar for press-and-hold reveal interaction.

Purpose: Replace simple tap-to-navigate with engaging press-and-hold UI that adds ceremony to the photo reveal moment.
Output: DarkroomBottomSheet component integrated into CameraScreen, replacing direct navigation with modal overlay and progress animation.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/STACK.md
@.planning/codebase/CONVENTIONS.md
@.planning/phases/01-navigation-restructure/01-01-SUMMARY.md
@src/screens/CameraScreen.js

**Tech stack available:**
- React Native Animated API for progress bar animation
- React Native Modal for overlay
- React Native PanResponder for gesture detection
- expo-haptics (for next plan)

**Established patterns:**
- DarkroomButton component with badge count (Phase 1)
- 30s polling interval for badge updates (Phase 1)
- Service layer returns { success, data, error } objects
- Logger utility for structured logging (DEBUG/INFO/ERROR)

**Constraining decisions:**
- Keep existing photoService/darkroomService logic unchanged (backend logic preserved)
- Maintain disabled state when darkroomCount is 0 (visual affordance)
- Use Modal-based approach (no external bottom sheet library needed)

</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DarkroomBottomSheet component with press-and-hold progress bar</name>
  <files>src/components/DarkroomBottomSheet.js, src/components/index.js</files>
  <action>
Create DarkroomBottomSheet component with the following specs:

**Component Structure:**
- Use Modal from react-native with transparent background and slide animation
- Dark semi-transparent backdrop (rgba(0,0,0,0.7))
- Bottom sheet container: white background, rounded top corners (24px), positioned at bottom with safe area padding
- Header: "Press and hold to reveal" text (18px, bold, center aligned)
- Badge count display: Show count in large text (48px, bold) with "photos ready" subtitle
- Progress bar container: Horizontal bar, full width minus padding (24px), height 12px, rounded (6px), grey background
- Progress bar fill: Animated width from 0% to 100%, blue/brand color (#007AFF), rounded, smooth animation

**Press-and-Hold Interaction:**
- Use PanResponder to detect press (onPressIn) and release (onPressOut)
- On press: Start Animated.timing from 0 to 1 over 2000ms (2 seconds)
- On release before completion: Reset to 0 with spring animation
- Progress interpolates animated value: 0 → 0%, 1 → 100% width
- Visual feedback: Progress bar fills left-to-right during press

**Props:**
- visible (boolean): Controls modal visibility
- count (number): Badge count to display
- onClose (function): Called when backdrop pressed or sheet dismissed
- onComplete (function): Called when progress reaches 100% (for next plan, can be no-op for now)

**State Management:**
- Track press state (isPressing)
- Animated.Value for progress (0 to 1)
- Reset progress on mount/unmount

**Edge Cases:**
- If user releases before 100%, reset progress smoothly
- Backdrop press closes sheet (calls onClose)
- Component unmounts cleanly (stop animations)

**Styling:**
- Match CameraScreen aesthetic (dark theme, white text on dark, brand colors)
- Use StyleSheet.create at bottom
- Ensure safe area handling (paddingBottom for iPhone notch)

**Logging:**
- logger.debug on component mount/unmount
- logger.info when press starts/completes
- logger.debug on progress milestones (25%, 50%, 75%, 100%)

**Export:**
- Add to src/components/index.js barrel export
  </action>
  <verify>
1. Import and render DarkroomBottomSheet in a test screen
2. Pass visible=true, count=3
3. Verify modal appears with backdrop, sheet at bottom, rounded corners
4. Press and hold progress bar area - bar should fill left-to-right over 2 seconds
5. Release before completion - bar should spring back to 0%
6. Hold until 100% - onComplete callback fires (verify with logger)
7. Press backdrop - modal closes (onClose fires)
  </verify>
  <done>
- DarkroomBottomSheet.js created and exported
- Component accepts visible, count, onClose, onComplete props
- Press-and-hold fills progress bar 0% to 100% in 2 seconds
- Release before 100% resets progress with spring animation
- Backdrop press closes modal
- Visual styling matches CameraScreen theme
- Logging at key interaction points
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate DarkroomBottomSheet into CameraScreen</name>
  <files>src/screens/CameraScreen.js</files>
  <action>
Replace DarkroomButton's direct navigation with bottom sheet trigger:

**State Management:**
- Add state: const [isBottomSheetVisible, setIsBottomSheetVisible] = useState(false)
- Keep existing darkroomCount state (already polling)

**DarkroomButton Changes:**
- Change onPress from `navigation.navigate('Darkroom')` to `setIsBottomSheetVisible(true)`
- Keep disabled state when count === 0 (opacity: 0.4, disabled: true)
- No other changes to DarkroomButton component styling

**Bottom Sheet Integration:**
- Import DarkroomBottomSheet from '../components'
- Render DarkroomBottomSheet below Animated.View (after capturedPhoto animation)
- Pass props:
  - visible={isBottomSheetVisible}
  - count={darkroomCount}
  - onClose={() => setIsBottomSheetVisible(false)}
  - onComplete={() => { /* TODO: Will add navigation in next plan */ setIsBottomSheetVisible(false); }}

**Behavior:**
- Tapping darkroom button opens bottom sheet (when count > 0)
- Button remains disabled when count === 0 (no bottom sheet trigger)
- Closing bottom sheet (backdrop press) returns to camera view
- Badge count remains visible in button while sheet is open

**Logging:**
- logger.info when bottom sheet opens ("DarkroomButton: Opening bottom sheet", { count })
- logger.debug when bottom sheet closes ("DarkroomButton: Bottom sheet closed")

**What NOT to change:**
- Keep badge count polling logic (30s interval)
- Keep existing photo capture animation
- Keep flash/camera toggle controls unchanged
- Keep existing imports and styles (add bottom sheet only)
  </action>
  <verify>
1. npm start and open app in Expo Go
2. Navigate to Camera tab
3. Take a photo to trigger developing count > 0
4. Wait for badge to update (or manually trigger poll)
5. Tap darkroom button - bottom sheet should appear
6. Verify badge count shown in sheet matches button badge
7. Press backdrop - sheet closes, returns to camera view
8. Test with count = 0 - button should be disabled (semi-transparent, no tap response)
9. Check logs for open/close events
  </verify>
  <done>
- DarkroomButton onPress triggers setIsBottomSheetVisible(true) instead of navigation
- DarkroomBottomSheet rendered in CameraScreen with correct props
- Button disabled state preserved when count === 0
- Tapping button (count > 0) opens bottom sheet
- Pressing backdrop closes bottom sheet
- Badge count displays in both button and sheet
- No errors in console, smooth interaction
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm start runs without errors
- [ ] DarkroomBottomSheet component renders correctly
- [ ] Press-and-hold fills progress bar smoothly (2 seconds)
- [ ] Releasing before 100% resets progress
- [ ] Darkroom button opens bottom sheet (when count > 0)
- [ ] Darkroom button disabled when count === 0
- [ ] Backdrop press closes bottom sheet
- [ ] No TypeScript/ESLint errors
- [ ] Logger output shows interaction events
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- DarkroomBottomSheet component created and integrated
- Press-and-hold interaction works smoothly
- Button behavior preserved (disabled state when count=0)
- No errors or warnings in console
- Ready for Plan 02-02 (reveal logic and haptics)
</success_criteria>

<output>
After completion, create `.planning/phases/02-darkroom-bottom-sheet/02-01-SUMMARY.md`:

# Phase 2 Plan 1: Bottom Sheet with Press-and-Hold UI Summary

**[One-line description of what shipped]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `src/components/DarkroomBottomSheet.js` - Description
- `src/screens/CameraScreen.js` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 02-02-PLAN.md (Connect reveal logic and haptic feedback)
</output>
