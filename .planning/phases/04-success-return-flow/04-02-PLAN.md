---
phase: 04-success-return-flow
plan: 02
type: execute
---

<objective>
Add "Return to Camera" button to SuccessScreen and implement smooth navigation flow back to CameraScreen.

Purpose: Provide clear exit path from success celebration, returning user to camera for next photo capture cycle.
Output: Complete success/return flow with button, navigation, and proper state cleanup.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan summary (Plan 04-01 must be complete)
@.planning/phases/04-success-return-flow/04-01-SUMMARY.md

# Key files from this phase
@src/screens/SuccessScreen.js
@src/screens/DarkroomScreen.js
@src/screens/CameraScreen.js
@src/navigation/AppNavigator.js

**Tech stack available:**
- React Navigation 7.x (Stack navigation)
- expo-haptics ~15.0.8 (haptic feedback)

**Established patterns:**
- navigation.navigate() for screen transitions (used throughout app)
- useFocusEffect for refreshing counts on screen focus (CameraScreen pattern from Phase 3)
- TouchableOpacity for button interactions with haptic feedback
- Logger utility for all user actions

**Constraining decisions:**
- Plan 04-01: SuccessScreen created with confetti animation and success haptic
- Phase 3: Badge/count refresh happens automatically on Camera screen focus (useFocusEffect)
- Phase 1: Main navigation uses bottom tabs (Camera tab is primary)

**Current behavior:**
- User reaches SuccessScreen after triaging all darkroom photos
- No way to exit SuccessScreen (stuck on page)
- Must force-quit app or restart to return to Camera

**Issues being addressed:**
None (no open issues, this is planned feature completion)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add "Return to Camera" button to SuccessScreen</name>
  <files>src/screens/SuccessScreen.js</files>
  <action>
In SuccessScreen component:
- Import useNavigation from @react-navigation/native
- Import successNotification from utils/haptics.js
- Add "Return to Camera" button below subtitle text:
  - Large rounded button (marginTop: 48px)
  - Background: #007AFF (iOS blue)
  - Padding: 16px vertical, 48px horizontal
  - Border radius: 24px
  - Text: "Return to Camera" (18px, bold, white)
  - Center aligned
- Add onPress handler:
  - Trigger medium impact haptic (await successNotification())
  - Log user action: logger.info('SuccessScreen: User tapped Return to Camera button')
  - Navigate back to Camera tab: navigation.navigate('MainTabs', { screen: 'Camera' })
  - Note: This navigates to MainTabs bottom tab navigator, then to Camera screen within it
- Add slight animation on button press (scale down to 0.98, spring back) using Animated API
- Position button in center of screen, below subtitle

Follow iOS button design patterns (large, rounded, prominent).
Ensure button is visible after confetti animation completes (no z-index issues).
</action>
  <verify>
- npm start runs without errors
- SuccessScreen now shows "Return to Camera" button below subtitle
- Button renders with correct styling (blue, rounded, centered)
- Button pressable with press animation (scale effect)
- Logger call present for button press
- No console warnings or errors
  </verify>
  <done>
- "Return to Camera" button added to SuccessScreen
- Button has proper styling matching iOS design patterns
- onPress handler implemented with haptic and logging
- Press animation implemented
  </done>
</task>

<task type="auto">
  <name>Task 2: Test and verify complete success/return navigation flow</name>
  <files>None (verification only)</files>
  <action>
Test end-to-end flow:
1. Start from CameraScreen
2. Capture 2 photos
3. Navigate to Darkroom (press darkroom button, hold progress bar)
4. Triage all photos (swipe left/right, or delete)
5. Verify automatic navigation to SuccessScreen
6. Verify confetti animation plays
7. Tap "Return to Camera" button
8. Verify navigation back to Camera tab (MainTabs → Camera screen)
9. Verify badge count is 0 (all photos triaged, count refreshed via useFocusEffect)
10. Verify darkroom button is greyed out/disabled (no photos ready)
11. Capture another photo and verify count updates to 1

Add logging for successful navigation in SuccessScreen:
- logger.info('SuccessScreen: Navigating back to Camera', { timestamp })

Ensure state cleanup:
- CameraScreen should refresh darkroom count on focus (already implemented in Phase 3)
- DarkroomScreen photo list should be empty (already handled by setPhotos([]))
- SuccessScreen should be removed from navigation stack (popToTop behavior)

No code changes needed if flow works correctly (verification only).
If issues found, fix them following auto-fix rules.
</action>
  <verify>
- Complete flow works: Camera → Darkroom → (triage all) → Success → Camera
- Badge count updates to 0 after returning to Camera
- Darkroom button disabled when no photos ready
- New photo capture updates badge to 1
- Logger shows navigation event from Success to Camera
- No navigation warnings or state inconsistencies
  </verify>
  <done>
- End-to-end flow tested and working
- Navigation state properly cleaned up
- Badge counts accurate after return to Camera
- Logger calls present for navigation events
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete success/return flow with "Return to Camera" button, enabling smooth round-trip from camera capture through triage to success celebration and back to camera</what-built>
  <how-to-verify>
1. Run: npm start (open Expo Go on physical iOS device)
2. From CameraScreen:
   - Capture 2-3 photos
   - Verify badge count increments on darkroom button
3. Navigate to Darkroom:
   - Press darkroom button on Camera
   - Hold progress bar until navigation occurs
4. Triage all photos:
   - Swipe left (Archive) or right (Journal) for each photo
   - Or use Delete button with confirmation
   - Verify each photo is removed from view after action
5. After last photo triaged:
   - Verify automatic navigation to SuccessScreen (300ms delay)
   - Verify confetti animation plays smoothly
   - Verify success haptic triggers (strong vibration)
6. On SuccessScreen:
   - Verify "Return to Camera" button visible and styled correctly (blue, rounded)
   - Tap button
   - Verify medium haptic triggers on tap
   - Verify navigation back to CameraScreen (Camera tab selected in bottom nav)
7. Back on CameraScreen:
   - Verify badge count is 0 (all photos triaged)
   - Verify darkroom button is greyed out/disabled
   - Capture 1 new photo
   - Verify badge updates to 1 (count polling or immediate update)
8. Repeat flow to verify consistency
  </how-to-verify>
  <resume-signal>Type "approved" if the complete flow works smoothly and all verifications pass, or describe any issues (navigation broken, badge count wrong, button not working, etc.)</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] npm start runs without errors
- [ ] "Return to Camera" button renders on SuccessScreen
- [ ] Button tap navigates back to Camera tab correctly
- [ ] Haptic feedback triggers on button press
- [ ] Badge count updates to 0 after returning to Camera
- [ ] Darkroom button disabled when no photos ready
- [ ] Complete round-trip flow works: Camera → Darkroom → Success → Camera
- [ ] Logger calls present for all navigation events
- [ ] No navigation warnings or state inconsistencies
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- "Return to Camera" button functional on SuccessScreen
- Navigation flow complete: SuccessScreen → CameraScreen
- Badge counts accurate after return to Camera
- User verification approved (checkpoint passed)
- No errors or warnings introduced
- **Phase 4 complete** - Success & Return Flow fully implemented
  </success_criteria>

<output>
After completion, create `.planning/phases/04-success-return-flow/04-02-SUMMARY.md`:

# Phase 4 Plan 2: Return to Camera Navigation Summary

**[One-liner describing what shipped - e.g., "Added 'Return to Camera' button with complete navigation flow from success page back to camera"]**

## Accomplishments

- [Key outcomes - e.g., "Return to Camera" button on SuccessScreen]
- [e.g., Navigation flow from Success → Camera implemented]
- [e.g., Badge count refresh verified after return]

## Files Created/Modified

- `src/screens/SuccessScreen.js` - Description
- [Any other files if fixes were needed]

## Decisions Made

[Key decisions and rationale, or "None"]
[e.g., Navigated to MainTabs → Camera instead of direct navigation (reason: ensures bottom tab state is correct)]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

Phase 4 complete. Phase 5 ready to begin: Update camera control icons (flash, camera toggle) to match bottom nav design system.

**Dependencies met:**
- Success/return flow complete (Camera → Darkroom → Success → Camera)
- Confetti animation working
- Haptic feedback at all key moments
- Badge count logic solid
- Navigation state properly managed
- Ready for final visual polish (icon redesign)

---
*Phase: 04-success-return-flow*
*Completed: [Date will be filled by execute-phase]*
</output>
