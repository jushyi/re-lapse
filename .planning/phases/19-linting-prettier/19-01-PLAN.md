---
phase: 19-linting-prettier
plan: 01
type: execute
---

<objective>
Set up ESLint, Prettier, and pre-commit hooks infrastructure.

Purpose: Establish strict code quality enforcement with auto-fix on commit, eliminating style debates and catching potential bugs early.
Output: Configured ESLint (flat config), Prettier, Husky v9, and lint-staged - ready for codebase formatting.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-linting-prettier/19-RESEARCH.md
@.planning/phases/19-linting-prettier/19-CONTEXT.md
@package.json

**Constraints from v1.6 milestone:**
- No breaking changes - all external behavior must stay identical
- No functional changes - everything works exactly as it does now
- No visual changes - UI/UX must remain the same

**From RESEARCH.md:**
- Use ESLint flat config (eslint.config.js) with defineConfig() wrapper
- Use eslint-config-expo for Expo-specific rules
- Use eslint-plugin-prettier/recommended (sets up both plugin AND config-prettier)
- Husky v9 with "prepare": "husky" script
- lint-staged for staged-file-only execution

**Tech stack available:**
- Expo SDK 54 (supports flat config)
- React Native 0.81.5
- No existing ESLint or Prettier config
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install ESLint, Prettier, and hook dependencies</name>
  <files>package.json, package-lock.json</files>
  <action>
Install all required dev dependencies in a single command:

```bash
cd "c:/Users/maser/Lapse Clone"
npm install --save-dev eslint eslint-config-expo prettier eslint-plugin-prettier eslint-config-prettier husky lint-staged
```

Then initialize Husky v9:

```bash
npx husky init
```

This creates .husky/ directory with a sample pre-commit hook.

Add the "prepare" script to package.json if not already present (Husky init should add this automatically):

```json
"scripts": {
  "prepare": "husky"
}
```

Also add the lint scripts:

```json
"scripts": {
  "lint": "eslint .",
  "lint:fix": "eslint . --fix",
  "format": "prettier --write \"src/**/*.{js,jsx,json}\" \"*.{js,json}\""
}
```

**Avoid:** Don't use legacy husky install command (deprecated in v9). Don't install @babel/eslint-parser separately (eslint-config-expo handles this).
  </action>
  <verify>
- `npm ls eslint` shows eslint@9.x installed
- `npm ls prettier` shows prettier@3.x installed
- `npm ls husky` shows husky@9.x installed
- `.husky/` directory exists with pre-commit file
- `package.json` has "prepare": "husky" script
  </verify>
  <done>All dependencies installed, Husky initialized, scripts added to package.json</done>
</task>

<task type="auto">
  <name>Task 2: Create ESLint flat config with Prettier integration</name>
  <files>eslint.config.js</files>
  <action>
Create eslint.config.js in project root using flat config format (SDK 53+ standard):

```javascript
// eslint.config.js
const { defineConfig } = require('eslint/config');
const expoConfig = require('eslint-config-expo/flat');
const eslintPluginPrettierRecommended = require('eslint-plugin-prettier/recommended');

module.exports = defineConfig([
  // Expo's React Native rules (includes React, RN globals, etc.)
  expoConfig,

  // Prettier integration - MUST be last to override conflicting rules
  eslintPluginPrettierRecommended,

  // Project-specific ignores
  {
    ignores: [
      'dist/*',
      'node_modules/*',
      '.expo/*',
      'android/*',
      'ios/*',
      'coverage/*',
      '.husky/*',
      'functions/*', // Cloud Functions have their own lint config
      'patches/*',
      'scripts/*',
    ],
  },
]);
```

**Key points:**
- Use defineConfig() wrapper to avoid spread operator confusion
- eslint-plugin-prettier/recommended sets up BOTH the plugin AND config-prettier
- Keep Prettier config LAST to properly override conflicting ESLint rules
- Ignore functions/ since Cloud Functions may have different Node.js requirements

**Avoid:** Don't use legacy .eslintrc.js format. Don't manually configure eslint-config-prettier separately (it's included in the recommended config).
  </action>
  <verify>
- `npx eslint --print-config src/App.js` outputs config without errors
- Config includes Prettier rules (look for "prettier/prettier" in output)
  </verify>
  <done>eslint.config.js exists with Expo + Prettier configuration, ESLint can parse config</done>
</task>

<task type="auto">
  <name>Task 3: Create Prettier config and configure lint-staged</name>
  <files>.prettierrc, .prettierignore, package.json</files>
  <action>
Create .prettierrc in project root with settings matching React Native conventions:

```json
{
  "semi": true,
  "singleQuote": true,
  "trailingComma": "es5",
  "tabWidth": 2,
  "printWidth": 100,
  "bracketSpacing": true,
  "arrowParens": "avoid"
}
```

Create .prettierignore to skip generated/external files:

```
node_modules/
dist/
.expo/
android/
ios/
coverage/
*.lock
.husky/
functions/node_modules/
patches/
```

Add lint-staged configuration to package.json:

```json
{
  "lint-staged": {
    "*.{js,jsx}": [
      "eslint --fix",
      "prettier --write"
    ],
    "*.{json,md}": [
      "prettier --write"
    ]
  }
}
```

Update .husky/pre-commit to run lint-staged:

```sh
npx lint-staged
```

**Avoid:** Don't use trailingComma: "all" (ES5 compatible is safer for React Native). Don't run Prettier before ESLint --fix (ESLint may introduce changes that need reformatting).
  </action>
  <verify>
- `npx prettier --check src/App.js` runs without config errors (may report formatting needed)
- `cat package.json` shows lint-staged configuration
- `cat .husky/pre-commit` contains "npx lint-staged"
  </verify>
  <done>.prettierrc, .prettierignore created; lint-staged configured in package.json; pre-commit hook updated</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm ls eslint prettier husky lint-staged` shows all packages installed
- [ ] `npx eslint --print-config src/App.js` succeeds (config is valid)
- [ ] `npx prettier --check src/App.js` runs (config loads correctly)
- [ ] `.husky/pre-commit` exists and contains lint-staged command
- [ ] `package.json` has lint, lint:fix, format, and prepare scripts
</verification>

<success_criteria>

- All dependencies installed and versions correct
- ESLint flat config created with Expo + Prettier integration
- Prettier config and ignore file created
- Husky + lint-staged configured for pre-commit hooks
- Ready for codebase formatting in 19-02
</success_criteria>

<output>
After completion, create `.planning/phases/19-linting-prettier/19-01-SUMMARY.md`
</output>
