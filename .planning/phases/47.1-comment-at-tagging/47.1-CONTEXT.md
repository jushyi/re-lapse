# Phase 47.1: Comment @-Tagging for Mutual Friends - Context

**Gathered:** 2026-02-11
**Status:** Ready for research

<vision>
## How This Should Work

When a user is writing a comment (top-level or reply), typing `@` triggers a floating autocomplete dropdown that appears above the keyboard — just like Instagram. The dropdown shows mutual friends (friends shared between the commenter and the photo owner) with their profile pictures and display names, filtering as the user types.

Tapping a suggestion inserts a styled @-mention into the comment text. The mention is visually distinct — colored differently from regular text so it stands out. Once the comment is posted, the mention is tappable and navigates to that person's profile.

When someone is @-mentioned, they receive a push notification ("X mentioned you in a comment") and it appears in the activity feed. Tapping the notification deep-links directly to that comment on the photo.

</vision>

<essential>
## What Must Be Nailed

- **Smooth autocomplete UX** — The @ trigger, dropdown appearance, and selection flow must feel instant and polished with no jank
- **Mention notifications** — @-mentioned users get a push notification that deep-links to the comment, plus it shows in the activity feed
- Both are equally important — the feature is incomplete without either

</essential>

<boundaries>
## What's Out of Scope

- Tagging non-mutual friends — only mutual friends (friends of both commenter and photo owner) appear in autocomplete
- Rich-text editor or complex formatting — mentions work but no fancy text editing beyond the @-mention styling
- Photos are friend-gated so the photo owner is always a friend of the commenter — no special-case logic needed for owner tagging

</boundaries>

<specifics>
## Specific Ideas

- Instagram-style floating overlay above the keyboard for autocomplete suggestions
- Profile pictures + display names in the dropdown
- Colored/highlighted mention text so @-mentions stand out visually in posted comments
- Tappable mentions that navigate to the tagged person's profile
- Works in both top-level comments and nested reply comments
- Push notification + activity feed entry with deep-link to the specific comment

</specifics>

<notes>
## Additional Context

Builds on existing comment reply architecture (Phase 17: Nested Reply Comments) and notification infrastructure (Phases 34-38, 41). The mutual friends concept already exists in the codebase from Phase 42 (Mutual Friends Suggestions).

</notes>

---

_Phase: 47.1-comment-at-tagging_
_Context gathered: 2026-02-11_
