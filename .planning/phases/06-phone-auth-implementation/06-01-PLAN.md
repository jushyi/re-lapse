---
phase: 06-phone-auth-implementation
plan: 01
type: execute
domain: firebase-phone-auth
---

<objective>
Install and configure React Native Firebase for phone authentication.

Purpose: Replace Firebase JS SDK auth with React Native Firebase to enable native phone verification with silent APNs (no visible reCAPTCHA for most users).
Output: Working React Native Firebase installation with app.json configured for development builds.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-phone-auth-implementation/06-RESEARCH.md

# Key files to modify:
@package.json
@app.json

# Current auth implementation (reference only - do not modify yet):
@src/services/firebase/authService.js
@src/context/AuthContext.js

**From RESEARCH.md:**
- Use @react-native-firebase/app (^23.0.1) and @react-native-firebase/auth (^23.0.1)
- Requires expo-dev-client and expo-build-properties
- app.json needs useFrameworks: "static" for iOS
- Project already has EAS configured (projectId: b7da185a-d3e1-441b-88f8-0d4379333590)

**Constraints:**
- This plan only installs dependencies and configures app.json
- Existing Firebase JS SDK remains for other services (Firestore, Storage)
- Auth migration happens in Plan 03
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install React Native Firebase dependencies</name>
  <files>package.json</files>
  <action>
Install React Native Firebase packages for phone authentication:
```bash
npm install @react-native-firebase/app @react-native-firebase/auth
npx expo install expo-dev-client expo-build-properties
npm install libphonenumber-js
```

Install libphonenumber-js for phone number validation (use the default bundle, not 'min' - we need parsePhoneNumberFromString).

Do NOT install react-native-international-phone-number yet - we'll build a simpler phone input first to avoid potential compatibility issues.
  </action>
  <verify>
- `npm ls @react-native-firebase/app` shows ^23.x
- `npm ls @react-native-firebase/auth` shows ^23.x
- `npm ls expo-dev-client` shows ~5.x
- `npm ls libphonenumber-js` shows ^1.x
- No npm WARN about peer dependencies related to firebase
  </verify>
  <done>All four packages installed, no unresolved peer dependency warnings</done>
</task>

<task type="auto">
  <name>Task 2: Configure app.json for React Native Firebase</name>
  <files>app.json</files>
  <action>
Update app.json plugins array to include React Native Firebase config plugins:

1. Add @react-native-firebase/app plugin
2. Add @react-native-firebase/auth plugin
3. Add expo-build-properties with iOS useFrameworks: "static" (required for firebase-ios-sdk)

The plugins array should include (order matters - expo-build-properties should be before firebase plugins):
```json
"plugins": [
  "expo-secure-store",
  [
    "expo-camera",
    {
      "cameraPermission": "Allow Lapse to access your camera to take photos.",
      "microphonePermission": false
    }
  ],
  [
    "expo-build-properties",
    {
      "ios": {
        "useFrameworks": "static"
      }
    }
  ],
  "@react-native-firebase/app",
  "@react-native-firebase/auth"
]
```

Also ensure ios.bundleIdentifier is set (already "com.lapseclone.app").
  </action>
  <verify>
- app.json contains @react-native-firebase/app in plugins
- app.json contains @react-native-firebase/auth in plugins
- app.json contains expo-build-properties with useFrameworks: "static"
- Run `npx expo config --type introspect | grep -A5 plugins` to verify plugin order
  </verify>
  <done>app.json plugins configured with expo-build-properties (useFrameworks: static) and both React Native Firebase plugins</done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <action>Enable Phone Authentication in Firebase Console</action>
  <instructions>
I've installed the packages and configured app.json. Now you need to enable Phone auth in Firebase:

1. Go to Firebase Console: https://console.firebase.google.com/
2. Select your project (lapse-clone-app)
3. Navigate to: Authentication â†’ Sign-in method
4. Click "Phone" provider
5. Enable it (toggle ON)
6. OPTIONAL but recommended: Add test phone numbers for development:
   - +1 650-555-1234 with verification code: 123456
   - (Add more test numbers as needed)
7. Click "Save"

**Important:** Phone auth MUST be enabled before the app can send verification codes.
  </instructions>
  <verification>Firebase Console shows Phone provider as "Enabled" in Sign-in method tab</verification>
  <resume-signal>Type "done" when Phone auth is enabled in Firebase Console</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm ls @react-native-firebase/app` shows installed version
- [ ] `npm ls @react-native-firebase/auth` shows installed version
- [ ] `npm ls expo-dev-client` shows installed version
- [ ] `npm ls libphonenumber-js` shows installed version
- [ ] app.json contains all three plugin configurations
- [ ] Firebase Console has Phone provider enabled
</verification>

<success_criteria>
- All dependencies installed without errors
- app.json properly configured for React Native Firebase
- Firebase Console Phone auth enabled
- Ready for Plan 02 (Phone auth service and screens)
</success_criteria>

<output>
After completion, create `.planning/phases/06-phone-auth-implementation/06-01-SUMMARY.md`
</output>
