---
phase: 03-swipe-gesture-triage
plan: 02
type: execute
---

<objective>
Integrate SwipeablePhotoCard into DarkroomScreen and add haptic feedback on swipe completion.

Purpose: Replace button-based triage with gesture-based triage, add tactile confirmation via haptics, and verify gesture system doesn't conflict with bottom sheet.
Output: DarkroomScreen with functional swipe-to-triage gestures, haptic feedback, and polished animations.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-swipe-gesture-triage/03-01-SUMMARY.md
@src/screens/DarkroomScreen.js
@src/components/SwipeablePhotoCard.js
@src/utils/haptics.js

**Tech stack available:**
- react-native-gesture-handler ~2.28.0 (Swipeable component)
- react-native-reanimated ~3.16.1 (smooth animations)
- expo-haptics ~15.0.8 (tactile feedback)

**Established patterns:**
- Haptic feedback in DarkroomBottomSheet at progress milestones (light impact) and completion (success notification)
- handleTriage function in DarkroomScreen (lines 72-90) for photoService calls
- Alert.alert for confirmation messages
- Logger usage for user interactions

**Constraining decisions:**
- Phase 2: Press-and-hold is on CameraScreen, swipe gestures will be on DarkroomScreen - no gesture conflicts expected
- SwipeablePhotoCard already handles Archive/Journal swipes with onSwipeableOpen callback
- Delete button must remain separate (destructive action needs Alert confirmation)

**From 03-01 completion:**
- SwipeablePhotoCard component ready with left/right swipe actions
- Progressive visual feedback implemented
- 100px swipe threshold for completion
- iOS Mail-style behavior established
</context>

<tasks>

<task type="auto">
  <name>Task 1: Replace button-based triage with SwipeablePhotoCard</name>
  <files>src/screens/DarkroomScreen.js</files>
  <action>
Integrate SwipeablePhotoCard into DarkroomScreen photo display:

**Replace Photo Card Section (lines 146-162):**
- Remove current `<View style={styles.photoCard}>` with Image inside
- Replace with `<SwipeablePhotoCard>` component
- Pass props: photo={currentPhoto}, onSwipeLeft={handleArchive}, onSwipeRight={handleJournal}

**Remove Button Section (lines 165-185):**
- Delete entire actionButtons View containing Archive and Journal TouchableOpacity buttons
- Keep deleteButton section (lines 187-208) - delete requires confirmation Alert

**Create Swipe Handlers:**
- `handleArchive = async () => { await handleTriage(currentPhoto.id, 'archive'); }`
- `handleJournal = async () => { await handleTriage(currentPhoto.id, 'journal'); }`
- Reuse existing handleTriage function (lines 72-90) - no changes needed

**Update Imports:**
- Add: `import { SwipeablePhotoCard } from '../components';`
- Remove: TouchableOpacity no longer needed for triage buttons (still used for delete)

**Update Styles:**
- Remove: actionButtons, actionButton, archiveButton, journalButton, actionButtonIcon, actionButtonText, actionButtonSubtext styles
- Keep: photoCard styles may be moved to SwipeablePhotoCard (check if styles needed in DarkroomScreen)

**Logging:**
- logger.info when user swipes (Archive/Journal) before calling handleTriage
- Keep existing logger calls in handleTriage function

**Layout Adjustments:**
- SwipeablePhotoCard should fill same space as old photoCard (65% of screen height)
- Delete button positioned below SwipeablePhotoCard with 32px marginTop
- Header remains at top (no changes)

**Why this approach:** SwipeablePhotoCard encapsulates all swipe gesture logic. DarkroomScreen only needs to provide callbacks (handleArchive, handleJournal) and let the component handle gesture detection and animations.
  </action>
  <verify>
DarkroomScreen renders SwipeablePhotoCard without errors.
Swipe left triggers handleArchive → photoService.triagePhoto(photoId, 'archive').
Swipe right triggers handleJournal → photoService.triagePhoto(photoId, 'journal').
Photo removed from list after successful triage.
Delete button still works with Alert confirmation.
No console errors.
  </verify>
  <done>
DarkroomScreen uses SwipeablePhotoCard for triage, Archive/Journal buttons removed, swipe handlers connected to handleTriage, layout adjusted, imports updated, unused styles removed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add haptic feedback on swipe completion</name>
  <files>src/components/SwipeablePhotoCard.js</files>
  <action>
Add haptic feedback to SwipeablePhotoCard swipe completion:

**Import Haptics:**
- Add: `import * as Haptics from 'expo-haptics';`
- Add: `import logger from '../utils/logger';`

**Haptic on Swipe Completion:**
- In onSwipeableOpen callback, before triggering onSwipeLeft/onSwipeRight:
  - Call: `Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium)`
  - Medium impact provides tactile confirmation of swipe action completion
  - Wrap in try/catch (haptics only work on physical devices, fail silently on simulator)

**Haptic Timing:**
- Trigger haptic immediately when swipe threshold reached (onSwipeableOpen fires)
- This provides instant feedback that action will execute
- Happens before photo triage API call (don't wait for Firebase response)

**Error Handling:**
- Wrap Haptics.impactAsync in try/catch
- Log errors with logger.debug (not logger.error - expected on simulator)
- Continue execution even if haptic fails (graceful degradation)

**Logging:**
- logger.debug before haptic trigger: "SwipeablePhotoCard: Triggering haptic for [Archive/Journal] swipe"
- logger.debug if haptic fails: "SwipeablePhotoCard: Haptic failed (simulator or unsupported device)"

**Haptic Strength Rationale:**
- Medium impact (not Light or Heavy)
- Medium provides satisfying confirmation without being jarring
- Matches iOS Mail swipe-to-action haptic strength
- Lighter than DarkroomBottomSheet's success notification (which uses notificationAsync)

**Why haptic on completion, not progress:** iOS Mail provides haptic only when action executes, not during swipe. This prevents haptic fatigue and saves battery while maintaining clear tactile confirmation.
  </action>
  <verify>
On physical iOS device: Swipe left/right triggers medium impact haptic when threshold reached.
On simulator: Swipe works without errors (haptic fails gracefully).
Haptic timing feels immediate (not delayed by Firebase call).
Logger shows haptic trigger attempt in console.
  </verify>
  <done>
SwipeablePhotoCard triggers medium impact haptic on swipe completion, wrapped in try/catch for graceful degradation, logged for debugging, provides tactile confirmation of Archive/Journal actions.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Swipe-to-triage gesture system in DarkroomScreen with haptic feedback and iOS Mail-style animations.
  </what-built>
  <how-to-verify>
**Test on physical iOS device** (swipe gestures and haptics don't work properly on simulator):

1. **Capture and Reveal Photos:**
   - Open app, navigate to Camera tab
   - Tap capture button to take 2-3 photos
   - Tap darkroom button (top-right corner with badge)
   - Press and hold progress bar for 2 seconds to reveal photos
   - Should navigate to Darkroom screen with revealed photos

2. **Test Swipe Left (Archive):**
   - Swipe photo card from right to left (~1/3 screen width)
   - Gray "Archive" action should progressively appear
   - When threshold reached, feel medium haptic
   - Photo should be archived and removed from list
   - Confirm Alert shows "Photo archived successfully!"

3. **Test Swipe Right (Journal):**
   - Swipe photo card from left to right (~1/3 screen width)
   - Green "Journal" action should progressively appear
   - When threshold reached, feel medium haptic
   - Photo should be journaled and removed from list
   - Confirm Alert shows "Photo journaled successfully!"

4. **Test Incomplete Swipe:**
   - Swipe less than threshold (~50px)
   - Photo card should spring back to center
   - No haptic, no triage action triggered

5. **Test Delete Button:**
   - Tap "Delete Photo" button below photo card
   - Alert confirmation should appear
   - Tap "Delete" in Alert
   - Photo deleted and removed from list

6. **Check for Gesture Conflicts:**
   - Navigate back to Camera tab
   - Tap darkroom button again
   - Press and hold progress bar (Phase 2 gesture)
   - Should work normally without interference from swipe gestures
   - Swipe gestures only active on DarkroomScreen, not CameraScreen

**Expected Behaviors:**
- Swipe actions feel smooth and responsive (no lag)
- Haptic feedback confirms swipe completion
- Progressive visual feedback during swipe (opacity/scale animations)
- No gesture conflicts between screens
- Photos properly triaged and removed from darkroom
- Delete button still requires Alert confirmation (destructive action safety)

**Things to Check:**
- Visual polish: Action labels fade in smoothly
- Animation quality: No jank or stuttering
- Haptic timing: Immediate on threshold, not delayed
- Edge cases: Empty darkroom state, last photo, rapid swipes
  </how-to-verify>
  <resume-signal>Type "approved" to continue to Phase 4, or describe any issues found (animation lag, gesture conflicts, haptic timing, etc.)</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] DarkroomScreen uses SwipeablePhotoCard (buttons removed)
- [ ] Swipe left archives photo
- [ ] Swipe right journals photo
- [ ] Haptic feedback triggers on swipe completion (medium impact)
- [ ] Delete button still works with Alert confirmation
- [ ] No gesture conflicts with CameraScreen bottom sheet
- [ ] Photo triage works end-to-end (Firebase, removal from list, Alert)
- [ ] Tested on physical iOS device (gestures + haptics)
- [ ] No console errors or warnings
- [ ] All logging present for swipe actions
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Swipe-to-triage works on physical device
- Haptic feedback confirms actions
- No gesture conflicts between screens
- User verification approved
- Phase 3 complete, ready for Phase 4
  </success_criteria>

<output>
After completion, create `.planning/phases/03-swipe-gesture-triage/03-02-SUMMARY.md`:

# Phase 3 Plan 2: Swipe Gesture Integration Summary

**[One-line description of what shipped]**

## Accomplishments

- Replaced Archive/Journal buttons with SwipeablePhotoCard in DarkroomScreen
- Integrated haptic feedback on swipe completion (medium impact)
- Verified no gesture conflicts with Phase 2 bottom sheet
- Tested end-to-end on physical iOS device
- [Additional accomplishments]

## Files Created/Modified

- `src/screens/DarkroomScreen.js` - [Description of integration]
- `src/components/SwipeablePhotoCard.js` - [Description of haptic addition]

## Decisions Made

[Key technical decisions and rationale]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

Phase 3 complete. Phase 4 ready to begin: Create animated celebration page after triage with "Return to Camera" button.

**Dependencies met:**
- Swipe-to-triage gesture system working end-to-end
- Haptic feedback pattern established for gestures
- Photo triage flow complete (Archive/Journal/Delete)
- Ready for success page after triage completion
</output>
