---
phase: 30-optimization-performance
plan: 05
type: execute
---

<objective>
Verify performance improvements and create comprehensive documentation of optimization work.

Purpose: Confirm that optimizations achieved their goal and document findings for future reference.
Output: PERFORMANCE.md documentation with before/after analysis and optimization guide.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/30-optimization-performance/30-RESEARCH.md
@.planning/phases/30-optimization-performance/30-CONTEXT.md
@.planning/phases/30-optimization-performance/30-01-SUMMARY.md
@.planning/phases/30-optimization-performance/30-02-SUMMARY.md
@.planning/phases/30-optimization-performance/30-03-SUMMARY.md
@.planning/phases/30-optimization-performance/30-04-SUMMARY.md

**From 30-CONTEXT.md:**

- User requested detailed profiling document with before/after metrics
- Primary issue was monthly album photo loading
- Testing on latest iPhone - if it feels slow, there's room for improvement
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Verify optimizations and gather metrics</name>
  <files>N/A - testing and analysis</files>
  <action>
1. Create a verification checklist for each optimized screen:

**MonthlyAlbumGridScreen:**

- Open a monthly album with 20+ photos
- Scroll rapidly up and down
- Check: No blank cells, smooth scrolling, photos appear quickly

**AlbumPhotoViewer:**

- Open fullscreen viewer from any album
- Swipe through 10+ photos
- Scroll thumbnail strip rapidly
- Check: No flicker, fast loading, smooth transitions

**AlbumGridScreen:**

- Open a user album with photos
- Scroll through grid
- Check: Smooth scrolling, no blank cells

**AlbumPhotoPickerScreen:**

- Open photo picker (add photos to album)
- Scroll through entire library
- Check: Smooth scrolling, selection works

**SelectsScreen/SelectsBanner:**

- View profile with selects
- Tap SelectsBanner to edit
- Check: Photos load quickly, interactions work

2. Document observations:
   - Which screens feel improved?
   - Any remaining performance issues?
   - Any regressions introduced?

3. Compile summary of changes made:
   - Count of files migrated
   - Patterns applied (expo-image props, FlatList optimizations)
     </action>
     <verify>All screens tested, observations documented</verify>
     <done>Verification complete, findings ready for documentation</done>
     </task>

<task type="auto">
  <name>Task 2: Create PERFORMANCE.md documentation</name>
  <files>.planning/codebase/PERFORMANCE.md</files>
  <action>
Create `.planning/codebase/PERFORMANCE.md` with the following structure:

````markdown
# Performance Optimization Guide

**Last Updated:** [date]
**Phase:** 30 - Optimization and Performance Enhancements

## Summary

[Brief summary of what was optimized and why]

## Key Optimizations Applied

### 1. expo-image Migration

**Problem:** React Native `Image` has unreliable caching and blocks UI thread during resize.

**Solution:** Migrated all photo-heavy screens to `expo-image` with proper props.

**Files migrated:**

- [List from summaries]

**Standard pattern:**

```javascript
import { Image } from 'expo-image';

<Image
  source={{ uri: photo.imageURL }}
  style={styles.photoImage}
  contentFit="cover"
  cachePolicy="memory-disk"
  priority="normal" // or "high" for fullscreen, "low" for thumbnails
  recyclingKey={photo.id} // required in lists
  transition={150} // optional fade-in
/>;
```
````

### 2. FlatList Optimization

**Problem:** Missing optimization props caused async layout calculations and stuttery scrolling.

**Solution:** Added optimization props to all photo FlatLists.

**Standard pattern:**

```javascript
<FlatList
  data={photos}
  renderItem={renderItem}
  keyExtractor={item => item.id}
  getItemLayout={(data, index) => ({
    length: CELL_HEIGHT,
    offset: CELL_HEIGHT * index,
    index,
  })}
  initialNumToRender={9} // Enough to fill screen
  maxToRenderPerBatch={6} // Smaller batches
  windowSize={5} // 2 above + 1 visible + 2 below
  removeClippedSubviews={true}
/>
```

## Files Still Using RN Image

[List any files intentionally kept on RN Image, with rationale]

## Future Optimization Opportunities

[Any identified but not implemented optimizations]

## Verification Results

[Summary of testing observations]

## Guidelines for New Screens

When building new screens with photo grids:

1. Always use `expo-image` for remote images
2. Apply FlatList optimization props for any list > 10 items
3. Use appropriate priority levels (high for main content, low for thumbnails)
4. Always add `recyclingKey` for images in lists

```
  </action>
  <verify>PERFORMANCE.md exists with complete documentation</verify>
  <done>PERFORMANCE.md created with optimization guide and findings</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Completed Phase 30 performance optimizations</what-built>
  <how-to-verify>
1. Build and run app: `npx expo start`
2. Navigate to Profile → Monthly Albums → Select any month
3. Scroll rapidly through the photo grid
4. Tap a photo to open fullscreen viewer
5. Swipe through photos, scroll thumbnail strip
6. Go back, open a user-created album
7. Verify: Photos load quickly, no blank cells, smooth scrolling

Expected: App should feel noticeably faster for photo loading, especially in monthly albums.
  </how-to-verify>
  <resume-signal>Type "approved" to complete phase, or describe any remaining issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] All optimized screens manually tested
- [ ] PERFORMANCE.md created with comprehensive documentation
- [ ] No regressions identified
- [ ] Human verification checkpoint passed
</verification>

<success_criteria>
- All screens feel faster for photo loading
- PERFORMANCE.md documents: changes made, patterns to follow, remaining files
- User confirms monthly albums feel improved (primary issue resolved)
- No functional regressions
- Phase 30 complete
</success_criteria>

<output>
After completion, create `.planning/phases/30-optimization-performance/30-05-SUMMARY.md`:

Include:
- Verification results
- Link to PERFORMANCE.md
- Summary of Phase 30 overall
- Confirmation that primary issue (monthly albums) is resolved
</output>
```
