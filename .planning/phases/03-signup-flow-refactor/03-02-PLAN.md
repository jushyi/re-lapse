---
phase: 03-signup-flow-refactor
plan: 02
type: execute
---

<objective>
Create SelectsScreen for picking highlight photos and update signup navigation flow.

Purpose: Complete the three-step signup flow (Phone â†’ Profile â†’ Selects) by adding the Selects picking screen as the final onboarding step.
Output: SelectsScreen component and updated navigation connecting ProfileSetup â†’ Selects â†’ Main app
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-signup-flow-refactor/03-CONTEXT.md

# Prior phase context:

@.planning/phases/03-signup-flow-refactor/03-01-SUMMARY.md (after 03-01 completes)

# Key files:

@src/screens/ProfileSetupScreen.js
@src/navigation/AppNavigator.js
@src/context/AuthContext.js
@src/constants/colors.js

**Tech stack available:** expo-image-picker, colors.js constants, Button component
**Established patterns:**

- Dark theme with colors.background.primary/secondary/tertiary
- SafeAreaView + ScrollView pattern for screens
- useAuth() hook for user context and profile updates
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Create SelectsScreen for picking highlight photos</name>
  <files>src/screens/SelectsScreen.js</files>
  <action>
Create a new SelectsScreen component for the final signup step:

**Structure:**

- SafeAreaView with dark background (colors.background.primary)
- Title: "Pick Your Selects" with subtitle "Choose up to 5 photos to highlight on your profile"
- Photo grid using expo-image-picker's multiple selection
- "Add Photos" button to open photo library
- Selected photos shown in a horizontal preview row
- "Complete" primary button to finish signup
- "Skip for now" text link at bottom

**State:**

- selectedPhotos: array of { uri: string, assetId: string } (max 5)

**Functions:**

1. handleAddPhotos:
   - Use ImagePicker.launchImageLibraryAsync with allowsMultipleSelection: true
   - Limit to 5 total photos
   - Store selected URIs

2. handleRemovePhoto(index):
   - Remove photo from selectedPhotos array

3. handleComplete:
   - Store selectedPhotos URIs to user profile (selects field)
   - Update profileSetupCompleted to true (if not already)
   - Update selectsCompleted to true
   - Navigation handled by AuthContext state change

4. handleSkip:
   - Set selectsCompleted to true (without photos)
   - Navigation handled by AuthContext state change

**Layout:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Pick Your Selects       â”‚
â”‚   Choose up to 5 photos     â”‚
â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚     [Add Photos]        â”‚â”‚
â”‚  â”‚                         â”‚â”‚
â”‚  â”‚  ğŸ“·  Tap to add photos  â”‚â”‚
â”‚  â”‚                         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                             â”‚
â”‚  Selected: (horizontal row) â”‚
â”‚  [img1][img2][img3]...      â”‚
â”‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚      Complete           â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚        Skip for now         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Style using colors.js constants throughout. Match the visual language of ProfileSetupScreen.

**Export:** Add to src/screens/index.js barrel export.
</action>
<verify>npm run lint passes, file exists at src/screens/SelectsScreen.js</verify>
<done>SelectsScreen created with photo picker, preview, complete/skip functionality</done>
</task>

<task type="auto">
  <name>Task 2: Update navigation and auth flow for Selects step</name>
  <files>src/navigation/AppNavigator.js, src/context/AuthContext.js, src/screens/ProfileSetupScreen.js</files>
  <action>
Update the signup flow to include SelectsScreen as the final step:

**1. AppNavigator.js:**

- Import SelectsScreen
- Add SelectsScreen to the auth stack (after ProfileSetupScreen)
- Update the navigation logic:
  - If profileSetupCompleted && !selectsCompleted â†’ Show SelectsScreen
  - If profileSetupCompleted && selectsCompleted â†’ Show MainTabNavigator

**2. AuthContext.js:**

- Ensure selectsCompleted field is read from user document
- Include selectsCompleted in userProfile state
- Update condition for showing main app: profileSetupCompleted AND selectsCompleted

**3. ProfileSetupScreen.js:**

- After handleCompleteSetup succeeds, navigate to 'Selects' screen instead of relying on AuthContext alone
- Use navigation.replace('Selects') to prevent back navigation to profile setup
- handleSkip should also navigate to Selects

The flow becomes:
PhoneInput â†’ Verification â†’ ProfileSetup â†’ Selects â†’ MainTabNavigator

DO NOT change existing Firebase operations or user document structure beyond adding selectsCompleted field.
</action>
<verify>App navigation logic compiles, flow from ProfileSetup leads to Selects</verify>
<done>Navigation updated: ProfileSetup â†’ Selects â†’ Main app, auth state checks both flags</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete three-step signup flow: Phone â†’ Profile â†’ Selects</what-built>
  <how-to-verify>
    1. Run: npx expo start
    2. Start fresh (log out if needed)
    3. Enter phone number on PhoneInputScreen â†’ verify code
    4. Complete ProfileSetupScreen (with song section visible)
    5. Verify: After completing profile, SelectsScreen appears
    6. Test: Add 1-3 photos using "Add Photos" button
    7. Verify: Photos appear in selected preview row
    8. Test: Tap "Complete" â†’ should navigate to main app
    9. Test alternative: Log out, go through flow again, tap "Skip for now" on Selects â†’ should also reach main app
    10. Verify: Dark theme consistent throughout all three steps
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] SelectsScreen exists and compiles
- [ ] Navigation flows correctly: ProfileSetup â†’ Selects â†’ Main
- [ ] Both "Complete" and "Skip" work on SelectsScreen
- [ ] Photo picker allows selecting multiple photos
- [ ] Dark theme consistent throughout
</verification>

<success_criteria>

- SelectsScreen created with photo picker functionality
- Navigation updated for three-step signup flow
- Both complete and skip paths work
- User reaches main app after Selects step
- Phase 3 complete, ready for Phase 4
  </success_criteria>

<output>
After completion, create `.planning/phases/03-signup-flow-refactor/03-02-SUMMARY.md`:

Include:

- All files created/modified
- Navigation flow changes
- Any deviations from plan
- Readiness for Phase 4
  </output>
