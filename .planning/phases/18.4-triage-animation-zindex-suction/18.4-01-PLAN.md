---
phase: 18.4-triage-animation-zindex-suction
plan: 01
type: execute
---

<objective>
Fix z-index layering so photo cards animate behind triage buttons, and add vacuum suction effect for delete animation.

Purpose: Improve visual polish - buttons stay accessible during animations, delete action feels satisfying and intentional.
Output: Cards animate behind button bar, delete card gets "sucked into" delete button with shrinking + pull motion, button pulses on arrival.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18.4-triage-animation-zindex-suction/18.4-CONTEXT.md

# Key files:
@src/components/SwipeablePhotoCard.js
@src/screens/DarkroomScreen.js

# Prior decisions from Phase 17:
- Gesture.Pan() API for swipe gestures (Reanimated v4)
- BUTTON_EXIT_DURATION = 1200ms for button-triggered animations
- Cards use absolute positioning with zIndex = 3 - stackIndex
- Delete animation currently drops card straight down with translateY

# Animation patterns established:
- withTiming for exit animations with Easing.out(Easing.cubic)
- withSpring for natural motion (damping: 15, stiffness: 150)
- runOnJS for callbacks after animation completes
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix z-index layering for triage button bar</name>
  <files>src/screens/DarkroomScreen.js</files>
  <action>
Add explicit zIndex: 10 to triageButtonBar style to ensure buttons always render above photo cards (which have zIndex 1-3).

Also add zIndex: 1 to photoCardContainer style to establish proper stacking context.

The button bar must stay visually on top during all card animations (archive, journal, delete). Cards currently have zIndex = 3 - stackIndex (so max 3), so buttonBar at zIndex 10 will always be above.

**What to avoid:** Don't use elevation alone (Android) - use both zIndex and elevation for cross-platform consistency. Don't change the card zIndex values as they're needed for proper stack ordering.
  </action>
  <verify>Visual inspection: Start triage animation via button, confirm card passes BEHIND button bar not over it. Test all three buttons (archive, journal, delete).</verify>
  <done>Cards animate behind the triage button bar in all three triage actions (archive, journal, delete).</done>
</task>

<task type="auto">
  <name>Task 2: Implement delete suction animation with button pulse</name>
  <files>src/components/SwipeablePhotoCard.js, src/screens/DarkroomScreen.js</files>
  <action>
**In SwipeablePhotoCard.js:**

1. Add a new shared value for scale animation: `const cardScale = useSharedValue(1);`

2. Update cardStyle to include scale transform: add `{ scale: cardScale.value }` to the transforms array for the active card.

3. Modify triggerDelete() to create vacuum suction effect:
   - Instead of dropping straight down, animate card to shrink AND move toward delete button position
   - Delete button is at center-bottom of screen (x=0, y=positive toward button)
   - Use translateY to move DOWN toward button (approximately SCREEN_HEIGHT * 0.35 to reach button area)
   - Scale from 1 to 0.1 (almost disappears into button)
   - Keep same BUTTON_EXIT_DURATION (1200ms) but use easing that accelerates: Easing.in(Easing.cubic) for "being pulled in" feel
   - Alternatively, use Easing.bezier(0.5, 0, 1, 0.5) for accelerating pull

4. Add onDeleteComplete callback prop to SwipeablePhotoCard:
   - After delete animation completes, call onDeleteComplete?.() before handleDelete()
   - This signals DarkroomScreen to trigger button pulse

**In DarkroomScreen.js:**

1. Import Animated from 'react-native-reanimated' (aliased or separate) for the button pulse, OR use existing react-native Animated.

2. Add a ref for delete button scale animation:
   ```javascript
   const deleteButtonScale = useRef(new Animated.Value(1)).current;
   ```

3. Create handleDeletePulse callback:
   ```javascript
   const handleDeletePulse = useCallback(() => {
     Animated.sequence([
       Animated.timing(deleteButtonScale, {
         toValue: 1.15,
         duration: 100,
         useNativeDriver: true,
       }),
       Animated.timing(deleteButtonScale, {
         toValue: 1,
         duration: 150,
         useNativeDriver: true,
       }),
     ]).start();
   }, [deleteButtonScale]);
   ```

4. Wrap delete button in Animated.View with scale transform:
   ```javascript
   <Animated.View style={{ transform: [{ scale: deleteButtonScale }] }}>
     <TouchableOpacity style={styles.deleteButton} onPress={handleDeleteButton}>
       ...
     </TouchableOpacity>
   </Animated.View>
   ```

5. Pass onDeleteComplete={handleDeletePulse} to the active SwipeablePhotoCard.

**Animation timing:**
- Duration: 400-500ms for the suction (faster than other button animations for snappy vacuum feel)
- Scale: 1 → 0.1 (card shrinks significantly)
- Position: Current position → toward delete button (translateY increases, card centers horizontally with translateX → 0)
- Button pulse: 100ms up, 150ms down

**What to avoid:**
- Don't add rotation during suction (keep it clean/direct per CONTEXT.md)
- Don't use withSpring for the suction (want controlled acceleration, not bounce)
- Don't change archive/journal animations (they stay as-is)
  </action>
  <verify>
1. Tap delete button - card should shrink and accelerate toward delete button position (not drop straight down)
2. When card reaches button, delete button should pulse (slight scale up then back)
3. Animation duration ~400-500ms (visible but not slow)
4. Card moves without rotation (clean, direct motion)
5. Archive and journal buttons still work normally with their existing animations
  </verify>
  <done>
- Delete button tap causes card to shrink and "get sucked into" the delete button
- Card scales from 1 to ~0.1 while moving toward button position
- Delete button pulses (scale 1→1.15→1) when card arrives
- Animation feels like vacuum/suction, not just falling
- Archive/journal animations unchanged
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Z-index fix and delete suction animation with button pulse</what-built>
  <how-to-verify>
    1. Run: npx expo start
    2. Open app and navigate to Darkroom with photos
    3. Test z-index fix:
       - Tap Archive button - watch card fly off screen
       - Confirm card passes BEHIND the button bar (not over it)
       - Repeat with Journal button
    4. Test delete suction:
       - Tap Delete button
       - Confirm card shrinks and gets "pulled" toward delete button
       - Confirm delete button pulses when card arrives
       - Confirm no rotation during animation (clean motion)
    5. Test swipe gestures still work:
       - Swipe left (archive) - card should arc off normally
       - Swipe right (journal) - card should arc off normally
       - Both should go behind button bar
  </how-to-verify>
  <resume-signal>Type "approved" if all animations work correctly, or describe specific issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] Cards animate behind triage button bar (all three actions)
- [ ] Delete suction: card shrinks + moves toward button (no rotation)
- [ ] Delete button pulses on card arrival
- [ ] Archive/journal animations unchanged
- [ ] Swipe gestures still work correctly
- [ ] No TypeScript/ESLint errors
- [ ] App loads without console errors
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Z-index layering correct (cards behind buttons during animation)
- Delete animation feels like vacuum suction (shrink + accelerate toward button)
- Button pulse provides satisfying completion feedback
- No regressions to archive/journal animations
</success_criteria>

<output>
After completion, create `.planning/phases/18.4-triage-animation-zindex-suction/18.4-01-SUMMARY.md`:

# Phase 18.4 Plan 01: Triage Animation Z-Index & Delete Suction Summary

**[Substantive one-liner about what shipped]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description
- `path/to/another.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase 18.4 complete, ready for next phase
</output>
