---
phase: 17.2-reveal-timing-0-5-minutes
plan: 01
type: execute
---

<objective>
Change darkroom reveal timing from 0-15 minutes to 0-5 minutes for faster photo reveals.

Purpose: Provide much faster feedback loop for users - photos reveal within 5 minutes instead of 15 minutes maximum.
Output: Both client-side and server-side reveal timing constants updated to 0-5 minute range.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior related work:
@.planning/phases/13.1-darkroom-reveal-timing-fix/13.1-01-SUMMARY.md

# Key files to modify:
@src/services/firebase/darkroomService.js
@functions/index.js

**Tech stack available:** React Native Firebase, Firebase Cloud Functions
**Established patterns:** calculateNextRevealTime() uses Math.random() * MINUTES constant

**Constraining decisions:**
- Phase 13.1: Changed reveal interval from 0-2 hours to 0-15 minutes
- Server-side reveals via Cloud Function (processDarkroomReveals) runs every 2 minutes

**Current implementation:**
- Client-side: `Math.random() * 15` in darkroomService.js line 233
- Server-side: `Math.floor(Math.random() * 16)` in functions/index.js line 40
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update client-side reveal timing to 0-5 minutes</name>
  <files>src/services/firebase/darkroomService.js</files>
  <action>
    Change the reveal interval constant in calculateNextRevealTime() from 15 to 5:
    - Line 233: Change `Math.random() * 15` to `Math.random() * 5`
    - Update the JSDoc comment on line 229 from "0-15 minutes" to "0-5 minutes"
  </action>
  <verify>grep -n "Math.random" src/services/firebase/darkroomService.js shows "* 5"</verify>
  <done>Client-side calculateNextRevealTime() uses 0-5 minute range</done>
</task>

<task type="auto">
  <name>Task 2: Update server-side reveal timing to 0-5 minutes</name>
  <files>functions/index.js</files>
  <action>
    Change the reveal interval constant in revealUserPhotos() from 16 to 6:
    - Line 40: Change `Math.floor(Math.random() * 16)` to `Math.floor(Math.random() * 6)`
    - Update the comment on line 39 from "0-15 minutes" to "0-5 minutes"

    Note: Using 6 (not 5) because Math.floor(Math.random() * 6) produces 0-5 inclusive.
  </action>
  <verify>grep -n "Math.random" functions/index.js shows "* 6"</verify>
  <done>Server-side reveal timing uses 0-5 minute range</done>
</task>

<task type="auto">
  <name>Task 3: Deploy updated Cloud Function</name>
  <files>functions/index.js</files>
  <action>
    Deploy the updated Cloud Function to Firebase:
    - cd functions && npm run deploy

    Or if that script doesn't exist:
    - firebase deploy --only functions

    Wait for deployment to complete and verify no errors.
  </action>
  <verify>Firebase CLI shows successful deployment with function URLs</verify>
  <done>Updated processDarkroomReveals function is deployed and active</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Client-side darkroomService.js uses `Math.random() * 5`
- [ ] Server-side functions/index.js uses `Math.floor(Math.random() * 6)`
- [ ] Cloud Function deployed successfully
- [ ] App builds without errors: npx expo start (no TypeScript errors)
</verification>

<success_criteria>

- Both client and server use 0-5 minute reveal timing
- Cloud Function deployed to Firebase
- No build errors
- Comments updated to reflect new timing
</success_criteria>

<output>
After completion, create `.planning/phases/17.2-reveal-timing-0-5-minutes/17.2-01-SUMMARY.md`:

# Phase 17.2 Plan 01: Reveal Timing 0-5 Minutes Summary

**[Substantive one-liner]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `src/services/firebase/darkroomService.js` - Updated timing constant to 0-5 minutes
- `functions/index.js` - Updated timing constant to 0-5 minutes

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase 17.2 complete, ready for Phase 18: Reaction Notification Debouncing.
</output>
