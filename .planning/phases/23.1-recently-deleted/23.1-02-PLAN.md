---
phase: 23.1-recently-deleted
plan: 02
type: execute
---

<objective>
Build Recently Deleted screen with iOS Photos-style experience: grid view with countdown overlays, multi-select, restore/delete actions.

Purpose: Give users a safety net to recover deleted photos within 30-day grace period.
Output: RecentlyDeletedScreen accessible from Settings, with full restore and permanent delete functionality.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/23.1-recently-deleted/23.1-CONTEXT.md
@.planning/phases/23.1-recently-deleted/23.1-01-SUMMARY.md (after Plan 01 complete)

**Key files:**
@src/screens/SettingsScreen.js
@src/screens/AlbumPhotoPickerScreen.js (multi-select pattern reference)
@src/screens/MonthlyAlbumGridScreen.js (grid layout reference)
@src/components/AlbumPhotoViewer.js (full-screen viewer reference)

**From 23.1-CONTEXT.md (vision):**

- iOS Photos "Recently Deleted" album pattern
- Grid view with countdown overlay showing days remaining
- Multi-select for batch restore/delete
- Full-screen viewer with restore/delete menu
- Access via Settings (not a profile album)

**From Plan 01:**

- `getDeletedPhotos(userId)` - Fetches deleted photos
- `restoreDeletedPhoto(photoId, userId)` - Restores to journal
- `permanentlyDeletePhoto(photoId, userId)` - Immediate permanent delete
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Create RecentlyDeletedScreen component</name>
  <files>src/screens/RecentlyDeletedScreen.js, src/styles/RecentlyDeletedScreen.styles.js</files>
  <action>
  Create the Recently Deleted screen following existing patterns:

**RecentlyDeletedScreen.js:**

1. **Imports:**
   - React, useState, useEffect, useCallback
   - View, Text, FlatList, TouchableOpacity, Image, Alert, ActivityIndicator
   - SafeAreaView from react-native-safe-area-context
   - useNavigation, useFocusEffect from @react-navigation/native
   - Ionicons from @expo/vector-icons
   - useAuth for user.uid
   - colors from constants
   - getDeletedPhotos, restoreDeletedPhoto, permanentlyDeletePhoto from photoService
   - logger

2. **State:**
   - `photos` - Array of deleted photos from getDeletedPhotos
   - `loading` - Boolean for initial load
   - `refreshing` - Boolean for pull-to-refresh
   - `selectedIds` - Array of selected photo IDs for multi-select
   - `multiSelectMode` - Boolean to toggle selection mode

3. **Data fetching:**
   - useFocusEffect to load photos when screen focused
   - Call getDeletedPhotos(user.uid), set photos state
   - Calculate days remaining for each photo: `Math.ceil((scheduledForPermanentDeletionAt.toDate() - Date.now()) / (1000 * 60 * 60 * 24))`

4. **Header:**
   - Back button (chevron-back)
   - Title: "Recently Deleted"
   - Right side: "Select" button to toggle multiSelectMode, OR when in multiSelectMode: "Done" button
   - When multiSelectMode and selectedIds.length > 0: show "{count} selected" subtitle

5. **Grid layout:**
   - 3-column FlatList (numColumns: 3)
   - Square aspect ratio thumbnails (screenWidth / 3 - margin)
   - Gap/margin: 2px between items
   - Each thumbnail shows:
     - Image with cover resize
     - Countdown overlay (absolute positioned, bottom-left)
     - Overlay text: "{days}d" in white on semi-transparent dark background
     - Selection checkmark when in multiSelectMode and selected

6. **Thumbnail onPress:**
   - If multiSelectMode: toggle selection (add/remove from selectedIds)
   - If NOT multiSelectMode: navigate to full-screen viewer (or open modal)

7. **Bottom action bar (when multiSelectMode && selectedIds.length > 0):**
   - Absolute positioned at bottom
   - Two buttons: "Restore" (left) and "Delete" (right, red/danger color)
   - Restore: Confirmation alert, then batch restoreDeletedPhoto for each selectedIds
   - Delete: Serious confirmation alert ("This will permanently delete {count} photos"), then batch permanentlyDeletePhoto

8. **Empty state:**
   - When photos.length === 0: centered message
   - Icon: trash-outline (large)
   - Text: "No Recently Deleted Photos"
   - Subtext: "Photos you delete will appear here for 30 days before being permanently removed."

9. **Pull-to-refresh:**
   - FlatList refreshControl with onRefresh to reload photos

**Styles (RecentlyDeletedScreen.styles.js):** - Follow existing pattern in src/styles/ - Use colors constants throughout - Grid item size calculated from Dimensions
</action>
<verify>

- npm run lint passes (only pre-existing warnings)
- RecentlyDeletedScreen.js exists with all required functionality
- Styles file exists
  </verify>
  <done>
- RecentlyDeletedScreen displays 3-column grid of deleted photos
- Countdown overlay shows days remaining on each thumbnail
- Multi-select mode with batch restore and delete
- Empty state when no deleted photos
  </done>
  </task>

<task type="auto">
  <name>Task 2: Add full-screen viewer and navigation</name>
  <files>src/screens/RecentlyDeletedScreen.js, src/navigation/AppNavigator.js, src/screens/SettingsScreen.js</files>
  <action>
  Add full-screen photo viewing and wire up navigation:

**1. Full-screen viewer in RecentlyDeletedScreen:**

Use a modal approach (simpler than separate screen):

- Add state: `viewerPhoto` (currently viewed photo or null)
- When thumbnail tapped (not multiSelectMode): setViewerPhoto(photo)
- Render Modal when viewerPhoto !== null:
  - Full-screen Image with resizeMode="contain"
  - Header overlay: back button (X icon), photo info
  - Days remaining badge: "{days} days remaining"
  - Bottom action buttons: "Restore" and "Delete"
  - Restore: restoreDeletedPhoto, show success alert, close modal, refresh list
  - Delete: permanentlyDeletePhoto with confirmation, close modal, refresh list
- Modal background: black (colors.background.primary)

**2. Navigation registration (AppNavigator.js):**

- Import RecentlyDeletedScreen
- Add to MainStack (after DeleteAccount, before any modals):
  ```jsx
  <MainStack.Screen
    name="RecentlyDeleted"
    component={RecentlyDeletedScreen}
    options={{ headerShown: false }}
  />
  ```

**3. Settings menu item (SettingsScreen.js):**

- Add new menu item to menuItems array, BEFORE "Sign Out":
  ```javascript
  {
    id: 'recentlyDeleted',
    label: 'Recently Deleted',
    icon: 'trash-outline',
    onPress: () => handleNavigate('RecentlyDeleted'),
  },
  ```
- Position: After "Terms of Service", before "Sign Out"
  </action>
  <verify>
- Navigation to RecentlyDeleted works from Settings
- Full-screen viewer modal opens on thumbnail tap
- Restore and Delete buttons work in full-screen viewer
- Can navigate back to Settings
  </verify>
  <done>
- Full-screen photo viewer with restore/delete actions
- RecentlyDeleted screen registered in navigation
- Settings has "Recently Deleted" menu item
- Complete end-to-end flow works
  </done>
  </task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Recently Deleted screen with iOS Photos-style experience</what-built>
  <how-to-verify>
    1. Run: npx expo start (or npm start)
    2. Navigate: Profile → Settings (gear icon)
    3. Verify: "Recently Deleted" menu item visible (between Terms and Sign Out)
    4. Tap "Recently Deleted":
       - If no deleted photos: See empty state with trash icon and explanatory text
       - If you have deleted photos: See 3-column grid with countdown overlays
    5. Test single photo view:
       - Tap any photo thumbnail → Full-screen viewer opens
       - See days remaining badge
       - See Restore and Delete buttons
       - Test Restore: Photo should disappear from list
       - Test Delete: Confirmation dialog, then permanent deletion
    6. Test multi-select:
       - Tap "Select" in header
       - Tap multiple photos (checkmarks appear)
       - See "{count} selected" in header
       - Bottom action bar appears with Restore/Delete
       - Test batch Restore or Delete
       - Tap "Done" to exit multi-select mode
    7. Go back to profile, check that restored photos appear in monthly albums
  </how-to-verify>
  <resume-signal>Type "approved" to complete phase, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run lint passes (only pre-existing warnings)
- [ ] RecentlyDeletedScreen accessible from Settings
- [ ] Grid displays deleted photos with countdown overlays
- [ ] Multi-select mode works with batch actions
- [ ] Full-screen viewer with individual restore/delete
- [ ] Empty state displays when no deleted photos
- [ ] Restored photos return to journal
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- Human verification approved
- Phase 23.1 complete
  </success_criteria>

<output>
After completion, create `.planning/phases/23.1-recently-deleted/23.1-02-SUMMARY.md`
</output>
