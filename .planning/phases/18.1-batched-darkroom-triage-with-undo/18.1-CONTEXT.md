# Phase 18.1: Batched Darkroom Triage with Undo - Context

**Gathered:** 2026-01-22
**Status:** Ready for planning

<vision>
## How This Should Work

When you're in the darkroom triaging photos, nothing saves until you explicitly tap Done. You swipe through photos making decisions (journal, archive, delete), but those decisions stay local — you're always in control of when they become permanent.

If you make a mistake or change your mind, tap the Undo button and the last card slides back in from wherever it exited. Keep tapping Undo to step back through multiple decisions, like the undo stack in editing apps. It's forgiving and lets you experiment without commitment.

When you've triaged all photos (or whenever you're ready), tap the Done button to save everything at once. It saves silently in the background and immediately closes the darkroom, returning you to the camera. No fanfare, just quick and clean.

</vision>

<essential>
## What Must Be Nailed

- **Batch save gives control** — Nothing is permanent until you tap Done. You're always in control of when decisions become final.
- **Multi-level undo** — Can step back through multiple decisions by tapping Undo repeatedly, not just the last one.
- **Explicit Done tap required** — Even after swiping the last card, you must tap Done to save. No auto-save.

</essential>

<boundaries>
## What's Out of Scope

- No visual history/timeline — Don't need to see a list of all decisions made, just undo works
- No advanced gestures — Keep swipe gestures as-is, undo is a button tap only (no swipe-up to undo)
- No session persistence — If app closes mid-triage, draft is discarded and you start fresh (keeps things simple)
- No redo functionality — Only undo, no stepping forward through decisions

</boundaries>

<specifics>
## Specific Ideas

**Undo Button:**
- Rectangular button with rounded edges
- Small circular icon next to "Undo" text
- Positioned in top right of header
- Always visible, but grayed out/dimmed when nothing to undo
- Becomes active after first swipe decision

**Undo Animation:**
- Card reverses its exit animation when undo is tapped
- If card flew off to the right (journal), it slides back in from the right
- Same for left (archive) or down (delete)
- Intuitive and satisfying reversal

**Done Flow:**
- Must explicitly tap Done button to save (required even after last card)
- Silent save in background
- Immediately closes darkroom and returns to camera
- No success screen or confirmation message

**Animation Fix (UAT-015 from Phase 17):**
- Fix the black flash that occurs after card exit animation
- Top card briefly flashes black after cascade animation completes
- Should be smooth with no visual glitch

</specifics>

<notes>
## Additional Context

This phase changes the triage model from "save immediately on swipe" to "batch local decisions, save on Done". The key shift is giving users full control over when their decisions become permanent.

The undo stack approach (vs. single undo) was chosen because it's more forgiving — users can experiment with different decisions without fear of making irreversible mistakes.

Session persistence was explicitly excluded to keep complexity down. Users need to complete triage in one sitting, which is acceptable given the typical batch size (a few photos at a time).

The UAT-015 black flash bug was deferred from Phase 17 and should be fixed as part of this work since we're already modifying the card animation system.

</notes>

---

*Phase: 18.1-batched-darkroom-triage-with-undo*
*Context gathered: 2026-01-22*
