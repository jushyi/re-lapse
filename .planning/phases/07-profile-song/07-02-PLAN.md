---
phase: 07-profile-song
plan: 02
type: execute
---

<objective>
Create ProfileSongCard component with playback controls and integrate into ProfileScreen.

Purpose: Display the user's profile song with album art, title, artist, and playback UI.
Output: ProfileSongCard component and ProfileScreen integration replacing the placeholder.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-profile-song/07-CONTEXT.md
@.planning/phases/07-profile-song/07-01-SUMMARY.md
@src/screens/ProfileScreen.js
@src/services/audioPlayer.js
@src/constants/colors.js

**Tech stack available:**

- Services from 07-01: iTunesService.js, audioPlayer.js
- react-native-reanimated for glow animation
- Ionicons for play/pause icons

**Established patterns:**

- ProfileScreen placeholder at lines 174-176
- Dark theme with colors.background.tertiary for cards
- Subtle animations with reanimated

**From CONTEXT.md:**

- Card layout: Album art thumbnail left | Title + Artist + Duration | Play button right
- Progress bar fills during playback
- Subtle glow animation when active
- Quick tap plays/pauses
- Empty state: Placeholder with "Add song" prompt
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Create ProfileSongCard component</name>
  <files>src/components/ProfileSong/ProfileSongCard.js, src/components/ProfileSong/index.js, src/components/index.js</files>
  <action>
Create ProfileSongCard component:

**Props:**

```javascript
{
  song: {
    id, title, artist, albumArt, previewUrl, clipStart, clipEnd
  } | null,
  isOwnProfile: boolean,
  onPress: () => void,      // For quick tap (play/pause if has song, open search if empty)
  onLongPress: () => void,  // For edit menu (own profile only)
}
```

**Layout (horizontal row, ~60px height):**

1. Album art thumbnail (48x48, rounded corners 8px)
2. Song info (flex: 1):
   - Title (14pt, bold, colors.text.primary, numberOfLines 1)
   - Artist (12pt, colors.text.secondary, numberOfLines 1)
3. Play/Pause button (44x44 touch target):
   - Ionicons play-circle or pause-circle (32px)
   - colors.text.primary

**Playback state:**

- useState for isPlaying, progress (0-1)
- Call audioPlayer.playPreview when play pressed
- Pass onProgress callback to update progress state
- Call audioPlayer.stopPreview when pause pressed or on unmount

**Progress bar:**

- Absolute positioned at bottom of card
- Height 2px, colors.accent.primary (or similar accent color)
- Width = progress \* 100%
- Only visible when isPlaying or progress > 0

**Glow animation (when playing):**

- Animated.View wrapper with animated shadow
- Use useAnimatedStyle + withRepeat + withTiming
- Subtle shadow/glow pulse (shadowOpacity 0.2 to 0.4)
- Only animate when isPlaying

**Empty state (song === null):**

- Same card size/styling
- Ionicons musical-notes-outline (24px)
- Text: "Add a song" (colors.text.secondary)
- Dashed border style

**TouchableOpacity wrapper:**

- onPress: If has song, toggle play/pause. If empty, call onPress prop.
- onLongPress: Only if isOwnProfile and has song, call onLongPress prop

**Cleanup:**

- useEffect cleanup: stopPreview on unmount

Avoid: Global audio state (component manages its own). No search modal here (separate component).
</action>
<verify>Import component and render with mock song data, verify layout matches spec</verify>
<done>ProfileSongCard displays song info, plays/pauses audio with progress bar, shows empty state when no song</done>
</task>

<task type="auto">
  <name>Task 2: Integrate into ProfileScreen</name>
  <files>src/screens/ProfileScreen.js</files>
  <action>
Replace Profile Song placeholder with ProfileSongCard:

1. Import ProfileSongCard from components

2. Add state for profile song modal (future plan will use):

```javascript
const [showSongSearch, setShowSongSearch] = useState(false);
const [showSongMenu, setShowSongMenu] = useState(false);
```

3. Create handlers:

```javascript
const handleSongPress = () => {
  if (!profileData?.profileSong) {
    // Open song search (placeholder for now)
    logger.info('ProfileScreen: Add song pressed');
    setShowSongSearch(true);
  }
  // Play/pause handled internally by ProfileSongCard
};

const handleSongLongPress = () => {
  logger.info('ProfileScreen: Song long press');
  setShowSongMenu(true);
};
```

4. Replace the placeholder View (lines 174-176):

```javascript
<ProfileSongCard
  song={profileData?.profileSong || null}
  isOwnProfile={isOwnProfile}
  onPress={handleSongPress}
  onLongPress={handleSongLongPress}
/>
```

5. Adjust styling:

- Keep marginHorizontal: 16, marginTop: 16 from placeholder
- Remove fixed height (ProfileSongCard has its own)

6. For now, modals are placeholders (setShowSongSearch/setShowSongMenu set state but no modal rendered yet - Plan 03 and 05 will add)

Avoid: Implementing search modal here (Plan 03). Implementing edit menu here (Plan 05).
</action>
<verify>Navigate to ProfileScreen, see empty song card with "Add a song" prompt. If user has profileSong data, see song info.</verify>
<done>ProfileScreen displays ProfileSongCard, placeholder replaced, handlers ready for future modal integration</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] ProfileSongCard component exists with all props
- [ ] Empty state shows "Add a song" with dashed border
- [ ] With song data: album art, title, artist, play button visible
- [ ] Play/pause toggles audio, progress bar updates
- [ ] Glow animation visible during playback
- [ ] ProfileScreen uses ProfileSongCard instead of placeholder
- [ ] No TypeScript/ESLint errors
</verification>

<success_criteria>

- ProfileSongCard renders correctly for both states (empty/with song)
- Audio playback works with progress bar
- Glow animation during playback
- ProfileScreen integration complete
- Handlers ready for future modal integration
  </success_criteria>

<output>
After completion, create `.planning/phases/07-profile-song/07-02-SUMMARY.md`
</output>
