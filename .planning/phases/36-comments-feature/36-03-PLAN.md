---
phase: 36-comments-feature
plan: 03
type: execute
---

<objective>
Integrate comment components into PhotoDetailModal and FeedPhotoCard.

Purpose: Connect the comment system to the existing feed and modal UI, including footer redesign (comment input + emoji pills), comment previews in modal, and preview comments on feed cards.
Output: Modified PhotoDetailModal with comments integration, FeedPhotoCard with comment previews, seamless UX.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/36-comments-feature/36-CONTEXT.md
@.planning/phases/36-comments-feature/36-RESEARCH.md

**Key source files:**
@src/components/PhotoDetailModal.js
@src/hooks/usePhotoDetailModal.js
@src/styles/PhotoDetailModal.styles.js
@src/components/FeedPhotoCard.js
@src/screens/FeedScreen.js

**From CONTEXT.md - Integration approach:**

- Footer becomes: comment input (left half) + emoji pills (right half, compressed)
- Tapping comment input expands CommentsBottomSheet upward
- Photo stays visible at top of screen
- Comment preview in modal: below username, above progress bar
- Feed cards: 1-2 preview comments below photo
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Redesign PhotoDetailModal footer with comment input</name>
  <files>src/components/PhotoDetailModal.js, src/styles/PhotoDetailModal.styles.js, src/hooks/usePhotoDetailModal.js</files>
  <action>
**Modify the footer section** to include a comment input trigger alongside emoji pills:

**New footer layout:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Add a comment...     ] â”‚ ðŸ˜‚ â¤ï¸ ðŸ”¥ ðŸ˜ (pills)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Implementation:**

1. **Add state for CommentsBottomSheet:**

   ```javascript
   const [showComments, setShowComments] = useState(false);
   ```

2. **Create comment input trigger (not full input, just tappable placeholder):**
   - TouchableOpacity that looks like text input
   - "Add a comment..." placeholder text
   - onPress sets showComments = true

3. **Modify footer layout:**
   - Left side (~50%): Comment input trigger
   - Right side (~50%): Emoji pills ScrollView (existing, just constrained width)

4. **Add CommentsBottomSheet:**
   - Render below the main content wrapper
   - Pass photoId, photoOwnerId (from currentPhoto.userId), currentUserId
   - visible={showComments}, onClose={() => setShowComments(false)}

5. **Wire up comment count:**
   - Show comment count on input trigger if > 0: "12 comments"
   - Or keep "Add a comment..." if 0 comments

**Update usePhotoDetailModal.js:**

- Expose commentCount from currentPhoto.commentCount (may need to add to data model)

**Update styles:**

- footer: flexDirection: 'row', alignItems: 'center'
- commentInputTrigger: flex: 0.5, backgroundColor, borderRadius, padding
- emojiPickerContainer: flex: 0.5 (was full width)

**Note:** The existing emoji pills remain fully functional, just narrower.
</action>
<verify>
Open PhotoDetailModal on a feed photo. Footer should show "Add a comment..." on left, emoji pills on right. Tapping comment area should open CommentsBottomSheet.
</verify>
<done>

- Footer redesigned with comment input trigger on left, emoji pills on right
- CommentsBottomSheet integrated and opens on tap
- Comment count shown when > 0 comments
- Emoji pills still functional (narrower width)
- Sheet opens with proper keyboard handling
  </done>
  </task>

<task type="auto">
  <name>Task 2: Add comment preview in modal and feed cards</name>
  <files>src/components/PhotoDetailModal.js, src/components/FeedPhotoCard.js, src/styles/FeedPhotoCard.styles.js, src/components/comments/CommentPreview.js</files>
  <action>
**Create CommentPreview component:**

File: src/components/comments/CommentPreview.js

**Props:**

- `comments` - Array of preview comments (1-2 items from getPreviewComments)
- `onPress` - Callback when pressed (opens full comments)
- `totalCount` - Total comment count (for "View all X comments" link)
- `compact` - Boolean for condensed feed card style vs modal style

**Layout (compact=false for modal):**

```
**username** This is the comment text that can wrap to multiple lines if needed...
**username2** Another comment here...
[View all 24 comments]
```

**Layout (compact=true for feed card):**

```
**username** Comment text truncated...  [View 12 comments]
```

**Implementation:**

- Bold username inline with comment text (inline Text components)
- Truncate text with numberOfLines={2} for modal, numberOfLines={1} for compact
- "View all X comments" link at bottom (if totalCount > visible count)

**Integrate in PhotoDetailModal:**

- Position below userInfoOverlay, above progressBarScrollView
- Fetch preview comments using commentService.getPreviewComments
- Pass onPress that opens CommentsBottomSheet

**Integrate in FeedPhotoCard:**

- Position below the infoRow (username, reactions row)
- Fetch preview comments in FeedScreen and pass to FeedPhotoCard
- Or fetch in FeedPhotoCard using useEffect (simpler)
- Compact style with single line

**FeedScreen changes:**

- Either prefetch preview comments with feed data
- Or let FeedPhotoCard lazy-load its own previews (simpler, acceptable for MVP)

**Update FeedPhotoCard:**

- Add `previewComments` prop or internal state
- Add `onCommentsPress` prop for navigation to comments
- Render CommentPreview below reactions
  </action>
  <verify>
  Check PhotoDetailModal - preview comments should appear between username and progress bar (if comments exist).
  Check FeedPhotoCard - preview comments should appear below the user info/reactions row.
  </verify>
  <done>
- CommentPreview.js component created with compact/full modes
- PhotoDetailModal shows preview comments below username
- FeedPhotoCard shows preview comments (compact, 1 line)
- "View all X comments" link opens full comments view
- Owner comment shows first (caption behavior)
  </done>
  </task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Comments integration in PhotoDetailModal and FeedPhotoCard</what-built>
  <how-to-verify>
1. Run: npx expo start
2. Open the app on a test device
3. Navigate to Feed tab
4. Verify: Feed cards show comment preview section (may be empty if no comments yet)
5. Tap a photo to open PhotoDetailModal
6. Verify: Footer shows "Add a comment..." on left, emoji pills on right
7. Tap the comment input area
8. Verify: CommentsBottomSheet slides up from bottom, photo stays visible at top
9. Verify: Keyboard appears and input field is visible above keyboard
10. Type a test comment and send
11. Verify: Comment appears in the list
12. Close sheet and verify: Preview comment shows in modal
13. Return to feed and verify: Preview comment shows on feed card
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] PhotoDetailModal footer shows comment input + emoji pills side by side
- [ ] CommentsBottomSheet opens when comment input tapped
- [ ] Comments can be added and appear in list
- [ ] CommentPreview shows in modal (below username)
- [ ] CommentPreview shows on feed cards
- [ ] Keyboard handling works on iOS
</verification>

<success_criteria>

- Footer redesigned with 50/50 split: comment input trigger + emoji pills
- CommentsBottomSheet integrates seamlessly with modal
- Comment previews show in both modal and feed cards
- Owner comment prioritized as caption in preview
- "View all X comments" link opens full comments
- UX feels native and Instagram-like
  </success_criteria>

<output>
After completion, create `.planning/phases/36-comments-feature/36-03-SUMMARY.md`
</output>
