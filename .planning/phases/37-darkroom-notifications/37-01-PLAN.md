---
phase: 37-darkroom-notifications
plan: 01
type: execute
---

<objective>
Audit and update existing darkroom ready notification to ensure reliable delivery and clear messaging.

Purpose: The darkroom notification already exists and works. This phase audits the implementation, cleans up unused code, and improves messaging clarity.
Output: Clean, well-documented darkroom notification with clear messaging and no dead code.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/37-darkroom-notifications/37-CONTEXT.md

**Audit Findings:**

The darkroom notification implementation is functional but has dead code:

**What works:**

- Cloud Function triggers notification when photos reveal (`sendPhotoRevealNotification`)
- Deduplication prevents duplicate notifications (lastNotifiedAt tracking)
- Deep linking opens darkroom via Camera tab â†’ DarkroomBottomSheet
- Messaging includes photo count ("Your 5 photos are ready!")

**Issues found:**

1. `revealAll` and `revealedCount` params are sent to client but NEVER USED
   - Passed through notificationService.js â†’ useCamera.js â†’ DarkroomScreen
   - No code actually reads or acts on these values
   - Dead code that adds confusion

2. Messaging is functional but generic
   - Current: "ðŸ“¸ Photos Ready!" / "Your photo is ready to view in the darkroom"
   - Could be simpler per context: "Your 5 photos are ready!"

**Key files:**

- /functions/index.js (lines 213-322) - sendPhotoRevealNotification trigger
- /src/services/firebase/notificationService.js (lines 235-296) - handleNotificationTapped
- /src/hooks/useCamera.js (lines 212-221) - openDarkroom param detection
- /App.js (lines 92-123) - notification response listener

**Out of scope (Phase 34):**

- Token refresh strategy
- Permission denied feedback
- Token management improvements
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Remove unused notification params</name>
  <files>functions/index.js, src/services/firebase/notificationService.js, src/hooks/useCamera.js</files>
  <action>
Remove the unused `revealAll` and `revealedCount` parameters from the notification flow:

1. In functions/index.js (sendPhotoRevealNotification):
   - Remove `revealAll: 'true'` from the data payload
   - Keep `revealedCount` in payload as it's used for the message, but simplify to just pass it for logging/tracking, not for client-side behavior

2. In notificationService.js (handleNotificationTapped):
   - Simplify the photo_reveal case to just return navigation to Camera with openDarkroom: true
   - Remove extraction of revealAll and revealedCount from data
   - Remove the unused params from returned navigation data

3. In useCamera.js:
   - Remove revealAll and revealedCount from the route params destructuring
   - Keep only openDarkroom param which is what actually triggers the darkroom opening

Why: Dead code adds confusion and maintenance burden. These params were prepared for a feature that was never implemented. Clean code is better than aspirational code.
</action>
<verify>
grep -r "revealAll" src/ --include="_.js" --include="_.jsx" returns no results (only functions/ should have it for logging)
grep -r "revealedCount" src/ --include="_.js" --include="_.jsx" returns no results in navigation code
</verify>
<done>Unused params removed from client-side code. Notification flow simplified to: tap â†’ open darkroom. No dead code paths.</done>
</task>

<task type="auto">
  <name>Task 2: Simplify notification messaging</name>
  <files>functions/index.js</files>
  <action>
Update the notification message in sendPhotoRevealNotification to be simpler and more direct:

Current:

- Title: "ðŸ“¸ Photos Ready!"
- Body: "Your photo is ready to view in the darkroom" / "X photos are ready to view in the darkroom"

Updated:

- Title: "ðŸ“¸ Photos Ready!"
- Body: "Your photo is ready!" / "Your X photos are ready!"

Changes:

1. Keep the emoji and title (works well)
2. Shorten the body - remove "to view in the darkroom" as the tap action makes it obvious
3. Possessive "Your" emphasizes ownership
4. Exclamation adds energy without being overwhelming

The shorter message is clearer and follows the context guidance: "Keep the notification copy simple and direct (e.g., 'Your 5 photos are ready!')"
</action>
<verify>Read the updated message strings in functions/index.js around line 296-300</verify>
<done>Notification body shortened to "Your X photos are ready!" - simpler, clearer, more direct.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Cleaned up darkroom notification with simplified messaging and no dead code</what-built>
  <how-to-verify>
    1. Deploy functions: cd functions && npm run deploy (or firebase deploy --only functions)
    2. On physical device with app installed:
       - Ensure notification permissions granted
       - Take a photo to start darkroom timer
       - Wait for photo to develop (or manually trigger via Firebase console)
    3. When notification appears, verify:
       - Title: "ðŸ“¸ Photos Ready!"
       - Body: "Your X photos are ready!" (shorter message)
    4. Tap the notification
    5. Verify: App opens directly to darkroom (Camera tab with darkroom sheet open)
    6. No errors in console, flow feels natural
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe any issues with the notification flow</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `revealAll` param removed from client-side code
- [ ] `revealedCount` param removed from client navigation
- [ ] Notification message updated to shorter format
- [ ] Functions deployed successfully
- [ ] Manual test: notification appears with correct message
- [ ] Manual test: tapping notification opens darkroom
</verification>

<success_criteria>

- Unused params (revealAll, revealedCount) removed from client code
- Notification messaging simplified to "Your X photos are ready!"
- End-to-end flow verified: notification â†’ tap â†’ darkroom opens
- No TypeScript/JS errors introduced
- Clean code with no dead paths
  </success_criteria>

<output>
After completion, create `.planning/phases/37-darkroom-notifications/37-01-SUMMARY.md`:

# Phase 37 Plan 01: Darkroom Ready Notifications Summary

**[One-liner: what was accomplished]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `functions/index.js` - Description
- `src/services/firebase/notificationService.js` - Description
- `src/hooks/useCamera.js` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase complete, ready for Phase 38: Notification UI Polish
</output>
