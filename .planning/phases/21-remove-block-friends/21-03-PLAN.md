---
phase: 21-remove-block-friends
plan: 03
type: execute
---

<objective>
Create ReportUserScreen with reason picker and optional details field.

Purpose: Provide a clean interface for users to report inappropriate behavior with structured data for review.
Output: Full-screen ReportUserScreen accessible from FriendCard and ProfileScreen menus.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/21-remove-block-friends/21-CONTEXT.md
@.planning/phases/21-remove-block-friends/21-01-SUMMARY.md
@.planning/phases/21-remove-block-friends/21-02-SUMMARY.md

# Services:

@src/services/firebase/reportService.js (created in 21-01)

# Existing screen patterns:

@src/screens/SettingsScreen.js
@src/screens/FriendsScreen.js
@src/constants/colors.js

# Key design from context:

# - Full-screen reason picker with options: Spam, Harassment, Inappropriate content, Impersonation, Other

# - When reason selected, text field expands inline for optional details

# - Submit button appears below the field

# - X button AND back gesture both work to cancel (no discard confirmation)

# - Toast confirms "Report submitted" on success

# - Reports include profile snapshot for evidence

</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ReportUserScreen</name>
  <files>src/screens/ReportUserScreen.js, src/styles/ReportUserScreen.styles.js</files>
  <action>
Create ReportUserScreen following existing screen patterns.

**Route params expected:**

- userId: string (required)
- username: string (for display)
- displayName: string (for snapshot)
- profilePhotoURL: string (for snapshot)

**ReportUserScreen.js structure:**

```javascript
import React, { useState } from 'react';
import {
  View,
  Text,
  TouchableOpacity,
  TextInput,
  ScrollView,
  Alert,
  ActivityIndicator,
  KeyboardAvoidingView,
  Platform,
} from 'react-native';
import { Ionicons } from '@expo/vector-icons';
import { useSafeAreaInsets } from 'react-native-safe-area-context';
import { useNavigation, useRoute } from '@react-navigation/native';
import Toast from 'react-native-toast-message';

import { submitReport, REPORT_REASONS } from '../services/firebase';
import { useAuth } from '../context/AuthContext';
import { colors } from '../constants/colors';
import { styles } from '../styles/ReportUserScreen.styles';
import logger from '../utils/logger';

const REASON_LABELS = {
  spam: 'Spam',
  harassment: 'Harassment',
  inappropriate: 'Inappropriate Content',
  impersonation: 'Impersonation',
  other: 'Other',
};
```

**State:**

- `selectedReason: string | null`
- `details: string` (empty string initially)
- `submitting: boolean`

**UI Layout:**

1. **Header:** X button on left, "Report @username" title centered
   - X button calls `navigation.goBack()`
   - No confirmation on cancel (per context requirements)

2. **Reason Picker:** List of touchable rows with radio-style selection
   - Each reason row: icon on left, label, checkmark if selected
   - Icons:
     - spam: 'mail-unread-outline'
     - harassment: 'alert-circle-outline'
     - inappropriate: 'eye-off-outline'
     - impersonation: 'person-outline'
     - other: 'ellipsis-horizontal-outline'
   - On select, set `selectedReason` and show details field

3. **Details Field:** Appears when reason selected
   - `<TextInput>` multiline, placeholder "Add details (optional)", maxLength 500
   - Shows character count when focused
   - Expands/animates in using LayoutAnimation.configureNext

4. **Submit Button:** Appears when reason selected
   - Disabled while submitting
   - Shows ActivityIndicator when submitting
   - On press, call `handleSubmit()`

**handleSubmit function:**

```javascript
const handleSubmit = async () => {
  if (!selectedReason) return;

  setSubmitting(true);
  try {
    const profileSnapshot = {
      displayName: route.params.displayName || null,
      username: route.params.username || null,
      bio: null, // We don't have bio in route params, that's fine
      profilePhotoURL: route.params.profilePhotoURL || null,
    };

    const result = await submitReport(
      user.uid,
      route.params.userId,
      selectedReason,
      details.trim() || null,
      profileSnapshot
    );

    if (result.success) {
      Toast.show({
        type: 'success',
        text1: 'Report submitted',
        text2: 'Thank you for helping keep the community safe',
        visibilityTime: 3000,
      });
      navigation.goBack();
    } else {
      Alert.alert('Error', result.error || 'Could not submit report');
    }
  } catch (error) {
    logger.error('ReportUserScreen: Error submitting report', { error: error.message });
    Alert.alert('Error', 'Could not submit report');
  } finally {
    setSubmitting(false);
  }
};
```

**ReportUserScreen.styles.js:**

```javascript
import { StyleSheet } from 'react-native';
import { colors } from '../constants/colors';

export const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: colors.background.primary,
  },
  header: {
    flexDirection: 'row',
    alignItems: 'center',
    justifyContent: 'space-between',
    paddingHorizontal: 16,
    height: 56,
    borderBottomWidth: StyleSheet.hairlineWidth,
    borderBottomColor: colors.border.subtle,
  },
  headerButton: {
    width: 40,
    height: 40,
    alignItems: 'center',
    justifyContent: 'center',
  },
  headerTitle: {
    fontSize: 17,
    fontWeight: '600',
    color: colors.text.primary,
  },
  content: {
    flex: 1,
    padding: 16,
  },
  sectionTitle: {
    fontSize: 14,
    fontWeight: '600',
    color: colors.text.secondary,
    marginBottom: 12,
    textTransform: 'uppercase',
    letterSpacing: 0.5,
  },
  reasonRow: {
    flexDirection: 'row',
    alignItems: 'center',
    paddingVertical: 16,
    borderBottomWidth: StyleSheet.hairlineWidth,
    borderBottomColor: colors.border.subtle,
  },
  reasonIcon: {
    marginRight: 16,
  },
  reasonLabel: {
    flex: 1,
    fontSize: 16,
    color: colors.text.primary,
  },
  checkmark: {
    marginLeft: 8,
  },
  detailsContainer: {
    marginTop: 24,
  },
  detailsInput: {
    backgroundColor: colors.background.secondary,
    borderRadius: 12,
    padding: 16,
    fontSize: 16,
    color: colors.text.primary,
    minHeight: 120,
    textAlignVertical: 'top',
  },
  charCount: {
    fontSize: 12,
    color: colors.text.secondary,
    textAlign: 'right',
    marginTop: 8,
  },
  submitButton: {
    backgroundColor: colors.brand.primary,
    borderRadius: 12,
    paddingVertical: 16,
    alignItems: 'center',
    marginTop: 24,
  },
  submitButtonDisabled: {
    opacity: 0.5,
  },
  submitButtonText: {
    fontSize: 16,
    fontWeight: '600',
    color: colors.text.primary,
  },
});
```

  </action>
  <verify>ReportUserScreen renders with reason picker, details field appears on selection, submit works.</verify>
  <done>ReportUserScreen created with reason picker, expandable details field, and submit functionality.</done>
</task>

<task type="auto">
  <name>Task 2: Wire up navigation to ReportUserScreen</name>
  <files>src/navigation/AppNavigator.js</files>
  <action>
Add ReportUserScreen to navigation stack.

**Changes to AppNavigator.js:**

1. Import ReportUserScreen:

   ```javascript
   import ReportUserScreen from '../screens/ReportUserScreen';
   ```

2. Add Stack.Screen inside the authenticated stack (near other modal/utility screens):
   ```javascript
   <Stack.Screen
     name="ReportUser"
     component={ReportUserScreen}
     options={{
       presentation: 'modal',
       headerShown: false,
     }}
   />
   ```

The navigation calls from FriendsScreen and ProfileScreen (added in 21-02) will now work:

```javascript
navigation.navigate('ReportUser', {
  userId,
  username,
  displayName,
  profilePhotoURL,
});
```

  </action>
  <verify>ReportUserScreen accessible via navigation.navigate('ReportUser', params). Modal presentation works.</verify>
  <done>ReportUserScreen added to AppNavigator with modal presentation. Navigation from menus works.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] ReportUserScreen renders with reason picker
- [ ] Selecting reason shows details text field
- [ ] Submit creates report in Firestore
- [ ] Toast confirmation appears on success
- [ ] Navigation back to previous screen on success
- [ ] X button closes without confirmation
- [ ] `npx eslint src/screens/ReportUserScreen.js` passes
</verification>

<success_criteria>

- Full report flow works end-to-end
- Reports stored in Firestore with correct structure
- Clean UX with expandable details field
- Toast feedback on success
  </success_criteria>

<output>
After completion, create `.planning/phases/21-remove-block-friends/21-03-SUMMARY.md`
</output>
