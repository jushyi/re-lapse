---
phase: 04.1-drag-reorder-visual-feedback
plan: 01
type: execute
---

<objective>
Add animated visual feedback during drag-to-reorder so other thumbnails slide out of the way to show drop position.

Purpose: Make drag interactions feel premium and polished (iOS home screen style) with clear drop target indication.
Output: Thumbnails animate smoothly to create/collapse space during drag operations.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/4.1-drag-reorder-visual-feedback/4.1-CONTEXT.md
@.planning/phases/04-profile-creation-onboarding/04-03-SUMMARY.md

# Key file to modify:

@src/screens/SelectsScreen.js

**Tech stack available:** react-native-reanimated (useSharedValue, useAnimatedStyle, withTiming, runOnJS)
**Established patterns:** Pan gesture with long press activation, shared values for animation state

**Constraining decisions:**

- Phase 4 04-03: Drag uses absolute Y position for delete zone detection
- Phase 4 04-03: Button/delete bar swap when dragging
- Context: Use withTiming (not withSpring) for smooth, precise animations without bounce

**Animation requirements from CONTEXT.md:**

- iOS home screen style - fluid and responsive, smooth and precise (not bouncy)
- Other thumbnails glide apart to make space, collapse when moved away
- Must be instantly responsive, no lag
- Clear drop target indication at all times
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Add hover index tracking to drag state</name>
  <files>src/screens/SelectsScreen.js</files>
  <action>
Add hover index tracking to SelectsScreen and DraggableThumbnail:

1. In SelectsScreen, add state: `const [hoverIndex, setHoverIndex] = useState(null)`

2. Update DraggableThumbnail props to receive `hoverIndex` and `onHoverIndexChange` callback

3. In DraggableThumbnail's gesture.onUpdate:
   - Calculate target index using existing calculateTargetIndex logic
   - Call `runOnJS(onHoverIndexChange)(targetIndex)` to update parent state
   - This runs on every drag movement to track where item would land

4. In gesture.onStart: Call `runOnJS(onHoverIndexChange)(index)` to initialize

5. In gesture.onEnd/onFinalize: Call `runOnJS(onHoverIndexChange)(null)` to clear

6. Pass hoverIndex and onHoverIndexChange to all DraggableThumbnail instances

Key point: hoverIndex represents "where this item would go if dropped now" and updates in real-time during drag.
</action>
<verify>Add console.log in onHoverIndexChange to confirm index updates during drag movement. Should see index values changing as thumbnail is dragged horizontally.</verify>
<done>hoverIndex state updates in real-time during drag, showing calculated drop position</done>
</task>

<task type="auto">
  <name>Task 2: Animate non-dragged thumbnails based on hover index</name>
  <files>src/screens/SelectsScreen.js</files>
  <action>
Add horizontal shift animation to DraggableThumbnail for non-dragged items:

1. Add new shared value in DraggableThumbnail: `const shiftX = useSharedValue(0)`

2. Add useEffect to calculate and animate shift based on props:

```javascript
useEffect(() => {
  // Only shift if something is being dragged (hoverIndex !== null)
  // and this thumbnail is NOT the one being dragged
  if (hoverIndex === null || draggingIndex === null || draggingIndex === index) {
    shiftX.value = withTiming(0, { duration: 200 });
    return;
  }

  const shiftAmount = THUMBNAIL_SIZE + THUMBNAIL_GAP;

  // Determine if this item needs to shift
  // Items between old position and new position need to move
  if (draggingIndex < hoverIndex) {
    // Dragging right: items in range (draggingIndex, hoverIndex] shift left
    if (index > draggingIndex && index <= hoverIndex) {
      shiftX.value = withTiming(-shiftAmount, { duration: 200 });
    } else {
      shiftX.value = withTiming(0, { duration: 200 });
    }
  } else if (draggingIndex > hoverIndex) {
    // Dragging left: items in range [hoverIndex, draggingIndex) shift right
    if (index >= hoverIndex && index < draggingIndex) {
      shiftX.value = withTiming(shiftAmount, { duration: 200 });
    } else {
      shiftX.value = withTiming(0, { duration: 200 });
    }
  } else {
    shiftX.value = withTiming(0, { duration: 200 });
  }
}, [hoverIndex, draggingIndex, index]);
```

3. Update animatedStyle to include shiftX for non-dragged items:
   - The dragged item uses translateX.value (from gesture)
   - Non-dragged items use shiftX.value (from hover calculation)
   - Combine: `translateX: draggingIndex === index ? translateX.value : shiftX.value`

4. Handle delete zone: When isOverDeleteZone is true in parent, set hoverIndex to null or -1 so all gaps collapse (item is "leaving" the row). Update onHoverIndexChange call in onUpdate to pass null when over delete zone.

5. Use withTiming with duration: 200 (NOT withSpring) for smooth, precise animations without bounce.

Key points:

- 200ms duration feels responsive but smooth
- Items shift the full width of a thumbnail + gap to create visible space
- When dragged item moves toward delete bar, all shifts reset to 0 (gap collapses)
  </action>
  <verify>

1. Long-press and drag a thumbnail horizontally
2. Observe adjacent thumbnails sliding to make space at the drop position
3. Verify animations are smooth (no bounce/overshoot)
4. Verify gap collapses when dragging toward delete bar
5. Verify gap collapses when drag ends
   </verify>
   <done>Thumbnails animate smoothly to create/collapse space based on drag position. Animation uses withTiming (no bounce). Delete zone approach collapses gap.</done>
   </task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Animated thumbnail repositioning during drag-to-reorder</what-built>
  <how-to-verify>
    1. Run: npx expo start
    2. Navigate to SelectsScreen (profile setup step 2)
    3. Add 3+ photos using the picker
    4. Long-press a thumbnail to start dragging
    5. Drag horizontally and verify:
       - Other thumbnails slide smoothly to show drop position
       - No bounce or overshoot in the animations
       - Drop target is always clear (you know where it will land)
       - Movement feels responsive (no lag)
    6. Drag toward delete bar and verify:
       - Gap collapses as item approaches delete zone
       - Smooth transition back if you move away from delete
    7. Release to complete reorder and verify position is correct
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] Hover index tracking works during drag
- [ ] Non-dragged thumbnails animate horizontally to create space
- [ ] Animations use withTiming (smooth, no bounce)
- [ ] Gap collapses when approaching delete zone
- [ ] Drop position is always visually clear
- [ ] No performance issues or jank during drag
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Drag-to-reorder feels like iOS home screen icon rearrangement
- Animations are smooth and precise (not bouncy)
- Visual feedback is responsive and clear
  </success_criteria>

<output>
After completion, create `.planning/phases/4.1-drag-reorder-visual-feedback/04.1-01-SUMMARY.md`:

# Phase 4.1 Plan 1: Drag-Reorder Visual Feedback Summary

**[Substantive one-liner]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `src/screens/SelectsScreen.js` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase 4.1 complete, ready for Phase 5: Profile Screen Layout
</output>
