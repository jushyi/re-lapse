---
phase: 50-cicd-pipeline
plan: 02
type: execute
---

<objective>
Create the EAS Build and EAS Submit GitHub Actions workflows.

Purpose: Complete the three-workflow CI/CD pipeline by adding the build workflow (triggered by version tags and manual dispatch) and the submit workflow (manual dispatch with approval gate documentation).
Output: .github/workflows/eas-build.yml and .github/workflows/eas-submit.yml — ready to use once EXPO_TOKEN is configured as a GitHub Secret.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/50-cicd-pipeline/50-RESEARCH.md
@.planning/phases/50-cicd-pipeline/50-CONTEXT.md
@.planning/phases/50-cicd-pipeline/50-01-SUMMARY.md

# Key source files:

@eas.json
@.github/workflows/pr-checks.yml

**Tech stack available:** EAS CLI >= 16.28.0, expo/expo-github-action@v8, GitHub Actions
**Established patterns:** PR checks workflow structure from 50-01 (checkout, setup-node, expo-github-action pattern)
**Constraining decisions:**

- [50-RESEARCH]: Use `expo/expo-github-action@v8` for EAS CLI setup and EXPO_TOKEN auth
- [50-RESEARCH]: Use `--non-interactive` and `--no-wait` flags for CI builds
- [50-RESEARCH]: Tag-triggered builds (v\*) for production, manual dispatch for any profile
- [50-RESEARCH]: Submit workflow uses `--latest` with production profile filter
- [50-CONTEXT]: iOS only. Manual dispatch support for both build and submit.
- [50-CONTEXT]: Gated submission — human approval required before App Store submission
- [50-RESEARCH]: GitHub Environment approval gates require Pro plan for private repos. If on free plan, workflow_dispatch itself serves as the manual gate.
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Create EAS Build workflow</name>
  <files>.github/workflows/eas-build.yml</files>
  <action>
Create .github/workflows/eas-build.yml with:

**Triggers:**

- push.tags: ['v*'] — automatically builds on version tags
- workflow_dispatch with inputs:
  - platform: choice (ios only for now), required, default "ios"
  - profile: choice (development, preview, production), required, default "production"

**Single job "build"** running on ubuntu-latest:

1. actions/checkout@v4
2. actions/setup-node@v4 with node-version: 22, cache: npm
3. expo/expo-github-action@v8 with eas-version: latest, token: ${{ secrets.EXPO_TOKEN }}
4. npm ci
5. Conditional build step for tag trigger: `eas build --platform ios --profile production --non-interactive --no-wait`
6. Conditional build step for manual trigger: `eas build --platform ios --profile ${{ inputs.profile }} --non-interactive --no-wait`

Use `if: github.event_name == 'push'` for the tag step and `if: github.event_name == 'workflow_dispatch'` for the manual step.

The `--no-wait` flag is critical — it queues the build on EAS servers and returns immediately. The CI job doesn't need to wait for the 10-20 min native build to complete. Build status is visible on expo.dev.

Use descriptive step names: "Checkout code", "Setup Node.js", "Setup EAS CLI", "Install dependencies", "Build iOS (release tag)", "Build iOS (manual)".
</action>
<verify>
Verify YAML exists and has both trigger types: check the file contains both "push:" with "tags:" and "workflow_dispatch:" with "inputs:".
Verify the EXPO_TOKEN secret reference: check the file contains `secrets.EXPO_TOKEN`.
Verify --non-interactive and --no-wait flags are present in both build commands.
</verify>
<done>eas-build.yml triggers on v\* tags (production profile) and manual dispatch (selectable profile). Uses expo-github-action@v8 with EXPO_TOKEN. Builds queue on EAS with --no-wait.</done>
</task>

<task type="auto">
  <name>Task 2: Create EAS Submit workflow</name>
  <files>.github/workflows/eas-submit.yml</files>
  <action>
Create .github/workflows/eas-submit.yml with:

**Trigger:** workflow_dispatch only (manual trigger from GitHub Actions UI). No automatic triggers — submission must always be deliberate.

**Single job "submit"** running on ubuntu-latest:

- Add `environment: app-store-production` to the job — this enables the GitHub Environment approval gate (requires reviewer approval before job runs). Include a YAML comment explaining that this requires GitHub Pro for private repos, and that on free plan the manual workflow_dispatch trigger itself serves as the approval gate.

Steps:

1. actions/checkout@v4
2. actions/setup-node@v4 with node-version: 22, cache: npm
3. expo/expo-github-action@v8 with eas-version: latest, token: ${{ secrets.EXPO_TOKEN }}
4. npm ci
5. `eas submit --platform ios --profile production --latest --non-interactive`

Add a YAML comment above the submit step warning about the `--latest` flag: it picks the most recent successful build for the platform. Ensure no dev/preview builds have completed after the production build before submitting. Alternative: use `--id <build-id>` for precise build selection.

Use descriptive step names: "Checkout code", "Setup Node.js", "Setup EAS CLI", "Install dependencies", "Submit to App Store".

Do NOT use `--auto-submit` on the build workflow — always keep build and submit as separate, gated workflows.
</action>
<verify>
Verify YAML exists and uses workflow_dispatch trigger only (no push, no pull_request triggers).
Verify the environment reference: check file contains `environment: app-store-production`.
Verify --non-interactive flag is present on the submit command.
Verify --latest flag is present (submits most recent production build).
</verify>
<done>eas-submit.yml triggers only via manual dispatch, references app-store-production environment for approval gate, submits latest production iOS build to App Store Connect.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] .github/workflows/eas-build.yml exists with tag + manual dispatch triggers
- [ ] .github/workflows/eas-submit.yml exists with manual dispatch only
- [ ] Both workflows use expo/expo-github-action@v8 with EXPO_TOKEN
- [ ] Build workflow uses --non-interactive --no-wait
- [ ] Submit workflow uses --non-interactive --latest
- [ ] Submit workflow references app-store-production environment
- [ ] All three workflow files (.github/workflows/) are present: pr-checks, eas-build, eas-submit
</verification>

<success_criteria>

- EAS Build workflow triggers on version tags and manual dispatch
- EAS Submit workflow requires manual trigger with environment approval gate
- Both workflows use proper EAS CLI flags for non-interactive CI execution
- Three-workflow pipeline is complete (pr-checks from 50-01, eas-build and eas-submit from this plan)
  </success_criteria>

<output>
After completion, create `.planning/phases/50-cicd-pipeline/50-02-SUMMARY.md`
</output>
