---
phase: 50-cicd-pipeline
plan: 03
type: execute
---

<objective>
Set up GitHub Secrets, configure the approval environment, and verify the pipeline works.

Purpose: The workflow files are created but need credentials (EXPO_TOKEN) and environment configuration (approval gate) to function. This plan walks through the interactive setup steps and verifies everything works end-to-end.
Output: EXPO_TOKEN configured as GitHub Secret, app-store-production environment created (if applicable), and PR checks verified working on a real PR.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/50-cicd-pipeline/50-RESEARCH.md
@.planning/phases/50-cicd-pipeline/50-CONTEXT.md
@.planning/phases/50-cicd-pipeline/50-01-SUMMARY.md
@.planning/phases/50-cicd-pipeline/50-02-SUMMARY.md

# Key source files:

@.github/workflows/pr-checks.yml
@.github/workflows/eas-build.yml
@.github/workflows/eas-submit.yml

**Constraining decisions:**

- [50-RESEARCH]: EXPO_TOKEN created at expo.dev/accounts/[account]/settings/access-tokens
- [50-RESEARCH]: GitHub Environment approval gates require Pro for private repos
- [50-RESEARCH]: Workflow YAML must be on the default branch (main) for tag triggers to work
- [50-CONTEXT]: User is new to GitHub Secrets — needs clear step-by-step guidance
  </context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <action>Create EXPO_TOKEN and add it as a GitHub Secret</action>
  <instructions>
I'll guide you through creating the EXPO_TOKEN that all CI workflows need.

**Step 1: Create an Expo access token**

1. Go to https://expo.dev — sign in with your Expo account (owner: spoodsjs)
2. Click your avatar (top-right) → "Account Settings"
3. Navigate to "Access Tokens" in the left sidebar
4. Click "Create Token"
5. Name it: `github-actions-ci`
6. Select type: "Robot" (recommended for CI — not tied to your personal session)
7. Copy the token immediately — you won't see it again

**Step 2: Add the token as a GitHub Secret**

1. Go to your GitHub repository → Settings → Secrets and variables → Actions
2. Click "New repository secret"
3. Name: `EXPO_TOKEN`
4. Value: paste the token from Step 1
5. Click "Add secret"

The token is now available to all three workflows as `${{ secrets.EXPO_TOKEN }}`.
</instructions>
<verification>The secret shows as "EXPO_TOKEN" in the repository's Actions secrets list (the value is masked but the name is visible)</verification>
<resume-signal>Type "done" when EXPO_TOKEN is added as a GitHub Secret</resume-signal>
</task>

<task type="checkpoint:human-action" gate="optional">
  <action>Create GitHub Environment for App Store submission approval gate</action>
  <instructions>
This step adds a required reviewer approval before App Store submissions can run. This is an extra safety layer on top of the manual dispatch trigger.

**Note:** This feature requires GitHub Pro ($4/mo) for private repos. It works free on public repos. If your repo is private and on the free plan, you can skip this — the manual workflow_dispatch trigger already prevents accidental submissions. The submit workflow will still work; it just won't have the extra approval step.

**If you want to set it up:**

1. Go to your GitHub repository → Settings → Environments
2. Click "New environment"
3. Name: `app-store-production`
4. Under "Environment protection rules", check "Required reviewers"
5. Add yourself as a reviewer
6. Click "Save protection rules"

**If skipping (private repo on free plan):**
That's fine — the eas-submit.yml workflow already requires manual dispatch from the Actions UI. No one can accidentally trigger a submission.
</instructions>
<verification>Either the environment "app-store-production" appears in Settings → Environments with yourself as required reviewer, or you've decided to skip this step</verification>
<resume-signal>Type "done" if created, or "skipped" if not applicable</resume-signal>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete three-workflow CI/CD pipeline (pr-checks, eas-build, eas-submit) with production build config and GitHub Secrets</what-built>
  <how-to-verify>
    1. **Verify workflow files are committed:** Check that .github/workflows/ contains pr-checks.yml, eas-build.yml, and eas-submit.yml
    2. **Verify GitHub Secret exists:** Go to repo Settings → Secrets → Actions and confirm EXPO_TOKEN is listed
    3. **Verify PR checks trigger:** The workflow files need to be on the main branch to trigger on PRs. Once the prelaunch branch is merged to main (or workflows are pushed to main), create a test PR — the PR Checks workflow should appear in the PR's "Checks" tab
    4. **Verify build workflow is visible:** Go to Actions tab — you should see "EAS Build" and "Submit to App Store" listed as available workflows with "Run workflow" buttons
    5. **Verify config changes:** Run locally: `node -e "const c = require('./app.config.js')(); console.log('aps-env:', c.ios.entitlements['aps-environment'])"` — should show "development"

    **Note:** The EAS Build and Submit workflows can't be fully tested until Phase 51 (iOS Release Preparation) establishes Apple credentials via an initial interactive `eas build`. That's expected — Phase 50 creates the pipeline, Phase 51 makes it operational.

  </how-to-verify>
  <resume-signal>Type "approved" to complete the phase, or describe any issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] EXPO_TOKEN exists as a GitHub Secret
- [ ] GitHub Environment created (or deliberately skipped with rationale)
- [ ] All three workflow files present in .github/workflows/
- [ ] Pipeline visible in GitHub Actions tab
- [ ] Config files (app.config.js, eas.json) updated for production builds
</verification>

<success_criteria>

- EXPO_TOKEN configured as GitHub Secret
- GitHub Environment approval gate set up (or documented as skipped)
- All three workflows visible in GitHub Actions tab
- Pipeline ready for use once Apple credentials are established in Phase 51
- Phase 50 complete
  </success_criteria>

<output>
After completion, create `.planning/phases/50-cicd-pipeline/50-03-SUMMARY.md`:

# Phase 50 Plan 03: Secrets Setup & Pipeline Verification Summary

**[Substantive one-liner]**

## Accomplishments

- [Key outcomes]

## Files Created/Modified

- [Files list]

## Decisions Made

- [Decisions or "None"]

## Issues Encountered

- [Issues or "None"]

## Next Step

Phase 50 complete, ready for Phase 51 (iOS Release Preparation)
</output>
