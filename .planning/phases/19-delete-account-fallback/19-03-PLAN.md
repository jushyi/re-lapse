---
phase: 19-delete-account-fallback
plan: 03
type: execute
---

<objective>
Redesign DeleteAccountScreen with Instagram-style 30-day explanation, download photos option, and updated flow to schedule deletion instead of immediate delete.

Purpose: Clear communication about what happens, easy photo export, and scheduled (not immediate) deletion.
Output: Redesigned DeleteAccountScreen with download option and 30-day grace period flow.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/19-delete-account-fallback/19-CONTEXT.md
@src/screens/DeleteAccountScreen.js
@src/services/firebase/accountService.js
@src/services/downloadPhotosService.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Redesign warning step with 30-day explanation and download button</name>
  <files>src/screens/DeleteAccountScreen.js</files>
  <action>
Update the warning step (first screen) with new content and download option:

**New Warning Content:**

- Title: "Delete Account"
- Icon: Keep warning icon
- Explanation box with:
  - "Your account will be scheduled for deletion in **30 days**"
  - "During this time, you can cancel by logging back in"
  - "After 30 days, the following will be permanently deleted:"
  - Bullet list: All your photos, Your friend connections, Your profile and account data

**Download Section (new):**

- Add section between explanation and buttons
- Heading: "Save Your Memories"
- Subtext: "Download all your photos to your camera roll before deleting"
- Button: "Download All Photos" (outline style, colors.brand.primary border)
- When tapped:
  1. Request permission via requestMediaLibraryPermission()
  2. If denied, show alert explaining why permission is needed
  3. If granted, show DownloadProgress component (replace button area)
  4. Call downloadAllPhotos with progress callback
  5. On complete, show success message, re-enable proceed button

**Button Changes:**

- Primary button: "Schedule Deletion" (was "I understand, delete my account")
- Cancel button: Keep as is
- Disable "Schedule Deletion" during download (re-enable after complete or if skipped)

Add state: downloadStatus ('idle' | 'downloading' | 'complete' | 'error'), downloadProgress ({ current, total })
</action>
<verify>Screen renders with new layout, download button triggers download flow</verify>
<done>Warning step shows 30-day explanation, download section with progress, and Schedule Deletion button</done>
</task>

<task type="auto">
  <name>Task 2: Update deletion flow to schedule instead of immediate delete</name>
  <files>src/screens/DeleteAccountScreen.js</files>
  <action>
Update the flow after phone verification succeeds:

**Changes to handleDeleteAccount:**

1. Rename to `handleScheduleDeletion`
2. Call `scheduleAccountDeletion()` instead of `deleteUserAccount()`
3. On success:
   - Show success alert: "Account Scheduled for Deletion"
   - Message: "Your account will be deleted on {date}. You can cancel anytime by logging back in."
   - On alert dismiss, call signOut() from AuthContext
4. On failure:
   - Keep existing error handling (preserve account, show retry option)

**Update step flow:**

- After verification success, call handleScheduleDeletion
- Remove the 'deleting' step (no longer needed - deletion is scheduled, not immediate)
- Replace with brief "Scheduling..." state if needed

**Update renderDeletingStep:**

- Rename to renderSchedulingStep
- Text: "Scheduling deletion..." instead of "Deleting account..."
- Subtext: "Please wait while we process your request"

**Sign out after scheduling:**

- Import signOut from AuthContext
- Call signOut() after showing success alert
- User returns to login screen (auth state listener handles navigation)

**Import changes:**

- Add: scheduleAccountDeletion from accountService
- Add: signOut from useAuth hook
- Add: downloadAllPhotos, requestMediaLibraryPermission from downloadPhotosService
- Add: DownloadProgress component
  </action>
  <verify>Flow schedules deletion, shows success with date, signs out user</verify>
  <done>Deletion is scheduled (not immediate), user sees confirmation with date, gets signed out</done>
  </task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Redesigned DeleteAccountScreen with download option and 30-day scheduled deletion</what-built>
  <how-to-verify>
    1. Run: npx expo start
    2. Navigate: Settings → Delete Account
    3. Verify: Warning shows "30 days" explanation and download section
    4. Test: Tap "Download All Photos" - should request permission and download
    5. Test: Tap "Schedule Deletion" → verify phone → confirm scheduling
    6. Verify: Success alert shows date 30 days from now
    7. Verify: After dismissing alert, user is signed out
    8. Verify: In Firebase Console, user doc has scheduledForDeletionAt field
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Warning step shows 30-day explanation
- [ ] Download All Photos button works with progress
- [ ] Schedule Deletion calls scheduleAccountDeletion (not deleteUserAccount)
- [ ] Success alert shows scheduled date
- [ ] User is signed out after scheduling
</verification>

<success_criteria>

- All tasks completed
- Download flow works with permission handling
- Deletion is scheduled (user doc has scheduledForDeletionAt)
- User is signed out after scheduling
- Clear communication about 30-day grace period
  </success_criteria>

<output>
After completion, create `.planning/phases/19-delete-account-fallback/19-03-SUMMARY.md`
</output>
