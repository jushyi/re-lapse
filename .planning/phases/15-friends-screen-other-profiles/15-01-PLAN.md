---
phase: 15-friends-screen-other-profiles
plan: 01
type: execute
---

<objective>
Redesign the friends screen with a unified tabbed interface combining friends list, requests, and user search into a single cohesive experience.

Purpose: Create a fresh, modern friends screen that consolidates FriendsListScreen, FriendRequestsScreen, and UserSearchScreen functionality into one intuitive interface with Requests | Friends tabs.
Output: Single FriendsScreen with tabbed navigation, unified FriendCard component, and search functionality in both tabs.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/15-friends-screen-other-profiles/15-CONTEXT.md

# Current implementation (to be replaced):

@src/screens/FriendsListScreen.js
@src/screens/FriendRequestsScreen.js
@src/screens/UserSearchScreen.js
@src/components/FriendRequestCard.js
@src/components/UserSearchCard.js

# Service layer (already complete):

@src/services/firebase/friendshipService.js

**Prior decisions:**

- Card layout similar to comments section â€” avatar left, names middle, action button right
- Two-tab structure: Requests | Friends
- Both tabs have search bars
- Requests tab: incoming/outgoing sections + search to add users
- Friends tab: friend list with filter search

**Design guidance from CONTEXT.md:**

- Fresh design that works well for list/card context
- Action button changes based on relationship (Add Friend, Accept/Deny, Cancel, Remove)
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Create unified FriendCard component</name>
  <files>src/components/FriendCard.js, src/styles/FriendCard.styles.js</files>
  <action>
Create a new FriendCard component that handles ALL relationship states with a consistent card layout:

**Layout:** Avatar (50x50) left | Name/username middle | Action button right

**Props:**

- user: { userId, displayName, username, profilePhotoURL }
- relationshipStatus: 'none' | 'friends' | 'pending_sent' | 'pending_received'
- friendshipId: string (for request actions)
- onAction: callback for primary action
- onPress: callback for card tap (navigate to profile)
- showFriendsSince: boolean (only in friends list)
- friendsSince: Date (if applicable)

**Action button by status:**

- 'none': Purple "Add" button
- 'friends': No button (or subtle remove on long press)
- 'pending_sent': Gray "Pending" button that triggers cancel confirmation
- 'pending_received': Two buttons - green "Accept" and red "Deny"

**Styling:**

- Dark theme using colors from constants
- Avatar: 50x50 circular, placeholder with initial if no photo
- Names: displayName bold (16pt), @username secondary (14pt)
- Cards: subtle separator between items, no heavy borders
- Action buttons: rounded, compact, color-coded by action type

This replaces both FriendRequestCard and UserSearchCard.
</action>
<verify>Component renders without errors, all relationship states display correct buttons</verify>
<done>FriendCard component exists, handles all relationship states, consistent styling</done>
</task>

<task type="auto">
  <name>Task 2: Create unified FriendsScreen with tabs</name>
  <files>src/screens/FriendsScreen.js, src/styles/FriendsScreen.styles.js</files>
  <action>
Create new FriendsScreen that consolidates all friends functionality:

**Structure:**

```
Header: "Friends" title + back button
Tabs: [Requests] [Friends]
Tab content area with search + list
```

**Requests Tab:**

- Search bar at top (searches users to add, like UserSearchScreen)
- When search empty: Show two sections:
  - "Incoming" section with pending_received requests (Accept/Deny)
  - "Sent" section with pending_sent requests (Cancel)
- When searching: Show search results with Add/Pending/Accept buttons
- Empty states for no requests / no search results

**Friends Tab:**

- Search bar at top (filters existing friends by name/username)
- List of accepted friends using FriendCard (showFriendsSince=true)
- Long press to remove friend (with confirmation)
- Empty state for no friends

**Tab implementation:**

- Use simple state-based tabs (not @react-navigation/material-top-tabs)
- Underline indicator on active tab (purple accent)
- Badge count on Requests tab when incoming requests exist

**Data fetching:**

- Use existing friendshipService functions
- Real-time listener via subscribeFriendships
- For search: query users collection by username prefix (like UserSearchScreen)

**Navigation:**

- Card tap navigates to Profile with userId param (to be wired in Plan 15-03)
- Back button returns to previous screen
  </action>
  <verify>Both tabs work, search functions, requests show/hide correctly, friend actions work</verify>
  <done>FriendsScreen with Requests | Friends tabs, search in both, all actions working</done>
  </task>

<task type="auto">
  <name>Task 3: Update navigation and remove old screens</name>
  <files>src/navigation/AppNavigator.js, src/screens/index.js, src/components/index.js</files>
  <action>
Update navigation to use new FriendsScreen:

**AppNavigator.js:**

- Replace FriendsListScreen with FriendsScreen at the 'FriendsList' route
- Remove FriendRequests and UserSearch routes (no longer needed as separate screens)
- Update imports

**Clean up:**

- Remove old screen files: FriendsListScreen.js, FriendRequestsScreen.js, UserSearchScreen.js
- Remove old component files: FriendRequestCard.js, UserSearchCard.js
- Update screens/index.js exports
- Update components/index.js exports
- Add FriendCard to components/index.js

**Update ProfileScreen:**

- handleFriendsPress already navigates to 'FriendsList' - no change needed
  </action>
  <verify>Navigation works, no broken imports, app builds without errors</verify>
  <done>Old screens removed, new FriendsScreen at FriendsList route, clean imports</done>
  </task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Unified Friends screen with Requests | Friends tabs</what-built>
  <how-to-verify>
    1. Run: npx expo start
    2. Navigate to Profile tab, tap Friends icon (people-outline)
    3. Verify Requests | Friends tabs appear
    4. **Friends tab:** See friends list (if any), test search filter, long-press to remove
    5. **Requests tab (no search):** See Incoming/Sent sections with pending requests
    6. **Requests tab (search):** Type a username, see search results with Add buttons
    7. Test Add Friend flow - button should change to "Pending"
    8. Test Accept/Deny on incoming request
    9. Verify card layout: avatar left, names middle, button right
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] FriendCard component renders all relationship states correctly
- [ ] FriendsScreen loads with Requests | Friends tabs
- [ ] Friends tab search filters existing friends
- [ ] Requests tab search finds users to add
- [ ] All friend actions work (add, accept, deny, cancel, remove)
- [ ] Old screens and components removed
- [ ] App builds without errors
- [ ] No TypeScript/ESLint errors
</verification>

<success_criteria>

- Unified FriendCard component handling all relationship states
- Single FriendsScreen with tabbed interface
- Both tabs have functional search
- All friend request actions work
- Old fragmented screens removed
- Navigation updated and working
  </success_criteria>

<output>
After completion, create `.planning/phases/15-friends-screen-other-profiles/15-01-SUMMARY.md`
</output>
