---
phase: 15-friends-screen-other-profiles
plan: 03
type: execute
---

<objective>
Wire universal profile navigation by making all user avatars throughout the app tappable to view that user's profile.

Purpose: Enable consistent, discoverable navigation to user profiles from anywhere avatars appear — stories bar, comments, reactions, friend cards, notifications.
Output: Tapping any user avatar in the app navigates to their profile screen.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/15-friends-screen-other-profiles/15-CONTEXT.md
@.planning/phases/15-friends-screen-other-profiles/15-01-SUMMARY.md
@.planning/phases/15-friends-screen-other-profiles/15-02-SUMMARY.md

# Components with user avatars (from grep):

@src/components/FriendStoryCard.js
@src/components/MeStoryCard.js
@src/components/StoriesViewerModal.js
@src/components/comments/CommentRow.js
@src/components/PhotoDetailModal.js
@src/components/FeedPhotoCard.js

# FriendCard already handles this from Plan 15-01

**From CONTEXT.md:**
"Tapping anyone's avatar anywhere in the app (story cards, comments, reactions, friend cards) opens their full profile. Universal, consistent navigation."
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire avatar navigation in stories components</name>
  <files>src/components/FriendStoryCard.js, src/components/StoriesViewerModal.js</files>
  <action>
Add profile navigation when tapping user avatars in stories:

**FriendStoryCard.js:**

- Add onAvatarPress prop (callback with userId)
- Wrap the profile photo in TouchableOpacity
- When avatar tapped, call onAvatarPress(userId) instead of opening story
- Keep main card tap for opening story viewer

```jsx
// Add prop
onAvatarPress: (PropTypes.func,
  (
    // In render, wrap avatar
    <TouchableOpacity onPress={() => onAvatarPress?.(userId)} activeOpacity={0.7}>
      <View style={styles.profilePhotoContainer}>{/* existing profile photo render */}</View>
    </TouchableOpacity>
  ));
```

**FeedScreen.js (where FriendStoryCard is used):**

- Pass onAvatarPress that navigates to ProfileMain with userId
- Use navigation.navigate('ProfileMain', { userId, username })

**StoriesViewerModal.js:**

- The header shows current story owner's avatar and name
- Make avatar tappable to navigate to profile
- Close modal first, then navigate
- Pass onAvatarPress prop from FeedScreen

**MeStoryCard.js:**

- This is the user's own card (leftmost in stories bar)
- Avatar tap should navigate to own profile
- Use navigation.navigate('ProfileMain') (no userId = own profile)
  </action>
  <verify>Tapping avatar on story cards navigates to profile (not opens story)</verify>
  <done>FriendStoryCard, MeStoryCard, StoriesViewerModal avatar taps navigate to profile</done>
  </task>

<task type="auto">
  <name>Task 2: Wire avatar navigation in comments and reactions</name>
  <files>src/components/comments/CommentRow.js, src/components/PhotoDetailModal.js</files>
  <action>
Add profile navigation when tapping avatars in comments and reactions:

**CommentRow.js:**

- Add onAvatarPress prop
- Wrap commenter's avatar in TouchableOpacity
- Call onAvatarPress(comment.userId, comment.username)

```jsx
<TouchableOpacity
  onPress={() => onAvatarPress?.(comment.userId, comment.username)}
  activeOpacity={0.7}
>
  <Image source={{ uri: comment.userPhotoURL }} style={styles.avatar} />
</TouchableOpacity>
```

**CommentsBottomSheet.js (or where CommentRow is rendered):**

- Pass onAvatarPress that navigates to ProfileMain
- Close bottom sheet first, then navigate

**PhotoDetailModal.js:**

- Reactions section shows who reacted
- Each reaction row has user avatar
- Make avatars tappable to navigate to profile
- Close modal first, then navigate

Check if reactions are displayed inline or in a separate view:

- If inline emoji badges, may need to show "who reacted" tappable list
- If there's already a reactions list view, add avatar tap handling
  </action>
  <verify>Tapping avatar in comments navigates to profile, same for reactions</verify>
  <done>CommentRow and PhotoDetailModal avatar taps navigate to profiles</done>
  </task>

<task type="auto">
  <name>Task 3: Wire avatar navigation in remaining components</name>
  <files>src/components/FeedPhotoCard.js, src/screens/ActivityScreen.js</files>
  <action>
Complete avatar navigation in remaining components:

**FeedPhotoCard.js:**

- Shows photo author's name/avatar at top of feed card
- Make avatar tappable to navigate to author's profile
- Check if avatar exists, add TouchableOpacity wrapper
- Pass navigation callback or use useNavigation hook

**ActivityScreen.js (Notifications):**

- Notification items often show who performed the action
- If notifications have user avatars, make them tappable
- Navigate to the actor's profile
- Pattern: "John liked your photo" — tap John's avatar → John's profile

**FriendCard.js (from Plan 15-01):**

- Already has onPress prop for card tap
- Verify it navigates to ProfileMain with userId
- If not implemented, add navigation in FriendsScreen

**Navigation pattern to use consistently:**

```javascript
const handleAvatarPress = (userId, username) => {
  // Close any open modals/sheets first if needed
  navigation.navigate('ProfileMain', { userId, username });
};
```

Note: For own profile (when userId matches current user), can navigate without params or with userId — ProfileScreen handles both via isOwnProfile check.
</action>
<verify>All avatars throughout app navigate to profiles when tapped</verify>
<done>FeedPhotoCard, ActivityScreen, and any remaining avatar locations wired</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Universal avatar navigation throughout the app</what-built>
  <how-to-verify>
    1. Run: npx expo start
    2. **Stories bar:** Tap a friend's avatar (not the card) in stories bar
       - Verify: Navigates to their profile
    3. **Own story:** Tap your own avatar in MeStoryCard
       - Verify: Navigates to your profile
    4. **Story viewer:** Open a story, tap the avatar in the header
       - Verify: Modal closes, navigates to profile
    5. **Comments:** Open a photo, open comments, tap a commenter's avatar
       - Verify: Bottom sheet closes, navigates to profile
    6. **Feed card:** Tap the author avatar on a feed photo card
       - Verify: Navigates to author's profile
    7. **Friends screen:** Tap a friend card in Friends tab
       - Verify: Navigates to their profile
    8. **Notifications:** If notification has avatar, tap it
       - Verify: Navigates to that user's profile
    9. **Profile content:** When viewing profile, verify content visibility matches friendship
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] FriendStoryCard avatar tap navigates to profile
- [ ] MeStoryCard avatar tap navigates to own profile
- [ ] StoriesViewerModal avatar tap closes modal and navigates
- [ ] CommentRow avatar tap closes sheet and navigates
- [ ] FeedPhotoCard author avatar navigates to profile
- [ ] FriendCard in Friends screen navigates to profile
- [ ] Notifications with avatars navigate to profile
- [ ] No navigation crashes or stuck states
- [ ] Modal/sheet cleanup before navigation works correctly
</verification>

<success_criteria>

- Consistent avatar tap behavior across all components
- Smooth navigation flow (modals/sheets close first)
- All user touchpoints lead to profile viewing
- Phase 15 complete: Friends screen, profile viewing, avatar navigation all working
  </success_criteria>

<output>
After completion, create `.planning/phases/15-friends-screen-other-profiles/15-03-SUMMARY.md`

Include in summary:

- Phase 15 complete status
- All three parts working: Friends screen, Profile viewing, Avatar navigation
  </output>
