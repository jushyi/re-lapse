---
phase: 18.3-success-sound
plan: 01
type: execute
---

<objective>
Add celebratory sound effect when user completes photo triage in darkroom.

Purpose: Create a satisfying audio celebration moment that syncs with the sparkles animation when all photos are triaged.
Output: Sound plays automatically during success state, respects iOS silent mode.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18.3-success-sound/18.3-RESEARCH.md
@.planning/phases/18.3-success-sound/18.3-CONTEXT.md

# Key files:
@src/screens/DarkroomScreen.js
@assets/theburntpeanut-hooray.mp3

**Constraints from research:**
- Use expo-av for audio playback
- Default behavior respects iOS silent mode (playsInSilentModeIOS: false)
- Must call unloadAsync() after playback to prevent memory leaks
- Sound triggers at lines 216-224 in DarkroomScreen.js (useEffect for success state)

**Established patterns:**
- Service/utility files use camelCase (soundUtils.js)
- Error handling returns { success, error } objects
- Logger used throughout for debugging
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install expo-av and create sound utility</name>
  <files>package.json, src/utils/soundUtils.js</files>
  <action>
1. Install expo-av:
   ```bash
   npx expo install expo-av
   ```

2. Create src/utils/soundUtils.js with playSuccessSound function:
   - Import Audio from expo-av
   - Import logger from ./logger
   - Export async function playSuccessSound() that:
     a. Loads the sound file with Audio.Sound.createAsync(require('../../assets/theburntpeanut-hooray.mp3'))
     b. Plays the sound with sound.playAsync()
     c. Sets up onPlaybackStatusUpdate listener to unloadAsync() when didJustFinish is true
     d. Wraps in try/catch, logs errors but does NOT throw (silent failure - sound is enhancement, not critical)
   - Follow codebase logging conventions (logger.debug for start, logger.info for success, logger.error for failures)
   - NO setAudioModeAsync call needed - default behavior already respects silent mode

**What to avoid:**
- Do NOT set playsInSilentModeIOS: true - user specifically requested silent mode respect
- Do NOT create a custom hook or preloading - the sound only plays once per triage session, simple load-play-unload is sufficient
- Do NOT forget unloadAsync() - this causes memory leaks
  </action>
  <verify>
1. Check package.json includes expo-av
2. File src/utils/soundUtils.js exists with playSuccessSound export
3. No lint/syntax errors: `npx expo doctor`
  </verify>
  <done>
- expo-av installed in package.json
- soundUtils.js exports playSuccessSound function
- Function loads, plays, and unloads sound with proper error handling
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate success sound into DarkroomScreen</name>
  <files>src/screens/DarkroomScreen.js</files>
  <action>
1. Add import at top of DarkroomScreen.js:
   ```javascript
   import { playSuccessSound } from '../utils/soundUtils';
   ```

2. Modify the useEffect at lines 216-224 to play sound when success animation starts:
   - Add playSuccessSound() call inside the if block, right after the Animated.timing().start() call
   - The sound will play in parallel with the fade animation (350ms duration)

The modified useEffect should look like:
```javascript
useEffect(() => {
  if ((triageComplete || pendingSuccess) && photos.length === 0) {
    Animated.timing(successFadeAnim, {
      toValue: 1,
      duration: 350,
      useNativeDriver: true,
    }).start();

    // Play success sound in sync with animation
    playSuccessSound();
  }
}, [triageComplete, pendingSuccess, photos.length, successFadeAnim]);
```

**What to avoid:**
- Do NOT await playSuccessSound() - fire and forget, don't block the UI
- Do NOT add sound to dependencies array - it's not reactive state
- Do NOT add any user-facing error handling - sound is enhancement, silent failures are fine
  </action>
  <verify>
1. DarkroomScreen.js imports playSuccessSound
2. playSuccessSound() is called in the success state useEffect
3. No lint/syntax errors
4. Manual test: Triage all photos in darkroom, verify sound plays when success state appears
  </verify>
  <done>
- DarkroomScreen imports and calls playSuccessSound
- Sound plays when success state animation begins
- Sound respects iOS silent mode (no sound when device is muted)
  </done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] expo-av is installed (check package.json)
- [ ] soundUtils.js exists with playSuccessSound function
- [ ] DarkroomScreen.js imports and uses playSuccessSound
- [ ] Manual test on iOS device: complete photo triage, sound plays with sparkles
- [ ] Manual test with device on silent: no sound plays
- [ ] No memory leaks (sound unloads after playback)
</verification>

<success_criteria>

- expo-av installed and configured
- soundUtils.js created with proper error handling and cleanup
- Success sound plays in sync with fade animation
- Sound respects iOS silent mode
- No memory leaks from audio playback
</success_criteria>

<output>
After completion, create `.planning/phases/18.3-success-sound/18.3-01-SUMMARY.md`:

# Phase 18.3 Plan 01: Success Sound Effect Summary

**[Substantive one-liner about what shipped]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `src/utils/soundUtils.js` - New sound utility with playSuccessSound function
- `src/screens/DarkroomScreen.js` - Added success sound integration
- `package.json` - Added expo-av dependency

## Decisions Made

[Any decisions made during implementation]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase 18.3 complete, ready for Phase 18.4 (Triage Animation Z-Index & Delete Suction Effect)
</output>
