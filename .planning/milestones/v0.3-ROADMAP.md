# Milestone v0.3: Firebase SDK Consolidation

**Status:** âœ… SHIPPED 2026-01-19
**Phases:** 9-10
**Total Plans:** 4

## Overview

This milestone migrated all Firebase operations from the Firebase JavaScript SDK to React Native Firebase SDK, eliminating dual-SDK issues and unifying auth state across all Firebase operations (Auth, Firestore, Storage).

## Phases

### Phase 9: Firestore Services Migration

**Goal**: Migrate all Firestore service files to React Native Firebase SDK
**Depends on**: Phase 6 (Phone Auth established RN Firebase pattern)
**Plans**: 2 plans

Plans:

- [x] 09-01: Core Photo Services Migration (photoService.js, darkroomService.js)
- [x] 09-02: Social Services Migration (feedService.js, friendshipService.js)

**Details:**

Migrated 30 functions across 4 service files:

- photoService.js: 9 functions (createPhoto, getUserPhotos, getDevelopingPhotoCount, getDarkroomCounts, getDevelopingPhotos, revealPhotos, triagePhoto, addReaction, removeReaction)
- darkroomService.js: 4 functions (getDarkroom, isDarkroomReadyToReveal, scheduleNextReveal, calculateNextRevealTime)
- feedService.js: 6 functions (getFeedPhotos, subscribeFeedPhotos, getPhotoById, getUserFeedPhotos, getFeedStats, toggleReaction)
- friendshipService.js: 11 functions (generateFriendshipId, sendFriendRequest, acceptFriendRequest, declineFriendRequest, removeFriend, getFriendships, getPendingRequests, getSentRequests, checkFriendshipStatus, subscribeFriendships, getFriendUserIds)

Key patterns established:

- RN Firebase method chaining: `firestore().collection().doc().get()`
- Filter.or for OR queries: `.where(Filter.or(Filter.where(), Filter.where()))`
- serverTimestamp via `firestore.FieldValue.serverTimestamp()`

---

### Phase 10: Storage Migration & Cleanup

**Goal**: Migrate storage service to RN Firebase and remove JS SDK
**Depends on**: Phase 9
**Plans**: 2 plans

Plans:

- [x] 10-01: Storage Service Migration (storageService.js)
- [x] 10-02: Remaining Services & Cleanup (userService.js, screen components, remove JS SDK)

**Details:**

10-01 Storage Service Migration:

- Installed @react-native-firebase/storage@23.8.2
- Migrated 5 storage functions to RN Firebase pattern
- Implemented putFile pattern (accepts local paths, no blob conversion)
- Added uriToFilePath helper for Expo ImageManipulator URI compatibility

10-02 Remaining Services & Cleanup:

- Migrated userService.js (2 functions)
- Migrated 4 screen/component files with direct Firestore queries
- Deleted firebaseConfig.js (JS SDK initialization)
- Deleted firestoreService.js (unused legacy functions)
- Cleaned up index.js exports

---

## Milestone Summary

**Key Decisions:**

- RN Firebase method chaining pattern (Rationale: Consistent with SDK conventions)
- Filter.or for OR queries (Rationale: JS SDK or() unavailable in RN Firebase)
- putFile over uploadBytes (Rationale: Eliminates blob conversion overhead)
- Delete firestoreService.js (Rationale: Unused legacy functions)
- Delete firebaseConfig.js (Rationale: JS SDK init no longer needed)

**Issues Resolved:**

- Auth state mismatch between JS SDK Firestore and RN Firebase Auth
- Photo uploads failing with permission denied errors
- Friendship queries failing with OR query syntax errors

**Issues Deferred:**

- RN Firebase v23 uses deprecated namespaced API (warnings only, functional)

**Technical Debt Incurred:**

None - clean migration with full JS SDK removal.

---

_For current project status, see .planning/ROADMAP.md_
