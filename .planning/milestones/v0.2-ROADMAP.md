# Milestone v0.2: Phone Authentication

**Status:** SHIPPED 2026-01-19
**Phases:** 6-8
**Total Plans:** 8 (including 1 FIX plan)

## Overview

Migrated authentication from email/Apple Sign-In to phone-only with SMS verification using React Native Firebase. Removed all legacy authentication code and added polish including error boundaries, phone formatting, and custom app branding.

## Phases

### Phase 6: Phone Auth Implementation

**Goal**: Set up Firebase phone authentication with phone number input UI and SMS code verification
**Depends on**: v0.1 complete
**Plans**: 4 plans

Plans:

- [x] 06-01: React Native Firebase setup (dependencies, app.json, Firebase Console)
- [x] 06-02: Phone auth service and screens (phoneAuthService, PhoneInput, Verification)
- [x] 06-FIX: Phone auth reCAPTCHA configuration (INSERTED - fixed app crash)
- [x] 06-03: AuthContext phone auth integration (state management, navigation)

**Details:**

- Installed @react-native-firebase/app and @react-native-firebase/auth (v23.8.0)
- Created phoneAuthService.js with 7 exported functions
- Created PhoneInputScreen with 15-country picker modal
- Created VerificationScreen with auto-submit and 60s resend timer
- Fixed reCAPTCHA configuration with REVERSED_CLIENT_ID URL scheme
- Integrated native Firestore for user document operations (SDK auth state isolation)

### Phase 7: Legacy Auth Removal & Cleanup

**Goal**: Remove email/password and Apple Sign-In flows, update AuthContext for phone-only auth
**Depends on**: Phase 6
**Plans**: 1 plan

Plans:

- [x] 07-01: Legacy auth removal (email/Apple auth, screens, authService.js)

**Details:**

- Removed 973 lines of legacy authentication code
- Deleted LoginScreen.js, SignUpScreen.js, ForgotPasswordScreen.js
- Deleted authService.js entirely
- Removed Firebase JS SDK auth initialization
- Simplified AppNavigator to phone-only auth flow

### Phase 8: Polish & Testing

**Goal**: Error handling, edge cases, phone number formatting, and visual polish
**Depends on**: Phase 7
**Plans**: 3 plans

Plans:

- [x] 08-01: Phone auth cleanup & error boundaries
- [x] 08-02: Phone auth UX polish (formatting, error messages)
- [x] 08-03: App icon and splash screen assets

**Details:**

- Created ErrorBoundary component for crash resilience
- Added phoneUtils.js with AsYouType formatting
- Implemented shake animations for validation errors
- Added 3-second retry delay after verification errors
- Created minimalist "L" app icon (1024x1024)
- Created LAPSE splash screen (1284x2778)
- Added generation scripts for reproducible asset updates

---

## Milestone Summary

**Decimal Phases:**

- Phase 6-FIX: Phone Auth reCAPTCHA Configuration (inserted after 06-02 for app crash fix)

**Key Decisions:**

| Decision                                       | Rationale                                                       |
| ---------------------------------------------- | --------------------------------------------------------------- |
| React Native Firebase for phone auth           | JS SDK cannot support silent APNs verification                  |
| libphonenumber-js for validation               | Lightweight, can enhance UI later                               |
| Manual country picker (15 countries)           | Simpler implementation, covers common cases                     |
| Auto-submit on 6 digits                        | Better UX - no need to press verify button                      |
| reCAPTCHA fallback over APNs                   | Simpler than configuring APNs certificates                      |
| RN Firebase Firestore for phone auth users     | JS SDK Firestore doesn't share auth state with RN Firebase Auth |
| Full deletion of authService.js                | All email auth removed; cleaner codebase                        |
| ErrorBoundary inside NavigationContainer       | Catches UI errors while allowing auth state listeners           |
| AsYouType formatter for phone input            | Better UX without blocking input                                |
| 3-second retry delay after verification errors | Prevents rapid retry spam                                       |
| Minimalist L letterform for app icon           | Matches Lapse brand aesthetic                                   |
| Sharp library for icon generation              | Reproducible assets                                             |

**Issues Resolved:**

- UAT-001: Phone auth crashes app (reCAPTCHA URL scheme missing) - Fixed in 06-FIX
- New phone auth users bypassing ProfileSetup (navigation condition) - Fixed in 06-03
- Firestore permission errors (SDK auth state isolation) - Fixed in 06-03

**Issues Deferred:**

- None

**Technical Debt Incurred:**

- RN Firebase v23 uses deprecated namespaced API (warnings only, functional)
- Consider migrating to modular API in future milestone

---

_For current project status, see .planning/ROADMAP.md_
