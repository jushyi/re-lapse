# Roadmap: Camera/Darkroom UX Refactor

## Overview

This roadmap transforms the Camera and Darkroom experience from two separate tabs into a unified, native-feeling iOS interface. Starting with navigation restructuring, we'll progressively add the darkroom button, implement press-and-hold reveals with haptic feedback, replace buttons with iOS Mail-style swipe gestures, add celebratory success moments, and polish the visual design system across all camera controls.

## Milestones

- âœ… **v1.1 Camera/Darkroom UX Refactor** - [archive](milestones/v1.1-ROADMAP.md) (Phases 1-5, shipped 2026-01-12)
- âœ… **v1.2 Phone Authentication** - [archive](milestones/v1.2-ROADMAP.md) (Phases 6-8, shipped 2026-01-19)
- âœ… **v1.3 Firebase SDK Consolidation** - [archive](milestones/v1.3-ROADMAP.md) (Phases 9-10, shipped 2026-01-19)
- âœ… **v1.4 Production Ready** - [archive](milestones/v1.4-ROADMAP.md) (Phases 11-14, shipped 2026-01-20)
- âœ… **v1.5 Camera Performance & UX Polish** - [archive](milestones/v1.5-ROADMAP.md) (Phases 15-18.6, shipped 2026-01-23)
- ðŸš§ **v1.6 Code Quality, Security & Documentation** - Phases 19-29 (in progress)

## Completed Milestones

<details>
<summary>âœ… v1.5 Camera Performance & UX Polish (Phases 15-18.6) - SHIPPED 2026-01-23</summary>

- [x] Phase 15: Background Photo Upload (1/1 plan) - completed 2026-01-20
- [x] Phase 15.1: Darkroom Notification Fix (1/1 plan) - completed 2026-01-21
- [x] Phase 15.2: Camera UI & Darkroom Animation Overhaul (3/3 plans) - completed 2026-01-21
- [x] Phase 15.3: ISS-001 - Add True 0.5x Ultra-Wide Zoom (1/1 plan) - completed 2026-01-21
- [x] Phase 16: Camera Capture Feedback (1/1 plan) - completed 2026-01-21
- [x] Phase 16.1: UI Overhaul for Darkroom Bottom Sheet (1/1 plan) - completed 2026-01-21
- [x] Phase 16.2: Fix 0.5x Ultra-Wide Zoom (1/1 plan) - completed 2026-01-21
- [x] Phase 16.3: Fix React Native Firebase Warnings (1/1 plan) - completed 2026-01-21
- [x] Phase 17: Darkroom UX Polish (2/2 plans + fixes) - completed 2026-01-22
- [x] Phase 17.1: Darkroom Animation Refinements (1/1 plan + fixes) - completed 2026-01-22
- [x] Phase 17.2: Reveal Timing 0-5 Minutes (1/1 plan) - completed 2026-01-22
- [x] Phase 18: Reaction Notification Debouncing (2/2 plans + fix) - completed 2026-01-22
- [x] Phase 18.1: Batched Darkroom Triage with Undo (2/2 plans + 6 fixes) - completed 2026-01-23
- [x] Phase 18.2: Success Sound Effect on Triage Completion (1/1 plan) - completed 2026-01-23
- [x] Phase 18.3: Triage Animation Z-Index & Delete Suction (1/1 plan) - completed 2026-01-23
- [x] Phase 18.4: Triage Animation Arc Adjustment (1/1 plan) - completed 2026-01-23
- [x] Phase 18.5: Camera Default Launch Screen (1/1 plan) - completed 2026-01-23
- [x] Phase 18.6: Triage Animation Timing Optimization (1/1 plan) - completed 2026-01-23

**Stats:** 22 phases, 37 plans, 5.8 hours execution time
**See:** [Full archive](milestones/v1.5-ROADMAP.md)

</details>

<details>
<summary>âœ… v1.4 Production Ready (Phases 11-14) - SHIPPED 2026-01-20</summary>

- [x] Phase 11: Firebase Modular API Migration (4/4 plans) - completed 2026-01-19
- [x] Phase 12: Friendship Service Fix + Testing (1/1 plan) - completed 2026-01-19
- [x] Phase 12.1: Friends List Screen Crash Fix (1/1 plan + fixes) - completed 2026-01-20
- [x] Phase 12.2: Feed Stories Feature (4/4 plans) - completed 2026-01-20
- [x] Phase 13: Production Build & Branding (3/3 plans) - completed 2026-01-20
- [x] Phase 13.1: Darkroom Reveal Timing Fix (1/1 plan) - completed 2026-01-20
- [x] Phase 13.2: Darkroom Auto-Reveal Fix (1/1 plan + fix) - completed 2026-01-20
- [x] Phase 14: Remote Notification Testing & Polish (1/1 plan) - completed 2026-01-20

**Stats:** 8 phases, 17 plans, 1.4 hours execution time
**See:** [Full archive](milestones/v1.4-ROADMAP.md)

</details>

<details>
<summary>âœ… v1.3 Firebase SDK Consolidation (Phases 9-10) - SHIPPED 2026-01-19</summary>

- [x] Phase 9: Firestore Services Migration (2/2 plans) - completed 2026-01-19
- [x] Phase 10: Storage Migration & Cleanup (2/2 plans) - completed 2026-01-19

**Stats:** 2 phases, 4 plans, 42 min execution time
**See:** [Full archive](milestones/v1.3-ROADMAP.md)

</details>

<details>
<summary>âœ… v1.2 Phone Authentication (Phases 6-8) - SHIPPED 2026-01-19</summary>

- [x] Phase 6: Phone Auth Implementation (4/4 plans) - completed 2026-01-19
- [x] Phase 7: Legacy Auth Removal & Cleanup (1/1 plan) - completed 2026-01-19
- [x] Phase 8: Polish & Testing (3/3 plans) - completed 2026-01-19

**Stats:** 3 phases, 8 plans, 2.1 hours execution time
**See:** [Full archive](milestones/v1.2-ROADMAP.md)

</details>

<details>
<summary>âœ… v1.1 Camera/Darkroom UX Refactor (Phases 1-5) - SHIPPED 2026-01-12</summary>

- [x] Phase 1: Navigation Restructure (1/1 plans) - completed 2026-01-12
- [x] Phase 2: Darkroom Bottom Sheet (2/2 plans) - completed 2026-01-12
- [x] Phase 3: Swipe Gesture Triage (2/2 plans) - completed 2026-01-12
- [x] Phase 4: Success & Return Flow (2/2 plans) - completed 2026-01-13
- [x] Phase 5: Camera Icon Redesign (1/1 plan) - completed 2026-01-13

**Stats:** 5 phases, 8 plans, 4.3 hours execution time
**See:** [Full archive](milestones/v1.1-ROADMAP.md)

</details>

## Progress

| Phase                                          | Milestone | Plans Complete | Status   | Completed  |
| ---------------------------------------------- | --------- | -------------- | -------- | ---------- |
| 1. Navigation Restructure                      | v1.1      | 1/1            | Complete | 2026-01-12 |
| 2. Darkroom Bottom Sheet                       | v1.1      | 2/2            | Complete | 2026-01-12 |
| 3. Swipe Gesture Triage                        | v1.1      | 2/2            | Complete | 2026-01-12 |
| 4. Success & Return Flow                       | v1.1      | 2/2            | Complete | 2026-01-13 |
| 5. Camera Icon Redesign                        | v1.1      | 1/1            | Complete | 2026-01-13 |
| 6. Phone Auth Implementation                   | v1.2      | 4/4            | Complete | 2026-01-19 |
| 7. Legacy Auth Removal & Cleanup               | v1.2      | 1/1            | Complete | 2026-01-19 |
| 8. Polish & Testing                            | v1.2      | 3/3            | Complete | 2026-01-19 |
| 9. Firestore Services Migration                | v1.3      | 2/2            | Complete | 2026-01-19 |
| 10. Storage Migration & Cleanup                | v1.3      | 2/2            | Complete | 2026-01-19 |
| 11. Firebase Modular API Migration             | v1.4      | 4/4            | Complete | 2026-01-19 |
| 12. Friendship Service Fix + Testing           | v1.4      | 1/1            | Complete | 2026-01-19 |
| 12.1 Friends List Screen Crash Fix             | v1.4      | 1/1            | Complete | 2026-01-19 |
| 12.2 Feed Stories Feature                      | v1.4      | 4/4            | Complete | 2026-01-20 |
| 13. Production Build & Branding                | v1.4      | 3/3            | Complete | 2026-01-20 |
| 13.1 Darkroom Reveal Timing Fix                | v1.4      | 1/1            | Complete | 2026-01-20 |
| 13.2 Darkroom Auto-Reveal Fix                  | v1.4      | 1/1            | Complete | 2026-01-20 |
| 14. Remote Notification Testing & Polish       | v1.4      | 1/1            | Complete | 2026-01-20 |
| 15. Background Photo Upload                    | v1.5      | 1/1            | Complete | 2026-01-20 |
| 15.1 Darkroom Notification Fix                 | v1.5      | 1/1            | Complete | 2026-01-21 |
| 15.2 Camera UI & Darkroom Animation Overhaul   | v1.5      | 3/3            | Complete | 2026-01-21 |
| 15.3 ISS-001 - Add True 0.5x Ultra-Wide Zoom   | v1.5      | 1/1            | Complete | 2026-01-21 |
| 16. Camera Capture Feedback                    | v1.5      | 1/1            | Complete | 2026-01-21 |
| 16.1 UI Overhaul for Darkroom Bottom Sheet     | v1.5      | 1/1            | Complete | 2026-01-21 |
| 16.2 Fix 0.5x Ultra-Wide Zoom                  | v1.5      | 1/1            | Complete | 2026-01-21 |
| 16.3 Fix React Native Firebase Warnings        | v1.5      | 1/1            | Complete | 2026-01-21 |
| 17. Darkroom UX Polish                         | v1.5      | 2/2            | Complete | 2026-01-22 |
| 17.1 Darkroom Animation Refinements            | v1.5      | 1/1            | Complete | 2026-01-22 |
| 17.2 Reveal Timing 0-5 Minutes                 | v1.5      | 1/1            | Complete | 2026-01-22 |
| 18. Reaction Notification Debouncing           | v1.5      | 2/2 + FIX      | Complete | 2026-01-22 |
| 18.1 Batched Darkroom Triage with Undo         | v1.5      | 2/2 + 6 FIX    | Complete | 2026-01-23 |
| 18.2 Success Sound Effect on Triage Completion | v1.5      | 1/1            | Complete | 2026-01-23 |
| 18.3 Triage Animation Z-Index & Delete Suction | v1.5      | 1/1            | Complete | 2026-01-23 |
| 18.4 Triage Animation Arc Adjustment           | v1.5      | 1/1            | Complete | 2026-01-23 |
| 18.5 Camera Default Launch Screen              | v1.5      | 1/1            | Complete | 2026-01-23 |
| 18.6 Triage Animation Timing Optimization      | v1.5      | 1/1            | Complete | 2026-01-23 |

### ðŸš§ v1.6 Code Quality, Security & Documentation (In Progress)

**Milestone Goal:** Comprehensive codebase cleanup, security hardening, and documentation for maintainability and contributor onboarding

**Constraints:**

- No breaking changes - all external behavior must stay identical
- No functional changes - everything works exactly as it does now
- No visual changes - UI/UX must remain the same

#### Phase 19: Linting and Prettier Setup

**Goal**: Configure ESLint, Prettier, husky pre-commit hooks, and format all existing files
**Depends on**: Previous milestone complete
**Research**: Unlikely (established patterns)
**Plans**: 2
**Status**: Complete

Plans:

- [x] 19-01: Tooling Infrastructure (ESLint, Prettier, Husky, lint-staged) - completed 2026-01-23
- [x] 19-02: Codebase Formatting - completed 2026-01-23

#### Phase 20: Debug Cleanup

**Goal**: Remove all console.log/console.error statements, replace with logger utility
**Depends on**: Phase 19
**Research**: Unlikely (internal patterns)
**Plans**: 1
**Status**: Complete

Plans:

- [x] 20-01: Cloud Functions Logger Utility - completed 2026-01-23

#### Phase 21: Global Constants and Design System

**Goal**: Extract and centralize colors, typography, spacing, layout, timing, and config values into src/constants/
**Depends on**: Phase 20
**Research**: Unlikely (internal patterns)
**Plans**: 1
**Status**: Complete

Plans:

- [x] 21-01: Design System Constants Infrastructure - completed 2026-01-23

#### Phase 21.1: API Key Exposure Remediation (INSERTED)

**Goal**: Remove exposed GoogleService-Info.plist from git history and prevent future exposure
**Depends on**: Phase 21
**Research**: Complete
**Plans**: 1
**Status**: Complete
**Priority**: URGENT - Security incident response

Plans:

- [x] 21.1-01: API Key Exposure Remediation - completed 2026-01-24

#### Phase 21.2: EAS Secure Google Services File (INSERTED)

**Goal**: Configure EAS file environment variables to securely pass GoogleService-Info.plist to builds without checking into version control
**Depends on**: Phase 21.1
**Research**: Complete
**Plans**: 1
**Status**: Complete
**Priority**: HIGH - Required for successful EAS builds

Plans:

- [x] 21.2-01: EAS file environment variable and dynamic app.config.js - completed 2026-01-24

#### Phase 21.3: App Crashes When Inputting Phone Number (INSERTED)

**Goal**: Fix crash that occurs when user inputs phone number
**Depends on**: Phase 21.2
**Research**: Complete
**Plans**: 1
**Status**: Complete
**Priority**: URGENT - User-facing crash

Plans:

- [x] 21.3-01: Phone crash fix via PhoneAuthContext - completed 2026-01-24

#### Phase 22: Environment and Configuration

**Goal**: Create .env.example template and prepare for security audit
**Depends on**: Phase 21.3
**Research**: Unlikely (established patterns)
**Plans**: 1
**Status**: Complete

Plans:

- [x] 22-01: Security audit, .env.example, and secret detection pre-commit hook - completed 2026-01-24

#### Phase 23: Firestore Security Rules Audit

**Goal**: Audit and harden Firestore security rules
**Depends on**: Phase 22
**Research**: Complete
**Plans**: 1
**Status**: Complete

Plans:

- [x] 23-01: Security hardening (self-reaction prevention, immutable fields, tightened updates) - completed 2026-01-24

#### Phase 24: Cloud Functions Validation and Security

**Goal**: Add input validation and security hardening to Cloud Functions
**Depends on**: Phase 23
**Research**: Complete
**Plans**: 1
**Status**: Complete

Plans:

- [x] 24-01: Zod validation schemas and entry-point guards - completed 2026-01-24

#### Phase 25: Authentication and Data Security

**Goal**: Implement SecureStore for sensitive data, signed URLs for photos, secure logout
**Depends on**: Phase 24
**Research**: Complete
**Plans**: 2
**Status**: Complete

Plans:

- [x] 25-01: SecureStore service and comprehensive secure logout - completed 2026-01-25
- [x] 25-02: Signed Photo URLs Cloud Function and client service - completed 2026-01-25

#### Phase 26: Privacy Features

**Goal**: Add privacy policy screen, terms of service screen, and account deletion feature
**Depends on**: Phase 25
**Research**: Complete
**Plans**: 2
**Status**: Complete

Plans:

- [x] 26-01: Settings screen and legal content screens - completed 2026-01-25
- [x] 26-02: Account deletion flow with re-authentication - completed 2026-01-25

#### Phase 27: Test Suite Setup

**Goal**: Configure Jest with mocks, write tests for auth, photo lifecycle, friendships, reactions
**Depends on**: Phase 26
**Research**: Complete
**Plans**: 4
**Status**: Complete

Plans:

- [x] 27-01: Jest test infrastructure and Firebase mocking - completed 2026-01-25
- [x] 27-02: Unit tests for core services (phoneAuthService, photoService, darkroomService) - completed 2026-01-25
- [x] 27-03: Unit tests for social features (friendshipService, feedService) - completed 2026-01-25
- [x] 27-04: Integration tests for photo lifecycle and friendship flows - completed 2026-01-25

#### Phase 28: Code Refactoring

**Goal**: Extract large components (SwipeablePhotoCard, CameraScreen, DarkroomScreen) into custom hooks
**Depends on**: Phase 27 (tests written first)
**Research**: Unlikely (internal patterns)
**Plans**: 4
**Status**: Complete

Plans:

- [x] 28-01: Infrastructure + SwipeablePhotoCard refactoring - completed 2026-01-25
- [x] 28-02: CameraScreen refactoring - completed 2026-01-25
- [x] 28-03: DarkroomScreen refactoring - completed 2026-01-25
- [x] 28-04: FeedPhotoCard + PhotoDetailModal refactoring - completed 2026-01-25

#### Phase 28.1: Fix Photo Upload Permission Denied (INSERTED)

**Goal**: Fix Firestore permission-denied error when updating photo document after Storage upload
**Depends on**: Phase 28
**Research**: Complete (logs show UploadQueueService can upload to Storage but fails to update Firestore document)
**Plans**: 1
**Status**: Complete
**Priority**: URGENT - Photos not saving properly

**Root Cause Analysis:**

- Storage upload succeeds: `StorageService.uploadPhoto: Upload successful`
- Firestore update fails: `[firestore/permission-denied] The caller does not have permission to execute the specified operation`
- The UploadQueueService creates a placeholder document, uploads to Storage, then tries to update the document with the URL
- Security rules were blocking the update operation (immutablePhotoFieldsUnchanged required imageURL to be unchanged)

**Fix Applied:**

- Modified `immutablePhotoFieldsUnchanged()` to allow imageURL to change from empty to non-empty (initial set)
- imageURL still protected once set (prevents tampering)

Plans:

- [x] 28.1-01: Fix Firestore security rules for photo document updates - completed 2026-01-25

#### Phase 29: Documentation

**Goal**: JSDoc on all services, document complex animation logic, update README, create CONTRIBUTING.md
**Depends on**: Phase 28
**Research**: Unlikely (established patterns)
**Plans**: 1
**Status**: Complete

Plans:

- [x] 29-01: Project documentation (README.md, CONTRIBUTING.md) - completed 2026-01-25

---

| 19. Linting and Prettier Setup | v1.6 | 2/2 | Complete | 2026-01-23 |
| 20. Debug Cleanup | v1.6 | 1/1 | Complete | 2026-01-23 |
| 21. Global Constants and Design System | v1.6 | 1/1 | Complete | 2026-01-23 |
| 21.1 API Key Exposure Remediation | v1.6 | 1/1 | Complete | 2026-01-24 |
| 21.2 EAS Secure Google Services File | v1.6 | 1/1 | Complete | 2026-01-24 |
| 21.3 App Crashes When Inputting Phone Number | v1.6 | 1/1 | Complete | 2026-01-24 |
| 22. Environment and Configuration | v1.6 | 1/1 | Complete | 2026-01-24 |
| 23. Firestore Security Rules Audit | v1.6 | 1/1 | Complete | 2026-01-24 |
| 24. Cloud Functions Validation | v1.6 | 1/1 | Complete | 2026-01-24 |
| 25. Authentication and Data Security | v1.6 | 2/2 | Complete | 2026-01-25 |
| 26. Privacy Features | v1.6 | 2/2 | Complete | 2026-01-25 |
| 27. Test Suite Setup | v1.6 | 4/4 | Complete | 2026-01-25 |
| 28. Code Refactoring | v1.6 | 4/4 | Complete | 2026-01-25 |
| 28.1 Fix Photo Upload Permission Denied | v1.6 | 1/1 | Complete | 2026-01-25 |
| 29. Documentation | v1.6 | 1/1 | Complete | 2026-01-25 |
